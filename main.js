/*! For license information please see main.js.LICENSE.txt */
(()=>{var t,e,r={924:(t,e,r)=>{"use strict";var n=r(210),i=r(559),s=i(n("String.prototype.indexOf"));t.exports=function(t,e){var r=n(t,!!e);return"function"==typeof r&&s(t,".prototype.")>-1?i(r):r}},559:(t,e,r)=>{"use strict";var n=r(612),i=r(210),s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||n.call(o,s),l=i("%Object.getOwnPropertyDescriptor%",!0),h=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(h)try{h({},"a",{value:1})}catch(d){h=null}t.exports=function(t){var e=a(n,o,arguments);l&&h&&(l(e,"length").configurable&&h(e,"length",{value:1+u(0,t.length-(arguments.length-1))}));return e};var c=function(){return a(n,s,arguments)};h?h(t.exports,"apply",{value:c}):t.exports.apply=c},187:t=>{"use strict";function e(t,e,n){n=n||2;var s,o,a,l,c,d,p,m=e&&e.length,g=m?e[0]*n:t.length,_=r(t,0,g,n,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(t,e,n,i){var s,o,a,l=[];for(s=0,o=e.length;s<o;s++)(a=r(t,e[s]*i,s<o-1?e[s+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),l.push(f(a));for(l.sort(h),s=0;s<l.length;s++)n=u(l[s],n);return n}(t,e,_,n)),t.length>80*n){s=a=t[0],o=l=t[1];for(var v=n;v<g;v+=n)(c=t[v])<s&&(s=c),(d=t[v+1])<o&&(o=d),c>a&&(a=c),d>l&&(l=d);p=0!==(p=Math.max(a-s,l-o))?32767/p:0}return i(_,y,n,s,o,p,0),y}function r(t,e,r,n,i){var s,o;if(i===S(t,e,r,n)>0)for(s=e;s<r;s+=n)o=T(s,t[s],t[s+1],o);else for(s=r-n;s>=e;s-=n)o=T(s,t[s],t[s+1],o);return o&&_(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!_(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(A(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function i(t,e,r,h,u,c,f){if(t){!f&&c&&function(t,e,r,n){var i=t;do{0===i.z&&(i.z=d(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,s,o,a,l,h=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,n=r,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}s.nextZ=null,h*=2}while(o>1)}(i)}(t,h,u,c);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,c?o(t,h,u,c):s(t))e.push(p.i/r|0),e.push(t.i/r|0),e.push(m.i/r|0),A(t),t=m.next,g=m.next;else if((t=m)===g){f?1===f?i(t=a(n(t),e,r),e,r,h,u,c,2):2===f&&l(t,e,r,h,u,c):i(n(t),e,r,h,u,c,1);break}}}function s(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=e.x,s=r.x,o=n.x,a=e.y,l=r.y,h=n.y,u=i<s?i<o?i:o:s<o?s:o,c=a<l?a<h?a:h:l<h?l:h,d=i>s?i>o?i:o:s>o?s:o,f=a>l?a>h?a:h:l>h?l:h,m=n.next;m!==e;){if(m.x>=u&&m.x<=d&&m.y>=c&&m.y<=f&&p(i,a,s,l,o,h,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function o(t,e,r,n){var i=t.prev,s=t,o=t.next;if(g(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,h=o.x,u=i.y,c=s.y,f=o.y,m=a<l?a<h?a:h:l<h?l:h,_=u<c?u<f?u:f:c<f?c:f,y=a>l?a>h?a:h:l>h?l:h,v=u>c?u>f?u:f:c>f?c:f,x=d(m,_,e,r,n),b=d(y,v,e,r,n),E=t.prevZ,T=t.nextZ;E&&E.z>=x&&T&&T.z<=b;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==i&&E!==o&&p(a,u,l,c,h,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,T.x>=m&&T.x<=y&&T.y>=_&&T.y<=v&&T!==i&&T!==o&&p(a,u,l,c,h,f,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;E&&E.z>=x;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==i&&E!==o&&p(a,u,l,c,h,f,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;T&&T.z<=b;){if(T.x>=m&&T.x<=y&&T.y>=_&&T.y<=v&&T!==i&&T!==o&&p(a,u,l,c,h,f,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function a(t,e,r){var i=t;do{var s=i.prev,o=i.next.next;!_(s,o)&&y(s,i,i.next,o)&&b(s,o)&&b(o,s)&&(e.push(s.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),A(i),A(i.next),i=t=o),i=i.next}while(i!==t);return n(i)}function l(t,e,r,s,o,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&m(l,h)){var u=E(l,h);return l=n(l,l.next),u=n(u,u.next),i(l,e,r,s,o,a,0),void i(u,e,r,s,o,a,0)}h=h.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function u(t,e){var r=function(t,e){var r,n=e,i=t.x,s=t.y,o=-Infinity;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>o&&(o=a,r=n.x<n.next.x?n:n.next,a===i))return r}n=n.next}while(n!==e);if(!r)return null;var l,h=r,u=r.x,d=r.y,f=Infinity;n=r;do{i>=n.x&&n.x>=u&&i!==n.x&&p(s<d?i:o,s,u,d,s<d?o:i,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(i-n.x),b(n,t)&&(l<f||l===f&&(n.x>r.x||n.x===r.x&&c(r,n)))&&(r=n,f=l)),n=n.next}while(n!==h);return r}(t,e);if(!r)return e;var i=E(r,t);return n(i,i.next),n(r,r.next)}function c(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function p(t,e,r,n,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&y(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||_(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,r,n){var i=x(g(t,e,r)),s=x(g(t,e,n)),o=x(g(r,n,t)),a=x(g(r,n,e));return i!==s&&o!==a||(!(0!==i||!v(t,r,e))||(!(0!==s||!v(t,n,e))||(!(0!==o||!v(r,t,n))||!(0!==a||!v(r,e,n)))))}function v(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function E(t,e){var r=new w(t.i,t.x,t.y),n=new w(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function T(t,e,r,n){var i=new w(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function w(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,e,r,n){for(var i=0,s=e,o=r-n;s<r;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}t.exports=e,t.exports["default"]=e,e.deviation=function(t,e,r,n){var i=e&&e.length,s=i?e[0]*r:t.length,o=Math.abs(S(t,0,s,r));if(i)for(var a=0,l=e.length;a<l;a++){var h=e[a]*r,u=a<l-1?e[a+1]*r:t.length;o-=Math.abs(S(t,h,u,r))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*r,f=n[a+1]*r,p=n[a+2]*r;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},e.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[i][s][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||t,o),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,i,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var l,h,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,undefined,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,s),!0;case 6:return u.fn.call(u.context,e,n,i,s,o),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d,f=u.length;for(h=0;h<f;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,undefined,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,n);break;case 4:u[h].fn.call(u[h].context,e,n,i);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u[h].fn.apply(u[h].context,l)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,i){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var l=0,h=[],u=a.length;l<u;l++)(a[l].fn!==e||i&&!a[l].once||n&&a[l].context!==n)&&h.push(a[l]);h.length?this._events[s]=1===h.length?h[0]:h:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},648:t=>{"use strict";var e=Array.prototype.slice,r=Object.prototype.toString;t.exports=function(t){var n=this;if("function"!=typeof n||"[object Function]"!==r.call(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var i,s=e.call(arguments,1),o=Math.max(0,n.length-s.length),a=[],l=0;l<o;l++)a.push("$"+l);if(i=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var r=n.apply(this,s.concat(e.call(arguments)));return Object(r)===r?r:this}return n.apply(t,s.concat(e.call(arguments)))})),n.prototype){var h=function(){};h.prototype=n.prototype,i.prototype=new h,h.prototype=null}return i}},612:(t,e,r)=>{"use strict";var n=r(648);t.exports=Function.prototype.bind||n},210:(t,e,r)=>{"use strict";var n,i=SyntaxError,s=Function,o=TypeError,a=function(t){try{return s('"use strict"; return ('+t+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(P){l=null}var h=function(){throw new o},u=l?function(){try{return h}catch(t){try{return l(arguments,"callee").get}catch(e){return h}}}():h,c=r(405)(),d=r(185)(),f=Object.getPrototypeOf||(d?function(t){return t.__proto__}:null),p={},m="undefined"!=typeof Uint8Array&&f?f(Uint8Array):n,g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":c&&f?f([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":c&&f?f(f([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&c&&f?f((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&c&&f?f((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":c&&f?f(""[Symbol.iterator]()):n,"%Symbol%":c?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(f)try{null.error}catch(P){var _=f(f(P));g["%Error.prototype%"]=_}var y=function M(t){var e;if("%AsyncFunction%"===t)e=a("async function () {}");else if("%GeneratorFunction%"===t)e=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)e=a("async function* () {}");else if("%AsyncGenerator%"===t){var r=M("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var n=M("%AsyncGenerator%");n&&f&&(e=f(n.prototype))}return g[t]=e,e},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},x=r(612),b=r(642),E=x.call(Function.call,Array.prototype.concat),T=x.call(Function.apply,Array.prototype.splice),A=x.call(Function.call,String.prototype.replace),w=x.call(Function.call,String.prototype.slice),S=x.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,R=/\\(\\)?/g,I=function(t,e){var r,n=t;if(b(v,n)&&(n="%"+(r=v[n])[0]+"%"),b(g,n)){var s=g[n];if(s===p&&(s=y(n)),void 0===s&&!e)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:s}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new o('"allowMissing" argument must be a boolean');if(null===S(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=w(t,0,1),r=w(t,-1);if("%"===e&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return A(t,C,(function(t,e,r,i){n[n.length]=r?A(i,R,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",s=I("%"+n+"%",e),a=s.name,h=s.value,u=!1,c=s.alias;c&&(n=c[0],T(r,E([0,1],c)));for(var d=1,f=!0;d<r.length;d+=1){var p=r[d],m=w(p,0,1),_=w(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===_||"'"===_||"`"===_)&&m!==_)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&f||(u=!0),b(g,a="%"+(n+="."+p)+"%"))h=g[a];else if(null!=h){if(!(p in h)){if(!e)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(l&&d+1>=r.length){var y=l(h,p);h=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:h[p]}else f=b(h,p),h=h[p];f&&!u&&(g[a]=h)}}return h}},185:t=>{"use strict";var e={foo:{}},r=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!({__proto__:null}instanceof r)}},405:(t,e,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(419);t.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},642:(t,e,r)=>{"use strict";var n=r(612);t.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},483:(t,e,r)=>{t.exports=function n(t,e,r){function i(o,a){if(!e[o]){if(!t[o]){var l=undefined;if(!a&&l)return require(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=e[o]={exports:{}};t[o][0].call(u.exports,(function(e){var r=t[o][1][e];return i(r||e)}),u,u.exports,n,t,e,r)}return e[o].exports}for(var s=undefined,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e,n){(function(t){"use strict";var r,n,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var s=0,o=new i(u),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),r=function(){a.data=s=++s%2}}else if(t.setImmediate||"undefined"==typeof t.MessageChannel)r="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var h=[];function u(){var t,e;n=!0;for(var r=h.length;r;){for(e=h,h=[],t=-1;++t<r;)e[t]();r=h.length}n=!1}function c(t){1!==h.push(t)||n||r()}e.exports=c}).call(this,"undefined"!=typeof r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,r){"use strict";var n=t(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==i&&f(this,t)}function u(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function c(t,e,r){n((function(){var n;try{n=e(r)}catch(i){return s.reject(t,i)}n===t?s.reject(t,new TypeError("Cannot resolve promise with itself")):s.resolve(t,n)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var r=!1;function n(e){r||(r=!0,s.reject(t,e))}function i(e){r||(r=!0,s.resolve(t,e))}function o(){e(i,n)}var a=p(o);"error"===a.status&&n(a.value)}function p(t,e){var r={};try{r.value=t(e),r.status="success"}catch(n){r.status="error",r.value=n}return r}function m(t){return t instanceof this?t:s.resolve(new this(i),t)}function g(t){var e=new this(i);return s.reject(e,t)}function _(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);for(var o=new Array(r),a=0,l=-1,h=new this(i);++l<r;)u(t[l],l);return h;function u(t,i){function l(t){o[i]=t,++a!==r||n||(n=!0,s.resolve(h,o))}e.resolve(t).then(l,(function(t){n||(n=!0,s.reject(h,t))}))}}function y(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);for(var o=-1,a=new this(i);++o<r;)l(t[o]);return a;function l(t){e.resolve(t).then((function(t){n||(n=!0,s.resolve(a,t))}),(function(t){n||(n=!0,s.reject(a,t))}))}}e.exports=h,h.prototype["catch"]=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var r=new this.constructor(i);return this.state!==l?c(r,this.state===a?t:e,this.outcome):this.queue.push(new u(r,t,e)),r},u.prototype.callFulfilled=function(t){s.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){s.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},s.resolve=function(t,e){var r=p(d,e);if("error"===r.status)return s.reject(t,r.value);var n=r.value;if(n)f(t,n);else{t.state=a,t.outcome=e;for(var i=-1,o=t.queue.length;++i<o;)t.queue[i].callFulfilled(e)}return t},s.reject=function(t,e){t.state=o,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},h.resolve=m,h.reject=g,h.all=_,h.race=y},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}var o=s();function a(){try{if(!o||!o.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(r){return!1}}function l(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)r.append(t[n]);return r.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var h=Promise;function u(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function c(t,e,r){"function"==typeof e&&t.then(e),"function"==typeof r&&t["catch"](r)}function d(t){return"string"!=typeof t&&(t=String(t)),t}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",m=void 0,g={},_=Object.prototype.toString,y="readonly",v="readwrite";function x(t){for(var e=t.length,r=new ArrayBuffer(e),n=new Uint8Array(r),i=0;i<e;i++)n[i]=t.charCodeAt(i);return r}function b(t){return new h((function(e){var r=t.transaction(p,v),n=l([""]);r.objectStore(p).put(n,"key"),r.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},r.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);e(r||!t||parseInt(t[1],10)>=43)}}))["catch"]((function(){return!1}))}function E(t){return"boolean"==typeof m?h.resolve(m):b(t).then((function(t){return m=t}))}function T(t){var e=g[t.name],r={};r.promise=new h((function(t,e){r.resolve=t,r.reject=e})),e.deferredOperations.push(r),e.dbReady?e.dbReady=e.dbReady.then((function(){return r.promise})):e.dbReady=r.promise}function A(t){var e=g[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function w(t,e){var r=g[t.name].deferredOperations.pop();if(r)return r.reject(e),r.promise}function S(t,e){return new h((function(r,n){if(g[t.name]=g[t.name]||L(),t.db){if(!e)return r(t.db);T(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var s=o.open.apply(o,i);e&&(s.onupgradeneeded=function(e){var r=s.result;try{r.createObjectStore(t.storeName),e.oldVersion<=1&&r.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n}}),s.onerror=function(t){t.preventDefault(),n(s.error)},s.onsuccess=function(){var e=s.result;e.onversionchange=function(t){t.target.close()},r(e),A(t)}}))}function C(t){return S(t,!1)}function R(t){return S(t,!0)}function I(t,e){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,i=t.version>t.db.version;if(n&&(t.version,t.version=t.db.version),i||r){if(r){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}function P(t){return new h((function(e,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:t.type})},n.readAsBinaryString(t)}))}function M(t){return l([x(atob(t.data))],{type:t.type})}function O(t){return t&&t.__local_forage_encoded_blob}function D(t){var e=this,r=e._initReady().then((function(){var t=g[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return c(r,t,t),r}function N(t){T(t);for(var e=g[t.name],r=e.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return t.db=null,C(t).then((function(e){return t.db=e,I(t)?R(t):e})).then((function(n){t.db=e.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n}))["catch"]((function(e){throw w(t,e),e}))}function F(t,e,r,n){n===undefined&&(n=1);try{var i=t.db.transaction(t.storeName,e);r(null,i)}catch(s){if(n>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return h.resolve().then((function(){if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),R(t)})).then((function(){return N(t).then((function(){F(t,e,r,n-1)}))}))["catch"](r);r(s)}}function L(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function B(t){var e=this,r={db:null};if(t)for(var n in t)r[n]=t[n];var i=g[r.name];i||(i=L(),g[r.name]=i),i.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=D);var s=[];function o(){return h.resolve()}for(var a=0;a<i.forages.length;a++){var l=i.forages[a];l!==e&&s.push(l._initReady()["catch"](o))}var u=i.forages.slice(0);return h.all(s).then((function(){return r.db=i.db,C(r)})).then((function(t){return r.db=t,I(r,e._defaultConfig.version)?R(r):t})).then((function(t){r.db=i.db=t,e._dbInfo=r;for(var n=0;n<u.length;n++){var s=u[n];s!==e&&(s._dbInfo.db=r.db,s._dbInfo.version=r.version)}}))}function k(t,e){var r=this;t=d(t);var n=new h((function(e,n){r.ready().then((function(){F(r._dbInfo,y,(function(i,s){if(i)return n(i);try{var o=s.objectStore(r._dbInfo.storeName).get(t);o.onsuccess=function(){var t=o.result;t===undefined&&(t=null),O(t)&&(t=M(t)),e(t)},o.onerror=function(){n(o.error)}}catch(a){n(a)}}))}))["catch"](n)}));return u(n,e),n}function U(t,e){var r=this,n=new h((function(e,n){r.ready().then((function(){F(r._dbInfo,y,(function(i,s){if(i)return n(i);try{var o=s.objectStore(r._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var r=o.result;if(r){var n=r.value;O(n)&&(n=M(n));var i=t(n,r.key,a++);void 0!==i?e(i):r["continue"]()}else e()},o.onerror=function(){n(o.error)}}catch(l){n(l)}}))}))["catch"](n)}));return u(n,e),n}function G(t,e,r){var n=this;t=d(t);var i=new h((function(r,i){var s;n.ready().then((function(){return s=n._dbInfo,"[object Blob]"===_.call(e)?E(s.db).then((function(t){return t?e:P(e)})):e})).then((function(e){F(n._dbInfo,v,(function(s,o){if(s)return i(s);try{var a=o.objectStore(n._dbInfo.storeName);null===e&&(e=undefined);var l=a.put(e,t);o.oncomplete=function(){e===undefined&&(e=null),r(e)},o.onabort=o.onerror=function(){var t=l.error?l.error:l.transaction.error;i(t)}}catch(h){i(h)}}))}))["catch"](i)}));return u(i,r),i}function j(t,e){var r=this;t=d(t);var n=new h((function(e,n){r.ready().then((function(){F(r._dbInfo,v,(function(i,s){if(i)return n(i);try{var o=s.objectStore(r._dbInfo.storeName)["delete"](t);s.oncomplete=function(){e()},s.onerror=function(){n(o.error)},s.onabort=function(){var t=o.error?o.error:o.transaction.error;n(t)}}catch(a){n(a)}}))}))["catch"](n)}));return u(n,e),n}function V(t){var e=this,r=new h((function(t,r){e.ready().then((function(){F(e._dbInfo,v,(function(n,i){if(n)return r(n);try{var s=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=s.error?s.error:s.transaction.error;r(t)}}catch(o){r(o)}}))}))["catch"](r)}));return u(r,t),r}function H(t){var e=this,r=new h((function(t,r){e.ready().then((function(){F(e._dbInfo,y,(function(n,i){if(n)return r(n);try{var s=i.objectStore(e._dbInfo.storeName).count();s.onsuccess=function(){t(s.result)},s.onerror=function(){r(s.error)}}catch(o){r(o)}}))}))["catch"](r)}));return u(r,t),r}function z(t,e){var r=this,n=new h((function(e,n){t<0?e(null):r.ready().then((function(){F(r._dbInfo,y,(function(i,s){if(i)return n(i);try{var o=s.objectStore(r._dbInfo.storeName),a=!1,l=o.openKeyCursor();l.onsuccess=function(){var r=l.result;r?0===t||a?e(r.key):(a=!0,r.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(h){n(h)}}))}))["catch"](n)}));return u(n,e),n}function W(t){var e=this,r=new h((function(t,r){e.ready().then((function(){F(e._dbInfo,y,(function(n,i){if(n)return r(n);try{var s=i.objectStore(e._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var e=s.result;e?(o.push(e.key),e["continue"]()):t(o)},s.onerror=function(){r(s.error)}}catch(a){r(a)}}))}))["catch"](r)}));return u(r,t),r}function X(t,e){e=f.apply(this,arguments);var r=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||r.name,t.storeName=t.storeName||r.storeName);var n,i=this;if(t.name){var s=t.name===r.name&&i._dbInfo.db?h.resolve(i._dbInfo.db):C(t).then((function(e){var r=g[t.name],n=r.forages;r.db=e;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=e;return e}));n=t.storeName?s.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var r=e.version+1;T(t);var n=g[t.name],i=n.forages;e.close();for(var s=0;s<i.length;s++){var a=i[s];a._dbInfo.db=null,a._dbInfo.version=r}var l=new h((function(e,n){var i=o.open(t.name,r);i.onerror=function(t){i.result.close(),n(t)},i.onupgradeneeded=function(){i.result.deleteObjectStore(t.storeName)},i.onsuccess=function(){var t=i.result;t.close(),e(t)}}));return l.then((function(t){n.db=t;for(var e=0;e<i.length;e++){var r=i[e];r._dbInfo.db=t,A(r._dbInfo)}}))["catch"]((function(e){throw(w(t,e)||h.resolve())["catch"]((function(){})),e}))}})):s.then((function(e){T(t);var r=g[t.name],n=r.forages;e.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;var s=new h((function(e,r){var n=o.deleteDatabase(t.name);n.onerror=function(){var t=n.result;t&&t.close(),r(n.error)},n.onblocked=function(){},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}}));return s.then((function(t){r.db=t;for(var e=0;e<n.length;e++)A(n[e]._dbInfo)}))["catch"]((function(e){throw(w(t,e)||h.resolve())["catch"]((function(){})),e}))}))}else n=h.reject("Invalid arguments");return u(n,e),n}var Y={_driver:"asyncStorage",_initStorage:B,_support:a(),iterate:U,getItem:k,setItem:G,removeItem:j,clear:V,length:H,key:z,keys:W,dropInstance:X};function K(){return"function"==typeof openDatabase}var $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,J="__lfsc__:",Z=J.length,tt="arbf",et="blob",rt="si08",nt="ui08",it="uic8",st="si16",ot="si32",at="ur16",lt="ui32",ht="fl32",ut="fl64",ct=Z+tt.length,dt=Object.prototype.toString;function ft(t){var e,r,n,i,s,o=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var h=new ArrayBuffer(o),u=new Uint8Array(h);for(e=0;e<a;e+=4)r=$.indexOf(t[e]),n=$.indexOf(t[e+1]),i=$.indexOf(t[e+2]),s=$.indexOf(t[e+3]),u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&s;return h}function pt(t){var e,r=new Uint8Array(t),n="";for(e=0;e<r.length;e+=3)n+=$[r[e]>>2],n+=$[(3&r[e])<<4|r[e+1]>>4],n+=$[(15&r[e+1])<<2|r[e+2]>>6],n+=$[63&r[e+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function mt(t,e){var r="";if(t&&(r=dt.call(t)),t&&("[object ArrayBuffer]"===r||t.buffer&&"[object ArrayBuffer]"===dt.call(t.buffer))){var n,i=J;t instanceof ArrayBuffer?(n=t,i+=tt):(n=t.buffer,"[object Int8Array]"===r?i+=rt:"[object Uint8Array]"===r?i+=nt:"[object Uint8ClampedArray]"===r?i+=it:"[object Int16Array]"===r?i+=st:"[object Uint16Array]"===r?i+=at:"[object Int32Array]"===r?i+=ot:"[object Uint32Array]"===r?i+=lt:"[object Float32Array]"===r?i+=ht:"[object Float64Array]"===r?i+=ut:e(new Error("Failed to get type for BinaryArray"))),e(i+pt(n))}else if("[object Blob]"===r){var s=new FileReader;s.onload=function(){var r=q+t.type+"~"+pt(this.result);e(J+et+r)},s.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(o){e(null,o)}}function gt(t){if(t.substring(0,Z)!==J)return JSON.parse(t);var e,r=t.substring(ct),n=t.substring(Z,ct);if(n===et&&Q.test(r)){var i=r.match(Q);e=i[1],r=r.substring(i[0].length)}var s=ft(r);switch(n){case tt:return s;case et:return l([s],{type:e});case rt:return new Int8Array(s);case nt:return new Uint8Array(s);case it:return new Uint8ClampedArray(s);case st:return new Int16Array(s);case at:return new Uint16Array(s);case ot:return new Int32Array(s);case lt:return new Uint32Array(s);case ht:return new Float32Array(s);case ut:return new Float64Array(s);default:throw new Error("Unkown type: "+n)}}var _t={serialize:mt,deserialize:gt,stringToBuffer:ft,bufferToString:pt};function yt(t,e,r,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function vt(t){var e=this,r={db:null};if(t)for(var n in t)r[n]="string"!=typeof t[n]?t[n].toString():t[n];var i=new h((function(t,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(i){return n(i)}r.db.transaction((function(i){yt(i,r,(function(){e._dbInfo=r,t()}),(function(t,e){n(e)}))}),n)}));return r.serializer=_t,i}function xt(t,e,r,n,i,s){t.executeSql(r,n,i,(function(t,o){o.code===o.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,a){a.rows.length?s(t,o):yt(t,e,(function(){t.executeSql(r,n,i,s)}),s)}),s):s(t,o)}),s)}function bt(t,e){var r=this;t=d(t);var n=new h((function(e,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){xt(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),e(n)}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,e),n}function Et(t,e){var r=this,n=new h((function(e,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){xt(r,i,"SELECT * FROM "+i.storeName,[],(function(r,n){for(var s=n.rows,o=s.length,a=0;a<o;a++){var l=s.item(a),h=l.value;if(h&&(h=i.serializer.deserialize(h)),void 0!==(h=t(h,l.key,a+1)))return void e(h)}e()}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,e),n}function Tt(t,e,r,n){var i=this;t=d(t);var s=new h((function(s,o){i.ready().then((function(){e===undefined&&(e=null);var a=e,l=i._dbInfo;l.serializer.serialize(e,(function(e,h){h?o(h):l.db.transaction((function(r){xt(r,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){s(a)}),(function(t,e){o(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(n>0)return void s(Tt.apply(i,[t,a,r,n-1]));o(e)}}))}))}))["catch"](o)}));return u(s,r),s}function At(t,e,r){return Tt.apply(this,[t,e,r,1])}function wt(t,e){var r=this;t=d(t);var n=new h((function(e,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){xt(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,e),n}function St(t){var e=this,r=new h((function(t,r){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){xt(e,n,"DELETE FROM "+n.storeName,[],(function(){t()}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,t),r}function Ct(t){var e=this,r=new h((function(t,r){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){xt(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(e,r){var n=r.rows.item(0).c;t(n)}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,t),r}function Rt(t,e){var r=this,n=new h((function(e,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){xt(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,r){var n=r.rows.length?r.rows.item(0).key:null;e(n)}),(function(t,e){n(e)}))}))}))["catch"](n)}));return u(n,e),n}function It(t){var e=this,r=new h((function(t,r){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){xt(e,n,"SELECT key FROM "+n.storeName,[],(function(e,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);t(n)}),(function(t,e){r(e)}))}))}))["catch"](r)}));return u(r,t),r}function Pt(t){return new h((function(e,r){t.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,n){for(var i=[],s=0;s<n.rows.length;s++)i.push(n.rows.item(s).name);e({db:t,storeNames:i})}),(function(t,e){r(e)}))}),(function(t){r(t)}))}))}function Mt(t,e){e=f.apply(this,arguments);var r=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||r.name,t.storeName=t.storeName||r.storeName);var n,i=this;return u(n=t.name?new h((function(e){var n;n=t.name===r.name?i._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:n,storeNames:[t.storeName]}):e(Pt(n))})).then((function(t){return new h((function(e,r){t.db.transaction((function(n){function i(t){return new h((function(e,r){n.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){r(e)}))}))}for(var s=[],o=0,a=t.storeNames.length;o<a;o++)s.push(i(t.storeNames[o]));h.all(s).then((function(){e()}))["catch"]((function(t){r(t)}))}),(function(t){r(t)}))}))})):h.reject("Invalid arguments"),e),n}var Ot={_driver:"webSQLStorage",_initStorage:vt,_support:K(),iterate:Et,getItem:bt,setItem:At,removeItem:wt,clear:St,length:Ct,key:Rt,keys:It,dropInstance:Mt};function Dt(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}function Nt(t,e){var r=t.name+"/";return t.storeName!==e.storeName&&(r+=t.storeName+"/"),r}function Ft(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}function Lt(){return!Ft()||localStorage.length>0}function Bt(t){var e=this,r={};if(t)for(var n in t)r[n]=t[n];return r.keyPrefix=Nt(t,e._defaultConfig),Lt()?(e._dbInfo=r,r.serializer=_t,h.resolve()):h.reject()}function kt(t){var e=this,r=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(t)&&localStorage.removeItem(n)}}));return u(r,t),r}function Ut(t,e){var r=this;t=d(t);var n=r.ready().then((function(){var e=r._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n}));return u(n,e),n}function Gt(t,e){var r=this,n=r.ready().then((function(){for(var e=r._dbInfo,n=e.keyPrefix,i=n.length,s=localStorage.length,o=1,a=0;a<s;a++){var l=localStorage.key(a);if(0===l.indexOf(n)){var h=localStorage.getItem(l);if(h&&(h=e.serializer.deserialize(h)),void 0!==(h=t(h,l.substring(i),o++)))return h}}}));return u(n,e),n}function jt(t,e){var r=this,n=r.ready().then((function(){var e,n=r._dbInfo;try{e=localStorage.key(t)}catch(i){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e}));return u(n,e),n}function Vt(t){var e=this,r=e.ready().then((function(){for(var t=e._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var s=localStorage.key(i);0===s.indexOf(t.keyPrefix)&&n.push(s.substring(t.keyPrefix.length))}return n}));return u(r,t),r}function Ht(t){var e=this.keys().then((function(t){return t.length}));return u(e,t),e}function zt(t,e){var r=this;t=d(t);var n=r.ready().then((function(){var e=r._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return u(n,e),n}function Wt(t,e,r){var n=this;t=d(t);var i=n.ready().then((function(){e===undefined&&(e=null);var r=e;return new h((function(i,s){var o=n._dbInfo;o.serializer.serialize(e,(function(e,n){if(n)s(n);else try{localStorage.setItem(o.keyPrefix+t,e),i(r)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||s(a),s(a)}}))}))}));return u(i,r),i}function Xt(t,e){if(e=f.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var r=this.config();t.name=t.name||r.name,t.storeName=t.storeName||r.storeName}var n,i=this;return n=t.name?new h((function(e){t.storeName?e(Nt(t,i._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var r=localStorage.key(e);0===r.indexOf(t)&&localStorage.removeItem(r)}})):h.reject("Invalid arguments"),u(n,e),n}var Yt={_driver:"localStorageWrapper",_initStorage:Bt,_support:Dt(),iterate:Gt,getItem:Ut,setItem:Wt,removeItem:zt,clear:kt,length:Ht,key:jt,keys:Vt,dropInstance:Xt},Kt=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},$t=function(t,e){for(var r=t.length,n=0;n<r;){if(Kt(t[n],e))return!0;n++}return!1},qt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Qt={},Jt={},Zt={INDEXEDDB:Y,WEBSQL:Ot,LOCALSTORAGE:Yt},te=[Zt.INDEXEDDB._driver,Zt.WEBSQL._driver,Zt.LOCALSTORAGE._driver],ee=["dropInstance"],re=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),ne={description:"",driver:te.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ie(t,e){t[e]=function(){var r=arguments;return t.ready().then((function(){return t[e].apply(t,r)}))}}function se(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var r in e)e.hasOwnProperty(r)&&(qt(e[r])?arguments[0][r]=e[r].slice():arguments[0][r]=e[r])}return arguments[0]}var oe=function(){function t(e){for(var r in i(this,t),Zt)if(Zt.hasOwnProperty(r)){var n=Zt[r],s=n._driver;this[r]=s,Qt[s]||this.defineDriver(n)}this._defaultConfig=se({},ne),this._config=se({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)["catch"]((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":n(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,r){var n=new h((function(e,r){try{var n=t._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void r(i);for(var s=re.concat("_initStorage"),o=0,a=s.length;o<a;o++){var l=s[o];if((!$t(ee,l)||t[l])&&"function"!=typeof t[l])return void r(i)}var c=function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),r=h.reject(e);return u(r,arguments[arguments.length-1]),r}},r=0,n=ee.length;r<n;r++){var i=ee[r];t[i]||(t[i]=e(i))}};c();var d=function(r){Qt[n],Qt[n]=t,Jt[n]=r,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(d,r):d(!!t._support):d(!0)}catch(f){r(f)}}));return c(n,e,r),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,r){var n=Qt[t]?h.resolve(Qt[t]):h.reject(new Error("Driver not found."));return c(n,e,r),n},t.prototype.getSerializer=function(t){var e=h.resolve(_t);return c(e,t),e},t.prototype.ready=function(t){var e=this,r=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return c(r,t,t),r},t.prototype.setDriver=function(t,e,r){var n=this;qt(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){n._config.driver=n.driver()}function o(t){return n._extend(t),s(),n._ready=n._initStorage(n._config),n._ready}function a(t){return function(){var e=0;function r(){for(;e<t.length;){var i=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(o)["catch"](r)}s();var a=new Error("No available storage method found.");return n._driverSet=h.reject(a),n._driverSet}return r()}}var l=null!==this._driverSet?this._driverSet["catch"]((function(){return h.resolve()})):h.resolve();return this._driverSet=l.then((function(){var t=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then((function(t){n._driver=t._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=a(i)}))}))["catch"]((function(){s();var t=new Error("No available storage method found.");return n._driverSet=h.reject(t),n._driverSet})),c(this._driverSet,e,r),this._driverSet},t.prototype.supports=function(t){return!!Jt[t]},t.prototype._extend=function(t){se(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];this.supports(i)&&e.push(i)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=re.length;t<e;t++)ie(this,re[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),ae=new oe;e.exports=ae},{3:3}]},{},[4])(4)},631:(t,e,r)=>{var n="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&i&&"function"==typeof i.get?i.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,c="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,v=String.prototype.replace,x=String.prototype.toUpperCase,b=String.prototype.toLowerCase,E=RegExp.prototype.test,T=Array.prototype.concat,A=Array.prototype.join,w=Array.prototype.slice,S=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,R=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,M="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function N(t,e){if(t===Infinity||t===-Infinity||t!=t||t&&t>-1e3&&t<1e3||E.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-S(-t):S(t);if(n!==t){var i=String(n),s=y.call(e,i.length+1);return v.call(i,r,"$&_")+"."+v.call(v.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(e,r,"$&_")}var F=r(654),L=F.custom,B=V(L)?L:null;function k(t,e,r){var n="double"===(r.quoteStyle||e)?'"':"'";return n+t+n}function U(t){return v.call(String(t),/"/g,"&quot;")}function G(t){return!("[object Array]"!==W(t)||M&&"object"==typeof t&&M in t)}function j(t){return!("[object RegExp]"!==W(t)||M&&"object"==typeof t&&M in t)}function V(t){if(P)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!I)return!1;try{return I.call(t),!0}catch(e){}return!1}t.exports=function tt(t,e,r,n){var i=e||{};if(z(i,"quoteStyle")&&"single"!==i.quoteStyle&&"double"!==i.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(i,"maxStringLength")&&("number"==typeof i.maxStringLength?i.maxStringLength<0&&i.maxStringLength!==Infinity:null!==i.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=!z(i,"customInspect")||i.customInspect;if("boolean"!=typeof a&&"symbol"!==a)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(i,"indent")&&null!==i.indent&&"\t"!==i.indent&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(i,"numericSeparator")&&"boolean"!=typeof i.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=i.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Y(t,i);if("number"==typeof t){if(0===t)return Infinity/t>0?"0":"-0";var m=String(t);return l?N(t,m):m}if("bigint"==typeof t){var x=String(t)+"n";return l?N(t,x):x}var E="undefined"==typeof i.depth?5:i.depth;if(void 0===r&&(r=0),r>=E&&E>0&&"object"==typeof t)return G(t)?"[Array]":"[Object]";var S=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=A.call(Array(t.indent+1)," ")}return{base:r,prev:A.call(Array(e+1),r)}}(i,r);if(void 0===n)n=[];else if(X(n,t)>=0)return"[Circular]";function R(t,e,s){if(e&&(n=w.call(n)).push(e),s){var o={depth:i.depth};return z(i,"quoteStyle")&&(o.quoteStyle=i.quoteStyle),tt(t,o,r+1,n)}return tt(t,i,r+1,n)}if("function"==typeof t&&!j(t)){var L=function(t){if(t.name)return t.name;var e=_.call(g.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(t),H=Z(t,R);return"[Function"+(L?": "+L:" (anonymous)")+"]"+(H.length>0?" { "+A.call(H,", ")+" }":"")}if(V(t)){var K=P?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!=typeof t||P?K:$(K)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(t)){for(var et="<"+b.call(String(t.nodeName)),rt=t.attributes||[],nt=0;nt<rt.length;nt++)et+=" "+rt[nt].name+"="+k(U(rt[nt].value),"double",i);return et+=">",t.childNodes&&t.childNodes.length&&(et+="..."),et+="</"+b.call(String(t.nodeName))+">"}if(G(t)){if(0===t.length)return"[]";var it=Z(t,R);return S&&!function(t){for(var e=0;e<t.length;e++)if(X(t[e],"\n")>=0)return!1;return!0}(it)?"["+J(it,S)+"]":"[ "+A.call(it,", ")+" ]"}if(function(t){return!("[object Error]"!==W(t)||M&&"object"==typeof t&&M in t)}(t)){var st=Z(t,R);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===st.length?"["+String(t)+"]":"{ ["+String(t)+"] "+A.call(st,", ")+" }":"{ ["+String(t)+"] "+A.call(T.call("[cause]: "+R(t.cause),st),", ")+" }"}if("object"==typeof t&&a){if(B&&"function"==typeof t[B]&&F)return F(t,{depth:E-r});if("symbol"!==a&&"function"==typeof t.inspect)return t.inspect()}if(function(t){if(!s||!t||"object"!=typeof t)return!1;try{s.call(t);try{h.call(t)}catch(et){return!0}return t instanceof Map}catch(e){}return!1}(t)){var ot=[];return o&&o.call(t,(function(e,r){ot.push(R(r,t,!0)+" => "+R(e,t))})),Q("Map",s.call(t),ot,S)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t);try{s.call(t)}catch(e){return!0}return t instanceof Set}catch(r){}return!1}(t)){var at=[];return u&&u.call(t,(function(e){at.push(R(e,t))})),Q("Set",h.call(t),at,S)}if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{d.call(t,d)}catch(et){return!0}return t instanceof WeakMap}catch(e){}return!1}(t))return q("WeakMap");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{d.call(t,d);try{c.call(t,c)}catch(et){return!0}return t instanceof WeakSet}catch(e){}return!1}(t))return q("WeakSet");if(function(t){if(!f||!t||"object"!=typeof t)return!1;try{return f.call(t),!0}catch(e){}return!1}(t))return q("WeakRef");if(function(t){return!("[object Number]"!==W(t)||M&&"object"==typeof t&&M in t)}(t))return $(R(Number(t)));if(function(t){if(!t||"object"!=typeof t||!C)return!1;try{return C.call(t),!0}catch(e){}return!1}(t))return $(R(C.call(t)));if(function(t){return!("[object Boolean]"!==W(t)||M&&"object"==typeof t&&M in t)}(t))return $(p.call(t));if(function(t){return!("[object String]"!==W(t)||M&&"object"==typeof t&&M in t)}(t))return $(R(String(t)));if(!function(t){return!("[object Date]"!==W(t)||M&&"object"==typeof t&&M in t)}(t)&&!j(t)){var lt=Z(t,R),ht=D?D(t)===Object.prototype:t instanceof Object||t.constructor===Object,ut=t instanceof Object?"":"null prototype",ct=!ht&&M&&Object(t)===t&&M in t?y.call(W(t),8,-1):ut?"Object":"",dt=(ht||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ct||ut?"["+A.call(T.call([],ct||[],ut||[]),": ")+"] ":"");return 0===lt.length?dt+"{}":S?dt+"{"+J(lt,S)+"}":dt+"{ "+A.call(lt,", ")+" }"}return String(t)};var H=Object.prototype.hasOwnProperty||function(t){return t in this};function z(t,e){return H.call(t,e)}function W(t){return m.call(t)}function X(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function Y(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return Y(y.call(t,0,e.maxStringLength),e)+n}return k(v.call(v.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,K),"single",e)}function K(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+x.call(e.toString(16))}function $(t){return"Object("+t+")"}function q(t){return t+" { ? }"}function Q(t,e,r,n){return t+" ("+e+") {"+(n?J(r,n):A.call(r,", "))+"}"}function J(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+A.call(t,","+r)+"\n"+e.prev}function Z(t,e){var r=G(t),n=[];if(r){n.length=t.length;for(var i=0;i<t.length;i++)n[i]=z(t,i)?e(t[i],t):""}var s,o="function"==typeof R?R(t):[];if(P){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in t)z(t,l)&&(r&&String(Number(l))===l&&l<t.length||P&&s["$"+l]instanceof Symbol||(E.call(/[^\w$]/,l)?n.push(e(l,t)+": "+e(t[l],t)):n.push(l+": "+e(t[l],t))));if("function"==typeof R)for(var h=0;h<o.length;h++)O.call(t,o[h])&&n.push("["+e(o[h])+"]: "+e(t[o[h]],t));return n}},971:function(t,e,r){var n;t=r.nmd(t),function(i){e&&e.nodeType,t&&t.nodeType;var s="object"==typeof r.g&&r.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,l=36,h=1,u=26,c=38,d=700,f=72,p=128,m="-",g=/^xn--/,_=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-h,b=Math.floor,E=String.fromCharCode;function T(t){throw new RangeError(v[t])}function A(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function w(t,e){var r=t.split("@"),n="";return r.length>1&&(n=r[0]+"@",t=r[1]),n+A((t=t.replace(y,".")).split("."),e).join(".")}function S(t){for(var e,r,n=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function C(t){return A(t,(function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)})).join("")}function R(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function I(t,e,r){var n=0;for(t=r?b(t/d):t>>1,t+=b(t/e);t>x*u>>1;n+=l)t=b(t/x);return b(n+(x+1)*t/(t+c))}function P(t){var e,r,n,i,s,o,c,d,g,_,y,v=[],x=t.length,E=0,A=p,w=f;for((r=t.lastIndexOf(m))<0&&(r=0),n=0;n<r;++n)t.charCodeAt(n)>=128&&T("not-basic"),v.push(t.charCodeAt(n));for(i=r>0?r+1:0;i<x;){for(s=E,o=1,c=l;i>=x&&T("invalid-input"),((d=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:l)>=l||d>b((a-E)/o))&&T("overflow"),E+=d*o,!(d<(g=c<=w?h:c>=w+u?u:c-w));c+=l)o>b(a/(_=l-g))&&T("overflow"),o*=_;w=I(E-s,e=v.length+1,0==s),b(E/e)>a-A&&T("overflow"),A+=b(E/e),E%=e,v.splice(E++,0,A)}return C(v)}function M(t){var e,r,n,i,s,o,c,d,g,_,y,v,x,A,w,C=[];for(v=(t=S(t)).length,e=p,r=0,s=f,o=0;o<v;++o)(y=t[o])<128&&C.push(E(y));for(n=i=C.length,i&&C.push(m);n<v;){for(c=a,o=0;o<v;++o)(y=t[o])>=e&&y<c&&(c=y);for(c-e>b((a-r)/(x=n+1))&&T("overflow"),r+=(c-e)*x,e=c,o=0;o<v;++o)if((y=t[o])<e&&++r>a&&T("overflow"),y==e){for(d=r,g=l;!(d<(_=g<=s?h:g>=s+u?u:g-s));g+=l)w=d-_,A=l-_,C.push(E(R(_+w%A,0))),d=b(w/A);C.push(E(R(d,0))),s=I(r,x,n==i),r=0,++n}++r,++e}return C.join("")}o={version:"1.4.1",ucs2:{decode:S,encode:C},decode:P,encode:M,toASCII:function(t){return w(t,(function(t){return _.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return w(t,(function(t){return g.test(t)?P(t.slice(4).toLowerCase()):t}))}},(n=function(){return o}.call(e,r,e,t))===undefined||(t.exports=n)}()},798:t=>{"use strict";var e=String.prototype.replace,r=/%20/g,n="RFC1738",i="RFC3986";t.exports={"default":i,formatters:{RFC1738:function(t){return e.call(t,r,"+")},RFC3986:function(t){return String(t)}},RFC1738:n,RFC3986:i}},129:(t,e,r)=>{"use strict";var n=r(261),i=r(235),s=r(798);t.exports={formats:s,parse:i,stringify:n}},235:(t,e,r)=>{"use strict";var n=r(769),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},h=function(t,e,r,n){if(t){var s=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(s),h=a?s.slice(0,a.index):s,u=[];if(h){if(!r.plainObjects&&i.call(Object.prototype,h)&&!r.allowPrototypes)return;u.push(h)}for(var c=0;r.depth>0&&null!==(a=o.exec(s))&&c<r.depth;){if(c+=1,!r.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+s.slice(a.index)+"]"),function(t,e,r,n){for(var i=n?e:l(e,r),s=t.length-1;s>=0;--s){var o,a=t[s];if("[]"===a&&r.parseArrays)o=[].concat(i);else{o=r.plainObjects?Object.create(null):{};var h="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(h,10);r.parseArrays||""!==h?!isNaN(u)&&a!==h&&String(u)===h&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(o=[])[u]=i:"__proto__"!==h&&(o[h]=i):o={0:i}}i=o}return i}(u,e,r,n)}};t.exports=function(t,e){var r=function(t){if(!t)return o;if(null!==t.decoder&&t.decoder!==undefined&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!=typeof t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e="undefined"==typeof t.charset?o.charset:t.charset;return{allowDots:"undefined"==typeof t.allowDots?o.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:o.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:o.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:o.comma,decoder:"function"==typeof t.decoder?t.decoder:o.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:o.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:o.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:o.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:o.strictNullHandling}}(e);if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var u="string"==typeof t?function(t,e){var r,h={__proto__:null},u=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,c=e.parameterLimit===Infinity?undefined:e.parameterLimit,d=u.split(e.delimiter,c),f=-1,p=e.charset;if(e.charsetSentinel)for(r=0;r<d.length;++r)0===d[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[r]?p="utf-8":"utf8=%26%2310003%3B"===d[r]&&(p="iso-8859-1"),f=r,r=d.length);for(r=0;r<d.length;++r)if(r!==f){var m,g,_=d[r],y=_.indexOf("]="),v=-1===y?_.indexOf("="):y+1;-1===v?(m=e.decoder(_,o.decoder,p,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(_.slice(0,v),o.decoder,p,"key"),g=n.maybeMap(l(_.slice(v+1),e),(function(t){return e.decoder(t,o.decoder,p,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===p&&(g=a(g)),_.indexOf("[]=")>-1&&(g=s(g)?[g]:g),i.call(h,m)?h[m]=n.combine(h[m],g):h[m]=g}return h}(t,r):t,c=r.plainObjects?Object.create(null):{},d=Object.keys(u),f=0;f<d.length;++f){var p=d[f],m=h(p,u[p],r,"string"==typeof t);c=n.merge(c,m,r)}return!0===r.allowSparse?c:n.compact(c)}},261:(t,e,r)=>{"use strict";var n=r(478),i=r(769),s=r(798),o=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,h=Array.prototype.push,u=function(t,e){h.apply(t,l(e)?e:[e])},c=Date.prototype.toISOString,d=s["default"],f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(t){return c.call(t)},skipNulls:!1,strictNullHandling:!1},p={},m=function g(t,e,r,s,o,a,h,c,d,m,_,y,v,x,b,E){for(var T,A=t,w=E,S=0,C=!1;(w=w.get(p))!==void undefined&&!C;){var R=w.get(t);if(S+=1,void 0!==R){if(R===S)throw new RangeError("Cyclic object value");C=!0}void 0===w.get(p)&&(S=0)}if("function"==typeof c?A=c(e,A):A instanceof Date?A=_(A):"comma"===r&&l(A)&&(A=i.maybeMap(A,(function(t){return t instanceof Date?_(t):t}))),null===A){if(o)return h&&!x?h(e,f.encoder,b,"key",y):e;A=""}if("string"==typeof(T=A)||"number"==typeof T||"boolean"==typeof T||"symbol"==typeof T||"bigint"==typeof T||i.isBuffer(A))return h?[v(x?e:h(e,f.encoder,b,"key",y))+"="+v(h(A,f.encoder,b,"value",y))]:[v(e)+"="+v(String(A))];var I,P=[];if(void 0===A)return P;if("comma"===r&&l(A))x&&h&&(A=i.maybeMap(A,h)),I=[{value:A.length>0?A.join(",")||null:void undefined}];else if(l(c))I=c;else{var M=Object.keys(A);I=d?M.sort(d):M}for(var O=s&&l(A)&&1===A.length?e+"[]":e,D=0;D<I.length;++D){var N=I[D],F="object"==typeof N&&"undefined"!=typeof N.value?N.value:A[N];if(!a||null!==F){var L=l(A)?"function"==typeof r?r(O,N):O:O+(m?"."+N:"["+N+"]");E.set(t,S);var B=n();B.set(p,E),u(P,g(F,L,r,s,o,a,"comma"===r&&x&&l(A)?null:h,c,d,m,_,y,v,x,b,B))}}return P};t.exports=function(t,e){var r,i=t,h=function(t){if(!t)return f;if(null!==t.encoder&&"undefined"!=typeof t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||f.charset;if("undefined"!=typeof t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=s["default"];if("undefined"!=typeof t.format){if(!o.call(s.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=s.formatters[r],i=f.filter;return("function"==typeof t.filter||l(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:f.addQueryPrefix,allowDots:"undefined"==typeof t.allowDots?f.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:f.charsetSentinel,delimiter:"undefined"==typeof t.delimiter?f.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:f.encode,encoder:"function"==typeof t.encoder?t.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:f.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:f.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof h.filter?i=(0,h.filter)("",i):l(h.filter)&&(r=h.filter);var c,d=[];if("object"!=typeof i||null===i)return"";c=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var p=a[c];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===p&&e&&e.commaRoundTrip;r||(r=Object.keys(i)),h.sort&&r.sort(h.sort);for(var _=n(),y=0;y<r.length;++y){var v=r[y];h.skipNulls&&null===i[v]||u(d,m(i[v],v,p,g,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,_))}var x=d.join(h.delimiter),b=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),x.length>0?b+x:""}},769:(t,e,r)=>{"use strict";var n=r(798),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)"undefined"!=typeof t[n]&&(r[n]=t[n]);return r};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var i=e[n],o=i.obj[i.prop],a=Object.keys(o),l=0;l<a.length;++l){var h=a[l],u=o[h];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:o,prop:h}),r.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(s(r)){for(var n=[],i=0;i<r.length;++i)"undefined"!=typeof r[i]&&n.push(r[i]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(i){return n}},encode:function(t,e,r,i,s){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",h=0;h<a.length;++h){var u=a.charCodeAt(h);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===n.RFC1738&&(40===u||41===u)?l+=a.charAt(h):u<128?l+=o[u]:u<2048?l+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?l+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(h+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(h)),l+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return l},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(s(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},merge:function l(t,e,r){if(!e)return t;if("object"!=typeof e){if(s(t))t.push(e);else{if(!t||"object"!=typeof t)return[t,e];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,e))&&(t[e]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(e);var n=t;return s(t)&&!s(e)&&(n=a(t,r)),s(t)&&s(e)?(e.forEach((function(e,n){if(i.call(t,n)){var s=t[n];s&&"object"==typeof s&&e&&"object"==typeof e?t[n]=l(s,e,r):t.push(e)}else t[n]=e})),t):Object.keys(e).reduce((function(t,n){var s=e[n];return i.call(t,n)?t[n]=l(t[n],s,r):t[n]=s,t}),n)}}},478:(t,e,r)=>{"use strict";var n=r(210),i=r(924),s=r(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),l=n("%Map%",!0),h=i("WeakMap.prototype.get",!0),u=i("WeakMap.prototype.set",!0),c=i("WeakMap.prototype.has",!0),d=i("Map.prototype.get",!0),f=i("Map.prototype.set",!0),p=i("Map.prototype.has",!0),m=function(t,e){for(var r,n=t;null!==(r=n.next);n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r};t.exports=function(){var t,e,r,n={assert:function(t){if(!n.has(t))throw new o("Side channel does not contain "+s(t))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return h(t,n)}else if(l){if(e)return d(e,n)}else if(r)return function(t,e){var r=m(t,e);return r&&r.value}(r,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return c(t,n)}else if(l){if(e)return p(e,n)}else if(r)return function(t,e){return!!m(t,e)}(r,n);return!1},set:function(n,i){a&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new a),u(t,n,i)):l?(e||(e=new l),f(e,n,i)):(r||(r={key:{},next:null}),function(t,e,r){var n=m(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}}(r,n,i))}};return n}},466:function(t){var e;t.exports=((e=function(){function t(t){return i.appendChild(t.dom),t}function r(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";n=t}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),r(++n%i.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,l=t(new e.Panel("FPS","#0ff","#002")),h=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:i,addPanel:t,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(h.update(t-s,200),t>o+1e3&&(l.update(1e3*a/(t-o),100),o=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:i,setMode:r}}).Panel=function(t,e,r){var n=Infinity,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,u=2*o,c=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,h,u),g.fillRect(c,d,f,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(c,d,f,p),{dom:m,update:function(l,_){n=Math.min(n,l),i=Math.max(i,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(i)+")",h,u),g.drawImage(m,c+o,d,f-o,p,c,d,f-o,p),g.fillRect(c+f-o,d,o,p),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(c+f-o,d,o,s((1-l/_)*p))}}},e)},575:(t,e,r)=>{"use strict";var n=r(971);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(l),u=["%","/","?",";","#"].concat(h),c=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=r(129);function y(t,e,r){if(t&&"object"==typeof t&&t instanceof i)return t;var n=new i;return n.parse(t,e,r),n}i.prototype.parse=function(t,e,r){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),o=-1!==i&&i<t.indexOf("#")?"?":"#",l=t.split(o);l[0]=l[0].replace(/\\/g,"/");var y=t=l.join(o);if(y=y.trim(),!r&&1===t.split("#").length){var v=a.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=s.exec(y);if(x){var b=(x=x[0]).toLowerCase();this.protocol=b,y=y.substr(x.length)}if(r||x||y.match(/^\/\/[^@/]+@[^@/]+/)){var E="//"===y.substr(0,2);!E||x&&m[x]||(y=y.substr(2),this.slashes=!0)}if(!m[x]&&(E||x&&!g[x])){for(var T,A,w=-1,S=0;S<c.length;S++){-1!==(C=y.indexOf(c[S]))&&(-1===w||C<w)&&(w=C)}-1!==(A=-1===w?y.lastIndexOf("@"):y.lastIndexOf("@",w))&&(T=y.slice(0,A),y=y.slice(A+1),this.auth=decodeURIComponent(T)),w=-1;for(S=0;S<u.length;S++){var C;-1!==(C=y.indexOf(u[S]))&&(-1===w||C<w)&&(w=C)}-1===w&&(w=y.length),this.host=y.slice(0,w),y=y.slice(w),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var I=this.hostname.split(/\./),P=(S=0,I.length);S<P;S++){var M=I[S];if(M&&!M.match(d)){for(var O="",D=0,N=M.length;D<N;D++)M.charCodeAt(D)>127?O+="x":O+=M[D];if(!O.match(d)){var F=I.slice(0,S),L=I.slice(S+1),B=M.match(f);B&&(F.push(B[1]),L.unshift(B[2])),L.length&&(y="/"+L.join(".")+y),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=n.toASCII(this.hostname));var k=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+k,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!p[b])for(S=0,P=h.length;S<P;S++){var G=h[S];if(-1!==y.indexOf(G)){var j=encodeURIComponent(G);j===G&&(j=escape(G)),y=y.split(G).join(j)}}var V=y.indexOf("#");-1!==V&&(this.hash=y.substr(V),y=y.slice(0,V));var H=y.indexOf("?");if(-1!==H?(this.search=y.substr(H),this.query=y.substr(H+1),e&&(this.query=_.parse(this.query)),y=y.slice(0,H)):e&&(this.search="",this.query={}),y&&(this.pathname=y),g[b]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){k=this.pathname||"";var z=this.search||"";this.path=k+z}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=_.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+i+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+n},i.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if("string"==typeof t){var e=new i;e.parse(t,!1,!0),t=e}for(var r=new i,n=Object.keys(this),s=0;s<n.length;s++){var o=n[s];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),l=0;l<a.length;l++){var h=a[l];"protocol"!==h&&(r[h]=t[h])}return g[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!g[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var d=u[c];r[d]=t[d]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||m[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var p=r.pathname||"",_=r.search||"";r.path=p+_}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=v||y||r.host&&t.pathname,b=x,E=r.pathname&&r.pathname.split("/")||[],T=(f=t.pathname&&t.pathname.split("/")||[],r.protocol&&!g[r.protocol]);if(T&&(r.hostname="",r.port=null,r.host&&(""===E[0]?E[0]=r.host:E.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),x=x&&(""===f[0]||""===E[0])),v)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,E=f;else if(f.length)E||(E=[]),E.pop(),E=E.concat(f),r.search=t.search,r.query=t.query;else if(null!=t.search){if(T)r.host=E.shift(),r.hostname=r.host,(R=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=R.shift(),r.hostname=R.shift(),r.host=r.hostname);return r.search=t.search,r.query=t.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!E.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var A=E.slice(-1)[0],w=(r.host||t.host||E.length>1)&&("."===A||".."===A)||""===A,S=0,C=E.length;C>=0;C--)"."===(A=E[C])?E.splice(C,1):".."===A?(E.splice(C,1),S++):S&&(E.splice(C,1),S--);if(!x&&!b)for(;S--;S)E.unshift("..");!x||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),w&&"/"!==E.join("/").substr(-1)&&E.push("");var R,I=""===E[0]||E[0]&&"/"===E[0].charAt(0);T&&(r.hostname=I?"":E.length?E.shift():"",r.host=r.hostname,(R=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=R.shift(),r.hostname=R.shift(),r.host=r.hostname));return(x=x||r.host&&E.length)&&!I&&E.unshift(""),E.length>0?r.pathname=E.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},e.Qc=y,e.DB=function(t,e){return y(t,!1,!0).resolve(e)},e.WU=function(t){return"string"==typeof t&&(t=y(t)),t instanceof i?t.format():i.prototype.format.call(t)}},654:()=>{}},n={};function i(t){var e=n[t];if(e!==undefined)return e.exports;var s=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=r,i.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,r)=>(i.f[r](t,e),e)),[])),i.u=t=>t+".main.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="3DGame:",i.l=(r,n,s,o)=>{if(t[r])t[r].push(n);else{var a,l;if(s!==undefined)for(var h=document.getElementsByTagName("script"),u=0;u<h.length;u++){var c=h[u];if(c.getAttribute("src")==r||c.getAttribute("data-webpack")==e+s){a=c;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",e+s),a.src=r),t[r]=[n];var d=(e,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=t[r];if(delete t[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(n))),e)return e(n)},f=setTimeout(d.bind(null,undefined,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");r.length&&(t=r[r.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{i.b=document.baseURI||self.location.href;var t={179:0};i.f.j=(e,r)=>{var n=i.o(t,e)?t[e]:undefined;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise(((r,i)=>n=t[e]=[r,i]));r.push(n[2]=s);var o=i.p+i.u(e),a=new Error;i.l(o,(r=>{if(i.o(t,e)&&(0!==(n=t[e])&&(t[e]=undefined),n)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+e,e)}};var e=(e,r)=>{var n,s,[o,a,l]=r,h=0;if(o.some((e=>0!==t[e]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(l)l(i)}for(e&&e(r);h<o.length;h++)s=o[h],i.o(t,s)&&t[s]&&t[s][0](),t[s]=0},r=self.webpackChunk_3DGame=self.webpackChunk_3DGame||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var s={};(()=>{"use strict";i.d(s,{W:()=>Hp});var t={};i.r(t),i.d(t,{BaseTextureCache:()=>se,BoundingBox:()=>re,CanvasRenderTarget:()=>le,DATA_URI:()=>Ht,EventEmitter:()=>W,ProgramCache:()=>ne,TextureCache:()=>ie,clearTextureCache:()=>ae,correctBlendMode:()=>Ut,createIndicesForQuads:()=>zt,decomposeDataUri:()=>fe,deprecation:()=>Z,destroyTextureCache:()=>oe,determineCrossOrigin:()=>me,earcut:()=>X,getBufferType:()=>Wt,getCanvasBoundingBox:()=>ce,getResolutionOfUrl:()=>ge,hex2rgb:()=>Nt,hex2string:()=>Ft,interleaveTypedArrays:()=>Yt,isMobile:()=>z,isPow2:()=>$t,isWebGLSupported:()=>nt,log2:()=>qt,nextPow2:()=>Kt,path:()=>Q,premultiplyBlendMode:()=>kt,premultiplyRgba:()=>Gt,premultiplyTint:()=>jt,premultiplyTintToRgba:()=>Vt,removeItems:()=>Qt,rgb2hex:()=>Bt,sayHello:()=>et,sign:()=>Jt,skipHello:()=>tt,string2hex:()=>Lt,trimCanvas:()=>de,uid:()=>te,url:()=>K});var e={};i.r(e),i.d(e,{ALPHA_MODES:()=>_,AbstractMultiResource:()=>xi,ArrayResource:()=>bi,Attribute:()=>Be,BLEND_MODES:()=>l,BUFFER_BITS:()=>a,BUFFER_TYPE:()=>A,BackgroundSystem:()=>Gr,BaseImageResource:()=>Yr,BaseRenderTexture:()=>Xr,BaseTexture:()=>De,BatchDrawCall:()=>Ne,BatchGeometry:()=>He,BatchRenderer:()=>Br,BatchShaderGenerator:()=>Dr,BatchSystem:()=>jr,BatchTextureArray:()=>Nr,BrowserAdapter:()=>w,Buffer:()=>Le,BufferResource:()=>Pe,BufferSystem:()=>gi,CLEAR_MODES:()=>y,COLOR_MASK_BITS:()=>E,CanvasResource:()=>Ei,Circle:()=>Qe,Color:()=>Dt,ContextSystem:()=>Hr,CubeResource:()=>Ai,DEG_TO_RAD:()=>Xe,DRAW_MODES:()=>h,ENV:()=>n,Ellipse:()=>Je,ExtensionType:()=>_e,FORMATS:()=>u,Filter:()=>Ur,FilterState:()=>nn,FilterSystem:()=>an,Framebuffer:()=>Wr,FramebufferSystem:()=>un,GC_MODES:()=>v,GLFramebuffer:()=>ln,GLProgram:()=>On,GLTexture:()=>ei,GenerateTextureSystem:()=>Cn,Geometry:()=>Ve,GeometrySystem:()=>dn,IGLUniformData:()=>Mn,INSTALLED:()=>Se,ImageBitmapResource:()=>wi,ImageResource:()=>Kr,MASK_TYPES:()=>b,MIPMAP_MODES:()=>g,MSAA_QUALITY:()=>T,MaskData:()=>gn,MaskSystem:()=>_n,Matrix:()=>er,MultisampleSystem:()=>pi,ObjectRenderer:()=>Fr,ObjectRendererSystem:()=>_i,ObservablePoint:()=>ur,PI_2:()=>ze,PRECISION:()=>x,PluginSystem:()=>An,Point:()=>Ke,Polygon:()=>Ze,Program:()=>Ir,ProjectionSystem:()=>wn,Quad:()=>en,QuadUv:()=>rn,RAD_TO_DEG:()=>We,RENDERER_TYPE:()=>o,Rectangle:()=>qe,RenderTexture:()=>Zr,RenderTexturePool:()=>tn,RenderTextureSystem:()=>Pn,Renderer:()=>vi,Resource:()=>Ie,RoundedRectangle:()=>tr,Runner:()=>Re,SAMPLER_TYPES:()=>f,SCALE_MODES:()=>p,SHAPES:()=>Ye,SVGResource:()=>Ci,ScissorSystem:()=>En,Shader:()=>Or,ShaderSystem:()=>Kn,SpriteMaskFilter:()=>mn,StartupSystem:()=>$n,State:()=>we,StateSystem:()=>Qn,StencilSystem:()=>Tn,SystemManager:()=>Jn,TARGETS:()=>c,TYPES:()=>d,Texture:()=>Jr,TextureGCSystem:()=>ti,TextureMatrix:()=>pn,TextureSystem:()=>ri,TextureUvs:()=>$r,Ticker:()=>li,TickerPlugin:()=>hi,Transform:()=>dr,TransformFeedback:()=>Pi,TransformFeedbackSystem:()=>ni,UPDATE_PRIORITY:()=>si,UniformGroup:()=>Mr,VERSION:()=>Mi,VideoResource:()=>Ii,ViewSystem:()=>ii,ViewableBuffer:()=>be,WRAP_MODES:()=>m,autoDetectRenderer:()=>ci,autoDetectResource:()=>Ce,checkMaxIfStatementsInShader:()=>Ae,createUBOElements:()=>jn,defaultFilterVertex:()=>fi,defaultVertex:()=>di,extensions:()=>xe,generateProgram:()=>Bn,generateUniformBufferSync:()=>Hn,getTestContext:()=>vr,getUBOData:()=>Vn,groupD8:()=>hr,isMobile:()=>z,settings:()=>S,uniformParsers:()=>fr,unsafeEvalSupported:()=>Wn,utils:()=>t});var r={};i.r(r),i.d(r,{BUILD_DATE:()=>bf,DEBUG:()=>Ef,LANG:()=>If,PIXI_VERSION:()=>Mi,PROJECT_NAME:()=>Cf,SAVEDATA_VERSION:()=>Sf,SHOW_COLLIDERS:()=>Tf,STATS:()=>Af,USE_BOX2D:()=>Rf,VERSION:()=>wf});var n=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(n||{}),o=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(o||{}),a=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(a||{}),l=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(l||{}),h=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(h||{}),u=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(u||{}),c=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(c||{}),d=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(d||{}),f=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(f||{}),p=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(p||{}),m=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(m||{}),g=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(g||{}),_=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(_||{}),y=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(y||{}),v=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(v||{}),x=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(x||{}),b=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(b||{}),E=(t=>(t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t))(E||{}),T=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(T||{}),A=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(A||{});const w={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},S={ADAPTER:w,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var C=/iPhone/i,R=/iPod/i,I=/iPad/i,P=/\biOS-universal(?:.+)Mac\b/i,M=/\bAndroid(?:.+)Mobile\b/i,O=/Android/i,D=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,N=/Silk/i,F=/Windows Phone/i,L=/\bWindows(?:.+)ARM\b/i,B=/BlackBerry/i,k=/BB10/i,U=/Opera Mini/i,G=/\b(CriOS|Chrome)(?:.+)Mobile/i,j=/Mobile(?:.+)Firefox\b/i,V=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function H(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,n=r.split("[FBAN");"undefined"!=typeof n[1]&&(r=n[0]),"undefined"!=typeof(n=r.split("Twitter"))[1]&&(r=n[0]);var i=function(t){return function(e){return e.test(t)}}(r),s={apple:{phone:i(C)&&!i(F),ipod:i(R),tablet:!i(C)&&(i(I)||V(e))&&!i(F),universal:i(P),device:(i(C)||i(R)||i(I)||i(P)||V(e))&&!i(F)},amazon:{phone:i(D),tablet:!i(D)&&i(N),device:i(D)||i(N)},android:{phone:!i(F)&&i(D)||!i(F)&&i(M),tablet:!i(F)&&!i(D)&&!i(M)&&(i(N)||i(O)),device:!i(F)&&(i(D)||i(N)||i(M)||i(O))||i(/\bokhttp\b/i)},windows:{phone:i(F),tablet:i(L),device:i(F)||i(L)},other:{blackberry:i(B),blackberry10:i(k),opera:i(U),firefox:i(j),chrome:i(G),device:i(B)||i(k)||i(U)||i(j)||i(G)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const z=(H["default"]??H)(globalThis.navigator);S.RETINA_PREFIX=/@([0-9\.]+)x/,S.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var W=i(729),X=i(187),Y=i(575);const K={parse:Y.Qc,format:Y.WU,resolve:Y.DB};function $(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function q(t){return t.split("?")[0].split("#")[0]}const Q={toPosix(t){return e="\\",r="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r);var e,r},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){$(t),t=this.toPosix(t);let e="";const r=/^file:\/\/\//.exec(t),n=/^[^/:]+:\/\//.exec(t),i=/^[^/:]+:\//.exec(t);if(r||n||i){const s=r?.[0]||n?.[0]||i?.[0];e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,r){if(this.isDataUrl(t))return t;const n=q(this.toPosix(e??S.ADAPTER.getBaseUrl())),i=q(this.toPosix(r??this.rootname(n)));if($(t),(t=this.toPosix(t)).startsWith("/"))return Q.join(i,t.slice(1));return this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if($(t=this.toPosix(t)),0===t.length)return".";let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return t=function(t,e){let r="",n=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(i===a-1||1===s);else if(i!==a-1&&2===s){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",n=0):(r=r.slice(0,t),n=r.length-1-r.lastIndexOf("/")),i=a,s=0;continue}}else if(2===r.length||1===r.length){r="",n=0,i=a,s=0;continue}e&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+=`/${t.slice(i+1,a)}`:r=t.slice(i+1,a),n=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return r}(t,!1),t.length>0&&n&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return $(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let r=0;r<t.length;++r){const n=t[r];if($(n),n.length>0)if(void 0===e)e=n;else{const i=t[r-1]??"";this.extname(i)?e+=`/../${n}`:e+=`/${n}`}}return void 0===e?".":this.normalize(e)},dirname(t){if($(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let n=-1,i=!0;const s=this.getProtocol(t),o=t;for(let a=(t=t.slice(s.length)).length-1;a>=1;--a)if(e=t.charCodeAt(a),47===e){if(!i){n=a;break}}else i=!1;return-1===n?r?"/":this.isUrl(o)?s+t:s:r&&1===n?"//":s+t.slice(0,n)},rootname(t){$(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){$(t),e&&$(e),t=q(this.toPosix(t));let r,n=0,i=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const l=t.charCodeAt(r);if(47===l){if(!s){n=r+1;break}}else-1===a&&(s=!1,a=r+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(i=r):(o=-1,i=a))}return n===i?i=a:-1===i&&(i=t.length),t.slice(n,i)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!s){n=r+1;break}}else-1===i&&(s=!1,i=r+1);return-1===i?"":t.slice(n,i)},extname(t){$(t);let e=-1,r=0,n=-1,i=!0,s=0;for(let o=(t=q(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===n&&(i=!1,n=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!i){r=o+1;break}}return-1===e||-1===n||0===s||1===s&&e===n-1&&e===r+1?"":t.slice(e,n)},parse(t){$(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=q(this.toPosix(t))).charCodeAt(0);const n=this.isAbsolute(t);let i;e.root=this.rootname(t),i=n||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,l=!0,h=t.length-1,u=0;for(;h>=i;--h)if(r=t.charCodeAt(h),47!==r)-1===a&&(l=!1,a=h+1),46===r?-1===s?s=h:1!==u&&(u=1):-1!==s&&(u=-1);else if(!l){o=h+1;break}return-1===s||-1===a||0===u||1===u&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&n?t.slice(1,a):t.slice(o,a)):(0===o&&n?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},J={};function Z(t,e,r=3){if(J[e])return;let n=(new Error).stack;void 0===n||(n=n.split("\n").splice(r).join("\n"),console.groupCollapsed),J[e]=!0}function tt(){Z(0,"skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function et(){Z(0,'sayHello is deprecated, please use Renderer\'s "hello" option')}let rt;function nt(){return void 0===rt&&(rt=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:S.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!S.ADAPTER.getWebGLRenderingContext())return!1;const e=S.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!r?.getContextAttributes()?.stencil;if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,n}catch(at){return!1}}()),rt}var it={grad:.9,turn:360,rad:360/(2*Math.PI)},st=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},ot=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},at=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},lt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},ht=function(t){return{r:at(t.r,0,255),g:at(t.g,0,255),b:at(t.b,0,255),a:at(t.a)}},ut=function(t){return{r:ot(t.r),g:ot(t.g),b:ot(t.b),a:ot(t.a,3)}},ct=/^#([0-9a-f]{3,8})$/i,dt=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},ft=function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=Math.max(e,r,n),o=s-Math.min(e,r,n),a=o?s===e?(r-n)/o:s===r?2+(n-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},pt=function(t){var e=t.h,r=t.s,n=t.v,i=t.a;e=e/360*6,r/=100,n/=100;var s=Math.floor(e),o=n*(1-r),a=n*(1-(e-s)*r),l=n*(1-(1-e+s)*r),h=s%6;return{r:255*[n,a,o,o,l,n][h],g:255*[l,n,n,a,o,o][h],b:255*[o,o,l,n,n,a][h],a:i}},mt=function(t){return{h:lt(t.h),s:at(t.s,0,100),l:at(t.l,0,100),a:at(t.a)}},gt=function(t){return{h:ot(t.h),s:ot(t.s),l:ot(t.l),a:ot(t.a,3)}},_t=function(t){return pt((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},yt=function(t){return{h:(e=ft(t)).h,s:(i=(200-(r=e.s))*(n=e.v)/100)>0&&i<200?r*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,r,n,i},vt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xt=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bt=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Et=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Tt={string:[[function(t){var e=ct.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?ot(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?ot(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=bt.exec(t)||Et.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:ht({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=vt.exec(t)||xt.exec(t);if(!e)return null;var r,n,i=mt({h:(r=e[1],n=e[2],void 0===n&&(n="deg"),Number(r)*(it[n]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return _t(i)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=void 0===i?1:i;return st(e)&&st(r)&&st(n)?ht({r:Number(e),g:Number(r),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,i=t.a,s=void 0===i?1:i;if(!st(e)||!st(r)||!st(n))return null;var o=mt({h:Number(e),s:Number(r),l:Number(n),a:Number(s)});return _t(o)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,i=t.a,s=void 0===i?1:i;if(!st(e)||!st(r)||!st(n))return null;var o=function(t){return{h:lt(t.h),s:at(t.s,0,100),v:at(t.v,0,100),a:at(t.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(s)});return pt(o)},"hsv"]]},At=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},wt=function(t){return"string"==typeof t?At(t.trim(),Tt.string):"object"==typeof t&&null!==t?At(t,Tt.object):[null,void 0]},St=function(t,e){var r=yt(t);return{h:r.h,s:at(r.s+100*e,0,100),l:r.l,a:r.a}},Ct=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Rt=function(t,e){var r=yt(t);return{h:r.h,s:r.s,l:at(r.l+100*e,0,100),a:r.a}},It=function(){function t(t){this.parsed=wt(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return ot(Ct(this.rgba),2)},t.prototype.isDark=function(){return Ct(this.rgba)<.5},t.prototype.isLight=function(){return Ct(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=ut(this.rgba)).r,r=t.g,n=t.b,s=(i=t.a)<1?dt(ot(255*i)):"","#"+dt(e)+dt(r)+dt(n)+s;var t,e,r,n,i,s},t.prototype.toRgb=function(){return ut(this.rgba)},t.prototype.toRgbString=function(){return e=(t=ut(this.rgba)).r,r=t.g,n=t.b,(i=t.a)<1?"rgba("+e+", "+r+", "+n+", "+i+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,i},t.prototype.toHsl=function(){return gt(yt(this.rgba))},t.prototype.toHslString=function(){return e=(t=gt(yt(this.rgba))).h,r=t.s,n=t.l,(i=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+i+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,i},t.prototype.toHsv=function(){return t=ft(this.rgba),{h:ot(t.h),s:ot(t.s),v:ot(t.v),a:ot(t.a,3)};var t},t.prototype.invert=function(){return Pt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Pt(St(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Pt(St(this.rgba,-t))},t.prototype.grayscale=function(){return Pt(St(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Pt(Rt(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Pt(Rt(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Pt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ot(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=yt(this.rgba);return"number"==typeof t?Pt({h:t,s:e.s,l:e.l,a:e.a}):ot(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Pt(t).toHex()},t}(),Pt=function(t){return t instanceof It?t:new It(t)},Mt=[];!function(t){t.forEach((function(t){Mt.indexOf(t)<0&&(t(It,Tt),Mt.push(t))}))}([function(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in r)n[r[i]]=i;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var i,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var l=this.toRgb(),h=1/0,u="black";if(!s.length)for(var c in r)s[c]=new t(r[c]).toRgb();for(var d in r){var f=(i=l,o=s[d],Math.pow(i.r-o.r,2)+Math.pow(i.g-o.g,2)+Math.pow(i.b-o.b,2));f<h&&(h=f,u=d)}return u}},e.string.push([function(e){var n=e.toLowerCase(),i="transparent"===n?"#0000":r[n];return i?new t(i).toRgb():null},"name"])}]);const Ot=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Ot)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if("number"===r||"string"===r||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,r)=>t===e[r]));if(null!==t&&null!==e){const r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every((r=>t[r]===e[r]))}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return(t=t??[])[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*n),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(t){const[e,r,n,i]=Ot.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=i,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,i=255&this._int;return e&&(r=r*t+.5|0,n=n*t+.5|0,i=i*t+.5|0),(255*t<<24)+(r<<16)+(n<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,i]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}normalize(t){let e,r,n,i;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){e=(t>>16&255)/255,r=(t>>8&255)/255,n=(255&t)/255,i=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,i=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,i=255]=t,e/=255,r/=255,n/=255,i/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){const e=Ot.HEX_PATTERN.exec(t);e&&(t=`#${e[2]}`)}const s=Pt(t);s.isValid()&&(({r:e,g:r,b:n,a:i}=s.rgba),e/=255,r/=255,n/=255)}if(void 0===e)throw new Error(`Unable to convert color ${t}`);this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=i,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}_clamp(t,e=0,r=1){return"number"==typeof t?Math.min(Math.max(t,e),r):(t.forEach(((n,i)=>{t[i]=Math.min(Math.max(n,e),r)})),t)}};let Dt=Ot;function Nt(t,e=[]){return Z(0,"utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Dt.shared.setValue(t).toRgbArray(e)}function Ft(t){return Z(0,"utils.hex2string is deprecated, use Color#toHex instead"),Dt.shared.setValue(t).toHex()}function Lt(t){return Z(0,"utils.string2hex is deprecated, use Color#toNumber instead"),Dt.shared.setValue(t).toNumber()}function Bt(t){return Z(0,"utils.rgb2hex is deprecated, use Color#toNumber instead"),Dt.shared.setValue(t).toNumber()}Dt.shared=new Ot,Dt.temp=new Ot,Dt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const kt=function(){const t=[],e=[];for(let n=0;n<32;n++)t[n]=n,e[n]=n;t[l.NORMAL_NPM]=l.NORMAL,t[l.ADD_NPM]=l.ADD,t[l.SCREEN_NPM]=l.SCREEN,e[l.NORMAL]=l.NORMAL_NPM,e[l.ADD]=l.ADD_NPM,e[l.SCREEN]=l.SCREEN_NPM;const r=[];return r.push(e),r.push(t),r}();function Ut(t,e){return kt[e?1:0][t]}function Gt(t,e,r,n=!0){return Z(0,"utils.premultiplyRgba has moved to Color.premultiply"),Dt.shared.setValue(t).premultiply(e,n).toArray(r??new Float32Array(4))}function jt(t,e){return Z(0,"utils.premultiplyTint has moved to Color.toPremultiplied"),Dt.shared.setValue(t).toPremultiplied(e)}function Vt(t,e,r,n=!0){return Z(0,"utils.premultiplyTintToRgba has moved to Color.premultiply"),Dt.shared.setValue(t).premultiply(e,n).toArray(r??new Float32Array(4))}const Ht=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function zt(t,e=null){const r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let n=0,i=0;n<r;n+=6,i+=4)e[n+0]=i+0,e[n+1]=i+1,e[n+2]=i+2,e[n+3]=i+0,e[n+4]=i+2,e[n+5]=i+3;return e}function Wt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}const Xt={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function Yt(t,e){let r=0,n=0;const i={};for(let l=0;l<t.length;l++)n+=e[l],r+=t[l].length;const s=new ArrayBuffer(4*r);let o=null,a=0;for(let l=0;l<t.length;l++){const r=e[l],h=t[l],u=Wt(h);i[u]||(i[u]=new Xt[u](s)),o=i[u];for(let t=0;t<h.length;t++){o[(t/r|0)*n+a+t%r]=h[t]}a+=r}return new Float32Array(s)}function Kt(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function $t(t){return!(t&t-1||!t)}function qt(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1}function Qt(t,e,r){const n=t.length;let i;if(e>=n||0===r)return;const s=n-(r=e+r>n?n-e:r);for(i=e;i<s;++i)t[i]=t[i+r];t.length=s}function Jt(t){return 0===t?0:t<0?-1:1}let Zt=0;function te(){return++Zt}const ee=class{constructor(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let re=ee;re.EMPTY=new ee(0,0,0,0);const ne={},ie=Object.create(null),se=Object.create(null);function oe(){let t;for(t in ie)ie[t].destroy();for(t in se)se[t].destroy()}function ae(){let t;for(t in ie)delete ie[t];for(t in se)delete se[t]}class le{constructor(t,e,r){this._canvas=S.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||S.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function he(t,e,r){for(let n=0,i=4*r*e;n<e;++n,i+=4)if(0!==t[i+3])return!1;return!0}function ue(t,e,r,n,i){const s=4*e;for(let o=n,a=n*s+4*r;o<=i;++o,a+=s)if(0!==t[a+3])return!1;return!0}function ce(t){const{width:e,height:r}=t,n=t.getContext("2d",{willReadFrequently:!0});if(null===n)throw new TypeError("Failed to get canvas 2D context");const i=n.getImageData(0,0,e,r).data;let s=0,o=0,a=e-1,l=r-1;for(;o<r&&he(i,e,o);)++o;if(o===r)return re.EMPTY;for(;he(i,e,l);)--l;for(;ue(i,e,s,o,l);)++s;for(;ue(i,e,a,o,l);)--a;return++a,++l,new re(s,o,a,l)}function de(t){const e=ce(t),{width:r,height:n}=e;let i=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(e.left,e.top,r,n)}return{width:r,height:n,data:i}}function fe(t){const e=Ht.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}let pe;function me(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,pe||(pe=document.createElement("a")),pe.href=t;const r=K.parse(pe.href),n=!r.port&&""===e.port||r.port===e.port;return r.hostname===e.hostname&&n&&r.protocol===e.protocol?"":"anonymous"}function ge(t,e=1){const r=S.RETINA_PREFIX?.exec(t);return r?parseFloat(r[1]):e}var _e=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(_e||{});const ye=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},ve=(t,e)=>ye(t).priority??e,xe={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(ye).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(ye).forEach((t=>{t.type.forEach((e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))}))})),this},handle(t,e,r){const n=this._addHandlers,i=this._removeHandlers;if(n[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);n[t]=e,i[t]=r;const s=this._queue;return s[t]&&(s[t].forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>ve(e,r)-ve(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))}};class be{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Ee=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Te(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function Ae(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=Ee.replace(/%forloop%/gi,Te(t));if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}class we{constructor(){this.data=0,this.blendMode=l.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==l.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new we;return t.depthTest=!1,t.blend=!0,t}}const Se=[];function Ce(t,e){if(!t)return null;let r="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(r=e[1].toLowerCase())}for(let n=Se.length-1;n>=0;--n){const i=Se[n];if(i.test&&i.test(t,r))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Re{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,i,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:h}=this;this._aliasCount++;for(let u=0,c=h.length;u<c;u++)h[u][l](t,e,r,n,i,s,o,a);return h===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Re.prototype,{dispatch:{value:Re.prototype.emit},run:{value:Re.prototype.emit}});class Ie{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Re("setRealSize"),this.onUpdate=new Re("update"),this.onError=new Re("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Pe extends Ie{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK);const i=e.realWidth,s=e.realHeight;return r.width===i&&r.height===s?n.texSubImage2D(e.target,0,0,0,i,s,e.format,r.type,this.data):(r.width=i,r.height=s,n.texImage2D(e.target,0,r.internalFormat,i,s,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Me={scaleMode:p.NEAREST,format:u.RGBA,alphaMode:_.NPM},Oe=class extends W{constructor(t=null,e=null){super(),e=Object.assign({},Oe.defaultOptions,e);const{alphaMode:r,mipmap:n,anisotropicLevel:i,scaleMode:s,width:o,height:a,wrapMode:l,format:h,type:u,target:c,resolution:d,resourceOptions:f}=e;!t||t instanceof Ie||((t=Ce(t,f)).internal=!0),this.resolution=d||S.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=s,this.format=h,this.type=u,this.target=c,this.alphaMode=r,this.uid=te(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=$t(this.realWidth)&&$t(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete se[this.cacheId],delete ie[this.cacheId],this.cacheId=null),this.dispose(),Oe.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=S.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let i=null;if(n)i=t;else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${te()}`}i=t._pixiId}let s=se[i];if(n&&r&&!s)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return s||(s=new Oe(t,e),s.cacheId=i,Oe.addToCache(s,i)),s}static fromBuffer(t,e,r,n){t=t||new Float32Array(e*r*4);const i=new Pe(t,{width:e,height:r}),s=t instanceof Float32Array?d.FLOAT:d.UNSIGNED_BYTE;return new Oe(i,Object.assign({},Me,{type:s},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),se[e]&&se[e],se[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=se[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete se[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete se[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let De=Oe;De.defaultOptions={mipmap:g.POW2,anisotropicLevel:0,scaleMode:p.LINEAR,wrapMode:m.CLAMP,alphaMode:_.UNPACK,target:c.TEXTURE_2D,format:u.RGBA,type:d.UNSIGNED_BYTE},De._globalBatch=0;class Ne{constructor(){this.texArray=null,this.blend=0,this.type=h.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Fe=0;class Le{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this["static"]=e,this.id=Fe++,this.disposeRunner=new Re("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?A.ELEMENT_ARRAY_BUFFER:A.ARRAY_BUFFER}get index(){return this.type===A.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Le(t)}}class Be{constructor(t,e=0,r=!1,n=d.FLOAT,i,s,o,a=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=i,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,r,n,i){return new Be(t,e,r,n,i)}}const ke={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const Ue={5126:4,5123:2,5121:1};let Ge=0;const je={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class Ve{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Ge++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Re("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,i,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Le||(e instanceof Array&&(e=new Float32Array(e)),e=new Le(e));const l=t.split("|");if(l.length>1){for(let t=0;t<l.length;t++)this.addAttribute(l[t],e,r,n,i);return this}let h=this.buffers.indexOf(e);return-1===h&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new Be(h,r,n,i,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Le||(t instanceof Array&&(t=new Uint16Array(t)),t=new Le(t)),t.type=A.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],r=new Le;let n;for(n in this.attributes){const r=this.attributes[n],i=this.buffers[r.buffer];t.push(i.data),e.push(r.size*Ue[r.type]/4),r.buffer=0}for(r.data=function(t,e){let r=0,n=0;const i={};for(let l=0;l<t.length;l++)n+=e[l],r+=t[l].length;const s=new ArrayBuffer(4*r);let o=null,a=0;for(let l=0;l<t.length;l++){const r=e[l],h=t[l],u=Wt(h);i[u]||(i[u]=new ke[u](s)),o=i[u];for(let t=0;t<h.length;t++)o[(t/r|0)*n+a+t%r]=h[t];a+=r}return new Float32Array(s)}(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ve;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Le(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Be(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=A.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ve,r=[],n=[],i=[];let s;for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)n[t]=n[t]||0,n[t]+=s.buffers[t].data.length,i[t]=0}for(let o=0;o<s.buffers.length;o++)r[o]=new(je[Wt(s.buffers[o].data)])(n[o]),e.buffers[o]=new Le(r[o]);for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)r[t].set(s.buffers[t].data,i[t]),i[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=A.ELEMENT_ARRAY_BUFFER;let r=0,n=0,i=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(n+=e.size*Ue[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+i]+=r;r+=t[s].buffers[o].data.length/n,i+=a.length}}return e}}class He extends Ve{constructor(t=!1){super(),this._buffer=new Le(null,t,!1),this._indexBuffer=new Le(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,d.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,d.FLOAT).addAttribute("aColor",this._buffer,4,!0,d.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,d.FLOAT).addIndex(this._indexBuffer)}}const ze=2*Math.PI,We=180/Math.PI,Xe=Math.PI/180;var Ye=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(Ye||{});class Ke{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ke(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const $e=[new Ke,new Ke,new Ke,new Ke];class qe{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=Ye.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new qe(0,0,0,0)}clone(){return new qe(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,n=this.right,i=this.top,s=this.bottom;if(n<=r||s<=i)return!1;const o=$e[0].set(t.left,t.top),a=$e[1].set(t.left,t.bottom),l=$e[2].set(t.right,t.top),h=$e[3].set(t.right,t.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(l,l),e.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=r||Math.min(o.x,a.x,l.x,h.x)>=n||Math.max(o.y,a.y,l.y,h.y)<=i||Math.min(o.y,a.y,l.y,h.y)>=s)return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),f=c*r+d*i,p=c*n+d*i,m=c*r+d*s,g=c*n+d*s;if(Math.max(f,p,m,g)<=c*o.x+d*o.y||Math.min(f,p,m,g)>=c*h.x+d*h.y)return!1;const _=u*(o.y-l.y),y=u*(l.x-o.x),v=_*r+y*i,x=_*n+y*i,b=_*r+y*s,E=_*n+y*s;return!(Math.max(v,x,b,E)<=_*o.x+y*o.y||Math.min(v,x,b,E)>=_*h.x+y*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(i-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=i-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Qe{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=Ye.CIRC}clone(){return new Qe(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,i=this.y-e;return n*=n,i*=i,n+i<=r}getBounds(){return new qe(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Je{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=Ye.ELIP}clone(){return new Je(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new qe(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ze{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.type=Ye.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Ze(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let i=0,s=n-1;i<n;s=i++){const n=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],l=this.points[2*s+1];o>e!=l>e&&t<(e-o)/(l-o)*(a-n)+n&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class tr{constructor(t=0,e=0,r=0,n=0,i=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=i,this.type=Ye.RREC}clone(){return new tr(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),i=e-(this.y+r);const s=r*r;if(n*n+i*i<=s)return!0;if(n=t-(this.x+this.width-r),n*n+i*i<=s)return!0;if(i=e-(this.y+this.height-r),n*n+i*i<=s)return!0;if(n=t-(this.x+r),n*n+i*i<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class er{constructor(t=1,e=0,r=0,n=1,i=0,s=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,i,s){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ke;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new Ke;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,i=t.y;return e.x=this.d*r*n+-this.c*r*i+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*i+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,i=this.c,s=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=i*e-this.d*r,this.d=i*r+this.d*e,this.tx=s*e-this.ty*r,this.ty=s*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,i=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*i,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*i,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*i+this.ty,this}setTransform(t,e,r,n,i,s,o,a,l){return this.a=Math.cos(o+l)*i,this.b=Math.sin(o+l)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,i=this.d,s=t.pivot,o=-Math.atan2(-n,i),a=Math.atan2(r,e),l=Math.abs(o+a);return l<1e-5||Math.abs(ze-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+i*i),t.position.x=this.tx+(s.x*e+s.y*n),t.position.y=this.ty+(s.x*r+s.y*i),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,s=t*n-e*r;return this.a=n/s,this.b=-e/s,this.c=-r/s,this.d=t/s,this.tx=(r*this.ty-n*i)/s,this.ty=-(t*this.ty-e*i)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new er;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new er}static get TEMP_MATRIX(){return new er}}const rr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],nr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ir=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],sr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],or=[],ar=[],lr=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];or.push(e);for(let r=0;r<16;r++){const n=lr(rr[t]*rr[r]+ir[t]*nr[r]),i=lr(nr[t]*rr[r]+sr[t]*nr[r]),s=lr(rr[t]*ir[r]+ir[t]*sr[r]),o=lr(nr[t]*ir[r]+sr[t]*sr[r]);for(let t=0;t<16;t++)if(rr[t]===n&&nr[t]===i&&ir[t]===s&&sr[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new er;e.set(rr[t],nr[t],ir[t],sr[t],0,0),ar.push(e)}}();const hr={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>rr[t],uY:t=>nr[t],vX:t=>ir[t],vY:t=>sr[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>or[t][e],sub:(t,e)=>or[t][hr.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?hr.S:hr.N:2*Math.abs(e)<=Math.abs(t)?t>0?hr.E:hr.W:e>0?t>0?hr.SE:hr.SW:t>0?hr.NE:hr.NW,matrixAppendRotationInv:(t,e,r=0,n=0)=>{const i=ar[hr.inv(e)];i.tx=r,i.ty=n,t.append(i)}};class ur{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ur(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const cr=class{constructor(){this.worldTransform=new er,this.localTransform=new er,this.position=new ur(this.onChange,this,0,0),this.scale=new ur(this.onChange,this,1,1),this.pivot=new ur(this.onChange,this,0,0),this.skew=new ur(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let dr=cr;dr.IDENTITY=new cr;const fr=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],pr={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},mr={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const gr={};let _r,yr=gr;function vr(){if(yr===gr||yr?.isContextLost()){const t=S.ADAPTER.createCanvas();let e;S.PREFER_ENV>=n.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),yr=e}return yr}const xr={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function br(t){return xr[t]}let Er=null;const Tr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ar(t,e){if(!Er){const e=Object.keys(Tr);Er={};for(let r=0;r<e.length;++r){const n=e[r];Er[t[n]]=Tr[n]}}return Er[e]}function wr(t,e,r){if("precision"!==t.substring(0,9)){let n=e;return e===x.HIGH&&r!==x.HIGH&&(n=x.MEDIUM),`precision ${n} float;\n${t}`}return r!==x.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let Sr=0;const Cr={},Rr=class{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=Sr++,this.vertexSrc=t||Rr.defaultVertexSrc,this.fragmentSrc=e||Rr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Cr[r]?(Cr[r]++,r+=`-${Cr[r]}`):Cr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}\n${this.fragmentSrc}`,this.vertexSrc=wr(this.vertexSrc,Rr.defaultVertexPrecision,x.HIGH),this.fragmentSrc=wr(this.fragmentSrc,Rr.defaultFragmentPrecision,function(){if(!_r){_r=x.MEDIUM;const t=vr();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);_r=e.precision?x.HIGH:x.MEDIUM}}return _r}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,r){const n=t+e;let i=ne[n];return i||(ne[n]=i=new Rr(t,e,r)),i}};let Ir=Rr;Ir.defaultVertexPrecision=x.HIGH,Ir.defaultFragmentPrecision=z.apple.device?x.HIGH:x.MEDIUM;let Pr=0;class Mr{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Pr++,this["static"]=!!e,this.ubo=!!r,t instanceof Le?(this.buffer=t,this.buffer.type=A.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Le(new Float32Array(1)),this.buffer.type=A.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new Mr(e,r)}static from(t,e,r){return new Mr(t,e,r)}static uboFrom(t,e){return new Mr(t,e??!0,!0)}}class Or{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Mr?e:new Mr(e):new Mr({}),this.disposeRunner=new Re("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=Ir.from(t,e);return new Or(n,r)}}class Dr{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=Mr.from({uSamplers:e},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ir(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new er,"default":this.defaultGroupCache[t]};return new Or(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Nr{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Fr{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Lr=class extends Fr{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=He,this.vertexSize=6,this.state=we.for2d(),this.size=4*Lr.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const r=S.ADAPTER.getNavigator();if(z.tablet||z.phone){if(z.apple.device){const t=r.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(z.android.device){const t=r.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!z.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Z(0,"BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=Lr.defaultVertexSrc,fragment:e=Lr.defaultFragmentTemplate}={}){this.shaderGenerator=new Dr(t,e)}contextChange(){const t=this.renderer.gl;S.PREFER_ENV===n.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Lr.defaultMaxTextures),this.maxTextures=Ae(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Lr,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new Ne);for(;e.length<n;)e.push(new Nr);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Lr._textureArrayPool,n=this.renderer.batch,i=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++De._globalBatch,a=0,l=r[0],h=0;n.copyBoundTextures(i,e);for(let u=0;u<this._bufferSize;++u){const c=t[u];t[u]=null,c._batchEnabled!==o&&(l.count>=e&&(n.boundArray(l,i,o,e),this.buildDrawCalls(l,h,u),h=u,l=r[++a],++o),c._batchEnabled=o,c.touched=s,l.elements[l.count++]=c)}l.count>0&&(n.boundArray(l,i,o,e),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let u=0;u<i.length;u++)i[u]=null;De._globalBatch=o}buildDrawCalls(t,e,r){const{_bufferedElements:n,_attributeBuffer:i,_indexBuffer:s,vertexSize:o}=this,a=Lr._drawCallPool;let l=this._dcIndex,h=this._aIndex,u=this._iIndex,c=a[l];c.start=this._iIndex,c.texArray=t;for(let d=e;d<r;++d){const r=n[d],f=r._texture.baseTexture,p=kt[f.alphaMode?1:0][r.blendMode];n[d]=null,e<d&&c.blend!==p&&(c.size=u-c.start,e=d,c=a[++l],c.texArray=t,c.start=u),this.packInterleavedGeometry(r,i,s,h,u),h+=r.vertexData.length/2*o,u+=r.indices.length,c.blend=p}e<r&&(c.size=u-c.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=u}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Lr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,n=Lr._drawCallPool;let i=null;for(let s=0;s<t;s++){const{texArray:t,type:o,size:a,start:l,blend:h}=n[s];i!==t&&(i=t,this.bindAndClearTexArray(t)),this.state.blendMode=h,r.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Lr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Kt(Math.ceil(t/8)),r=qt(e),n=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new be(n*this.vertexSize*4)),i}getIndexBuffer(t){const e=Kt(Math.ceil(t/12)),r=qt(e),n=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i}packInterleavedGeometry(t,e,r,n,i){const{uint32View:s,float32View:o}=e,a=n/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Dt.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let p=0;p<u.length;p+=2)o[n++]=u[p],o[n++]=u[p+1],o[n++]=l[p],o[n++]=l[p+1],s[n++]=f,o[n++]=c;for(let p=0;p<h.length;p++)r[i++]=a+h[p]}};let Br=Lr;Br.defaultBatchSize=4096,Br.extension={name:"batch",type:_e.RendererPlugin},Br._drawCallPool=[],Br._textureArrayPool=[],xe.add(Br);const kr=class extends Or{constructor(t,e,r){super(Ir.from(t||kr.defaultVertexSrc,e||kr.defaultFragmentSrc),r),this.padding=0,this.resolution=kr.defaultResolution,this.multisample=kr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new we}apply(t,e,r,n,i){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let Ur=kr;Ur.defaultResolution=1,Ur.defaultMultisample=T.NONE;class Gr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Dt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,i=r??e;void 0!==i&&(this.color=i),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Gr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Gr.extension={type:[_e.RendererSystem,_e.CanvasRendererSystem],name:"background"},xe.add(Gr);class jr{constructor(t){this.renderer=t,this.emptyRenderer=new Fr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:i,ids:s,count:o}=t;let a=0;for(let l=0;l<o;l++){const t=i[l],o=t._batchLocation;if(o>=0&&o<n&&e[o]===t)s[l]=o;else for(;a<n;){const n=e[a];if(!n||n._batchEnabled!==r||n._batchLocation!==a){s[l]=a,t._batchLocation=a,e[a]=t;break}a++}}}destroy(){this.renderer=null}}jr.extension={type:_e.RendererSystem,name:"batch"},xe.add(jr);let Vr=0;class Hr{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Vr++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Vr++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(S.PREFER_ENV>=n.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&e.stencil;const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n}}Hr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Hr.extension={type:_e.RendererSystem,name:"context"},xe.add(Hr);class zr extends Pe{upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK);const i=e.realWidth,s=e.realHeight;return r.width===i&&r.height===s?n.texSubImage2D(e.target,0,0,0,i,s,e.format,r.type,this.data):(r.width=i,r.height=s,n.texImage2D(e.target,0,r.internalFormat,i,s,0,e.format,r.type,this.data)),!0}}class Wr{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Re("disposeFramebuffer"),this.multisample=T.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new De(null,{scaleMode:p.NEAREST,resolution:1,mipmap:g.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new De(new zr(null,{width:this.width,height:this.height}),{scaleMode:p.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:g.OFF,format:u.DEPTH_COMPONENT,type:d.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],i=n.resolution;n.setSize(t/i,e/i)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Xr extends De{constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=T.NONE),super(null,t),this.mipmap=g.OFF,this.valid=!0,this._clear=new Dt([0,0,0,0]),this.framebuffer=new Wr(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Yr extends Ie{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=me(e)}upload(t,e,r,n){const i=t.gl,s=e.realWidth,o=e.realHeight;if(n=n||this.source,"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement){if(!n.complete||0===n.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement&&n.readyState<=1&&0===n.buffered.length)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||r.width!==s||r.height!==o?(r.width=s,r.height=o,i.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,r.type,n),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Kr extends Yr{constructor(t,e){if(e=e||{},"string"==typeof t){const r=new Image;Yr.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??S.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then((t=>t.blob())).then((r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===_.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,r){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let t=!0;const n=e._glTextures;for(const i in n){const s=n[i];if(s!==r&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class $r{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,i=e.height;if(r){const e=t.width/2/n,s=t.height/2/i,o=t.x/n+e,a=t.y/i+s;r=hr.add(r,hr.NW),this.x0=o+e*hr.uX(r),this.y0=a+s*hr.uY(r),r=hr.add(r,2),this.x1=o+e*hr.uX(r),this.y1=a+s*hr.uY(r),r=hr.add(r,2),this.x2=o+e*hr.uX(r),this.y2=a+s*hr.uY(r),r=hr.add(r,2),this.x3=o+e*hr.uX(r),this.y3=a+s*hr.uY(r)}else this.x0=t.x/n,this.y0=t.y/i,this.x1=(t.x+t.width)/n,this.y1=t.y/i,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/i,this.x3=t.x/n,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const qr=new $r;function Qr(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Jr extends W{constructor(t,e,r,n,i,s,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new qe(0,0,1,1)),t instanceof Jr&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=qr,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new Ke(s.x,s.y):new Ke(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&ie[t.url]&&Jr.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Jr.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Jr(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===qr&&(this._uvs=new $r),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=S.STRICT_TEXTURE_CACHE){const n="string"==typeof t;let i=null;if(n)i=t;else if(t instanceof De){if(!t.cacheId){const r=e?.pixiIdPrefix||"pixiid";t.cacheId=`${r}-${te()}`,De.addToCache(t,t.cacheId)}i=t.cacheId}else{if(!t._pixiId){const r=e?.pixiIdPrefix||"pixiid";t._pixiId=`${r}_${te()}`}i=t._pixiId}let s=ie[i];if(n&&r&&!s)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return s||t instanceof De?!s&&t instanceof De&&(s=new Jr(t),Jr.addToCache(s,i)):(e.resolution||(e.resolution=ge(t)),s=new Jr(new De(t,e)),s.baseTexture.cacheId=i,De.addToCache(s.baseTexture,i),Jr.addToCache(s,i)),s}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),n=Jr.from(t,Object.assign({resourceOptions:r},e),!1),i=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):i.load().then((()=>Promise.resolve(n)))}static fromBuffer(t,e,r,n){return new Jr(De.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const i=new De(t,Object.assign({scaleMode:De.defaultOptions.scaleMode,resolution:ge(e)},n)),{resource:s}=i;s instanceof Kr&&(s.url=e);const o=new Jr(i);return r||(r=e),De.addToCache(o.baseTexture,r),Jr.addToCache(o,r),r!==e&&(De.addToCache(o.baseTexture,e),Jr.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ie[e]&&ie[e],ie[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=ie[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ie[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ie[t.textureCacheIds[e]]===t&&delete ie[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:i}=t,s=e+n>this.baseTexture.width,o=r+i>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,l=`Y: ${r} + ${i} = ${r+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${l}`)}this.valid=n&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Jr._EMPTY||(Jr._EMPTY=new Jr(new De),Qr(Jr._EMPTY),Qr(Jr._EMPTY.baseTexture)),Jr._EMPTY}static get WHITE(){if(!Jr._WHITE){const t=S.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Jr._WHITE=new Jr(De.from(t)),Qr(Jr._WHITE),Qr(Jr._WHITE.baseTexture)}return Jr._WHITE}}class Zr extends Jr{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,i=Math.round(t*n)/n,s=Math.round(e*n)/n;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,r&&this.baseTexture.resize(i,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Zr(new Xr(t))}}class tn{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=T.NONE){const n=new Xr(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Zr(n)}getOptimalTexture(t,e,r=1,n=T.NONE){let i;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=n>1?-n:-1:(i=((65535&(t=Kt(t)))<<16|65535&(e=Kt(e)))>>>0,n>1&&(i+=4294967296*n)),this.texturePool[i]||(this.texturePool[i]=[]);let s=this.texturePool[i].pop();return s||(s=this.createTexture(t,e,n)),s.filterPoolKey=i,s.setResolution(r),s}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||T.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}tn.SCREEN_KEY=-1;class en extends Ve{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class rn extends Ve{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Le(this.vertices),this.uvBuffer=new Le(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class nn{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=T.NONE,this.sourceFrame=new qe,this.destinationFrame=new qe,this.bindingSourceFrame=new qe,this.bindingDestinationFrame=new qe,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const sn=[new Ke,new Ke,new Ke,new Ke],on=new er;class an{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new tn,this.statePool=[],this.quad=new en,this.quadUv=new rn,this.tempRect=new qe,this.activeState={},this.globalUniforms=new Mr({outputFrame:new qe,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,i=this.statePool.pop()||new nn,s=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,l=e[0].padding,h=e[0].autoFit,u=e[0].legacy??!0;for(let f=1;f<e.length;f++){const t=e[f];o=Math.min(o,t.resolution),a=Math.min(a,t.multisample),l=this.useMaxPadding?Math.max(l,t.padding):l+t.padding,h=h&&t.autoFit,u=u||(t.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=s.current),n.push(i),i.resolution=o,i.multisample=a,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(l);const c=this.tempRect.copyFrom(s.sourceFrame);r.projection.transform&&this.transformAABB(on.copyFrom(r.projection.transform).invert(),c),h?(i.sourceFrame.fit(c),(i.sourceFrame.width<=0||i.sourceFrame.height<=0)&&(i.sourceFrame.width=0,i.sourceFrame.height=0)):i.sourceFrame.intersects(c)||(i.sourceFrame.width=0,i.sourceFrame.height=0),this.roundFrame(i.sourceFrame,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o,a),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=i.sourceFrame.width,d.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=r.projection.transform,r.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,d),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const i=n.inputSize,s=n.inputPixel,o=n.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*e.resolution),s[1]=Math.round(i[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*i[2]-.5*s[2],o[3]=e.sourceFrame.height*i[3]-.5*s[3],e.legacy){const t=n.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,a.renderTexture,y.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,n=this.getOptimalFilterTexture(t.width,t.height,e.resolution);n.filterFrame=t.filterFrame;let i=0;for(i=0;i<r.length-1;++i){1===i&&e.multisample>1&&(n=this.getOptimalFilterTexture(t.width,t.height,e.resolution),n.filterFrame=t.filterFrame),r[i].apply(this,t,n,y.CLEAR,e);const s=t;t=n,n=s}r[i].apply(this,t,a.renderTexture,y.BLEND,e),i>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(n)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=y.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,r.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&n.stateId||this.forceClear;(e===y.CLEAR||e===y.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const i=this.renderer;i.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(h.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(h.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:i}=e._texture,s=t.set(n.width,0,0,n.height,r.x,r.y),o=e.worldTransform.copyTo(er.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/i.width,1/i.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=T.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if("number"==typeof t){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||T.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=sn[0],n=sn[1],i=sn[2],s=sn[3];r.set(e.left,e.top),n.set(e.left,e.bottom),i.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(i,i),t.apply(s,s);const o=Math.min(r.x,n.x,i.x,s.x),a=Math.min(r.y,n.y,i.y,s.y),l=Math.max(r.x,n.x,i.x,s.x),h=Math.max(r.y,n.y,i.y,s.y);e.x=o,e.y=a,e.width=l-o,e.height=h-a}roundFrame(t,e,r,n,i){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(i){const{a:t,b:e,c:r,d:n}=i;if((Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4))return}(i=i?on.copyFrom(i):on.identity()).translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)}}}an.extension={type:_e.RendererSystem,name:"filter"},xe.add(an);class ln{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=T.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const hn=new qe;class un{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Wr(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new qe,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;S.PREFER_ENV===n.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=r),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const r=t.colorTextures[e];this.renderer.texture.unbind(r.parentTextureArray||r)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>r,n=e.height>>r,i=t/e.width;this.setViewport(e.x*i,e.y*i,t,n)}else{const e=t.width>>r,n=t.height>>r;this.setViewport(0,0,e,n)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const i=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),i.width===r&&i.height===n&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=r,i.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,i=a.COLOR|a.DEPTH){const{gl:s}=this;s.clearColor(t,e,r,n),s.clear(i)}initFramebuffer(t){const{gl:e}=this,r=new ln(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let i=n.length;e.drawBuffers||(i=Math.min(i,1));for(let s=0;s<i;s++){const i=n[s],o=i.parentTextureArray||i;this.renderer.texture.bind(o,0),0===s&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures;let s=i.length;r.drawBuffers||(s=Math.min(s,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=i[a],l=s.parentTextureArray||s;this.renderer.texture.bind(l,0),0===a&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,s.target,l._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),t.depthTexture){if(this.writeDepthTexture){const n=t.depthTexture;this.renderer.texture.bind(n,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null):(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=T.NONE;if(t<=1||null===e)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return 1===r&&(r=T.NONE),r}blit(t,e,r){const{current:n,renderer:i,gl:s,CONTEXT_UID:o}=this;if(2!==i.context.webGLVersion)return;if(!n)return;const a=n.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=n.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new Wr(n.width,n.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===n.width&&t.height===n.height||(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||((e=hn).width=n.width,e.height=n.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,s.COLOR_BUFFER_BIT,l?s.NEAREST:s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const r=t.width,n=t.height,i=this.gl,s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,r,n):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,r,n),e.stencil=s,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new qe}destroy(){this.renderer=null}}un.extension={type:_e.RendererSystem,name:"framebuffer"},xe.add(un);const cn={5126:4,5123:2,5121:1};class dn{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;S.PREFER_ENV===n.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,r)=>e.vertexAttribDivisorANGLE(t,r),t.drawElementsInstanced=(t,r,n,i,s)=>e.drawElementsInstancedANGLE(t,r,n,i,s),t.drawArraysInstanced=(t,r,n,i)=>e.drawArraysInstancedANGLE(t,r,n,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},i=!0);const s=n[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?r.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const i in n)if(!r[i])throw new Error(`shader and geometry incompatible, geometry missing the "${i}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,i=["g",t.id];for(const s in r)n[s]&&i.push(s,n[s].location);return i.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let h=l[a];if(h)return l[o.id]=h,h;const u=t.buffers,c=t.attributes,d={},f={};for(const p in u)d[p]=0,f[p]=0;for(const p in c)!c[p].size&&o.attributeData[p]?c[p].size=o.attributeData[p].size:c[p].size,d[c[p].buffer]+=c[p].size*cn[c[p].type];for(const p in c){const t=c[p],e=t.size;void 0===t.stride&&(d[t.buffer]===e*cn[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=e*cn[t.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(let p=0;p<u.length;p++){const t=u[p];s.bind(t),r&&t._glBuffers[i].refCount++}return this.activateVao(t,o),l[o.id]=h,l[a]=h,n.bindVertexArray(null),s.unbind(A.ARRAY_BUFFER),h}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,i=t.buffers,s=this.renderer?.buffer;if(t.disposeRunner.remove(this),r){if(s)for(let t=0;t<i.length;t++){const r=i[t]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0!==r.refCount||e||s.dispose(i[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),n.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,i=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let a=null;for(const l in o){const t=o[l],h=s[t.buffer],u=h._glBuffers[n];if(e.attributeData[l]){a!==u&&(i.bind(h),a=u);const n=e.attributeData[l].location;if(r.enableVertexAttribArray(n),r.vertexAttribPointer(n,t.size,t.type||r.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(n,t.divisor)}}}}draw(t,e,r,n){const{gl:i}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?i.UNSIGNED_SHORT:i.UNSIGNED_INT;(2===o||4===o&&this.canUseUInt32ElementIndex)&&(s.instanced?i.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(r||0)*o,n||1):i.drawElements(t,e||s.indexBuffer.data.length,a,(r||0)*o))}else s.instanced?i.drawArraysInstanced(t,r,e||s.getSize(),n||1):i.drawArrays(t,r,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}dn.extension={type:_e.RendererSystem,name:"geometry"},xe.add(dn);const fn=new er;class pn{constructor(t,e){this._texture=t,this.mapCoord=new er,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const i=t[n],s=t[n+1];e[n]=i*r.a+s*r.c+r.tx,e[n+1]=i*r.b+s*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,i=e.trim;i&&(fn.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(fn));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/s.width,o[1]=(e._frame.y+a+l)/s.height,o[2]=(e._frame.x+e._frame.width-a+l)/s.width,o[3]=(e._frame.y+e._frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}class mn extends Ur{constructor(t,e,r){let n=null;"string"!=typeof t&&void 0===e&&void 0===r&&(n=t,t=void 0,e=void 0,r=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r),this.maskSprite=n,this.maskMatrix=new er}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new pn(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class gn{constructor(t=null){this.type=b.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ur.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=b.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class _n{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const t=this.maskDataPool.pop()||new gn;t.pooled=!0,t.maskObject=e,r=t}const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==b.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case b.SCISSOR:this.renderer.scissor.push(r);break;case b.STENCIL:this.renderer.stencil.push(r);break;case b.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case b.COLOR:this.pushColorMask(r)}r.type===b.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case b.SCISSOR:this.renderer.scissor.pop(e);break;case b.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case b.SPRITE:this.popSpriteMask(e);break;case b.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===b.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=b.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=b.SCISSOR:t.type=b.STENCIL:t.type=b.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new mn]));const i=this.renderer,s=i.renderTexture;let o,a;if(s.current){const e=s.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||i.resolution,a=t.multisample??i.multisample;n[0].resolution=o,n[0].multisample=a,n[0].maskSprite=e;const l=r.filterArea;r.filterArea=e.getBounds(!0),i.filter.push(r,n),r.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))}destroy(){this.renderer=null}}_n.extension={type:_e.RendererSystem,name:"mask"},xe.add(_n);class yn{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(0===n?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const vn=new er,xn=[],bn=class extends yn{constructor(t){super(t),this.glConst=S.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,i=n.renderTexture,s=r.getBounds(!0,xn.pop()??new qe);this.roundFrameToPixels(s,i.current?i.current.resolution:n.resolution,i.sourceFrame,i.destinationFrame,n.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:i}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(bn.isMatrixRotated(e.worldTransform))return!1;if(bn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,n,i){bn.isMatrixRotated(i)||((i=i?vn.copyFrom(i):vn.identity()).translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(i,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&xn.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let En=bn;En.extension={type:_e.RendererSystem,name:"scissor"},xe.add(En);class Tn extends yn{constructor(t){super(t),this.glConst=S.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;0===n&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const i=t._colorMask;0!==i&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(t._colorMask=i,r.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;0!==n&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==n&&(r._colorMask=n,e.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Tn.extension={type:_e.RendererSystem,name:"stencil"},xe.add(Tn);class An{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Z(0,"renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Z(0,"renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Z(0,"renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}An.extension={type:[_e.RendererSystem,_e.CanvasRendererSystem],name:"_plugin"},xe.add(An);class wn{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new er,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const i=this.projectionMatrix,s=n?-1:1;i.identity(),i.a=1/e.width*2,i.d=s*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-s-e.y*i.d}setTransform(t){}destroy(){this.renderer=null}}wn.extension={type:_e.RendererSystem,name:"projection"},xe.add(wn);const Sn=new dr;class Cn{constructor(t){this.renderer=t,this._tempMatrix=new er}generateTexture(t,e){const{region:r,...n}=e||{},i=r||t.getLocalBounds(null,!0);0===i.width&&(i.width=1),0===i.height&&(i.height=1);const s=Zr.create({width:i.width,height:i.height,...n});this._tempMatrix.tx=-i.x,this._tempMatrix.ty=-i.y;const o=t.transform;return t.transform=Sn,this.renderer.render(t,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,s}destroy(){}}Cn.extension={type:[_e.RendererSystem,_e.CanvasRendererSystem],name:"textureGenerator"},xe.add(Cn);const Rn=new qe,In=new qe;class Pn{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new qe,this.destinationFrame=new qe,this.viewportFrame=new qe}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;let i,s,o;this.current=t,t?(i=t.baseTexture,o=i.resolution,e||(Rn.width=t.frame.width,Rn.height=t.frame.height,e=Rn),r||(In.x=t.frame.x,In.y=t.frame.y,In.width=e.width,In.height=e.height,r=In),s=i.framebuffer):(o=n.resolution,e||(Rn.width=n._view.screen.width,Rn.height=n._view.screen.height,e=Rn),r||((r=Rn).width=e.width,r.height=e.height));const a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=n.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(r,e,o,!s),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=Dt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,o=i.width!==s.width||i.height!==s.height;if(o){let{x:t,y:e,width:r,height:n}=this.viewportFrame;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,r,n)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Pn.extension={type:_e.RendererSystem,name:"renderTexture"},xe.add(Pn);class Mn{}class On{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Dn(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}function Nn(t){const e=new Array(t);for(let r=0;r<e.length;r++)e[r]=!1;return e}function Fn(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Nn(2*e);case"bvec3":return Nn(3*e);case"bvec4":return Nn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Ln(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),n=t.getShaderInfoLog(e).split("\n"),i={},s=n.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||i[t])&&(i[t]=!0,!0))),o=[""];s.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const a=r.join("\n");o[0]=a}function Bn(t,e){const r=Dn(t,t.VERTEX_SHADER,e.vertexSrc),n=Dn(t,t.FRAGMENT_SHADER,e.fragmentSrc),i=t.createProgram();t.attachShader(i,r),t.attachShader(i,n);const s=e.extra?.transformFeedbackVaryings;if(s&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(i,s.names,"separate"===s.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||function(t,e,r,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||Ln(t,r),t.getShaderParameter(n,t.COMPILE_STATUS)||Ln(t,n),t.getProgramInfoLog(e))}(t,i,r,n),e.attributeData=function(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i);if(n.name.startsWith("gl_"))continue;const s=Ar(e,n.type),o={type:s,name:n.name,size:br(s),location:e.getAttribLocation(t,n.name)};r[n.name]=o}return r}(i,t),e.uniformData=function(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const n=e.getActiveUniform(t,i),s=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),a=Ar(e,n.type);r[s]={name:s,index:i,type:a,size:n.size,isArray:o,value:Fn(a,n.size)}}return r}(i,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const r=Object.keys(e.attributeData);r.sort(((t,e)=>t>e?1:-1));for(let n=0;n<r.length;n++)e.attributeData[r[n]].location=n,t.bindAttribLocation(i,n,r[n]);t.linkProgram(i)}t.deleteShader(r),t.deleteShader(n);const o={};for(const a in e.uniformData){const r=e.uniformData[a];o[a]={location:t.getUniformLocation(i,a),value:Fn(r.type,r.size)}}return new On(i,o)}function kn(t,e,r,n,i){r.buffer.update(i)}const Un={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},Gn={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function jn(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let r=0,n=0,i=0;for(let s=0;s<e.length;s++){const t=e[s];if(r=Gn[t.data.type],t.data.size>1&&(r=Math.max(r,16)*t.data.size),t.dataLen=r,n%r!=0&&n<16){const t=n%r%16;n+=t,i+=t}n+r>16?(i=16*Math.ceil(i/16),t.offset=i,i+=r,n=r):(t.offset=i,n+=r,i+=r)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}function Vn(t,e){const r=[];for(const n in t)e[n]&&r.push(e[n]);return r.sort(((t,e)=>t.index-e.index)),r}function Hn(t,e){if(!t.autoManage)return{size:0,syncFunc:kn};const r=Vn(t.uniforms,e),{uboElements:n,size:i}=jn(r),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<n.length;o++){const e=n[o],r=t.uniforms[e.data.name],i=e.data.name;let a=!1;for(let t=0;t<fr.length;t++){const n=fr[t];if(n.codeUbo&&n.test(e.data,r)){s.push(`offset = ${e.offset/4};`,fr[t].codeUbo(e.data.name,r)),a=!0;break}}if(!a)if(e.data.size>1){const t=br(e.data.type),r=Math.max(Gn[e.data.type]/16,1),n=t/r,o=(4-n%4)%4;s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*r}; i++)\n                {\n                    for(var j = 0; j < ${n}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${o};\n                }\n\n                `)}else{const t=Un[e.data.type];s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}let zn;function Wn(){if("boolean"==typeof zn)return zn;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");zn=!0===t({a:"b"},"a","b")}catch(at){zn=!1}return zn}let Xn=0;const Yn={textureCount:0,uboCount:0};class Kn{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Xn++}systemCheck(){if(!Wn())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Yn.textureCount=0,Yn.uboCount=0,this.syncUniformGroup(t.uniformGroup,Yn)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();t["static"]&&t.dirtyId===r.uniformDirtyGroups[t.id]||(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const n in t.uniforms){const i=e[n];if(!i){t.uniforms[n]?.group&&(t.uniforms[n].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${n}, syncData);\n                    `));continue}const s=t.uniforms[n];let o=!1;for(let t=0;t<fr.length;t++)if(fr[t].test(i,s)){r.push(fr[t].code(n,s)),o=!0;break}if(!o){const t=(1!==i.size||i.isArray?mr:pr)[i.type].replace("location",`ud["${n}"].location`);r.push(`\n            cu = ud["${n}"];\n            cv = cu.value;\n            v = uv["${n}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t["static"]||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Yn,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const i=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=Hn(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,i=[`${r}-`];for(const s in n)i.push(s),e[s]&&i.push(e[s].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=Bn(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Kn.extension={type:_e.RendererSystem,name:"shader"},xe.add(Kn);class $n{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello,e.resize(e.screen.width,e.screen.height)}destroy(){}}$n.defaultOptions={hello:!1},$n.extension={type:[_e.RendererSystem,_e.CanvasRendererSystem],name:"startup"},xe.add($n);const qn=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=l.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new we,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[l.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.ADD]=[t.ONE,t.ONE],e[l.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.NONE]=[0,0],e[l.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[l.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[l.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[l.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[l.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[l.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[l.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[l.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[l.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[l.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[l.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(qn.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(qn.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):e||-1===r||this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let Qn=qn;Qn.extension={type:_e.RendererSystem,name:"state"},xe.add(Qn);class Jn extends W{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),r=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach((t=>{this.runners[t]=new Re(t)}))}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach((n=>{const i=r.find((t=>this._systemsHash[t]===n));n[t.name](e[i])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const Zn=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Zn.defaultMaxIdle,this.checkCountMax=Zn.defaultCheckCountMax,this.mode=Zn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==v.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const i=e[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[n]=null,r=!0)}if(r){let t=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[t++]=e[r]);e.length=t}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};let ti=Zn;ti.defaultMode=v.AUTO,ti.defaultMaxIdle=3600,ti.defaultCheckCountMax=600,ti.extension={type:_e.RendererSystem,name:"textureGC"},xe.add(ti);class ei{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=d.UNSIGNED_BYTE,this.internalFormat=u.RGBA,this.samplerType=0}}class ri{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new De,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[d.UNSIGNED_BYTE]:{[u.RGBA]:t.RGBA8,[u.RGB]:t.RGB8,[u.RG]:t.RG8,[u.RED]:t.R8,[u.RGBA_INTEGER]:t.RGBA8UI,[u.RGB_INTEGER]:t.RGB8UI,[u.RG_INTEGER]:t.RG8UI,[u.RED_INTEGER]:t.R8UI,[u.ALPHA]:t.ALPHA,[u.LUMINANCE]:t.LUMINANCE,[u.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[d.BYTE]:{[u.RGBA]:t.RGBA8_SNORM,[u.RGB]:t.RGB8_SNORM,[u.RG]:t.RG8_SNORM,[u.RED]:t.R8_SNORM,[u.RGBA_INTEGER]:t.RGBA8I,[u.RGB_INTEGER]:t.RGB8I,[u.RG_INTEGER]:t.RG8I,[u.RED_INTEGER]:t.R8I},[d.UNSIGNED_SHORT]:{[u.RGBA_INTEGER]:t.RGBA16UI,[u.RGB_INTEGER]:t.RGB16UI,[u.RG_INTEGER]:t.RG16UI,[u.RED_INTEGER]:t.R16UI,[u.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[d.SHORT]:{[u.RGBA_INTEGER]:t.RGBA16I,[u.RGB_INTEGER]:t.RGB16I,[u.RG_INTEGER]:t.RG16I,[u.RED_INTEGER]:t.R16I},[d.UNSIGNED_INT]:{[u.RGBA_INTEGER]:t.RGBA32UI,[u.RGB_INTEGER]:t.RGB32UI,[u.RG_INTEGER]:t.RG32UI,[u.RED_INTEGER]:t.R32UI,[u.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[d.INT]:{[u.RGBA_INTEGER]:t.RGBA32I,[u.RGB_INTEGER]:t.RGB32I,[u.RG_INTEGER]:t.RG32I,[u.RED_INTEGER]:t.R32I},[d.FLOAT]:{[u.RGBA]:t.RGBA32F,[u.RGB]:t.RGB32F,[u.RG]:t.RG32F,[u.RED]:t.R32F,[u.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[d.HALF_FLOAT]:{[u.RGBA]:t.RGBA16F,[u.RGB]:t.RGB16F,[u.RG]:t.RG16F,[u.RED]:t.R16F},[d.UNSIGNED_SHORT_5_6_5]:{[u.RGB]:t.RGB565},[d.UNSIGNED_SHORT_4_4_4_4]:{[u.RGBA]:t.RGBA4},[d.UNSIGNED_SHORT_5_5_5_1]:{[u.RGBA]:t.RGB5_A1},[d.UNSIGNED_INT_2_10_10_10_REV]:{[u.RGBA]:t.RGB10_A2,[u.RGBA_INTEGER]:t.RGB10_A2UI},[d.UNSIGNED_INT_10F_11F_11F_REV]:{[u.RGB]:t.R11F_G11F_B10F},[d.UNSIGNED_INT_5_9_9_9_REV]:{[u.RGB]:t.RGB9_E5},[d.UNSIGNED_INT_24_8]:{[u.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[d.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[u.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[d.UNSIGNED_BYTE]:{[u.RGBA]:t.RGBA,[u.RGB]:t.RGB,[u.ALPHA]:t.ALPHA,[u.LUMINANCE]:t.LUMINANCE,[u.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[d.UNSIGNED_SHORT_5_6_5]:{[u.RGB]:t.RGB},[d.UNSIGNED_SHORT_4_4_4_4]:{[u.RGBA]:t.RGBA},[d.UNSIGNED_SHORT_5_5_5_1]:{[u.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new ei(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new ei(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<r.length;t++)r[t]===this.unknownTexture&&this.bind(null,t)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[n].samplerType!==f.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new ei(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===d.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==f.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,i=t.realHeight,s=r.gl;(e.width!==n||e.height!==i||e.dirtyId<0)&&(e.width=n,e.height=i,s.texImage2D(t.target,0,e.internalFormat,n,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Qt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==g.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=m.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==g.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===p.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===p.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===p.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===p.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}ri.extension={type:_e.RendererSystem,name:"texture"},xe.add(ri);class ni{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,i=e.createTransformFeedback();t._glTransformFeedbacks[n]=i,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i);for(let s=0;s<t.buffers.length;s++){const i=t.buffers[s];i&&(r.buffer.update(i),i._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,i._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),i}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let s=0;s<t.buffers.length;s++){const r=t.buffers[s];if(!r)continue;const n=r._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||i.dispose(r,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}ni.extension={type:_e.RendererSystem,name:"transformFeedback"},xe.add(ni);class ii{constructor(t){this.renderer=t}init(t){this.screen=new qe(0,0,t.width,t.height),this.element=t.view||S.ADAPTER.createCanvas(),this.resolution=t.resolution||S.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ii.defaultOptions={width:800,height:600,resolution:S.RESOLUTION,autoDensity:!1},ii.extension={type:[_e.RendererSystem,_e.CanvasRendererSystem],name:"_view"},xe.add(ii),S.PREFER_ENV=n.WEBGL2,S.STRICT_TEXTURE_CACHE=!1,S.RENDER_OPTIONS={...Hr.defaultOptions,...Gr.defaultOptions,...ii.defaultOptions,...$n.defaultOptions},Object.defineProperties(S,{WRAP_MODE:{get(){return De.defaultOptions.wrapMode},set(t){Z(0,"settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),De.defaultOptions.wrapMode=t}},SCALE_MODE:{get(){return De.defaultOptions.scaleMode},set(t){Z(0,"settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),De.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get(){return De.defaultOptions.mipmap},set(t){Z(0,"settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),De.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get(){return De.defaultOptions.anisotropicLevel},set(t){Z(0,"settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),De.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get(){return Z(0,"settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ur.defaultResolution},set(t){Ur.defaultResolution=t}},FILTER_MULTISAMPLE:{get(){return Z(0,"settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ur.defaultMultisample},set(t){Ur.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get(){return Br.defaultMaxTextures},set(t){Z(0,"settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Br.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get(){return Br.defaultBatchSize},set(t){Z(0,"settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Br.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get(){return Br.canUploadSameBuffer},set(t){Z(0,"settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Br.canUploadSameBuffer=t}},GC_MODE:{get(){return ti.defaultMode},set(t){Z(0,"settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),ti.defaultMode=t}},GC_MAX_IDLE:{get(){return ti.defaultMaxIdle},set(t){Z(0,"settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),ti.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get(){return ti.defaultCheckCountMax},set(t){Z(0,"settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),ti.defaultCheckCountMax=t}},PRECISION_VERTEX:{get(){return Ir.defaultVertexPrecision},set(t){Z(0,"settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ir.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get(){return Ir.defaultFragmentPrecision},set(t){Z(0,"settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ir.defaultFragmentPrecision=t}}});var si=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(si||{});class oi{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ai=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new oi(null,null,Infinity),this.deltaMS=1/ai.targetFPMS,this.elapsedMS=1/ai.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=si.NORMAL){return this._addListener(new oi(t,e,r))}addOnce(t,e,r=si.NORMAL){return this._addListener(new oi(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ai.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,ai.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ai._shared){const t=ai._shared=new ai;t.autoStart=!0,t._protected=!0}return ai._shared}static get system(){if(!ai._system){const t=ai._system=new ai;t.autoStart=!0,t._protected=!0}return ai._system}};let li=ai;li.targetFPMS=.06,Object.defineProperties(S,{TARGET_FPMS:{get(){return li.targetFPMS},set(t){Z(0,"settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),li.targetFPMS=t}}});class hi{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,si.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?li.shared:new li,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}hi.extension=_e.Application,xe.add(hi);const ui=[];function ci(t){for(const e of ui)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}xe.handleByList(_e.Renderer,ui);const di="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",fi="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class pi{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=T.HIGH?this.multisample=T.HIGH:e>=T.MEDIUM?this.multisample=T.MEDIUM:e>=T.LOW?this.multisample=T.LOW:this.multisample=T.NONE}destroy(){}}pi.extension={type:_e.RendererSystem,name:"_multisample"},xe.add(pi);class mi{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class gi{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const i=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,i.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:i}=this;r=r||0;const s=t._glBuffers[i]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,s.buffer,256*r,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t["static"]?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new mi(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}gi.extension={type:_e.RendererSystem,name:"buffer"},xe.add(gi);class _i{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,i,s,o;if(e&&(n=e.renderTexture,i=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=s,!r.context.isLost){if(n||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(i??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}_i.extension={type:_e.RendererSystem,name:"objectRenderer"},xe.add(_i);const yi=class extends Jn{constructor(t){super(),this.type=o.WEBGL,t=Object.assign({},S.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Mr({projectionMatrix:new er},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:yi.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Z(0,"options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=yi.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return!t?.forceCanvas&&nt()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Z(0,"renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Z(0,"renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Z(0,"renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Z(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Z(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Z(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Z(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Z(0,"renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let vi=yi;vi.extension={type:_e.Renderer,priority:1},vi.__plugins={},vi.__systems={},xe.handleByMap(_e.RendererPlugin,vi.__plugins),xe.handleByMap(_e.RendererSystem,vi.__systems),xe.add(vi);class xi extends Ie{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let i=0;i<t;i++){const t=new De;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Ie?this.addResourceAt(t[r],r):this.addResourceAt(Ce(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}class bi extends xi{constructor(t,e){const{width:r,height:n}=e||{};let i,s;Array.isArray(t)?(i=t,s=t.length):s=t,super(s,{width:r,height:n}),i&&this.initFromArray(i,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=c.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:i,items:s}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let a=0;a<n;a++){const t=s[a];i[a]<t.dirtyId&&(i[a]=t.dirtyId,t.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,a,t.resource.width,t.resource.height,1,e.format,r.type,t.resource.source))}return!0}}class Ei extends Yr{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Ti=class extends xi{constructor(t,e){const{width:r,height:n,autoLoad:i,linkBaseTexture:s}=e||{};if(t&&t.length!==Ti.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:n});for(let o=0;o<Ti.SIDES;o++)this.items[o].target=c.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==i&&this.load()}bind(t){super.bind(t),t.target=c.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=c.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const n=this.itemDirtyIds;for(let i=0;i<Ti.SIDES;i++){const s=this.items[i];(n[i]<s.dirtyId||r.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,r),n[i]=s.dirtyId):n[i]<-1&&(t.gl.texImage2D(s.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),n[i]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Ti.SIDES}};let Ai=Ti;Ai.SIDES=6;class wi extends Yr{constructor(t,e){let r,n;e=e||{},"string"==typeof t?(r=wi.EMPTY,n=t):(r=t,n=null),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await S.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await e.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===_.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(at){if(this.destroyed)return;e(at),this.onError.emit(at)}else t(this)}))),this._load}upload(t,e,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return wi._EMPTY=wi._EMPTY??S.ADAPTER.createCanvas(0,0),wi._EMPTY}}const Si=class extends Yr{constructor(t,e){e=e||{},super(S.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Si.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Yr.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,i=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,i=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),i=Math.round(i);const s=this.source;s.width=n,s.height=i,s._pixiId=`canvas_${te()}`,s.getContext("2d").drawImage(t,0,0,e,r,0,0,n,i),this._resolve(),this._resolve=null}}static getSize(t){const e=Si.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Si.SVG_XML.test(t)}};let Ci=Si;Ci.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ci.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Ri=class extends Yr{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const n=t[0].src||t[0];Yr.crossOrigin(r,n,e.crossorigin);for(let e=0;e<t.length;++e){const n=document.createElement("source");let{src:i,mime:s}=t[e];i=i||t[e];const o=i.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||Ri.MIME_TYPES[a]||`video/${a}`,n.src=i,n.type=s,r.appendChild(n)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=li.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(li.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(li.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(li.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(li.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(li.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ri.TYPES.includes(e)}};let Ii=Ri;Ii.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ii.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Se.push(wi,Kr,Ei,Ii,Ci,Pe,Ai,bi);class Pi{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Re("disposeTransformFeedback")}bindBuffer(t,e){this.buffers[t]=e}destroy(){this.disposeRunner.emit(this,!1)}}const Mi="7.2.4",Oi={loader:_e.LoadParser,resolver:_e.ResolveParser,cache:_e.CacheParser,detection:_e.DetectionParser};xe.handle(_e.Asset,(t=>{const e=t.ref;Object.entries(Oi).filter((([t])=>!!e[t])).forEach((([t,r])=>xe.add(Object.assign(e[t],{extension:e[t].extension??r}))))}),(t=>{const e=t.ref;Object.keys(Oi).filter((t=>!!e[t])).forEach((t=>xe.remove(e[t])))}));class Di{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose,this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ni(t,e){const r=t.split("?")[0],n=Q.extname(r).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const Fi=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t);const Li=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e}set(t,e){const r=Fi(t);let n;for(let o=0;o<this.parsers.length;o++){const t=this.parsers[o];if(t.test(e)){n=t.getCacheableAssets(r,e);break}}n||(n={},r.forEach((t=>{n[t]=e})));const i=Object.keys(n),s={cacheKeys:i,keys:r};if(r.forEach((t=>{this._cacheMap.set(t,s)})),i.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,n[t])})),e instanceof Jr){const t=e;r.forEach((e=>{t.baseTexture!==Jr.EMPTY.baseTexture&&De.addToCache(t.baseTexture,e),Jr.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache["delete"](t)})),e.keys.forEach((t=>{this._cacheMap["delete"](t)}))}get parsers(){return this._parsers}},Bi=t=>!Array.isArray(t);class ki{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null,i=null;if(e.loadParser&&(i=this._parserHash[e.loadParser]),!i){for(let r=0;r<this.parsers.length;r++){const n=this.parsers[r];if(n.load&&n.test?.(t,e,this)){i=n;break}}if(!i)return null}n=await i.load(t,e,this),r.parser=i;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(i.testParse?.(n,e,this))&&(n=await i.parse(n,e,this)||n,r.parser=i)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},i=Bi(t),s=Fi(t,(t=>({src:t}))),o=s.length,a=s.map((async t=>{const i=Q.toAbsolute(t.src);if(!n[t.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,t)),n[t.src]=await this.promiseCache[i].promise,e&&e(++r/o)}catch(at){throw delete this.promiseCache[i],delete n[t.src],new Error(`[Loader.load] Failed to load ${i}.\n${at}`)}}));return await Promise.all(a),i?n[s[0].src]:n}async unload(t){const e=Fi(t,(t=>({src:t}))).map((async t=>{const e=Q.toAbsolute(t.src),r=this.promiseCache[e];if(r){const n=await r.promise;r.parser?.unload?.(n,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name],{...t,[e.name]:e})),{})}}var Ui=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ui||{});function Gi(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}const ji={extension:{type:_e.LoadParser,priority:Ui.Low},name:"loadJson",test(t){return Gi(t,"application/json")||Ni(t,".json")},async load(t){const e=await S.ADAPTER.fetch(t);return await e.json()}};xe.add(ji);const Vi={name:"loadTxt",extension:{type:_e.LoadParser,priority:Ui.Low},test(t){return Gi(t,"text/plain")||Ni(t,".txt")},async load(t){const e=await S.ADAPTER.fetch(t);return await e.text()}};xe.add(Vi);const Hi=["normal","bold","100","200","300","400","500","600","700","800","900"],zi=[".ttf",".otf",".woff",".woff2"],Wi=["font/ttf","font/otf","font/woff","font/woff2"],Xi=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;const Yi={extension:{type:_e.LoadParser,priority:Ui.Low},name:"loadWebFont",test(t){return Gi(t,Wi)||Ni(t,zi)},async load(t,e){const r=S.ADAPTER.getFontFaceSet();if(r){const n=[],i=e.data?.family??function(t){const e=Q.extname(t),r=Q.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let n=r.length>0;for(const s of r)if(!s.match(Xi)){n=!1;break}let i=r.join(" ");return n||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}(t),s=e.data?.weights?.filter((t=>Hi.includes(t)))??["normal"],o=e.data??{};for(let e=0;e<s.length;e++){const a=s[e],l=new FontFace(i,`url(${encodeURI(t)})`,{...o,weight:a});await l.load(),r.add(l),n.push(l)}return 1===n.length?n[0]:n}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>S.ADAPTER.getFontFaceSet()["delete"](t)))}};xe.add(Yi);let Ki,$i=0;const qi={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},Qi={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let Ji;const Zi=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([qi.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",(n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Ki&&(Ki=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ki&&(Ji||(Ji=URL.createObjectURL(new Blob([Qi.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Ji),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,n)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:n})}));return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[$i]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:$i++,id:r})}};function ts(t,e,r){const n=new Jr(t);return n.baseTexture.on("dispose",(()=>{delete e.promiseCache[r]})),n}const es=[".jpeg",".jpg",".png",".webp",".avif"],rs=["image/jpeg","image/png","image/webp","image/avif"];const ns={name:"loadTextures",extension:{type:_e.LoadParser,priority:Ui.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return Gi(t,rs)||Ni(t,es)},async load(t,e,r){let n=null;n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Zi.isImageBitmapSupported()?await Zi.loadImageBitmap(t):await async function(t){const e=await S.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}(t):await new Promise((e=>{n=new Image,n.crossOrigin=this.config.crossOrigin,n.src=t,n.complete?e(n):n.onload=()=>{e(n)}}));const i=new De(n,{resolution:ge(t),...e.data});return i.resource.src=t,ts(i,r,t)},unload(t){t.destroy(!0)}};xe.add(ns);const is={extension:{type:_e.LoadParser,priority:Ui.High},name:"loadSVG",test(t){return Gi(t,"image/svg+xml")||Ni(t,".svg")},async testParse(t){return Ci.test(t)},async parse(t,e,r){const n=new Ci(t,e?.data?.resourceOptions);await n.load();const i=new De(n,{resolution:ge(t),...e?.data});i.resource.src=t;return ts(i,r,t)},async load(t,e){return(await S.ADAPTER.fetch(t)).text()},unload:ns.unload};function ss(t,e,r,n,i){const s=e[r];for(let o=0;o<s.length;o++){const a=s[o];r<e.length-1?ss(t.replace(n[r],a),e,r+1,n,i):i.push(t.replace(n[r],a))}}function os(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const n=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");n.push(e)})),ss(t,n,0,e,r)}else r.push(t);return r}xe.add(is);class as{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const n=this._createBundleAssetId(t,e.name);r.push(n),this.add([e.name,n],e.srcs,e.data)}else{const n=e.name.map((e=>this._createBundleAssetId(t,e)));n.forEach((t=>{r.push(t)})),this.add([...e.name,...n],e.srcs)}})):Object.keys(e).forEach((n=>{r.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],e[n])})),this._bundles[t]=r}add(t,e,r){const n=Fi(t);n.forEach((t=>{this.hasKey(t)})),Array.isArray(e)||(e="string"==typeof e?os(e):[e]);const i=e.map((t=>{let e=t;if("string"==typeof t){let r=!1;for(let n=0;n<this._parsers.length;n++){const i=this._parsers[n];if(i.test(t)){e=i.parse(t),r=!0;break}}r||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=n),(this._basePath||this._rootPath)&&(e.src=Q.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??r,e}));n.forEach((t=>{this._assetMap[t]=i}))}resolveBundle(t){const e=Bi(t);t=Fi(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const n=this.resolve(e),i={};for(const e in n){const r=n[e];i[this._extractAssetIdFromBundle(t,e)]=r}r[t]=i}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=Bi(t);t=Fi(t);const r={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const r=this._getPreferredOrder(e),n=e[0];r?.priority.forEach((t=>{r.params[t].forEach((r=>{const n=e.filter((e=>!!e[t]&&e[t]===r));n.length&&(e=n)}))})),this._resolverHash[t]=e[0]??n}else{let e=t;(this._basePath||this._rootPath)&&(e=Q.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],r=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}const ls=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new as,this.loader=new ki,this.cache=Li,this._backgroundLoader=new Di(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,r="number"==typeof e?[e]:e;let n=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;n="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(n=await t.remove(n))}else for(const i of this._detections)await i.test()&&(n=await i.add(n));this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();const r=Bi(t),n=Fi(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),i=this.resolver.resolve(n),s=await this._mapLoadToResolve(i,e);return r?s[n[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),i={},s=Object.keys(n);let o=0,a=0;const l=()=>{e?.(++o/a)},h=s.map((t=>{const e=n[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,l).then((e=>{i[t]=e}))}));return await Promise.all(h),r?i[t[0]]:i}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Li.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Li.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const i=await this.loader.load(r,e);this._backgroundLoader.active=!0;const s={};return r.forEach(((t,e)=>{const r=i[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[n[e]]=r,Li.set(o,r)})),s}async unload(t){this._initialized||await this.init();const e=Fi(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Fi(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Li.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return ns.config.preferWorkers}set preferWorkers(t){Z(0,"Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((r=>{e.config[r]=t[r]}))}))}};xe.handleByList(_e.LoadParser,ls.loader.parsers).handleByList(_e.ResolveParser,ls.resolver.parsers).handleByList(_e.CacheParser,ls.cache.parsers).handleByList(_e.DetectionParser,ls.detections);const hs={extension:_e.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Jr)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,n)=>{r[t+(0===n?"":n+1)]=e}))})),r}};xe.add(hs);const us={extension:{type:_e.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await S.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};xe.add(us);const cs={extension:{type:_e.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await S.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};xe.add(cs);const ds=["png","jpg","jpeg"],fs={extension:{type:_e.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...ds],remove:async t=>t.filter((t=>!ds.includes(t)))};xe.add(fs);const ps={extension:_e.ResolveParser,test:ns.test,parse:t=>({resolution:parseFloat(S.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};xe.add(ps);const ms=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};class gs{constructor(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=Infinity,this.minY=Infinity,this.maxX=-Infinity,this.maxY=-Infinity}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?qe.EMPTY:((t=t||new qe(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t,l=r*e.x+i*e.y+o,h=n*e.x+s*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,i=this.maxY,s=t[0],o=t[1];e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[2],o=t[3],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[4],o=t[5],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,s=t[6],o=t[7],e=s<e?s:e,r=o<r?o:r,n=s>n?s:n,i=o>i?o:i,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i}addFrame(t,e,r,n,i){this.addFrameMatrix(t.worldTransform,e,r,n,i)}addFrameMatrix(t,e,r,n,i){const s=t.a,o=t.b,a=t.c,l=t.d,h=t.tx,u=t.ty;let c=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=s*e+a*r+h,g=o*e+l*r+u;c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*n+a*r+h,g=o*n+l*r+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*e+a*i+h,g=o*e+l*i+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*n+a*i+h,g=o*n+l*i+u,c=m<c?m:c,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=c,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,r){let n=this.minX,i=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<r;a+=2){const e=t[a],r=t[a+1];n=e<n?e:n,i=r<i?r:i,s=e>s?e:s,o=r>o?r:o}this.minX=n,this.minY=i,this.maxX=s,this.maxY=o}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,i=0,s=i){const o=t.a,a=t.b,l=t.c,h=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let g=r;g<n;g+=2){const t=e[g],r=e[g+1],n=o*t+l*r+u,_=h*r+a*t+c;d=Math.min(d,n-i),p=Math.max(p,n+i),f=Math.min(f,_-s),m=Math.max(m,_+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>i?t.maxY:i}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=i&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=i&&n<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=n<e?n:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,i,s){t-=i,e-=s,r+=i,n+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class _s extends W{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new dr,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new gs,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(_s.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new qe),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new qe),t=this._localBoundsRect),this._localBounds||(this._localBounds=new gs);const e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-i,s}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,i=0,s=0,o=0,a=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=i,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new ys),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*We}set angle(t){this.transform.rotation=t*Xe}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class ys extends _s{constructor(){super(...arguments),this.sortDirty=null}}_s.prototype.displayObjectUpdateTransform=_s.prototype.updateTransform;const vs=new er;function xs(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const bs=class extends _s{constructor(){super(),this.children=[],this.sortableChildren=bs.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Qt(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(-1===r)return null;e.parent=null,e.transform._parentID=-1,Qt(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Qt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e-r;let i;if(n>0&&n<=e){i=this.children.splice(r,n);for(let t=0;t<i.length;++t)i[t].parent=null,i[t].transform&&(i[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<i.length;++t)i[t].emit("removed",this),this.emit("childRemoved",i[t],this,t);return i}if(0===n&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(xs),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,i=this.children.length;n<i;++n){const t=this.children[n];t.visible&&t.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==bs.prototype._render&&(r=this.getBounds(!0));const i=t.projection.transform;if(i&&(n?(n=vs.copyFrom(n),n.prepend(i)):n=i),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let s=0,o=this.children.length;s<o;++s){const e=this.children[s],r=e.cullable;e.cullable=r||!this.cullArea,e.render(t),e.cullable=r}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const n=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==b.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let Es=bs;Es.defaultSortableChildren=!1,Es.prototype.containerUpdateTransform=Es.prototype.updateTransform,Object.defineProperties(S,{SORTABLE_CHILDREN:{get(){return Es.defaultSortableChildren},set(t){Z(0,"settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Es.defaultSortableChildren=t}}});const Ts=new Ke,As=new Uint16Array([0,1,2,0,2,3]);class ws extends Es{constructor(t){super(),this._anchor=new ur(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Dt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=l.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Jr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=As,this.pluginName="batch",this.isSprite=!0,this._roundPixels=S.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Jt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Jt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=this.vertexData,h=t.trim,u=t.orig,c=this._anchor;let d=0,f=0,p=0,m=0;if(h?(f=h.x-c._x*u.width,d=f+h.width,m=h.y-c._y*u.height,p=m+h.height):(f=-c._x*u.width,d=f+u.width,m=-c._y*u.height,p=m+u.height),l[0]=r*f+i*m+o,l[1]=s*m+n*f+a,l[2]=r*d+i*m+o,l[3]=s*m+n*d+a,l[4]=r*d+i*p+o,l[5]=s*p+n*d+a,l[6]=r*f+i*p+o,l[7]=s*p+n*f+a,this._roundPixels){const t=S.RESOLUTION;for(let e=0;e<l.length;++e)l[e]=Math.round(l[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,l=i.d,h=i.tx,u=i.ty,c=-n._x*r.width,d=c+r.width,f=-n._y*r.height,p=f+r.height;e[0]=s*c+a*f+h,e[1]=l*f+o*c+u,e[2]=s*d+a*f+h,e[3]=l*f+o*d+u,e[4]=s*d+a*p+h,e[5]=l*p+o*d+u,e[6]=s*c+a*p+h,e[7]=l*p+o*c+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new gs),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new qe),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Ts);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let i=0;return Ts.x>=n&&Ts.x<n+e&&(i=-r*this.anchor.y,Ts.y>=i&&Ts.y<i+r)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof Jr?t:Jr.from(t,e);return new ws(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Jt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Jt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Jr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}var Ss;(Ss||(Ss={})).get=function(t,e){return t[e]};var Cs=(t=>(t[t.buffer=0]="buffer",t[t.json=1]="json",t[t.text=2]="text",t))(Cs||{});class Rs{setLoaderResourceExtensionType(t,e){let r=LoaderResource.XHR_RESPONSE_TYPE.TEXT;e===Cs.buffer?r=LoaderResource.XHR_RESPONSE_TYPE.BUFFER:e===Cs.json&&(r=LoaderResource.XHR_RESPONSE_TYPE.JSON),LoaderResource.setExtensionXhrType(t,r)}getInteractionPlugin(t){return t.plugins.interaction}get assets(){}isRendererDestroyed(t){return!t.gl}installRendererPlugin(t,e){vi.registerPlugin(t,e)}installLoaderPlugin(t,e){Loader.registerPlugin(e)}render(t,e,r){t.render(e,r)}}class Is extends Rs{render(t,e,r){t.render(e,{renderTexture:r})}}class Ps extends Is{installRendererPlugin(t,r){r.extension={type:Ss.get(e,"ExtensionType").RendererPlugin,name:t},Ss.get(e,"extensions").add(r)}installLoaderPlugin(t,r){r.extension={type:Ss.get(e,"ExtensionType").Loader,name:t},Ss.get(e,"extensions").add(r)}}const Ms=Ss.get(e,"VERSION").startsWith("7")?new class extends Ps{setLoaderResourceExtensionType(t,e){}getInteractionPlugin(t){}get assets(){return ls}isRendererDestroyed(t){return"_systemsHash"in t&&0===Object.keys(t._systemsHash).length}installRendererPlugin(t,r){r.extension={type:[Ss.get(e,"ExtensionType").RendererPlugin],name:t},Ss.get(e,"extensions").add(r)}installLoaderPlugin(t,r){r.extension={type:[Ss.get(e,"ExtensionType").Loader,Ss.get(e,"ExtensionType").LoadParser],name:t},Ss.get(e,"extensions").add(r)}}:new Ps;class Os{constructor(t,e=[],r=[]){this.descriptor=t,this.buffers=e,this.images=r,this.textures=[]}static load(t,e,r){let n=new Os(t);return function(t,e,r){const n=[],i=t.buffers.filter((t=>Os.isEmbeddedResource(t.uri))).map(((t,e)=>e));for(let l=0;l<i.length;l++){let e=i[l],r=t.buffers[e];n[e]=Fs(r.uri)}const s=t.buffers.filter((t=>!Os.isEmbeddedResource(t.uri))).map(((t,e)=>e));if(0===s.length)return e(n);if(!r)throw new Error("PIXI3D: A resource loader is required when buffer is not embedded.");const o=(t,e,i)=>{r.load(t,(t=>{n[e]=t.data,i()}))};let a=s.length;for(let l=0;l<s.length;l++){let r=s[l];o(t.buffers[r].uri,r,(()=>{0==--a&&e(n)}))}}(t,(i=>{i.forEach((t=>n.buffers.push(t))),Ns(t,i,(t=>{t.forEach((t=>n.images.push(t))),r&&r(n)}),e)}),e),n}static isValidBuffer(t){const e=new Uint32Array(t,0,3);return 1179937895===e[0]&&2===e[1]}static isEmbeddedResource(t){return t&&t.startsWith("data:")}static fromBuffer(t,e){const r=[];let n=12;for(;n<t.byteLength;){const e=new Uint32Array(t,n,3);r.push({length:e[0],type:e[1],offset:n+8}),n+=e[0]+8}const i=new Uint8Array(t,r[0].offset,r[0].length),s=JSON.parse(new TextDecoder("utf-8").decode(i)),o=[];for(let a=1;a<r.length;a++)o.push(t.slice(r[a].offset,r[a].offset+r[a].length));Ns(s,o,(t=>{e(new Os(s,o,t))}))}static async fromURL(t,e){if(!Ms.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const r=await S.ADAPTER.fetch(t,e);return new Promise((async e=>{if(t.includes(".glb")){let t=await r.arrayBuffer();Os.fromBuffer(t,(t=>{e(t)}))}else{let n=await r.json();Os.load(n,new Ds(t),(t=>{e(t)}))}}))}}class Ds{constructor(t){this.parentURL=t}load(t,e){const r=this.parentURL.substring(0,this.parentURL.lastIndexOf("/")+1)+t;(async()=>{if(!Ms.assets)throw new Error("PIXI3D: Assets are not available in current version of PixiJS.");let t={};if(r.includes(".bin")){const e=await S.ADAPTER.fetch(r);t.data=await e.arrayBuffer()}else{let e=await Ms.assets.load(r);e&&(t.texture=e)}e(t)})()}}function Ns(t,e,r,n){const i=[];if(!t.images||0===t.images.length)return r(i);let s=t.images.filter((t=>"number"!=typeof t.bufferView&&Os.isEmbeddedResource(t.uri))).map(((t,e)=>e)),o=t.images.filter((t=>"number"!=typeof t.bufferView&&!Os.isEmbeddedResource(t.uri))).map(((t,e)=>e)),a=t.images.filter((t=>"number"==typeof t.bufferView)).map(((t,e)=>e));for(let d=0;d<s.length;d++){let e=s[d],r=t.images[e];i[e]=Jr.from(r.uri)}if(0===a.length&&0===o.length)return r(i);if(o.length>0&&!n)throw new Error("PIXI3D: A resource loader is required when image is external.");const l=(t,e,r)=>{null==n||n.load(t.uri,(t=>{t.texture&&(i[e]=t.texture,r())}))},h=(r,n,s)=>{!function(t,e,r,n){const i=e.bufferViews[t.bufferView],s=new Uint8Array(r[i.buffer],i.byteOffset,i.byteLength),o=new Blob([s],{type:t.mimeType}),a=new FileReader;a.onload=()=>{n(Jr.from(a.result))},a.readAsDataURL(o)}(r,t,e,(t=>{i[n]=t,s()}))};let u=o.length,c=a.length;for(let d=0;d<o.length;d++){let e=o[d];l(t.images[e],e,(()=>{0==--u&&0===c&&r(i)}))}for(let d=0;d<a.length;d++){let e=a[d];h(t.images[e],e,(()=>{0==--c&&0===u&&r(i)}))}}function Fs(t){return Uint8Array.from(atob(t.split(",")[1]),(t=>t.charCodeAt(0))).buffer}const Ls={use:function(t,e){if("gltf"!==t.extension)return e();Os.load(t.data,new Bs(this,t),(r=>{Object.assign(t,{gltf:r}),e()}))},add:function(){Ms.setLoaderResourceExtensionType("bin",Cs.buffer),Ms.setLoaderResourceExtensionType("gltf",Cs.json)},test(t){return t.includes(".gltf")||t.includes(".glb")},async load(t){return await Os.fromURL(t)}};Ms.installLoaderPlugin("gltf",Ls);class Bs{constructor(t,e){this._loader=t,this._resource=e}load(t,e){const r=this._resource.url.substring(0,this._resource.url.lastIndexOf("/")+1)+t;if(this._loader.resources[r])if(this._loader.resources[r].data)e(this._loader.resources[r]);else{let t=this._loader.onProgress.add(((n,i)=>{i.url===r&&(e(i),t.detach())}))}else this._loader.add({parentResource:this._resource,url:r,onComplete:e})}}const ks={use:function(t,e){return"glb"!==t.extension?e():Os.isValidBuffer(t.data)?void Os.fromBuffer(t.data,(r=>{Object.assign(t,{gltf:r}),e()})):e()},add:function(){Ms.setLoaderResourceExtensionType("glb",Cs.buffer)}};Ms.installLoaderPlugin("cubemap",ks);var Us=1e-6,Gs="undefined"!=typeof Float32Array?Float32Array:Array;function js(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Vs(t,e){var r=e[0],n=e[1],i=e[2],s=e[4],o=e[5],a=e[6],l=e[8],h=e[9],u=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,h,u),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Hs=function(t,e,r,n,i){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==Infinity?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t};var zs=function(t,e,r,n,i,s,o){var a=1/(e-r),l=1/(n-i),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*l,t[14]=(o+s)*h,t[15]=1,t};function Ws(){var t=new Gs(3);return Gs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Xs(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Ys(t,e,r){var n=new Gs(3);return n[0]=t,n[1]=e,n[2]=r,n}function Ks(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function $s(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qs(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=i*l-s*a,t[1]=s*o-n*l,t[2]=n*a-i*o,t}var Qs=Xs;function Js(t,e,r,n){var i=new Gs(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function Zs(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function to(){var t=new Gs(4);return Gs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function eo(t,e,r,n){var i,s,o,a,l,h=e[0],u=e[1],c=e[2],d=e[3],f=r[0],p=r[1],m=r[2],g=r[3];return(s=h*f+u*p+c*m+d*g)<0&&(s=-s,f=-f,p=-p,m=-m,g=-g),1-s>Us?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-n)*i)/o,l=Math.sin(n*i)/o):(a=1-n,l=n),t[0]=a*h+l*f,t[1]=a*u+l*p,t[2]=a*c+l*m,t[3]=a*d+l*g,t}Ws(),function(){var t,e=(t=new Gs(4),Gs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var ro,no,io,so,oo=Js,ao=Zs,lo=function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*r+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=s*o,t},ho=(ro=Ws(),no=Ys(1,0,0),io=Ys(0,1,0),function(t,e,r){var n=$s(e,r);return n<-.999999?(qs(ro,no,e),Qs(ro)<1e-6&&qs(ro,io,e),Ks(ro,ro),function(t,e,r){r*=.5;var n=Math.sin(r);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r)}(t,ro,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(qs(ro,e,r),t[0]=ro[0],t[1]=ro[1],t[2]=ro[2],t[3]=1+n,lo(t,t))});to(),to(),so=new Gs(9),Gs!=Float32Array&&(so[1]=0,so[2]=0,so[3]=0,so[5]=0,so[6]=0,so[7]=0),so[0]=1,so[4]=1,so[8]=1;class uo{static set(t,e,r,n=new Float32Array(3)){return function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}(n,t,e,r)}static fromValues(t,e,r){return Ys(t,e,r)}static create(){return Ws()}static add(t,e,r=new Float32Array(3)){return function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}(r,t,e)}static transformQuat(t,e,r=new Float32Array(3)){return function(t,e,r){var n=r[0],i=r[1],s=r[2],o=r[3],a=e[0],l=e[1],h=e[2],u=i*h-s*l,c=s*a-n*h,d=n*l-i*a,f=i*d-s*c,p=s*u-n*d,m=n*c-i*u,g=2*o;return u*=g,c*=g,d*=g,f*=2,p*=2,m*=2,t[0]=a+u+f,t[1]=l+c+p,t[2]=h+d+m,t}(r,t,e)}static subtract(t,e,r=new Float32Array(3)){return function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}(r,t,e)}static scale(t,e,r=new Float32Array(3)){return function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}(r,t,e)}static dot(t,e){return $s(t,e)}static normalize(t,e=new Float32Array(3)){return Ks(e,t)}static cross(t,e,r=new Float32Array(3)){return qs(r,t,e)}static transformMat4(t,e,r=new Float32Array(3)){return function(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,t}(r,t,e)}static copy(t,e=new Float32Array(3)){return function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}(e,t)}static magnitude(t){return Xs(t)}static squaredMagnitude(t){return function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}(t)}static inverse(t,e=new Float32Array(3)){return function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}(e,t)}static negate(t,e=new Float32Array(3)){return function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}(e,t)}static multiply(t,e,r=new Float32Array(3)){return function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}(r,t,e)}static distance(t,e){return function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}(t,e)}static squaredDistance(t,e){return function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}(t,e)}static lerp(t,e,r,n=new Float32Array(3)){return function(t,e,r,n){var i=e[0],s=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t}(n,t,e,r)}}class co{static set(t,e,r,n,i=new Float32Array(4)){return ao(i,t,e,r,n)}static fromValues(t,e,r,n){return oo(t,e,r,n)}static create(){return to()}static normalize(t,e=new Float32Array(4)){return lo(e,t)}static slerp(t,e,r,n=new Float32Array(4)){return eo(n,t,e,r)}static fromEuler(t,e,r,n=new Float32Array(4)){return function(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),h=Math.sin(n),u=Math.cos(n);return t[0]=s*l*u-o*a*h,t[1]=o*a*u+s*l*h,t[2]=o*l*h-s*a*u,t[3]=o*l*u+s*a*h,t}(n,t,e,r)}static conjugate(t,e=new Float32Array(4)){return function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}(e,t)}static rotateX(t,e,r=new Float32Array(4)){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*a,t[1]=i*l+s*a,t[2]=s*l-i*a,t[3]=o*l-n*a,t}(r,t,e)}static rotateY(t,e,r=new Float32Array(4)){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l-s*a,t[1]=i*l+o*a,t[2]=s*l+n*a,t[3]=o*l-i*a,t}(r,t,e)}static rotateZ(t,e,r=new Float32Array(4)){return function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+i*a,t[1]=i*l-n*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}(r,t,e)}static rotationTo(t,e,r=new Float32Array(4)){return ho(r,t,e)}}const fo=new Float32Array(4);class po extends ur{constructor(t=0,e=0,r=0,n=1,i=(()=>{}),s=void 0){super(i,s),this._array=new Float32Array(4),this._array.set([t,e,r,n])}get array(){return this._array}set array(t){this.setFrom(t)}get x(){return this._array[0]}set x(t){this._array[0]!==t&&(this._array[0]=t,this.cb.call(this.scope))}get y(){return this._array[1]}set y(t){this._array[1]!==t&&(this._array[1]=t,this.cb.call(this.scope))}get z(){return this._array[2]}set z(t){this._array[2]!==t&&(this._array[2]=t,this.cb.call(this.scope))}get w(){return this._array[3]}set w(t){this._array[3]!==t&&(this._array[3]=t,this.cb.call(this.scope))}setEulerAngles(t,e,r){co.fromEuler(t,e,r,this._array),this.cb.call(this.scope)}clone(t=this.cb,e=this.scope){return new po(this.x,this.y,this.z,this.w,t,e)}copyFrom(t){return this._array[0]===t.x&&this._array[1]===t.y&&this._array[2]===t.z&&this._array[3]===t.w||(this._array[0]=t.x,this._array[1]=t.y,this._array[2]=t.z,this._array[3]=t.w,this.cb.call(this.scope)),this}copyTo(t){return t instanceof po&&t.set(this.x,this.y,this.z,this.w),t}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}set(t,e=t,r=t,n=t){return this._array[0]===t&&this._array[1]===e&&this._array[2]===r&&this._array[3]===n||(this._array[0]=t,this._array[1]=e,this._array[2]=r,this._array[3]=n,this.cb.call(this.scope)),this}setFrom(t){return this.set(t[0],t[1],t[2],t[3]),this}normalize(t=new po){return t.setFrom(co.normalize(this._array,fo))}static slerp(t,e,r,n=new po){return n.setFrom(co.slerp(t.array,e.array,r,fo))}static fromEuler(t,e,r,n=new po){return n.setFrom(co.fromEuler(t,e,r,fo))}static conjugate(t,e=new po){return e.setFrom(co.conjugate(t.array,fo))}static rotateX(t,e,r=new po){return r.setFrom(co.rotateX(t.array,e,fo))}static rotateY(t,e,r=new po){return r.setFrom(co.rotateY(t.array,e,fo))}static rotateZ(t,e,r=new po){return r.setFrom(co.rotateZ(t.array,e,fo))}}class mo{static getTranslation(t,e=new Float32Array(3)){return function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}(e,t)}static create(){return function(){var t=new Gs(16);return Gs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}()}static translate(t,e,r=new Float32Array(16)){return function(t,e,r){var n,i,s,o,a,l,h,u,c,d,f,p,m=r[0],g=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=e[9],f=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=h,t[7]=u,t[8]=c,t[9]=d,t[10]=f,t[11]=p,t[12]=n*m+a*g+c*_+e[12],t[13]=i*m+l*g+d*_+e[13],t[14]=s*m+h*g+f*_+e[14],t[15]=o*m+u*g+p*_+e[15]),t}(r,t,e)}static getScaling(t,e=new Float32Array(3)){return Vs(e,t)}static getRotation(t,e=new Float32Array(4)){return function(t,e){var r=new Gs(3);Vs(r,e);var n=1/r[0],i=1/r[1],s=1/r[2],o=e[0]*n,a=e[1]*i,l=e[2]*s,h=e[4]*n,u=e[5]*i,c=e[6]*s,d=e[8]*n,f=e[9]*i,p=e[10]*s,m=o+u+p,g=0;return m>0?(g=2*Math.sqrt(m+1),t[3]=.25*g,t[0]=(c-f)/g,t[1]=(d-l)/g,t[2]=(a-h)/g):o>u&&o>p?(g=2*Math.sqrt(1+o-u-p),t[3]=(c-f)/g,t[0]=.25*g,t[1]=(a+h)/g,t[2]=(d+l)/g):u>p?(g=2*Math.sqrt(1+u-o-p),t[3]=(d-l)/g,t[0]=(a+h)/g,t[1]=.25*g,t[2]=(c+f)/g):(g=2*Math.sqrt(1+p-o-u),t[3]=(a-h)/g,t[0]=(d+l)/g,t[1]=(c+f)/g,t[2]=.25*g),t}(e,t)}static copy(t,e=new Float32Array(16)){return function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}(e,t)}static fromQuat(t,e=new Float32Array(16)){return function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,l=i+i,h=r*o,u=n*o,c=n*a,d=i*o,f=i*a,p=i*l,m=s*o,g=s*a,_=s*l;return t[0]=1-c-p,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-h-p,t[6]=f+m,t[7]=0,t[8]=d+g,t[9]=f-m,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(e,t)}static fromRotationTranslationScale(t,e,r,n=new Float32Array(16)){return function(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3],l=i+i,h=s+s,u=o+o,c=i*l,d=i*h,f=i*u,p=s*h,m=s*u,g=o*u,_=a*l,y=a*h,v=a*u,x=n[0],b=n[1],E=n[2];return t[0]=(1-(p+g))*x,t[1]=(d+v)*x,t[2]=(f-y)*x,t[3]=0,t[4]=(d-v)*b,t[5]=(1-(c+g))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(f+y)*E,t[9]=(m-_)*E,t[10]=(1-(c+p))*E,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}(n,t,e,r)}static fromRotation(t,e,r=new Float32Array(16)){return function(t,e,r){var n,i,s,o=r[0],a=r[1],l=r[2],h=Math.hypot(o,a,l);return h<Us?null:(o*=h=1/h,a*=h,l*=h,n=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=a*o*s+l*n,t[2]=l*o*s-a*n,t[3]=0,t[4]=o*a*s-l*n,t[5]=a*a*s+i,t[6]=l*a*s+o*n,t[7]=0,t[8]=o*l*s+a*n,t[9]=a*l*s-o*n,t[10]=l*l*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}(r,t,e)}static fromScaling(t,e=new Float32Array(16)){return function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(e,t)}static fromTranslation(t,e=new Float32Array(16)){return function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(e,t)}static multiply(t,e,r=new Float32Array(16)){return function(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=r[0],x=r[1],b=r[2],E=r[3];return t[0]=v*n+x*a+b*c+E*m,t[1]=v*i+x*l+b*d+E*g,t[2]=v*s+x*h+b*f+E*_,t[3]=v*o+x*u+b*p+E*y,v=r[4],x=r[5],b=r[6],E=r[7],t[4]=v*n+x*a+b*c+E*m,t[5]=v*i+x*l+b*d+E*g,t[6]=v*s+x*h+b*f+E*_,t[7]=v*o+x*u+b*p+E*y,v=r[8],x=r[9],b=r[10],E=r[11],t[8]=v*n+x*a+b*c+E*m,t[9]=v*i+x*l+b*d+E*g,t[10]=v*s+x*h+b*f+E*_,t[11]=v*o+x*u+b*p+E*y,v=r[12],x=r[13],b=r[14],E=r[15],t[12]=v*n+x*a+b*c+E*m,t[13]=v*i+x*l+b*d+E*g,t[14]=v*s+x*h+b*f+E*_,t[15]=v*o+x*u+b*p+E*y,t}(r,t,e)}static lookAt(t,e,r,n=new Float32Array(16)){return function(t,e,r,n){var i,s,o,a,l,h,u,c,d,f,p=e[0],m=e[1],g=e[2],_=n[0],y=n[1],v=n[2],x=r[0],b=r[1],E=r[2];return Math.abs(p-x)<Us&&Math.abs(m-b)<Us&&Math.abs(g-E)<Us?js(t):(u=p-x,c=m-b,d=g-E,i=y*(d*=f=1/Math.hypot(u,c,d))-v*(c*=f),s=v*(u*=f)-_*d,o=_*c-y*u,(f=Math.hypot(i,s,o))?(i*=f=1/f,s*=f,o*=f):(i=0,s=0,o=0),a=c*o-d*s,l=d*i-u*o,h=u*s-c*i,(f=Math.hypot(a,l,h))?(a*=f=1/f,l*=f,h*=f):(a=0,l=0,h=0),t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=c,t[7]=0,t[8]=o,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*p+s*m+o*g),t[13]=-(a*p+l*m+h*g),t[14]=-(u*p+c*m+d*g),t[15]=1,t)}(n,t,e,r)}static identity(t=new Float32Array(16)){return js(t)}static perspective(t,e,r,n,i=new Float32Array(16)){return Hs(i,t,e,r,n)}static ortho(t,e,r,n,i,s,o=new Float32Array(16)){return zs(o,t,e,r,n,i,s)}static invert(t,e=new Float32Array(16)){return function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8],c=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],_=e[15],y=r*a-n*o,v=r*l-i*o,x=r*h-s*o,b=n*l-i*a,E=n*h-s*a,T=i*h-s*l,A=u*m-c*p,w=u*g-d*p,S=u*_-f*p,C=c*g-d*m,R=c*_-f*m,I=d*_-f*g,P=y*I-v*R+x*C+b*S-E*w+T*A;return P?(P=1/P,t[0]=(a*I-l*R+h*C)*P,t[1]=(i*R-n*I-s*C)*P,t[2]=(m*T-g*E+_*b)*P,t[3]=(d*E-c*T-f*b)*P,t[4]=(l*S-o*I-h*w)*P,t[5]=(r*I-i*S+s*w)*P,t[6]=(g*x-p*T-_*v)*P,t[7]=(u*T-d*x+f*v)*P,t[8]=(o*R-a*S+h*A)*P,t[9]=(n*S-r*R-s*A)*P,t[10]=(p*E-m*x+_*y)*P,t[11]=(c*x-u*E-f*y)*P,t[12]=(a*w-o*C-l*A)*P,t[13]=(r*C-n*w+i*A)*P,t[14]=(m*v-p*b-g*y)*P,t[15]=(u*b-c*v+d*y)*P,t):null}(e,t)}static transpose(t,e=new Float32Array(16)){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}(e,t)}static targetTo(t,e,r,n=new Float32Array(16)){return function(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=n[0],l=n[1],h=n[2],u=i-r[0],c=s-r[1],d=o-r[2],f=u*u+c*c+d*d;f>0&&(u*=f=1/Math.sqrt(f),c*=f,d*=f);var p=l*d-h*c,m=h*u-a*d,g=a*c-l*u;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=c*g-d*m,t[5]=d*p-u*g,t[6]=u*m-c*p,t[7]=0,t[8]=u,t[9]=c,t[10]=d,t[11]=0,t[12]=i,t[13]=s,t[14]=o,t[15]=1,t}(n,t,e,r)}static rotateX(t,e,r=new Float32Array(16)){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+h*n,t[5]=o*i+u*n,t[6]=a*i+c*n,t[7]=l*i+d*n,t[8]=h*i-s*n,t[9]=u*i-o*n,t[10]=c*i-a*n,t[11]=d*i-l*n,t}(r,t,e)}static rotateY(t,e,r=new Float32Array(16)){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],h=e[8],u=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-h*n,t[1]=o*i-u*n,t[2]=a*i-c*n,t[3]=l*i-d*n,t[8]=s*n+h*i,t[9]=o*n+u*i,t[10]=a*n+c*i,t[11]=l*n+d*i,t}(r,t,e)}static rotateZ(t,e,r=new Float32Array(16)){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],h=e[4],u=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+h*n,t[1]=o*i+u*n,t[2]=a*i+c*n,t[3]=l*i+d*n,t[4]=h*i-s*n,t[5]=u*i-o*n,t[6]=c*i-a*n,t[7]=d*i-l*n,t}(r,t,e)}static rotate(t,e,r,n=new Float32Array(16)){return function(t,e,r,n){var i,s,o,a,l,h,u,c,d,f,p,m,g,_,y,v,x,b,E,T,A,w,S,C,R=n[0],I=n[1],P=n[2],M=Math.hypot(R,I,P);return M<Us?null:(R*=M=1/M,I*=M,P*=M,i=Math.sin(r),o=1-(s=Math.cos(r)),a=e[0],l=e[1],h=e[2],u=e[3],c=e[4],d=e[5],f=e[6],p=e[7],m=e[8],g=e[9],_=e[10],y=e[11],v=R*R*o+s,x=I*R*o+P*i,b=P*R*o-I*i,E=R*I*o-P*i,T=I*I*o+s,A=P*I*o+R*i,w=R*P*o+I*i,S=I*P*o-R*i,C=P*P*o+s,t[0]=a*v+c*x+m*b,t[1]=l*v+d*x+g*b,t[2]=h*v+f*x+_*b,t[3]=u*v+p*x+y*b,t[4]=a*E+c*T+m*A,t[5]=l*E+d*T+g*A,t[6]=h*E+f*T+_*A,t[7]=u*E+p*T+y*A,t[8]=a*w+c*S+m*C,t[9]=l*w+d*S+g*C,t[10]=h*w+f*S+_*C,t[11]=u*w+p*S+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}(n,t,e,r)}static scale(t,e,r=new Float32Array(16)){return function(t,e,r){var n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}(r,t,e)}}class go{constructor(t,e,r){this._parent=t,this._data=e,this._update=r}get data(){return this._id!==this._parent.transformId&&(this._update(this._data),this._id=this._parent.transformId),this._data}}const _o=new Float32Array(16);class yo extends er{constructor(t){super(),this._transformId=0,this.array=t?new Float32Array(t):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get transformId(){return this._transformId}toArray(t,e){return t?mo.transpose(this.array,e):e?mo.copy(this.array,e):this.array}get position(){return this._position||(this._position=new go(this,new xo,(t=>{mo.getTranslation(this.array,t.array)}))),this._position.data}get scaling(){return this._scaling||(this._scaling=new go(this,new xo,(t=>{mo.getScaling(this.array,t.array)}))),this._scaling.data}get rotation(){if(!this._rotation){let t=new Float32Array(16);this._rotation=new go(this,new po,(e=>{for(let r of[0,1,2])t[r+0]=this.array[r+0]/this.scaling.x,t[r+4]=this.array[r+4]/this.scaling.y,t[r+8]=this.array[r+8]/this.scaling.z;co.normalize(mo.getRotation(t,e.array),e.array)}))}return this._rotation.data}get up(){return this._up||(this._up=new go(this,new xo,(t=>{uo.normalize(uo.set(this.array[4],this.array[5],this.array[6],t.array),t.array)}))),this._up.data}get down(){return this._down||(this._down=new go(this,new xo,(t=>{uo.negate(this.up.array,t.array)}))),this._down.data}get right(){return this._right||(this._right=new go(this,new xo,(t=>{uo.negate(this.left.array,t.array)}))),this._right.data}get left(){return this._left||(this._left=new go(this,new xo,(t=>{uo.normalize(uo.cross(this.up.array,this.forward.array,t.array),t.array)}))),this._left.data}get forward(){return this._forward||(this._forward=new go(this,new xo,(t=>{uo.normalize(uo.set(this.array[8],this.array[9],this.array[10],t.array),t.array)}))),this._forward.data}get backward(){return this._backward||(this._backward=new go(this,new xo,(t=>{uo.negate(this.forward.array,t.array)}))),this._backward.data}copyFrom(t){return t instanceof yo&&(mo.copy(t.array,this.array),this._transformId++),this}setFrom(t){return mo.copy(t,this.array),this._transformId++,this}setFromRotationPositionScale(t,e,r){mo.fromRotationTranslationScale(t.array,e.array,r.array,this.array),this._transformId++}multiply(t){mo.multiply(t.array,this.array,this.array),this._transformId++}static translate(t,e,r=new yo){return r.setFrom(mo.translate(t.array,e.array,_o))}static fromQuaternion(t,e=new yo){return e.setFrom(mo.fromQuat(t.array,_o))}static fromRotationTranslationScale(t,e,r,n=new yo){return n.setFrom(mo.fromRotationTranslationScale(t.array,e.array,r.array,_o))}static fromRotation(t,e,r=new yo){return r.setFrom(mo.fromRotation(t,e.array,_o))}static fromScaling(t,e=new yo){return e.setFrom(mo.fromScaling(t.array,_o))}static fromTranslation(t,e=new yo){return e.setFrom(mo.fromTranslation(t.array,_o))}static lookAt(t,e,r,n=new yo){return n.setFrom(mo.lookAt(t.array,e.array,r.array,_o))}static identity(t=new yo){return t.setFrom(mo.identity(_o))}static perspective(t,e,r,n,i=new yo){return i.setFrom(mo.perspective(t,e,r,n,_o))}static ortho(t,e,r,n,i,s,o=new yo){return o.setFrom(mo.ortho(t,e,r,n,i,s,_o))}static invert(t,e=new yo){return e.setFrom(mo.invert(t.array,_o))}static transpose(t,e=new yo){return e.setFrom(mo.transpose(t.array,_o))}static targetTo(t,e,r,n=new yo){return n.setFrom(mo.targetTo(t.array,e.array,r.array,_o))}static rotateX(t,e,r=new yo){return r.setFrom(mo.rotateX(t.array,e,_o))}static rotateY(t,e,r=new yo){return r.setFrom(mo.rotateY(t.array,e,_o))}static rotateZ(t,e,r=new yo){return r.setFrom(mo.rotateZ(t.array,e,_o))}static rotate(t,e,r,n=new yo){return n.setFrom(mo.rotate(t.array,e,r.array,_o))}static scale(t,e,r=new yo){return r.setFrom(mo.scale(t.array,e.array,_o))}}const vo=new Float32Array(3);class xo extends ur{constructor(t=0,e=0,r=0,n=(()=>{}),i=void 0){super(n,i),this._array=new Float32Array(3),this._array.set([t,e,r])}get array(){return this._array}set array(t){this.setFrom(t)}get x(){return this._array[0]}set x(t){this._array[0]!==t&&(this._array[0]=t,this.cb.call(this.scope))}get y(){return this._array[1]}set y(t){this._array[1]!==t&&(this._array[1]=t,this.cb.call(this.scope))}get z(){return this._array[2]}set z(t){this._array[2]!==t&&(this._array[2]=t,this.cb.call(this.scope))}clone(t=this.cb,e=this.scope){return new xo(this.x,this.y,this.z,t,e)}copyFrom(t){return this._array[0]===t.x&&this._array[1]===t.y&&this._array[2]===t.z||(this._array[0]=t.x,this._array[1]=t.y,this._array[2]=t.z,this.cb.call(this.scope)),this}copyTo(t){return t instanceof xo&&t.set(this.x,this.y,this.z),t}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}set(t,e=t,r=t){return this._array[0]===t&&this._array[1]===e&&this._array[2]===r||(this._array[0]=t,this._array[1]=e,this._array[2]=r,this.cb.call(this.scope)),this}setFrom(t){return this.set(t[0],t[1],t[2]),this}normalize(t=new xo){return t.setFrom(uo.normalize(this._array,vo))}get magnitude(){return uo.magnitude(this._array)}static dot(t,e){return uo.dot(t._array,e._array)}static add(t,e,r=new xo){return r.setFrom(uo.add(t._array,e._array,vo))}static subtract(t,e,r=new xo){return r.setFrom(uo.subtract(t._array,e._array,vo))}static cross(t,e,r=new xo){return r.setFrom(uo.cross(t._array,e._array,vo))}static inverse(t,e=new xo){return e.setFrom(uo.inverse(t._array,vo))}static distance(t,e){return uo.distance(t._array,e._array)}static squaredDistance(t,e){return uo.squaredDistance(t._array,e._array)}static multiply(t,e,r=new xo){return r.setFrom(uo.multiply(t._array,e._array,vo))}static negate(t,e=new xo){return e.setFrom(uo.negate(t._array,vo))}static transform(t,e,r=new xo){return e instanceof yo?r.setFrom(uo.transformMat4(t._array,e.array,vo)):r.setFrom(uo.transformQuat(t._array,e.array,vo))}static lerp(t,e,r,n=new xo){return n.setFrom(uo.lerp(t._array,e._array,r,vo))}static scale(t,e,r=new xo){return r.setFrom(uo.scale(t._array,e,vo))}}class bo extends dr{constructor(){super(...arguments),this.position=new xo(0,0,0,this.onChange,this),this.scale=new xo(1,1,1,this.onChange,this),this.rotationQuaternion=new po(0,0,0,1,this.onChange,this),this.worldTransform=new yo,this.localTransform=new yo,this.inverseWorldTransform=new yo,this.normalTransform=new yo}updateLocalTransform(){this._localID!==this._currentLocalID&&(this.localTransform.setFromRotationPositionScale(this.rotationQuaternion,this.position,this.scale),this._parentID=-1,this._currentLocalID=this._localID)}setFromMatrix(t){this.localTransform.copyFrom(t),this.position.copyFrom(this.localTransform.position),this.scale.copyFrom(this.localTransform.scaling),this.rotationQuaternion.copyFrom(this.localTransform.rotation)}updateTransform(t){this.updateLocalTransform(),t&&this._parentID===t._worldID||(this.worldTransform.copyFrom(this.localTransform),t instanceof bo&&this.worldTransform.multiply(t.worldTransform),mo.invert(this.worldTransform.array,this.inverseWorldTransform.array),mo.transpose(this.inverseWorldTransform.array,this.normalTransform.array),this._worldID++,t&&(this._parentID=t._worldID))}lookAt(t,e=new xo(0,1,0)){e instanceof xo&&(e=e.array);let r=mo.getRotation(mo.targetTo(t.array,this.worldTransform.position.array,e));this.rotationQuaternion.set(r[0],r[1],r[2],r[3])}}class Eo extends Es{constructor(){super(...arguments),this.transform=new bo}set position(t){this.transform.position.copyFrom(t)}get position(){return this.transform.position}set scale(t){this.transform.scale.copyFrom(t)}get scale(){return this.transform.scale}set rotationQuaternion(t){this.transform.rotationQuaternion.copyFrom(t)}get rotationQuaternion(){return this.transform.rotationQuaternion}get z(){return this.transform.position.z}set z(t){this.transform.position.z=t}get localTransform(){return this.transform.localTransform}get worldTransform(){return this.transform.worldTransform}}class To{constructor(t,e){this._direction=new xo,this._origin=new xo,this._origin.copyFrom(t),this._direction.copyFrom(e)}get origin(){return this._origin}get direction(){return this._direction}getPoint(t,e=new xo){return xo.add(this._origin,xo.scale(this._direction,t,e),e)}}class Ao{static set(t,e,r,n,i=new Float32Array(4)){return Zs(i,t,e,r,n)}static transformMat4(t,e,r=new Float32Array(4)){return function(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,t}(r,t,e)}static fromValues(t,e,r,n){return Js(t,e,r,n)}}const wo=new Float32Array(3),So=new Float32Array(16),Co=new Float32Array(4);class Ro extends Eo{constructor(t){super(),this.renderer=t,this._transformId=0,this._orthographic=!1,this._orthographicSize=10,this._obliqueness=new ur((()=>{this._transformId++}),void 0),this._fieldOfView=60,this._near=.1,this._far=1e3;let e=t.width/t.height,r=-1;this.renderer.on("prerender",(()=>{this._aspect||t.width/t.height!==e&&(this._transformId++,e=t.width/t.height),this.parent||r===this.transform._localID||(this.transform.updateTransform(),r=this.transform._localID)})),Ro.main||(Ro.main=this),this.transform.position.z=5,this.transform.rotationQuaternion.setEulerAngles(0,180,0)}get transformId(){return this.transform._worldID+this._transformId}get obliqueness(){return this._obliqueness}set obliqueness(t){this._obliqueness.copyFrom(t)}destroy(t){super.destroy(t),this===Ro.main&&(Ro.main=void 0)}get orthographicSize(){return this._orthographicSize}set orthographicSize(t){this._orthographicSize!==t&&(this._orthographicSize=t,this._transformId++)}get orthographic(){return this._orthographic}set orthographic(t){this._orthographic!==t&&(this._orthographic=t,this._transformId++)}screenToRay(t,e,r=this.renderer.screen){let n=this.screenToWorld(t,e,1,void 0,r);if(n)return this.orthographic?new To(n,this.worldTransform.forward):new To(this.worldTransform.position,xo.subtract(n,this.worldTransform.position))}screenToWorld(t,e,r,n=new xo,i=this.renderer.screen){var s;this.transform.updateTransform(null==(s=this.parent)?void 0:s.transform);let o=this.far;this.far=r;let a=mo.invert(this.viewProjection.array,So);if(null===a)return;let l=Ao.set(t/i.width*2-1,-1*(e/i.height*2-1),1,1,Co);this.far=o;let h=Ao.transformMat4(l,a,Co);h[3]=1/h[3];for(let u=0;u<3;u++)h[u]*=h[3];return n.set(h[0],h[1],h[2])}worldToScreen(t,e,r,n=new Ke,i=this.renderer.screen){var s;this.transform.updateTransform(null==(s=this.parent)?void 0:s.transform);let o=Ao.set(t,e,r,1,Co),a=Ao.transformMat4(Ao.transformMat4(o,this.view.array,Co),this.projection.array,Co);if(0!==a[3])for(let l=0;l<3;l++)a[l]/=a[3];return n.set((a[0]+1)/2*i.width,i.height-(a[1]+1)/2*i.height)}get aspect(){return this._aspect}set aspect(t){this._aspect!==t&&(this._aspect=t,this._transformId++)}get fieldOfView(){return this._fieldOfView}set fieldOfView(t){this._fieldOfView!==t&&(this._fieldOfView=t,this._transformId++)}get near(){return this._near}set near(t){this._near!==t&&(this._near=t,this._transformId++)}get far(){return this._far}set far(t){this._far!==t&&(this._far=t,this._transformId++)}get projection(){return this._projection||(this._projection=new go(this,new yo,(t=>{const e=this._aspect||this.renderer.width/this.renderer.height;this._orthographic?mo.ortho(-this._orthographicSize*e,this._orthographicSize*e,-this._orthographicSize,this._orthographicSize,this._near,this._far,t.array):(mo.perspective(this._fieldOfView*Xe,e,this._near,this._far,t.array),t.array[8]=this._obliqueness.x,t.array[9]=this._obliqueness.y)}))),this._projection.data}get view(){return this._view||(this._view=new go(this,new yo,(t=>{const e=uo.add(this.worldTransform.position.array,this.worldTransform.forward.array,wo);mo.lookAt(this.worldTransform.position.array,e,this.worldTransform.up.array,t.array)}))),this._view.data}get viewProjection(){return this._viewProjection||(this._viewProjection=new go(this,new yo,(t=>{mo.multiply(this.projection.array,this.view.array,t.array)}))),this._viewProjection.data}}Ms.installRendererPlugin("camera",Ro);class Io{constructor(){this._shaderGeometry={}}getShaderGeometry(t){return this._shaderGeometry[t.name]}addShaderGeometry(t,e){this._shaderGeometry[t.name]=t.createShaderGeometry(this,e)}hasShaderGeometry(t,e){return!!this._shaderGeometry[t.name]&&(!e||e&&this._shaderGeometry[t.name].instanced)}destroy(){for(let t in this._shaderGeometry)this._shaderGeometry[t].destroy();this._shaderGeometry={}}}var Po,Mo,Oo;(Po||(Po={})).create=function(){return Object.assign(new Io,{positions:{buffer:new Float32Array([-1,0,1,1,0,-1,-1,0,-1,1,0,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1])},normals:{buffer:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([0,1,1,0,0,0,1,1])}]})},(Mo||(Mo={})).create=function(){return Object.assign(new Io,{positions:{buffer:new Float32Array([-1,1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,13,14,12,15,13,16,17,18,16,19,17,20,21,22,20,23,21])},normals:{buffer:new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([.625,1,.375,.75,.375,1,.625,.75,.625,.75,.375,.5,.375,.75,.625,.5,.625,.5,.375,.25,.375,.5,.625,.25,.625,.25,.375,0,.375,.25,.625,0,.375,.25,.125,.5,.375,.5,.125,.25,.875,.25,.625,.5,.875,.5,.625,.25])}],tangents:{buffer:new Float32Array([0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1])}})},(Oo||(Oo={})).create=function(){return Object.assign(new Io,{positions:{buffer:new Float32Array([-1,1,0,1,-1,0,-1,-1,0,1,1,0])},indices:{buffer:new Uint8Array([0,2,1,0,1,3])},normals:{buffer:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},uvs:[{buffer:new Float32Array([0,0,1,1,0,1,1,0])}]})};class Do extends Eo{constructor(t,e){super(),this.mesh=t,this.material=e}destroy(t){super.destroy(t),this.mesh.removeInstance(this)}}var No,Fo=(t=>(t.spot="spot",t.directional="directional",t.point="point",t))(Fo||{}),Lo=(t=>(t.opaque="opaque",t.mask="mask",t.blend="blend",t))(Lo||{}),Bo=(t=>(t.alpha="alpha",t.emissive="emissive",t.f0="f0",t.metallic="metallic",t.normal="normal",t.occlusion="occlusion",t.roughness="roughness",t))(Bo||{});(t=>{let e,r,n,i,s,o;t.getMaxVertexUniformVectors=function(t){if(void 0!==e)return e;const r=t.gl;return e=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),e},t.isFloatingPointTextureSupported=function(t){if(2===t.context.webGLVersion)return!0;if(void 0!==r)return r;const e=t.gl;return r=!!e.getExtension("OES_texture_float"),r},t.isHalfFloatFramebufferSupported=function(t){if(2===t.context.webGLVersion)return!0;if(void 0!==n)return n;const e=t.gl,r=e.getExtension("OES_texture_half_float");if(!r)return!1;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,8,8,0,e.RGBA,r.HALF_FLOAT_OES,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s);const o=e.COLOR_ATTACHMENT0;return e.framebufferTexture2D(e.FRAMEBUFFER,o,e.TEXTURE_2D,i,0),n=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,n},t.isFloatFramebufferSupported=function(t){if(2===t.context.webGLVersion)return!0;if(void 0!==i)return i;const e=t.gl;if(!e.getExtension("OES_texture_float"))return!1;const r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,8,8,0,e.RGBA,e.FLOAT,null);const n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n);const s=e.COLOR_ATTACHMENT0;return e.framebufferTexture2D(e.FRAMEBUFFER,s,e.TEXTURE_2D,r,0),i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,i},t.supportsFloatLinear=function(t){if(void 0!==s)return s;const e=t.gl;return s=null!==e.getExtension("OES_texture_float_linear"),s},t.isShaderTextureLodSupported=function(t){return 2===t.context.webGLVersion||null!==t.gl.getExtension("EXT_shader_texture_lod")},t.isInstancingSupported=function(t){if(void 0!==o)return o;const e=t.gl;return o=void 0!==e.getExtension("ANGLE_instanced_arrays"),o}})(No||(No={}));const ko=Ss.get(e,"BufferResource")||Ss.get(e,"resources").BufferResource;class Uo extends Jr{constructor(t){let e=new Float32Array(16*t),r=new ko(e,{width:4,height:t});super(new De(r,{mipmap:g.OFF,wrapMode:m.CLAMP,scaleMode:p.NEAREST,format:u.RGBA,type:d.FLOAT,alphaMode:_.NO_PREMULTIPLIED_ALPHA,resolution:1})),this._buffer=e}static isSupported(t){return No.isFloatingPointTextureSupported(t)}updateBuffer(t){this._buffer.set(t),this.baseTexture.resource.update()}}var Go;(t=>{const e=[],r=new W;function n(t,e){let r,n=t;for(;null!==(r=/{(\w*)}/g.exec(n))&&e;)n=n.replace(r[0],e[r[1]]);return n}t.on=function(t,e,n){r.on(t,e,n)},t.warn=function(t,i){if(!e.includes(t)){e.push(t);let s=n(t,i);r.emit("warn",s)}},t.error=function(t,i){if(!e.includes(t)){e.push(t);let s=n(t,i);r.emit("error",s)}}})(Go||(Go={}));var jo,Vo,Ho,zo=(t=>(t.meshVertexSkinningFloatingPointTexturesNotSupported='Mesh is using vertex skinning but floating point textures is not supported on this device/environment. In case of errors, try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',t.meshVertexSkinningNumberOfJointsNotSupported="Mesh is using vertex skinning but the number of joints ({joints}) is not supported on this device/environment. Max number of supported joints is {maxJoints}, try reducing the number of joints.",t.imageBasedLightingShaderTextureLodNotSupported='Image based lighting is used but shader texture lod is not supported on this device/environment, the material may not be displayed correctly. Try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',t))(zo||{}),Wo=(t=>(t.ldr="ldr",t.rgbe8="rgbe8",t))(Wo||{});(Vo=jo||(jo={})).build=function(t,e,r,n,i){let s=[];if(e.instances.length>0&&s.push("USE_INSTANCING 1"),1===t.context.webGLVersion&&s.push("WEBGL1 1"),2===t.context.webGLVersion&&s.push("WEBGL2 1"),r.colors&&(3===r.colors.componentCount?s.push("HAS_VERTEX_COLOR_VEC3 1"):s.push("HAS_VERTEX_COLOR_VEC4 1")),r.normals&&s.push("HAS_NORMALS 1"),r.uvs&&r.uvs[0]&&s.push("HAS_UV_SET1 1"),r.uvs&&r.uvs[1]&&s.push("HAS_UV_SET2 1"),r.tangents&&s.push("HAS_TANGENTS 1"),r.targets){for(let t=0;t<r.targets.length;t++)r.targets[t].positions&&s.push("HAS_TARGET_POSITION"+t),r.targets[t].normals&&s.push("HAS_TARGET_NORMAL"+t),r.targets[t].tangents&&s.push("HAS_TARGET_TANGENT"+t);e.targetWeights&&e.targetWeights.length>0&&(s.push(`WEIGHT_COUNT ${e.targetWeights.length}`),s.push("USE_MORPHING 1"))}if(r.joints&&s.push("HAS_JOINT_SET1 1"),r.weights&&s.push("HAS_WEIGHT_SET1 1"),e.skin&&function(t,e,r){if(!t.skin)return;let n=20,i=No.getMaxVertexUniformVectors(r)-n,s=8,o=Math.floor(i/s),a=t.skin.joints.length<=o;const l=()=>{var r;e.push("USE_SKINNING 1"),e.push(`JOINT_COUNT ${null==(r=t.skin)?void 0:r.joints.length}`)},h=()=>{var r;e.push("USE_SKINNING 1"),e.push(`JOINT_COUNT ${null==(r=t.skin)?void 0:r.joints.length}`),e.push("USE_SKINNING_TEXTURE 1")};if(S.PREFER_UNIFORMS_WHEN_UPLOADING_SKIN_JOINTS){if(a)return void l();if(Uo.isSupported(r))return void h();Go.error(zo.meshVertexSkinningNumberOfJointsNotSupported,{joints:t.skin.joints.length,maxJoints:o})}else{if(Uo.isSupported(r))return void h();Go.warn(zo.meshVertexSkinningFloatingPointTexturesNotSupported),a?l():Go.error(zo.meshVertexSkinningNumberOfJointsNotSupported,{joints:t.skin.joints.length,maxJoints:o})}}(e,s,t),n.unlit&&s.push("MATERIAL_UNLIT 1"),s.push("MATERIAL_METALLICROUGHNESS 1"),i.fog&&s.push("USE_FOG 1"),i.lights.length>0&&(s.push(`LIGHT_COUNT ${i.lights.length}`),s.push("USE_PUNCTUAL 1")),i.imageBasedLighting){if(!i.imageBasedLighting.valid)return;No.isShaderTextureLodSupported(t)?s.push("USE_TEX_LOD 1"):Go.warn(zo.imageBasedLightingShaderTextureLodNotSupported),s.push("USE_IBL 1"),i.imageBasedLighting.diffuse.cubemapFormat===Wo.rgbe8&&s.push("USE_RGBE 1")}if(n.shadowCastingLight&&s.push("USE_SHADOW_MAPPING 1"),n.baseColorTexture){if(!n.baseColorTexture.valid)return;n.baseColorTexture.transform&&s.push("HAS_BASECOLOR_UV_TRANSFORM 1"),s.push("HAS_BASE_COLOR_MAP 1")}if(n.emissiveTexture){if(!n.emissiveTexture.valid)return;n.emissiveTexture.transform&&s.push("HAS_EMISSIVE_UV_TRANSFORM 1"),s.push("HAS_EMISSIVE_MAP 1")}if(n.normalTexture){if(!n.normalTexture.valid)return;n.normalTexture.transform&&s.push("HAS_NORMAL_UV_TRANSFORM 1"),s.push("HAS_NORMAL_MAP 1")}if(n.metallicRoughnessTexture){if(!n.metallicRoughnessTexture.valid)return;n.metallicRoughnessTexture.transform&&s.push("HAS_METALLICROUGHNESS_UV_TRANSFORM 1"),s.push("HAS_METALLIC_ROUGHNESS_MAP 1")}if(n.occlusionTexture){if(!n.occlusionTexture.valid)return;n.occlusionTexture.transform&&s.push("HAS_OCCLUSION_UV_TRANSFORM 1"),s.push("HAS_OCCLUSION_MAP 1")}switch(n.alphaMode){case Lo.opaque:s.push("ALPHAMODE_OPAQUE 1");break;case Lo.mask:s.push("ALPHAMODE_MASK 1")}switch(n.debugMode&&s.push("DEBUG_OUTPUT 1"),n.debugMode){case Bo.alpha:s.push("DEBUG_ALPHA 1");break;case Bo.emissive:s.push("DEBUG_EMISSIVE 1");break;case Bo.f0:s.push("DEBUG_F0 1");break;case Bo.metallic:s.push("DEBUG_METALLIC 1");break;case Bo.normal:s.push("DEBUG_NORMAL 1");break;case Bo.occlusion:s.push("DEBUG_OCCLUSION 1");break;case Bo.roughness:s.push("DEBUG_ROUGHNESS 1")}return s},Vo.hasSkinningTextureFeature=function(t){return t.includes("USE_SKINNING_TEXTURE 1")};class Xo extends Or{constructor(){super(...arguments),this._state=Object.assign(new we,{culling:!0,clockwiseFrontFace:!1,depthTest:!0})}get name(){return"mesh-shader"}createShaderGeometry(t,e){let r=new Ve;return t.indices&&(1===t.indices.buffer.BYTES_PER_ELEMENT?r.addIndex(new Le(new Uint16Array(t.indices.buffer))):r.addIndex(new Le(t.indices.buffer))),t.positions&&r.addAttribute("a_Position",new Le(t.positions.buffer),3,!1,t.positions.componentType,t.positions.stride),t.uvs&&t.uvs[0]&&r.addAttribute("a_UV1",new Le(t.uvs[0].buffer),2,!1,t.uvs[0].componentType,t.uvs[0].stride),t.normals&&r.addAttribute("a_Normal",new Le(t.normals.buffer),3,!1,t.normals.componentType,t.normals.stride),t.tangents&&r.addAttribute("a_Tangent",new Le(t.tangents.buffer),4,!1,t.tangents.componentType,t.tangents.stride),t.colors&&r.addAttribute("a_Color",new Le(t.colors.buffer),t.colors.componentCount,!0,t.colors.componentType,t.colors.stride),r}render(t,e,r=this._state,n=h.TRIANGLES){const i=t.instances.filter((t=>t.worldVisible&&t.renderable)).length,s=t.instances.length>0;t.geometry.hasShaderGeometry(this,s)||t.geometry.addShaderGeometry(this,s);let o=t.geometry.getShaderGeometry(this);e.shader.bind(this,!1),e.state.set(r),e.geometry.bind(o,this),e.geometry.draw(n,void 0,void 0,i)}}class Yo{constructor(){this._maxInstances=200,this._modelMatrix=[new Le,new Le,new Le,new Le],this._normalMatrix=[new Le,new Le,new Le,new Le],this._baseColor=new Le,this.expandBuffers(this._maxInstances)}expandBuffers(t){for(;t>this._maxInstances;)this._maxInstances+=Math.floor(.5*this._maxInstances);for(let e=0;e<4;e++)this._modelMatrix[e].update(new Float32Array(4*this._maxInstances)),this._normalMatrix[e].update(new Float32Array(4*this._maxInstances));this._baseColor.update(new Float32Array(4*this._maxInstances))}updateBuffers(t){t.length>this._maxInstances&&this.expandBuffers(t.length);let e=0;for(let r=0;r<t.length;r++){const n=t[r].transform.normalTransform.array;for(let t=0;t<4;t++)this._normalMatrix[t].data.set(n.slice(4*t,4*t+4),4*e);const i=t[r].worldTransform.array;for(let t=0;t<4;t++)this._modelMatrix[t].data.set(i.slice(4*t,4*t+4),4*e);const s=t[r].material;this._baseColor.data.set(s.baseColor.rgba,4*e),e++}for(let r=0;r<4;r++)this._modelMatrix[r].update(),this._normalMatrix[r].update();this._baseColor.update()}addGeometryAttributes(t){for(let e=0;e<4;e++)t.addAttribute(`a_ModelMatrix${e}`,this._modelMatrix[e],4,!1,void 0,0,void 0,!0);for(let e=0;e<4;e++)t.addAttribute(`a_NormalMatrix${e}`,this._normalMatrix[e],4,!1,void 0,0,void 0,!0);t.addAttribute("a_BaseColorFactor",this._baseColor,4,!1,void 0,0,void 0,!0)}}(Ho||(Ho={})).build=function(t,e,r){return 1===r.context.webGLVersion&&(t=t.replace(/VERSION/,"100").replace(/VERT_IN/g,"attribute").replace(/VERT_OUT/g,"varying").replace(/FRAG_COLOR/g,"gl_FragColor").replace(/FRAG_IN/g,"varying")),2===r.context.webGLVersion&&(t=t.replace(/VERSION/,"300 es").replace(/VERT_IN/g,"in").replace(/VERT_OUT/g,"out").replace(/FRAG_COLOR/g,"g_finalColor").replace(/FRAG_IN/g,"in")),t.replace(/#define FEATURES/,e.map((t=>`#define ${t}`)).join("\n"))};var Ko="#version VERSION\n\n//\n// This fragment shader defines a reference implementation for Physically Based Shading of\n// a microfacet surface material defined by a glTF model.\n//\n// References:\n// [1] Real Shading in Unreal Engine 4\n//     http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\n// [2] Physically Based Shading at Disney\n//     http://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf\n// [3] README.md - Environment Maps\n//     https://github.com/KhronosGroup/glTF-WebGL-PBR/#environment-maps\n// [4] \"An Inexpensive BRDF Model for Physically based Rendering\" by Christophe Schlick\n//     https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\n\n#define FEATURES\n\n#if defined(WEBGL1) //&& defined(USE_TEX_LOD)\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n\n#if defined(WEBGL1)\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n#if defined(WEBGL1) && defined(USE_HDR)\n#extension GL_OES_texture_float : enable\n#extension GL_OES_texture_float_linear : enable\n#endif\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvec4 _texture(sampler2D sampler, vec2 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return texture2D(sampler, coord);\n#endif\n}\n\nvec4 _texture(samplerCube sampler, vec3 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return textureCube(sampler, coord);\n#endif\n}\nvec4 _textureLod(sampler2D sampler, vec2 coord, float lod)\n{\n#ifdef WEBGL2\n    return textureLod(sampler, coord, lod);\n#endif\n#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) \n    return texture2DLodEXT(sampler, coord, lod);\n#endif\n    return vec4(0.0);\n}\n\nvec4 _textureLod(samplerCube sampler, vec3 coord, float lod)\n{\n#ifdef WEBGL2\n    return textureLod(sampler, coord, lod);\n#endif\n#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) \n    return textureCubeLodEXT(sampler, coord, lod);\n#endif\n    return vec4(0.0);\n}\nvec3 _dFdx(vec3 coord)\n{\n#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)\n    return dFdx(coord);\n#endif\n    return vec3(0.0);\n}\n\nvec3 _dFdy(vec3 coord)\n{\n#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)\n    return dFdy(coord);\n#endif\n    return vec3(0.0);\n}\nFRAG_IN vec2 v_UVCoord1;\nFRAG_IN vec2 v_UVCoord2;\n\n// General Material\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\nuniform int u_NormalUVSet;\nuniform mat3 u_NormalUVTransform;\n#endif\n\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D u_EmissiveSampler;\nuniform int u_EmissiveUVSet;\nuniform vec3 u_EmissiveFactor;\nuniform mat3 u_EmissiveUVTransform;\n#endif\n\n#ifdef HAS_OCCLUSION_MAP\nuniform sampler2D u_OcclusionSampler;\nuniform int u_OcclusionUVSet;\nuniform float u_OcclusionStrength;\nuniform mat3 u_OcclusionUVTransform;\n#endif\n\n// Metallic Roughness Material\n#ifdef HAS_BASE_COLOR_MAP\nuniform sampler2D u_BaseColorSampler;\nuniform int u_BaseColorUVSet;\nuniform mat3 u_BaseColorUVTransform;\n#endif\n\n#ifdef HAS_METALLIC_ROUGHNESS_MAP\nuniform sampler2D u_MetallicRoughnessSampler;\nuniform int u_MetallicRoughnessUVSet;\nuniform mat3 u_MetallicRoughnessUVTransform;\n#endif\n\n// Specular Glossiness Material\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D u_DiffuseSampler;\nuniform int u_DiffuseUVSet;\nuniform mat3 u_DiffuseUVTransform;\n#endif\n\n#ifdef HAS_SPECULAR_GLOSSINESS_MAP\nuniform sampler2D u_SpecularGlossinessSampler;\nuniform int u_SpecularGlossinessUVSet;\nuniform mat3 u_SpecularGlossinessUVTransform;\n#endif\n\n// IBL\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\n#endif\n\n#ifdef USE_SHADOW_MAPPING\nuniform sampler2D u_ShadowSampler;\n#endif\n\nvec2 getNormalUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_NORMAL_MAP\n    uv.xy = u_NormalUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_NORMAL_UV_TRANSFORM\n    uv = u_NormalUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\nvec2 getEmissiveUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_EMISSIVE_MAP\n    uv.xy = u_EmissiveUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_EMISSIVE_UV_TRANSFORM\n    uv = u_EmissiveUVTransform * uv;\n    #endif\n#endif\n\n    return uv.xy;\n}\n\nvec2 getOcclusionUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_OCCLUSION_MAP\n    uv.xy = u_OcclusionUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_OCCLUSION_UV_TRANSFORM\n    uv = u_OcclusionUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\nvec2 getBaseColorUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_BASE_COLOR_MAP\n    uv.xy = u_BaseColorUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_BASECOLOR_UV_TRANSFORM\n    uv = u_BaseColorUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\nvec2 getMetallicRoughnessUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_METALLIC_ROUGHNESS_MAP\n    uv.xy = u_MetallicRoughnessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_METALLICROUGHNESS_UV_TRANSFORM\n    uv = u_MetallicRoughnessUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\nvec2 getSpecularGlossinessUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_SPECULAR_GLOSSINESS_MAP\n    uv.xy = u_SpecularGlossinessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_SPECULARGLOSSINESS_UV_TRANSFORM\n    uv = u_SpecularGlossinessUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\nvec2 getDiffuseUV()\n{\n    vec3 uv = vec3(v_UVCoord1, 1.0);\n#ifdef HAS_DIFFUSE_MAP\n    uv.xy = u_DiffuseUVSet < 1 ? v_UVCoord1 : v_UVCoord2;\n    #ifdef HAS_DIFFUSE_UV_TRANSFORM\n    uv = u_DiffuseUVTransform * uv;\n    #endif\n#endif\n    return uv.xy;\n}\n\n// textures.glsl needs to be included\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinReflectance = 0.04;\n\nFRAG_IN vec3 v_Position;\nFRAG_IN vec3 v_ModelViewPosition;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nFRAG_IN mat3 v_TBN;\n#else\nFRAG_IN vec3 v_Normal;\n#endif\n#endif\n\n#ifdef HAS_VERTEX_COLOR_VEC3\nFRAG_IN vec3 v_Color;\n#endif\n#ifdef HAS_VERTEX_COLOR_VEC4\nFRAG_IN vec4 v_Color;\n#endif\n\nstruct AngularInfo\n{\n    float NdotL;                  // cos angle between normal and light direction\n    float NdotV;                  // cos angle between normal and view direction\n    float NdotH;                  // cos angle between normal and half vector\n    float LdotH;                  // cos angle between light direction and half vector\n\n    float VdotH;                  // cos angle between view direction and half vector\n\n    vec3 padding;\n};\n\nvec4 getVertexColor()\n{\n   vec4 color = vec4(1.0, 1.0, 1.0, 1.0);\n\n#ifdef HAS_VERTEX_COLOR_VEC3\n    color.rgb = v_Color;\n#endif\n#ifdef HAS_VERTEX_COLOR_VEC4\n    color = v_Color;\n#endif\n\n   return color;\n}\n\n// Find the normal for this fragment, pulling either from a predefined normal map\n// or from the interpolated mesh normal and tangent attributes.\nvec3 getNormal()\n{\n    vec2 UV = getNormalUV();\n\n    // Retrieve the tangent space matrix\n#ifndef HAS_TANGENTS\n    vec3 pos_dx = _dFdx(v_Position);\n    vec3 pos_dy = _dFdy(v_Position);\n    vec3 tex_dx = _dFdx(vec3(UV, 0.0));\n    vec3 tex_dy = _dFdy(vec3(UV, 0.0));\n    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n    vec3 ng = normalize(v_Normal);\n#else\n    vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n    t = normalize(t - ng * dot(ng, t));\n    vec3 b = normalize(cross(ng, t));\n    mat3 tbn = mat3(t, b, ng);\n#else // HAS_TANGENTS\n    mat3 tbn = v_TBN;\n#endif\n\n#ifdef HAS_NORMAL_MAP\n    vec3 n = _texture(u_NormalSampler, UV).rgb;\n    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n    // The tbn matrix is linearly interpolated, so we need to re-normalize\n    vec3 n = normalize(tbn[2].xyz);\n#endif\n\n    return n;\n}\n\nfloat getPerceivedBrightness(vec3 vector)\n{\n    return sqrt(0.299 * vector.r * vector.r + 0.587 * vector.g * vector.g + 0.114 * vector.b * vector.b);\n}\n\n// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/examples/convert-between-workflows/js/three.pbrUtilities.js#L34\nfloat solveMetallic(vec3 diffuse, vec3 specular, float oneMinusSpecularStrength) {\n    float specularBrightness = getPerceivedBrightness(specular);\n\n    if (specularBrightness < c_MinReflectance) {\n        return 0.0;\n    }\n\n    float diffuseBrightness = getPerceivedBrightness(diffuse);\n\n    float a = c_MinReflectance;\n    float b = diffuseBrightness * oneMinusSpecularStrength / (1.0 - c_MinReflectance) + specularBrightness - 2.0 * c_MinReflectance;\n    float c = c_MinReflectance - specularBrightness;\n    float D = b * b - 4.0 * a * c;\n\n    return clamp((-b + sqrt(D)) / (2.0 * a), 0.0, 1.0);\n}\n\nAngularInfo getAngularInfo(vec3 pointToLight, vec3 normal, vec3 view)\n{\n    // Standard one-letter names\n    vec3 n = normalize(normal);           // Outward direction of surface point\n    vec3 v = normalize(view);             // Direction from surface point to view\n    vec3 l = normalize(pointToLight);     // Direction from surface point to light\n    vec3 h = normalize(l + v);            // Direction of the vector between l and v\n\n    float NdotL = clamp(dot(n, l), 0.0, 1.0);\n    float NdotV = clamp(dot(n, v), 0.0, 1.0);\n    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n    return AngularInfo(\n        NdotL,\n        NdotV,\n        NdotH,\n        LdotH,\n        VdotH,\n        vec3(0, 0, 0)\n    );\n}\n\n#ifdef USE_SHADOW_MAPPING\nFRAG_IN vec4 v_PositionLightSpace;\n#endif\n\nfloat linstep(float low, float high, float v)\n{\n    return clamp((v-low) / (high-low), 0.0, 1.0);\n}\n\n#ifdef USE_SHADOW_MAPPING\nfloat getShadowContribution()\n{\n    vec3 coords = v_PositionLightSpace.xyz / v_PositionLightSpace.w * 0.5 + 0.5;\n    if (coords.z < 0.01 || coords.z > 0.99 || coords.x < 0.01 || coords.x > 0.99 || coords.y < 0.01 || coords.y > 0.99) {\n        return 1.0;\n    }\n    vec2 moments = vec2(1.0) - _texture(u_ShadowSampler, coords.xy).xy;\n    float p = step(coords.z, moments.x);\n    float variance = max(moments.y - moments.x * moments.x, 0.00002);\n    float d = coords.z - moments.x;\n    float pMax = linstep(0.2, 1.0, variance / (variance + d*d));\n    return min(max(p, pMax), 1.0);\n}\n#endif\nuniform float u_Exposure;\n\nconst float GAMMA = 2.2;\nconst float INV_GAMMA = 1.0 / GAMMA;\n\n// linear to sRGB approximation\n// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\nvec3 LINEARtoSRGB(vec3 color)\n{\n    return pow(color, vec3(INV_GAMMA));\n}\n\n// sRGB to linear approximation\n// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n    return vec4(pow(srgbIn.xyz, vec3(GAMMA)), srgbIn.w);\n}\n\n// Uncharted 2 tone map\n// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 toneMapUncharted2Impl(vec3 color)\n{\n    const float A = 0.15;\n    const float B = 0.50;\n    const float C = 0.10;\n    const float D = 0.20;\n    const float E = 0.02;\n    const float F = 0.30;\n    return ((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;\n}\n\nvec3 toneMapUncharted(vec3 color)\n{\n    const float W = 11.2;\n    color = toneMapUncharted2Impl(color * 2.0);\n    vec3 whiteScale = 1.0 / toneMapUncharted2Impl(vec3(W));\n    return LINEARtoSRGB(color * whiteScale);\n}\n\n// Hejl Richard tone map\n// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 toneMapHejlRichard(vec3 color)\n{\n    color = max(vec3(0.0), color - vec3(0.004));\n    return (color*(6.2*color+.5))/(color*(6.2*color+1.7)+0.06);\n}\n\n// ACES tone map\n// see: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\nvec3 toneMapACES(vec3 color)\n{\n    const float A = 2.51;\n    const float B = 0.03;\n    const float C = 2.43;\n    const float D = 0.59;\n    const float E = 0.14;\n    return LINEARtoSRGB(clamp((color * (A * color + B)) / (color * (C * color + D) + E), 0.0, 1.0));\n}\n\nvec3 toneMap(vec3 color)\n{\n    color *= u_Exposure;\n\n#ifdef TONEMAP_UNCHARTED\n    return toneMapUncharted(color);\n#endif\n\n#ifdef TONEMAP_HEJLRICHARD\n    return toneMapHejlRichard(color);\n#endif\n\n#ifdef TONEMAP_ACES\n    return toneMapACES(color);\n#endif\n\n    return LINEARtoSRGB(color);\n}\n\nvec4 encodeRGBE(vec3 rgb) {\n  vec4 vEncoded;\n  float maxComponent = max(max(rgb.r, rgb.g), rgb.b);\n  float fExp = ceil(log2(maxComponent));\n  vEncoded.rgb = rgb / exp2(fExp);\n  vEncoded.a = (fExp + 128.0) / 255.0;\n  return vEncoded;\n}\n\nvec3 decodeRGBE(vec4 rgbe) {\n  vec3 vDecoded;\n  float fExp = rgbe.a * 255.0 - 128.0;\n  vDecoded = rgbe.rgb * exp2(fExp);\n  return vDecoded;\n}\n\n// KHR_lights_punctual extension.\n// see https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n\nstruct Light\n{\n    vec3 direction;\n    float range;\n\n    vec3 color;\n    float intensity;\n\n    vec3 position;\n    float innerConeCos;\n\n    float outerConeCos;\n    int type;\n\n    vec2 padding;\n};\n\nconst int LightType_Directional = 0;\nconst int LightType_Point = 1;\nconst int LightType_Spot = 2;\n\n#ifdef USE_PUNCTUAL\nuniform Light u_Lights[LIGHT_COUNT];\n#endif\n\n#ifdef USE_FOG\nuniform float u_FogNear;\nuniform float u_FogFar;\nuniform vec3 u_FogColor;\n#endif\n\n#if defined(MATERIAL_SPECULARGLOSSINESS) || defined(MATERIAL_METALLICROUGHNESS)\nuniform float u_MetallicFactor;\nuniform float u_RoughnessFactor;\nuniform vec4 u_BaseColorFactor;\n#endif\n\n#ifdef USE_INSTANCING\nFRAG_IN vec4 v_BaseColorFactor;\n#endif\n\n#ifdef MATERIAL_SPECULARGLOSSINESS\nuniform vec3 u_SpecularFactor;\nuniform vec4 u_DiffuseFactor;\nuniform float u_GlossinessFactor;\n#endif\n\n#ifdef ALPHAMODE_MASK\nuniform float u_AlphaCutoff;\n#endif\n\n#ifdef USE_SHADOW_MAPPING\nuniform int u_ShadowLightIndex;\n#endif\n\nuniform vec3 u_Camera;\n\nuniform int u_MipCount;\n\nstruct MaterialInfo\n{\n    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n    vec3 reflectance0;            // full reflectance color (normal incidence angle)\n\n    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n    vec3 diffuseColor;            // color contribution from diffuse lighting\n\n    vec3 reflectance90;           // reflectance color at grazing angle\n    vec3 specularColor;           // color contribution from specular lighting\n};\n\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\n#ifdef USE_IBL\nvec3 getIBLContribution(MaterialInfo materialInfo, vec3 n, vec3 v)\n{\n    float NdotV = clamp(dot(n, v), 0.0, 1.0);\n\n    float lod = clamp(materialInfo.perceptualRoughness * float(u_MipCount), 0.0, float(u_MipCount));\n    vec3 reflection = normalize(reflect(-v, n));\n\n    vec2 brdfSamplePoint = clamp(vec2(NdotV, materialInfo.perceptualRoughness), vec2(0.0, 0.0), vec2(1.0, 1.0));\n    // retrieve a scale and bias to F0. See [1], Figure 3\n    vec2 brdf = _texture(u_brdfLUT, brdfSamplePoint).rg;\n\n    vec4 diffuseSample = _texture(u_DiffuseEnvSampler, n);\n\n#ifdef USE_TEX_LOD\n    vec4 specularSample = _textureLod(u_SpecularEnvSampler, reflection, lod);\n#else\n    vec4 specularSample = _texture(u_SpecularEnvSampler, reflection);\n#endif\n\n#if defined(USE_HDR)\n    // Already linear.\n    vec3 diffuseLight = diffuseSample.rgb;\n    vec3 specularLight = specularSample.rgb;\n#elif defined(USE_RGBE)\n    vec3 diffuseLight = decodeRGBE(diffuseSample);\n    vec3 specularLight = decodeRGBE(specularSample);\n#else\n    vec3 diffuseLight = SRGBtoLINEAR(diffuseSample).rgb;\n    vec3 specularLight = SRGBtoLINEAR(specularSample).rgb;\n#endif\n\n    vec3 diffuse = diffuseLight * materialInfo.diffuseColor;\n    vec3 specular = specularLight * (materialInfo.specularColor * brdf.x + brdf.y);\n\n    return diffuse + specular;\n}\n#endif\n\n// Lambert lighting\n// see https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/\nvec3 diffuse(MaterialInfo materialInfo)\n{\n    return materialInfo.diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3 specularReflection(MaterialInfo materialInfo, AngularInfo angularInfo)\n{\n    return materialInfo.reflectance0 + (materialInfo.reflectance90 - materialInfo.reflectance0) * pow(clamp(1.0 - angularInfo.VdotH, 0.0, 1.0), 5.0);\n}\n\n// Smith Joint GGX\n// Note: Vis = G / (4 * NdotL * NdotV)\n// see Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs. Journal of Computer Graphics Techniques, 3\n// see Real-Time Rendering. Page 331 to 336.\n// see https://google.github.io/filament/Filament.md.html#materialsystem/specularbrdf/geometricshadowing(specularg)\nfloat visibilityOcclusion(MaterialInfo materialInfo, AngularInfo angularInfo)\n{\n    float NdotL = angularInfo.NdotL;\n    float NdotV = angularInfo.NdotV;\n    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;\n\n    float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n    float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n\n    float GGX = GGXV + GGXL;\n    if (GGX > 0.0)\n    {\n        return 0.5 / GGX;\n    }\n    return 0.0;\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// Implementation from \"Average Irregularity Representation of a Roughened Surface for Ray Reflection\" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\nfloat microfacetDistribution(MaterialInfo materialInfo, AngularInfo angularInfo)\n{\n    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;\n    float f = (angularInfo.NdotH * alphaRoughnessSq - angularInfo.NdotH) * angularInfo.NdotH + 1.0;\n    return alphaRoughnessSq / (M_PI * f * f);\n}\n\nvec3 getPointShade(vec3 pointToLight, MaterialInfo materialInfo, vec3 normal, vec3 view)\n{\n    AngularInfo angularInfo = getAngularInfo(pointToLight, normal, view);\n\n    if (angularInfo.NdotL > 0.0 || angularInfo.NdotV > 0.0)\n    {\n        // Calculate the shading terms for the microfacet specular shading model\n        vec3 F = specularReflection(materialInfo, angularInfo);\n        float Vis = visibilityOcclusion(materialInfo, angularInfo);\n        float D = microfacetDistribution(materialInfo, angularInfo);\n\n        // Calculation of analytical lighting contribution\n        vec3 diffuseContrib = (1.0 - F) * diffuse(materialInfo);\n        vec3 specContrib = F * Vis * D;\n\n        // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n        return angularInfo.NdotL * (diffuseContrib + specContrib);\n    }\n\n    return vec3(0.0, 0.0, 0.0);\n}\n\n// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#range-property\nfloat getRangeAttenuation(float range, float distance)\n{\n    if (range <= 0.0)\n    {\n        // negative range means unlimited\n        return 1.0;\n    }\n    return max(min(1.0 - pow(distance / range, 4.0), 1.0), 0.0) / pow(distance, 2.0);\n}\n\n// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#inner-and-outer-cone-angles\nfloat getSpotAttenuation(vec3 pointToLight, vec3 spotDirection, float outerConeCos, float innerConeCos)\n{\n    float actualCos = dot(normalize(spotDirection), normalize(-pointToLight));\n    if (actualCos > outerConeCos)\n    {\n        if (actualCos < innerConeCos)\n        {\n            return smoothstep(outerConeCos, innerConeCos, actualCos);\n        }\n        return 1.0;\n    }\n    return 0.0;\n}\n\nvec3 applyDirectionalLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)\n{\n    vec3 pointToLight = -light.direction;\n    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;\n    return light.intensity * light.color * shade;\n}\n\nvec3 applyPointLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view)\n{\n    vec3 pointToLight = light.position - v_Position;\n    float distance = length(pointToLight);\n    float attenuation = getRangeAttenuation(light.range, distance);\n    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view);\n    return attenuation * light.intensity * light.color * shade;\n}\n\nvec3 applySpotLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)\n{\n    vec3 pointToLight = light.position - v_Position;\n    float distance = length(pointToLight);\n    float rangeAttenuation = getRangeAttenuation(light.range, distance);\n    float spotAttenuation = getSpotAttenuation(pointToLight, light.direction, light.outerConeCos, light.innerConeCos);\n    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;\n    return rangeAttenuation * spotAttenuation * light.intensity * light.color * shade;\n}\n\n#ifdef WEBGL2\n    out vec4 FRAG_COLOR;\n#endif\n\nvoid main()\n{\n    // Metallic and Roughness material properties are packed together\n    // In glTF, these factors can be specified by fixed scalar values\n    // or from a metallic-roughness map\n    float perceptualRoughness = 0.0;\n    float metallic = 0.0;\n    vec4 baseColor = vec4(0.0, 0.0, 0.0, 1.0);\n    vec3 diffuseColor = vec3(0.0);\n    vec3 specularColor= vec3(0.0);\n    vec3 f0 = vec3(0.04);\n\n#ifdef MATERIAL_SPECULARGLOSSINESS\n\n#ifdef HAS_SPECULAR_GLOSSINESS_MAP\n    vec4 sgSample = SRGBtoLINEAR(_texture(u_SpecularGlossinessSampler, getSpecularGlossinessUV()));\n    perceptualRoughness = (1.0 - sgSample.a * u_GlossinessFactor); // glossiness to roughness\n    f0 = sgSample.rgb * u_SpecularFactor; // specular\n#else\n    f0 = u_SpecularFactor;\n    perceptualRoughness = 1.0 - u_GlossinessFactor;\n#endif // ! HAS_SPECULAR_GLOSSINESS_MAP\n\n#ifdef HAS_DIFFUSE_MAP\n    baseColor = SRGBtoLINEAR(_texture(u_DiffuseSampler, getDiffuseUV())) * u_DiffuseFactor;\n#else\n    baseColor = u_DiffuseFactor;\n#endif // !HAS_DIFFUSE_MAP\n\n    baseColor *= getVertexColor();\n\n    // f0 = specular\n    specularColor = f0;\n    float oneMinusSpecularStrength = 1.0 - max(max(f0.r, f0.g), f0.b);\n    diffuseColor = baseColor.rgb * oneMinusSpecularStrength;\n\n#ifdef DEBUG_METALLIC\n    // do conversion between metallic M-R and S-G metallic\n    metallic = solveMetallic(baseColor.rgb, specularColor, oneMinusSpecularStrength);\n#endif // ! DEBUG_METALLIC\n\n#endif // ! MATERIAL_SPECULARGLOSSINESS\n\n#ifdef MATERIAL_METALLICROUGHNESS\n\n#ifdef HAS_METALLIC_ROUGHNESS_MAP\n    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\n    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\n    vec4 mrSample = _texture(u_MetallicRoughnessSampler, getMetallicRoughnessUV());\n    perceptualRoughness = mrSample.g * u_RoughnessFactor;\n    metallic = mrSample.b * u_MetallicFactor;\n#else\n    metallic = u_MetallicFactor;\n    perceptualRoughness = u_RoughnessFactor;\n#endif\n\n    vec4 baseColorFactor = u_BaseColorFactor;\n#ifdef USE_INSTANCING\n    baseColorFactor = v_BaseColorFactor;\n#endif\n\n    // The albedo may be defined from a base texture or a flat color\n#if defined(HAS_BASE_COLOR_MAP) && defined(MATERIAL_UNLIT)\n    baseColor = _texture(u_BaseColorSampler, getBaseColorUV()) * baseColorFactor;\n#elif defined(HAS_BASE_COLOR_MAP)\n    baseColor = SRGBtoLINEAR(_texture(u_BaseColorSampler, getBaseColorUV())) * baseColorFactor;\n#else\n    baseColor = baseColorFactor;\n#endif\n\n    baseColor *= getVertexColor();\n\n    diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n\n    specularColor = mix(f0, baseColor.rgb, metallic);\n\n#endif // ! MATERIAL_METALLICROUGHNESS\n\n#ifdef ALPHAMODE_MASK\n    if(baseColor.a < u_AlphaCutoff)\n    {\n        discard;\n    }\n    baseColor.a = 1.0;\n#endif\n\n#ifdef ALPHAMODE_OPAQUE\n    baseColor.a = 1.0;\n#endif\n\n#ifdef MATERIAL_UNLIT\n    FRAG_COLOR = vec4(baseColor.rgb * baseColor.a, baseColor.a);\n    return;\n#endif\n\n    perceptualRoughness = clamp(perceptualRoughness, 0.0, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n\n    // Roughness is authored as perceptual roughness; as is convention,\n    // convert to material roughness by squaring the perceptual roughness [2].\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    // Compute reflectance.\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    // Anything less than 2% is physically impossible and is instead considered to be shadowing. Compare to \"Real-Time-Rendering\" 4th editon on page 325.\n    vec3 specularEnvironmentR90 = vec3(clamp(reflectance * 50.0, 0.0, 1.0));\n\n    MaterialInfo materialInfo = MaterialInfo(\n        perceptualRoughness,\n        specularEnvironmentR0,\n        alphaRoughness,\n        diffuseColor,\n        specularEnvironmentR90,\n        specularColor\n    );\n\n    // LIGHTING\n\n    vec3 color = vec3(0.0, 0.0, 0.0);\n    vec3 normal = getNormal();\n    vec3 view = normalize(u_Camera - v_Position);\n\n    float shadow = 1.0;\n    #ifdef USE_SHADOW_MAPPING\n        shadow = getShadowContribution();\n    #endif\n\n#ifdef USE_PUNCTUAL\n    for (int i = 0; i < LIGHT_COUNT; ++i)\n    {\n        float shadowContribution = shadow;\n        #ifdef USE_SHADOW_MAPPING\n        if (u_ShadowLightIndex != i) \n        {\n            shadowContribution = 1.0;\n        }\n        #endif\n        Light light = u_Lights[i];\n        if (light.type == LightType_Directional)\n        {\n            color += applyDirectionalLight(light, materialInfo, normal, view, shadowContribution);\n        }\n        else if (light.type == LightType_Point)\n        {\n            color += applyPointLight(light, materialInfo, normal, view);\n        }\n        else if (light.type == LightType_Spot)\n        {\n            color += applySpotLight(light, materialInfo, normal, view, shadowContribution);\n        }\n    }\n#endif\n\n    // Calculate lighting contribution from image based lighting source (IBL)\n#ifdef USE_IBL\n    color += getIBLContribution(materialInfo, normal, view);\n#endif\n\n    float ao = 1.0;\n    // Apply optional PBR terms for additional (optional) shading\n#ifdef HAS_OCCLUSION_MAP\n    ao = _texture(u_OcclusionSampler,  getOcclusionUV()).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n    vec3 emissive = vec3(0);\n#ifdef HAS_EMISSIVE_MAP\n    emissive = SRGBtoLINEAR(_texture(u_EmissiveSampler, getEmissiveUV())).rgb * u_EmissiveFactor;\n    color += emissive;\n#endif\n\n#ifndef DEBUG_OUTPUT // no debug\n\n    vec3 toneMappedColor = toneMap(color);\n\n    #ifdef USE_FOG\n        float fogDepth = -v_ModelViewPosition.z;\n        float fogFactor = smoothstep(u_FogNear, u_FogFar, fogDepth);\n        toneMappedColor = mix(toneMappedColor, u_FogColor, fogFactor);\n    #endif\n\n    // regular shading\n    FRAG_COLOR = vec4(toneMappedColor * baseColor.a, baseColor.a);\n\n#else // debug output\n\n    #ifdef DEBUG_METALLIC\n        FRAG_COLOR.rgb = vec3(metallic);\n    #endif\n\n    #ifdef DEBUG_ROUGHNESS\n        FRAG_COLOR.rgb = vec3(perceptualRoughness);\n    #endif\n\n    #ifdef DEBUG_NORMAL\n        #ifdef HAS_NORMAL_MAP\n            FRAG_COLOR.rgb = _texture(u_NormalSampler, getNormalUV()).rgb;\n        #else\n            FRAG_COLOR.rgb = vec3(0.5, 0.5, 1.0);\n        #endif\n    #endif\n\n    #ifdef DEBUG_BASECOLOR\n        FRAG_COLOR.rgb = LINEARtoSRGB(baseColor.rgb);\n    #endif\n\n    #ifdef DEBUG_OCCLUSION\n        FRAG_COLOR.rgb = vec3(ao);\n    #endif\n\n    #ifdef DEBUG_EMISSIVE\n        FRAG_COLOR.rgb = LINEARtoSRGB(emissive);\n    #endif\n\n    #ifdef DEBUG_F0\n        FRAG_COLOR.rgb = vec3(f0);\n    #endif\n\n    #ifdef DEBUG_ALPHA\n        FRAG_COLOR.rgb = vec3(baseColor.a);\n    #endif\n\n    FRAG_COLOR.a = 1.0;\n\n#endif // !DEBUG_OUTPUT\n}\n",$o="#version VERSION\n\n#define FEATURES\n\nvec4 _texture(sampler2D sampler, vec2 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return texture2D(sampler, coord);\n#endif\n}\n\nvec4 _texture(samplerCube sampler, vec3 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return textureCube(sampler, coord);\n#endif\n}\n#ifdef HAS_TARGET_POSITION0\nVERT_IN vec3 a_Target_Position0;\n#endif\n\n#ifdef HAS_TARGET_POSITION1\nVERT_IN vec3 a_Target_Position1;\n#endif\n\n#ifdef HAS_TARGET_POSITION2\nVERT_IN vec3 a_Target_Position2;\n#endif\n\n#ifdef HAS_TARGET_POSITION3\nVERT_IN vec3 a_Target_Position3;\n#endif\n\n#ifdef HAS_TARGET_POSITION4\nVERT_IN vec3 a_Target_Position4;\n#endif\n\n#ifdef HAS_TARGET_POSITION5\nVERT_IN vec3 a_Target_Position5;\n#endif\n\n#ifdef HAS_TARGET_POSITION6\nVERT_IN vec3 a_Target_Position6;\n#endif\n\n#ifdef HAS_TARGET_POSITION7\nVERT_IN vec3 a_Target_Position7;\n#endif\n\n#ifdef HAS_TARGET_NORMAL0\nVERT_IN vec3 a_Target_Normal0;\n#endif\n\n#ifdef HAS_TARGET_NORMAL1\nVERT_IN vec3 a_Target_Normal1;\n#endif\n\n#ifdef HAS_TARGET_NORMAL2\nVERT_IN vec3 a_Target_Normal2;\n#endif\n\n#ifdef HAS_TARGET_NORMAL3\nVERT_IN vec3 a_Target_Normal3;\n#endif\n\n#ifdef HAS_TARGET_TANGENT0\nVERT_IN vec3 a_Target_Tangent0;\n#endif\n\n#ifdef HAS_TARGET_TANGENT1\nVERT_IN vec3 a_Target_Tangent1;\n#endif\n\n#ifdef HAS_TARGET_TANGENT2\nVERT_IN vec3 a_Target_Tangent2;\n#endif\n\n#ifdef HAS_TARGET_TANGENT3\nVERT_IN vec3 a_Target_Tangent3;\n#endif\n\n#ifdef USE_MORPHING\nuniform float u_morphWeights[WEIGHT_COUNT];\n#endif\n\n#ifdef HAS_JOINT_SET1\nVERT_IN vec4 a_Joint1;\n#endif\n\n#ifdef HAS_JOINT_SET2\nVERT_IN vec4 a_Joint2;\n#endif\n\n#ifdef HAS_WEIGHT_SET1\nVERT_IN vec4 a_Weight1;\n#endif\n\n#ifdef HAS_WEIGHT_SET2\nVERT_IN vec4 a_Weight2;\n#endif\n\n#ifdef USE_SKINNING\n#ifdef USE_SKINNING_TEXTURE\nuniform sampler2D u_jointMatrixSampler;\nuniform sampler2D u_jointNormalMatrixSampler;\n#else\nuniform mat4 u_jointMatrix[JOINT_COUNT];\nuniform mat4 u_jointNormalMatrix[JOINT_COUNT];\n#endif\n#endif\n\n// these offsets assume the texture is 4 pixels across\n#define ROW0_U ((0.5 + 0.0) / 4.0)\n#define ROW1_U ((0.5 + 1.0) / 4.0)\n#define ROW2_U ((0.5 + 2.0) / 4.0)\n#define ROW3_U ((0.5 + 3.0) / 4.0)\n\n#ifdef USE_SKINNING\nmat4 getJointMatrix(float boneNdx) {\n    #ifdef USE_SKINNING_TEXTURE\n    float v = (boneNdx + 0.5) / float(JOINT_COUNT);\n    return mat4(\n        _texture(u_jointMatrixSampler, vec2(ROW0_U, v)),\n        _texture(u_jointMatrixSampler, vec2(ROW1_U, v)),\n        _texture(u_jointMatrixSampler, vec2(ROW2_U, v)),\n        _texture(u_jointMatrixSampler, vec2(ROW3_U, v))\n    );\n    #else\n    return u_jointMatrix[int(boneNdx)];\n    #endif\n}\n\nmat4 getJointNormalMatrix(float boneNdx) {\n    #ifdef USE_SKINNING_TEXTURE\n    float v = (boneNdx + 0.5) / float(JOINT_COUNT);\n    return mat4(\n        _texture(u_jointNormalMatrixSampler, vec2(ROW0_U, v)),\n        _texture(u_jointNormalMatrixSampler, vec2(ROW1_U, v)),\n        _texture(u_jointNormalMatrixSampler, vec2(ROW2_U, v)),\n        _texture(u_jointNormalMatrixSampler, vec2(ROW3_U, v))\n    );\n    #else\n    return u_jointNormalMatrix[int(boneNdx)];\n    #endif\n}\n\nmat4 getSkinningMatrix()\n{\n    mat4 skin = mat4(0);\n\n    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)\n    skin +=\n        a_Weight1.x * getJointMatrix(a_Joint1.x) +\n        a_Weight1.y * getJointMatrix(a_Joint1.y) +\n        a_Weight1.z * getJointMatrix(a_Joint1.z) +\n        a_Weight1.w * getJointMatrix(a_Joint1.w);\n    #endif\n\n    return skin;\n}\n\nmat4 getSkinningNormalMatrix()\n{\n    mat4 skin = mat4(0);\n\n    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)\n    skin +=\n        a_Weight1.x * getJointNormalMatrix(a_Joint1.x) +\n        a_Weight1.y * getJointNormalMatrix(a_Joint1.y) +\n        a_Weight1.z * getJointNormalMatrix(a_Joint1.z) +\n        a_Weight1.w * getJointNormalMatrix(a_Joint1.w);\n    #endif\n\n    return skin;\n}\n#endif // !USE_SKINNING\n\n#ifdef USE_MORPHING\nvec4 getTargetPosition()\n{\n    vec4 pos = vec4(0);\n\n#ifdef HAS_TARGET_POSITION0\n    pos.xyz += u_morphWeights[0] * a_Target_Position0;\n#endif\n\n#ifdef HAS_TARGET_POSITION1\n    pos.xyz += u_morphWeights[1] * a_Target_Position1;\n#endif\n\n#ifdef HAS_TARGET_POSITION2\n    pos.xyz += u_morphWeights[2] * a_Target_Position2;\n#endif\n\n#ifdef HAS_TARGET_POSITION3\n    pos.xyz += u_morphWeights[3] * a_Target_Position3;\n#endif\n\n#ifdef HAS_TARGET_POSITION4\n    pos.xyz += u_morphWeights[4] * a_Target_Position4;\n#endif\n\n    return pos;\n}\n\nvec4 getTargetNormal()\n{\n    vec4 normal = vec4(0);\n\n#ifdef HAS_TARGET_NORMAL0\n    normal.xyz += u_morphWeights[0] * a_Target_Normal0;\n#endif\n\n#ifdef HAS_TARGET_NORMAL1\n    normal.xyz += u_morphWeights[1] * a_Target_Normal1;\n#endif\n\n#ifdef HAS_TARGET_NORMAL2\n    normal.xyz += u_morphWeights[2] * a_Target_Normal2;\n#endif\n\n#ifdef HAS_TARGET_NORMAL3\n    normal.xyz += u_morphWeights[3] * a_Target_Normal3;\n#endif\n\n#ifdef HAS_TARGET_NORMAL4\n    normal.xyz += u_morphWeights[4] * a_Target_Normal4;\n#endif\n\n    return normal;\n}\n\nvec4 getTargetTangent()\n{\n    vec4 tangent = vec4(0);\n\n#ifdef HAS_TARGET_TANGENT0\n    tangent.xyz += u_morphWeights[0] * a_Target_Tangent0;\n#endif\n\n#ifdef HAS_TARGET_TANGENT1\n    tangent.xyz += u_morphWeights[1] * a_Target_Tangent1;\n#endif\n\n#ifdef HAS_TARGET_TANGENT2\n    tangent.xyz += u_morphWeights[2] * a_Target_Tangent2;\n#endif\n\n#ifdef HAS_TARGET_TANGENT3\n    tangent.xyz += u_morphWeights[3] * a_Target_Tangent3;\n#endif\n\n#ifdef HAS_TARGET_TANGENT4\n    tangent.xyz += u_morphWeights[4] * a_Target_Tangent4;\n#endif\n\n    return tangent;\n}\n\n#endif // !USE_MORPHING\n\n\nVERT_IN vec4 a_Position;\nVERT_OUT vec3 v_Position;\n\nVERT_OUT vec3 v_ModelViewPosition;\n\n#ifdef USE_INSTANCING\nVERT_IN vec4 a_ModelMatrix0;\nVERT_IN vec4 a_ModelMatrix1;\nVERT_IN vec4 a_ModelMatrix2;\nVERT_IN vec4 a_ModelMatrix3;\n#endif\n\n#ifdef USE_INSTANCING\nVERT_IN vec4 a_BaseColorFactor;\nVERT_OUT vec4 v_BaseColorFactor;\n#endif\n\n#ifdef USE_INSTANCING\nVERT_IN vec4 a_NormalMatrix0;\nVERT_IN vec4 a_NormalMatrix1;\nVERT_IN vec4 a_NormalMatrix2;\nVERT_IN vec4 a_NormalMatrix3;\n#endif\n\n#ifdef HAS_NORMALS\nVERT_IN vec4 a_Normal;\n#endif\n\n#ifdef HAS_TANGENTS\nVERT_IN vec4 a_Tangent;\n#endif\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nVERT_OUT mat3 v_TBN;\n#else\nVERT_OUT vec3 v_Normal;\n#endif\n#endif\n\n#ifdef HAS_UV_SET1\nVERT_IN vec2 a_UV1;\n#endif\n\n#ifdef HAS_UV_SET2\nVERT_IN vec2 a_UV2;\n#endif\n\nVERT_OUT vec2 v_UVCoord1;\nVERT_OUT vec2 v_UVCoord2;\n\n#ifdef HAS_VERTEX_COLOR_VEC3\nVERT_IN vec3 a_Color;\nVERT_OUT vec3 v_Color;\n#endif\n\n#ifdef HAS_VERTEX_COLOR_VEC4\nVERT_IN vec4 a_Color;\nVERT_OUT vec4 v_Color;\n#endif\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_NormalMatrix;\n\n#ifdef USE_SHADOW_MAPPING\nuniform mat4 u_LightViewProjectionMatrix;\nVERT_OUT vec4 v_PositionLightSpace;\n#endif\n\nvec4 getPosition()\n{\n    vec4 pos = a_Position;\n\n#ifdef USE_MORPHING\n    pos += getTargetPosition();\n#endif\n\n#ifdef USE_SKINNING\n    pos = getSkinningMatrix() * pos;\n#endif\n\n    return pos;\n}\n\n#ifdef HAS_NORMALS\nvec4 getNormal()\n{\n    vec4 normal = a_Normal;\n\n#ifdef USE_MORPHING\n    normal += getTargetNormal();\n#endif\n\n#ifdef USE_SKINNING\n    normal = getSkinningNormalMatrix() * normal;\n#endif\n\n    return normalize(normal);\n}\n#endif\n\n#ifdef HAS_TANGENTS\nvec4 getTangent()\n{\n    vec4 tangent = a_Tangent;\n\n#ifdef USE_MORPHING\n    tangent += getTargetTangent();\n#endif\n\n#ifdef USE_SKINNING\n    tangent = getSkinningMatrix() * tangent;\n#endif\n\n    return normalize(tangent);\n}\n#endif\n\nvoid main()\n{\n    mat4 modelMatrix = u_ModelMatrix;\n    #ifdef USE_INSTANCING\n        modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\n    #endif\n    vec4 pos = modelMatrix * getPosition();\n    v_Position = vec3(pos.xyz) / pos.w;\n\n    vec4 modelViewPosition = u_ViewMatrix * pos;\n    v_ModelViewPosition = vec3(modelViewPosition.xyz) / modelViewPosition.w;\n\n    mat4 normalMatrix = u_NormalMatrix;\n    #ifdef USE_INSTANCING\n        normalMatrix = mat4(a_NormalMatrix0, a_NormalMatrix1, a_NormalMatrix2, a_NormalMatrix3);\n    #endif\n\n    #ifdef HAS_NORMALS\n    #ifdef HAS_TANGENTS\n    vec4 tangent = getTangent();\n    vec3 normalW = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));\n    vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangent.xyz, 0.0)));\n    vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n    v_TBN = mat3(tangentW, bitangentW, normalW);\n    #else // !HAS_TANGENTS\n    v_Normal = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));\n    #endif\n    #endif // !HAS_NORMALS\n\n    v_UVCoord1 = vec2(0.0, 0.0);\n    v_UVCoord2 = vec2(0.0, 0.0);\n\n    #ifdef HAS_UV_SET1\n    v_UVCoord1 = a_UV1;\n    #endif\n\n    #ifdef HAS_UV_SET2\n    v_UVCoord2 = a_UV2;\n    #endif\n\n    #if defined(HAS_VERTEX_COLOR_VEC3) || defined(HAS_VERTEX_COLOR_VEC4)\n    v_Color = a_Color;\n    #endif\n\n    #ifdef USE_SHADOW_MAPPING\n    v_PositionLightSpace = u_LightViewProjectionMatrix * pos;\n    #endif\n\n    #ifdef USE_INSTANCING\n    v_BaseColorFactor = a_BaseColorFactor;\n    #endif\n\n    gl_Position = u_ViewProjectionMatrix * pos;\n}\n";class qo extends Xo{constructor(){super(...arguments),this._instancing=new Yo}static build(t,e){let r=Ir.from(Ho.build($o,e,t),Ho.build(Ko,e,t));return new qo(r)}get name(){return"standard-shader"}createShaderGeometry(t,e){let r=super.createShaderGeometry(t,e);if(e&&this._instancing.addGeometryAttributes(r),t.targets)for(let n=0;n<t.targets.length;n++){let e=t.targets[n].positions;e&&r.addAttribute(`a_Target_Position${n}`,new Le(e.buffer),3,!1,e.componentType,e.stride);let i=t.targets[n].normals;i&&r.addAttribute(`a_Target_Normal${n}`,new Le(i.buffer),3,!1,i.componentType,i.stride);let s=t.targets[n].tangents;s&&r.addAttribute(`a_Target_Tangent${n}`,new Le(s.buffer),3,!1,s.componentType,s.stride)}return t.uvs&&t.uvs[1]&&r.addAttribute("a_UV2",new Le(t.uvs[1].buffer),2,!1,t.uvs[1].componentType,t.uvs[1].stride),t.joints&&r.addAttribute("a_Joint1",new Le(t.joints.buffer),4,!1,t.joints.componentType,t.joints.stride),t.weights&&r.addAttribute("a_Weight1",new Le(t.weights.buffer),4,!1,t.weights.componentType,t.weights.stride),r}render(t,e,r,n){if(t.instances.length>0){const e=t.instances.filter((t=>t.worldVisible&&t.renderable));if(0===e.length)return;this._instancing.updateBuffers(e)}super.render(t,e,r,n)}}var Qo=(t=>(t.opaque="opaque",t.transparent="transparent",t))(Qo||{});class Jo{constructor(){this._renderSortType=Qo.opaque,this.state=Object.assign(new we,{culling:!0,clockwiseFrontFace:!1,depthTest:!0}),this.drawMode=h.TRIANGLES,this.renderSortType=Qo.opaque}get depthMask(){return this.state.depthMask}set depthMask(t){this.state.depthMask=t}get doubleSided(){return!this.state.culling}set doubleSided(t){this.state.culling=!t}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}createShader(t,e){}updateUniforms(t,e){}destroy(){}get isInstancingSupported(){return!1}createInstance(){}render(t,e){(this._shader||(this._shader=this.createShader(t,e),this._shader))&&(this.updateUniforms&&this.updateUniforms(t,this._shader),this._shader.render(t,e,this.state,this.drawMode))}static from(t,e,r){return Object.assign(new Jo,{updateUniforms:r||(()=>{}),_shader:new Xo(Ir.from(t,e))})}}class Zo{constructor(t,e){this.renderer=t,this.lights=[],this.renderer.on("prerender",(()=>{for(let t of this.lights)t.parent||t.transform.updateTransform()})),Zo.main||(Zo.main=this),this.imageBasedLighting=e}destroy(){}get valid(){return!this.imageBasedLighting||this.imageBasedLighting.valid}}Ms.installRendererPlugin("lighting",Zo);class ta{enableJointMatrixTextures(t){this._jointMatrixTexture||(this._jointMatrixTexture=new Uo(t)),this._jointNormalTexture||(this._jointNormalTexture=new Uo(t))}destroy(){var t,e;null==(t=this._jointNormalTexture)||t.destroy(!0),null==(e=this._jointMatrixTexture)||e.destroy(!0)}update(t,e){t.skin&&(this._jointMatrixTexture?(this._jointMatrixTexture.updateBuffer(t.skin.jointMatrices),e.uniforms.u_jointMatrixSampler=this._jointMatrixTexture):e.uniforms.u_jointMatrix=t.skin.jointMatrices,this._jointNormalTexture?(this._jointNormalTexture.updateBuffer(t.skin.jointNormalMatrices),e.uniforms.u_jointNormalMatrixSampler=this._jointNormalTexture):e.uniforms.u_jointNormalMatrix=t.skin.jointNormalMatrices)}}class ea{constructor(t=0,e=0,r=0,n=1){this._array4=new Float32Array([t,e,r,n]),this._array3=this._array4.subarray(0,3)}static fromBytes(t=0,e=0,r=0,n=255){return new ea(t/255,e/255,r/255,n/255)}static fromHex(t){return"string"==typeof t&&(t=parseInt(t.replace(/[^0-9A-F]/gi,""),16)),ea.fromBytes(t>>16&255,t>>8&255,255&t)}get rgb(){return this._array3}get rgba(){return this._array4}get r(){return this._array4[0]}set r(t){this._array4[0]=t}get g(){return this._array4[1]}set g(t){this._array4[1]=t}get b(){return this._array4[2]}set b(t){this._array4[2]=t}get a(){return this._array4[3]}set a(t){this._array4[3]=t}static from(t){return new ea(...t)}}class ra{constructor(t){this.baseColor=new ea(...t.baseColor.rgba)}}class na{constructor(){this.alphaCutoff=.5,this.alphaMode="OPAQUE",this.doubleSided=!1,this.roughness=1,this.metallic=1,this.emissiveFactor=[0,0,0],this.baseColor=[1,1,1,1],this.unlit=!1}}class ia{static multiply(t,e,r=new Float32Array(9)){return function(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=r[0],f=r[1],p=r[2],m=r[3],g=r[4],_=r[5],y=r[6],v=r[7],x=r[8];return t[0]=d*n+f*o+p*h,t[1]=d*i+f*a+p*u,t[2]=d*s+f*l+p*c,t[3]=m*n+g*o+_*h,t[4]=m*i+g*a+_*u,t[5]=m*s+g*l+_*c,t[6]=y*n+v*o+x*h,t[7]=y*i+v*a+x*u,t[8]=y*s+v*l+x*c,t}(r,t,e)}}class sa{constructor(){this._rotation=0,this._array=new Float32Array(9),this._dirty=!0,this._translation=new Float32Array([1,0,0,0,1,0,0,0,1]),this._scaling=new Float32Array([1,0,0,0,1,0,0,0,1]),this._rotate=new Float32Array([Math.cos(0),-Math.sin(0),0,Math.sin(0),Math.cos(0),0,0,0,1]),this.offset=new ur((()=>{this._translation.set([1,0,0,0,1,0,this.offset.x,this.offset.y,1]),this._dirty=!0}),void 0),this.scale=new ur((()=>{this._scaling.set([this.scale.x,0,0,0,this.scale.y,0,0,0,1]),this._dirty=!0}),void 0,1,1)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotate.set([Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]),this._dirty=!0}get array(){return this._dirty&&(ia.multiply(ia.multiply(this._translation,this._rotate,this._array),this._scaling,this._array),this._dirty=!1),this._array}static fromTexture(t){const e=new sa;if(!t.frame||t.noFrame)return e;let{x:r,y:n,width:i,height:s}=t.frame;return 0===t.rotate&&(e.offset.set(r/t.baseTexture.width,n/t.baseTexture.height),e.scale.set(i/t.baseTexture.width,s/t.baseTexture.height)),2===t.rotate&&(r=t.frame.x+t.frame.width,e.offset.set(r/t.baseTexture.width,n/t.baseTexture.height),e.scale.set(s/t.baseTexture.height,i/t.baseTexture.width),e.rotation=-90*Xe),e}}class oa extends Jr{constructor(t,e){super(t),this.uvSet=e}}class aa extends oa{constructor(t,e,r){super(t,r),this.scale=e,this.uvSet=r}}class la extends oa{constructor(t,e,r){super(t,r),this.strength=e,this.uvSet=r}}class ha{create(t){let e=new fa;if(!(t instanceof na))return e;switch(e.baseColor=ea.from(t.baseColor),t.baseColorTexture&&(e.baseColorTexture=new oa(t.baseColorTexture.baseTexture,t.baseColorTexture.texCoord),e.baseColorTexture.transform=this.createTextureTransform(t.baseColorTexture)),e.metallic=t.metallic,e.roughness=t.roughness,t.metallicRoughnessTexture&&(e.metallicRoughnessTexture=new oa(t.metallicRoughnessTexture.baseTexture,t.metallicRoughnessTexture.texCoord),e.metallicRoughnessTexture.transform=this.createTextureTransform(t.metallicRoughnessTexture)),e.emissive=ea.from(t.emissiveFactor),t.emissiveTexture&&(e.emissiveTexture=new oa(t.emissiveTexture.baseTexture,t.emissiveTexture.texCoord),e.emissiveTexture.transform=this.createTextureTransform(t.emissiveTexture)),t.alphaMode){case"BLEND":e.alphaMode=Lo.blend,e.renderSortType=Qo.transparent;break;case"MASK":e.alphaMode=Lo.mask;break;case"OPAQUE":e.alphaMode=Lo.blend}return e.unlit=t.unlit,e.doubleSided=t.doubleSided,e.alphaCutoff=t.alphaCutoff,t.normalTexture&&(e.normalTexture=new aa(t.normalTexture.baseTexture,t.normalTexture.scale,t.normalTexture.texCoord),e.normalTexture.transform=this.createTextureTransform(t.normalTexture)),t.occlusionTexture&&(e.occlusionTexture=new la(t.occlusionTexture.baseTexture,t.occlusionTexture.strength,t.occlusionTexture.texCoord),e.occlusionTexture.transform=this.createTextureTransform(t.occlusionTexture)),e}createTextureTransform(t){if(t.transform){const e=new sa;return t.transform.offset&&(e.offset.x=t.transform.offset[0],e.offset.y=t.transform.offset[1]),void 0!==t.transform.rotation&&(e.rotation=t.transform.rotation),t.transform.scale&&(e.scale.x=t.transform.scale[0],e.scale.y=t.transform.scale[1]),e}}}class ua{get diffuse(){return this._diffuse}get specular(){return this._specular}constructor(t,e){this._diffuse=t,this._specular=e}get valid(){return this._diffuse.valid&&this._specular.valid&&(!this.lookupBrdf||this.lookupBrdf.valid)}}ua.defaultLookupBrdf=Jr.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAADAFBMVEX/AACvAwC4BgC1BQD7AAD3AQDzAQD+AAD9AAD8AQDpAQC/CACxAwD5BgDACwCtAwDxAQC9CADDEQCrAwC7BwC4AQDfAQB+AADvAQD1AQD7AwB7AABrAADHAQDCDgDiAQCyBQCRAQD5AAC1AQDYAQDNAQCpAQCUAQCeAQB0AABhAAD3BwCnAQDCBwCMAACOAAD6BABvAADFAgDsAQD4AACIAADEDADKAQDnAQCfAQCoAwDuEADqFACAAACFAACKAADzCwCCAAC/AQCbAgDKDQDwDgC9AQDBAgCiAAC7AQCkAADlAQD0CACzAQDjGwBoAADEFgB4AAD2CADGEQDGDADQAQDbAQDGCADSAQDNCwDWAQDdAQDUAQBlAAB2AADJCADBGgCVAgDOEADtAQBxAADSDADBFgCZAADnGADXDADcIgDKEgDDAQBcAADQLQCkAwDSEADPCADfHgClAgDXBwDTCADkDACYAAC9IACxLgCiAwCZAgDIFgDINgDdDADxCgDuCACSAQDnEADqCgCPAQBYAAC+HADYJgDLMACWAADOFgDbEQCtMwDSGwCGAADLBgC4JwDbGADaDADBIACoVQDRIQCgAgCxTQDHGwDVKQC6IwDCPACRbADGIQDMGwBUAADgEQDgBwDXEgDkFQDkBgCHdgDnCQDSFQC1KgDWFwDgFwDgDACaRwDCJwCcAADLKAC4LwC2RwDELwCYZADLIACkPQDcBgC9KACFXgDrEAB/ZQCoOgDGKAC+LgDYHACpTwC6QwCWTQB5bQCiWwCcAgCfQgBxdACMVgCzNAB9fwCeYADXIQC4NwC+NgCxOgCHbQCRUQDDNwCrOQDRJwCnRQCYWQCuQQBnfQC+QACNZABziwBskAAY4QCXAgB4hQBghgBllwC1QACtSACfTgBfngCPXABYpQChSAC7PAB/dwCeVABTkQBKnABRrABBuwA4wwBcjgBKtAByfAAxywBApQA3sAAo1QBshgAK8QAY0QBXmgAkxgBPpAAqugBFrgA1uwB98tmWAAAOvklEQVR4nO3Ye1jW5RnA8d+Wtmmews2yJTlXrVWUmUNLt5xSVrpygqJZQShMwqWYOHSWhvMwkSESRRaej5hT8ZiJpCvDI5annGYecmpaOWdhHnff93O6n+f3exFc17yubTfG1V9+P8/9/F54X73Tp/fs+fqfX37xj8///um+3X/bu27GjDfeWLT+ry+//OqrC9/56PXXX3hh9HPPvTZq1LPP9u//2GO9e7du3bpVq1YPPtimTZuOHTvfAVO7dtOmN9xwQ40aNb6P8z01XqXm/4DTp09//b+9gT2n91zZDezZc6U3sOcKb+CbKw745hvo/7cALkcAgLNwA198fsUAZ8+epUfg8081YNF/EnD2/NmzX14UN3AZG+j8LQDOn7948YsLdAO7964jwHof4DUOeKuSgEoJCPDVhQvn5CPgXsEHLqD3twy4eP4rGAM4OqNMAEqqBGgaCKiM4KLsnzvz7wIucwUIOHXqFAD2nagS4EEGCHkHlSBcwPypc8fPnDmxu7xcAtZXFtAxEFClS7iA/ePHj585se+T8r0nsY+vQgQsrAqA/zC2VnApwgXKHz9z7MSJ8vKT66oM6GwDggQVE85h/tgx6H+iALvoVVgJQBsNqOAOLiUAwLHj1P+k/OTJo0fLynYtWrQdAQeCAI+FBFyu4MyZYzjQ37lTAbYDoAQ28M47RwAw2g94CwFD1UMQBHAFoQ0EOCH7a9dAf9eu7ds/gwUcsAGjLEArDehMAHEHFQpCIPadwDr2d0IfF4B9Adh/5MgmDdggANM4IPAOKhIEMPbp/tq1a9esWbFr1yEEHATA/v1HPpKArQLQXwBaM4C6g6oILM1umRf9MgUoEYAjHPCsAfCHwFqBJagMwSsvL9+p+2tWLN91CAEHAbBDAIoAsHXraxsUYFqGfQfOCmzBpQme6K8V+1+xAvqH8AYObyPAJgLMl4DC/oUIyNCAoXwFwYJLGby9J+HhXyvPv2L58kOHtsACDpZs2wGAjQgoQsDWDRtWwQYKC6dN660BQ4cGrUAIOKEihLdO9CmP/fcPbVl9EBagAEVFRfMBkEeAQgRMQwAKhqKAraBJU74DhxBK4a07KvKiv/z997cA4DABNm+0AatyJECuYJgEKEETJahWrUYIQ8DviaNH1xwVedO3ASsJkAeA/oV0BxkZGbiCYQgY2rGjuITqtWs3byIJ1aoZQqCBabwZKi/6CFgt+wgoFhvII0COWIEGGAEAqtdurgRNqlmEChFeWVkZy8u+BhQX0wbmWwApGNbKABre0bB69eYkAEITIbAMoRQIKMO6Of+bb7733ra3P9y8uXTjgmIQrFzpBwzPGP7WMLaChjDVDQG/BRkCJN4b8MtH1k1/yRIDmAeAxQDIQgAIJtMGADA8tEBMtWqhERri7cI5dEjkZf+9JW8DoLR0AQDm+QCTBQBGCOoRoaEhMINBhHJ4i/Bnn8xTXy6AAxYbQM5kAAy0BTBXw4Qg2Agfw4O3PyDYIvK6//aHY0s5YPHEvKw5c1YJwOSBAwcKAAmuB0A9LQgkuAhG8dZvhxF1kRcLGDsW+wuWLQNAAQDysrJAAIBMIcjImKkFQ68fWq/j1RaBDC4iEEKA1dtlXpyfFjB2EADGIaAAARMJMDUnM1OtYOZMtoJ6MA4hpMF2eJ/hrD64+k19fNEfO2jQbAUAwcSJCJgzNVMLZhoBGhwCM4RU0CDgIIy/X0p9CZgoATlCMHeuLbgepp5LEAaFCKXwXj5Ygj/7Dx+WeeiPpfMPmj2bALkCkJU1a9asOVMVgAvu9RG0QSK0ws/wSkpKDsu+yBNA9MdNWJaeC4D8fNjAmFlZCEDBi3O1gAj39uw5rKcmuAaFMAoOAcDhkm0wS7aZvOqPW5aePk8DxsAKJEAKpmsBEHoSga+BIwzDcjRv7h04cIDnqY8PIC1gQjpuIB8BYyyAEExHQc2ZNYfXvNclaIOFYAwlQcCBHdu2URx+/snzE2CCAOQCYIjcQD8QjM8cLwXTpxNhZs2aKDAEaTAIR8Eh3sIDO2g+xBlr+uNEHwDxCBgyhlbQDwTJ48cLwZQpStByuCHYBoYIYMB4C/djfbPKD1LHFxcAgHgBSEFAPwAkJyvBlCmS0KFlSyS4Bo2wFI7D2w+zGWdsqdtHwMj43PhO0EdAQgIA+iVrwZQpFqGmJAiDD+EyJEQD4HdPqcrLPgBGjoyPj+/UCQEpCQkkSHQE02k6KEKAwVK4DO/Ikf0bN5ZSvlTl9QNAfQB0QoAUJCrB0qVLzQ46dCACM0iEUVgMDQHARhwSLJhtHV8vQAJIkJjIBZJwUwiDQjCF65CABTSiLvoT0kdCHwBJkDeAxEQlGCAE0nCTFDCDi7AZyuFtwllAgtnjFjh57Cc5G0BDWlryABwh6IEAmg7GIBFKwRi2w/sA+8ViAzovnj8EJBEgOjoaAVHqDkCQNmDAeC3o0aBBkEEhtIIzeirAB5uKN8Gb3+JlOLpu+hKAhKjuOImpBEgbwJeAhgYNLINEaIVhcAcAioqpD4IJSEhPF4+f6gMgDPPRKVFRJEhNlQJJ6Np1aVcUEEEaNEIpDIM5UOLBR6+i4iK5gGWyrvpiA2FhtIGoaFcgAANuvrkrInr0sPbAEEEM5fBeQME8GpkXdXX+pKQwBaDpLgmpaS4Bpoe7CEuhGRzijSZA0Tx46wNf6bmqD6cfqfpCEBMVowipqZrw5JNCoAwMYRQWgzlaImD0ShzcQK6Yker1Z/oIiIkhQTYTkOFJmCeeGPDEzS7Cp3AcAuKNnj9aAApyhSCeJkn35QoiY3DioqLi4rKzu2cLQrfULt26pXUTBhhmsBUWw3J48Nl7PgDgnWeBvy/rYeFhkTAkoMmmIUOXLmDoRgaDcBWKYTsI4j1HggI58fG5/PyqHx4eKQWxcUEEMrgIo1AM7WAQbyv0F8+nem5BfH7g+RUgMiYWhgGyb7lFAAIQUsEY2mEgDQAAAvjotbgA3/zmF+R3gt9++vxJ4bB904+MlWMbYCyEUIRkMAhIALB1MU1BPgri8/F3j9p+nSTR9wli+UU4CEshGcphQ1Di4T+ACUE+Tic58vEPNxPpGgSiRYsW2dktblHTJZihHBqiJd7WPCGYKABKIG6/TlIditP3iIjICJjY2AgJaNSoURz810JNgEIytENDtMTLy8P+RBx895vP+2EyXocmIjxCT7NmzWLhT2xss0Y0LfwKy6Egfok3Ko+GBPDecwjrh1t9EKiJlQY9jVwGdwRCtMTbkLdB5qkP7770+cOsvEWQ06dPAIM7QkI0xduwAf/1JcsIojtFq3yS069zjRxot2/fnr6179PHZgQ6LIhFAQDk87LGjNEAGHMBTllPe3f6WJBG1rSowOKtWoWCiVn42S8lRfSjzQOg+9daQ4i2OMESzWlUEaWFAKzCKxCAISkKEM4X4NTlPKSmbVsfpY89AVtRGASskn3YgALwPo/+gM0j1z7ykG/asgm09HHuCAFz5mTNmiUBKSkuILgO/aCpqqZPMy8HAXMMgG2g6v2KOG2DOV5OjgCAIIEAQAiL9PV1+Lt8fhhiqgACQI4AzEpIUBuAXzl2P6BdUb/SJHB4hQYgriAK+5G8789fJeYnlZlLoDiANhAVHRPQ97Vxfl3ZqciFgBwCwOfOlAT4+BWjAeb4/vhVVzWmv7tx48Y8VUtO5WUEmDp1zqx++MlX98PVj5+gfGM1svadKkwtNmTwCguhP3Vqv34JQIhiC3D6dtzXrRtybEBd+aUHATkCADcAnz8V4Bp1Ab48a/NQ/VBzq/1Vt775ql+/LgIy3Q3wBZi8rNttq1T1qX8rADIlICGKAGwBvM/PbrXZX3e/nDsrnkfpjxxvWmFmjtpAlAbQr1+nz+tW3G0+b+bRS443bbLeALsBp6/zfOsmjak7Te/hwLlPfuEfNgTI1IAYC8D7Tp7i+rR9+wZkX1Fznzu34cj/B8BkAUhM6C5fhE6/sezrPB1dxfv27Tt48GAryiowf6lg2rVrpwGJGhBBAKtv57Eu44NpXnnlYRW+ze62k/PbkCMByQDorgF6AVaf8verel9ZV2dmXTf5ezEfq/kTHwFITsYFdKfXAFuA7rt5FtdtWeZRlntGzE/VvKTGBsQhIIIWENCnZ17nRR3K74q2KausSb7E5sdq/kjDAVEAiBU3IBeg+ip/P+bl4eno78KoY4u0DPMqy8m5W85dd92FgBcJQDcA/Yg61gJ438qr+h9UW6RNmVdVTs8DarwMAIxXgFi2AKtv52Ud4jAyTm23zLM6+cDP+ViAOPjszxbg9k2ezi7qIq7OrdIm7Eb/bOaXOA5APIJiAVZfHV/m6fCmzto6bYWtJs6v1HgZAzUgLk7dgLwA3rfydHiqO3GTtsJu9RdmADCXAKnyBtgC3D48eioPh6ezm7qImzYvO9nr+AQC1AU4fXr0VF5unuombtqs7O/+yIwNiIyANwJsAbIv13+buHuZ99V13LSdsMn+Rs3TEpAGAHoEQvX18Vle1dXRVdzfdsNPi/kZjA2I4AC8ANaX2w/KO3HetsumK6dXLw2AF4F4BCrq06On825dxe12ULmXmHtgHIBeAF2A24cXXnDe1EO07fI9em68UQFSu2drAFuA7os89WXeqeujO20rzcJqLIC5AbmA55+nPj++P8/PruPs3Fb6RjaP4xgAPoNqAbVUv29AXyyf8vrwvjo7tz/9uJqnnnrKG64B4gbEAswFqP4zKn+3nXfr+uSBbVamuf12CUjkAL2Avub+nzHHD8izuj65G/elxTgbEDeACxAPQIi+P8/q5ujB7dutEYC0tNTsuKAFsH6IvDy8r27HA9q/EyMBiRyAL4FL9HneHN49Oo8HtGFGjCBAMgPQDcAC6ALg5w/vh8zze684ztJiFKA7/RTAR4BugBaALwDTt4+v887hWd2N+9ojRkyaNIkAA+gZjIiQN0ALUBfg9HX+OjsfWPfHrTYNB4gbkAugC4D+x9QX128f38mHrPvik/gogH4EGtfSC4ALkH08v1y/yYu77+XmA+vBcZx/AeDdATn/vA1ZAAAAAElFTkSuQmCC",{mipmap:g.OFF});const ca={},da=t=>t?t.lights.length+(t.imageBasedLighting?.5:0):0;class fa extends Jo{constructor(){super(...arguments),this._lightingEnvironmentConfigId=0,this._unlit=!1,this._alphaMode=Lo.blend,this._baseColorFactor=new Float32Array(4),this._instancingEnabled=!1,this._skinUniforms=new ta,this.roughness=1,this.metallic=1,this.baseColor=new ea(1,1,1,1),this.alphaCutoff=.5,this.emissive=new ea(0,0,0),this.exposure=1}get baseColorTexture(){return this._baseColorTexture}set baseColorTexture(t){t!==this._baseColorTexture&&(this.invalidateShader(),(null==t?void 0:t.transform)||!(null==t?void 0:t.frame)||(null==t?void 0:t.noFrame)||(t.transform=sa.fromTexture(t)),this._baseColorTexture=t)}get metallicRoughnessTexture(){return this._metallicRoughnessTexture}set metallicRoughnessTexture(t){t!==this._metallicRoughnessTexture&&(this.invalidateShader(),(null==t?void 0:t.transform)||!(null==t?void 0:t.frame)||(null==t?void 0:t.noFrame)||(t.transform=sa.fromTexture(t)),this._metallicRoughnessTexture=t)}get normalTexture(){return this._normalTexture}set normalTexture(t){t!==this._normalTexture&&(this.invalidateShader(),(null==t?void 0:t.transform)||!(null==t?void 0:t.frame)||(null==t?void 0:t.noFrame)||(t.transform=sa.fromTexture(t)),this._normalTexture=t)}get occlusionTexture(){return this._occlusionTexture}set occlusionTexture(t){t!==this._occlusionTexture&&(this.invalidateShader(),(null==t?void 0:t.transform)||!(null==t?void 0:t.frame)||(null==t?void 0:t.noFrame)||(t.transform=sa.fromTexture(t)),this._occlusionTexture=t)}get emissiveTexture(){return this._emissiveTexture}set emissiveTexture(t){t!==this._emissiveTexture&&(this.invalidateShader(),(null==t?void 0:t.transform)||!(null==t?void 0:t.frame)||(null==t?void 0:t.noFrame)||(t.transform=sa.fromTexture(t)),this._emissiveTexture=t)}get alphaMode(){return this._alphaMode}set alphaMode(t){this._alphaMode!==t&&(this._alphaMode=t,this.invalidateShader())}get shadowCastingLight(){return this._shadowCastingLight}set shadowCastingLight(t){t!==this._shadowCastingLight&&(this.invalidateShader(),this._shadowCastingLight=t)}get debugMode(){return this._debugMode}set debugMode(t){this._debugMode!==t&&(this.invalidateShader(),this._debugMode=t)}get lightingEnvironment(){return this._lightingEnvironment}set lightingEnvironment(t){t!==this._lightingEnvironment&&(this.invalidateShader(),this._lightingEnvironmentConfigId=da(t),this._lightingEnvironment=t)}get unlit(){return this._unlit}set unlit(t){this._unlit!==t&&(this._unlit=t,this.invalidateShader())}destroy(){var t,e,r,n,i;null==(t=this._baseColorTexture)||t.destroy(),null==(e=this._normalTexture)||e.destroy(),null==(r=this._emissiveTexture)||r.destroy(),null==(n=this._occlusionTexture)||n.destroy(),null==(i=this._metallicRoughnessTexture)||i.destroy(),this._skinUniforms.destroy()}invalidateShader(){this._shader=void 0}static create(t){return(new ha).create(t)}render(t,e){!this._instancingEnabled&&t.instances.length>0&&(this.invalidateShader(),this._instancingEnabled=!0),this._instancingEnabled&&0===t.instances.length&&(this.invalidateShader(),this._instancingEnabled=!1);let r=this.lightingEnvironment||Zo.main,n=da(r);n!==this._lightingEnvironmentConfigId&&(this.invalidateShader(),this._lightingEnvironmentConfigId=n),super.render(t,e)}get isInstancingSupported(){return!0}createInstance(){return new ra(this)}createShader(t,e){if(1===e.context.webGLVersion){let t=["EXT_shader_texture_lod","OES_standard_derivatives"];for(let r of t)e.gl.getExtension(r)}let r=this.lightingEnvironment||Zo.main,n=jo.build(e,t,t.geometry,this,r);if(!n)return;t.skin&&jo.hasSkinningTextureFeature(n)&&this._skinUniforms.enableJointMatrixTextures(t.skin.joints.length);let i=n.join(",");return ca[i]||(ca[i]=qo.build(e,n)),ca[i]}updateUniforms(t,e){var r,n,i,s,o;for(let u=0;u<3;u++)this._baseColorFactor[u]=this.baseColor.rgba[u];this._baseColorFactor[3]=this.baseColor.a*t.worldAlpha;let a=this.camera||Ro.main;t.skin&&this._skinUniforms.update(t,e),e.uniforms.u_Camera=a.worldTransform.position.array,e.uniforms.u_ViewProjectionMatrix=a.viewProjection.array,e.uniforms.u_ViewMatrix=a.view.array,e.uniforms.u_Exposure=this.exposure,e.uniforms.u_MetallicFactor=this.metallic,e.uniforms.u_RoughnessFactor=this.roughness,e.uniforms.u_BaseColorFactor=this._baseColorFactor,e.uniforms.u_ModelMatrix=t.worldTransform.array,e.uniforms.u_NormalMatrix=t.transform.normalTransform.array,this._alphaMode===Lo.mask&&(e.uniforms.u_AlphaCutoff=this.alphaCutoff),t.targetWeights&&t.targetWeights.length>0&&(e.uniforms.u_morphWeights=t.targetWeights),(null==(r=this.baseColorTexture)?void 0:r.valid)&&(e.uniforms.u_BaseColorSampler=this.baseColorTexture,e.uniforms.u_BaseColorUVSet=this.baseColorTexture.uvSet||0,this.baseColorTexture.transform&&(e.uniforms.u_BaseColorUVTransform=this.baseColorTexture.transform.array));let l=this.lightingEnvironment||Zo.main;for(let u=0;u<l.lights.length;u++){let t=l.lights[u],r=0;switch(t.type){case Fo.point:r=1;break;case Fo.directional:r=0;break;case Fo.spot:r=2}e.uniforms[`u_Lights[${u}].type`]=r,e.uniforms[`u_Lights[${u}].position`]=t.worldTransform.position.array,e.uniforms[`u_Lights[${u}].direction`]=t.worldTransform.forward.array,e.uniforms[`u_Lights[${u}].range`]=t.range,e.uniforms[`u_Lights[${u}].color`]=t.color.rgb,e.uniforms[`u_Lights[${u}].intensity`]=t.intensity,e.uniforms[`u_Lights[${u}].innerConeCos`]=Math.cos(t.innerConeAngle*Xe),e.uniforms[`u_Lights[${u}].outerConeCos`]=Math.cos(t.outerConeAngle*Xe)}l.fog&&(e.uniforms.u_FogNear=l.fog.near,e.uniforms.u_FogFar=l.fog.far,e.uniforms.u_FogColor=l.fog.color.rgb),this._shadowCastingLight&&(e.uniforms.u_ShadowSampler=this._shadowCastingLight.shadowTexture,e.uniforms.u_LightViewProjectionMatrix=this._shadowCastingLight.lightViewProjection,e.uniforms.u_ShadowLightIndex=l.lights.indexOf(this._shadowCastingLight.light));let h=l.imageBasedLighting;(null==h?void 0:h.valid)&&(e.uniforms.u_DiffuseEnvSampler=h.diffuse,e.uniforms.u_SpecularEnvSampler=h.specular,e.uniforms.u_brdfLUT=h.lookupBrdf||ua.defaultLookupBrdf,e.uniforms.u_MipCount=h.specular.levels-1),(null==(n=this.emissiveTexture)?void 0:n.valid)&&(e.uniforms.u_EmissiveSampler=this.emissiveTexture,e.uniforms.u_EmissiveUVSet=this.emissiveTexture.uvSet||0,e.uniforms.u_EmissiveFactor=this.emissive.rgb,this.emissiveTexture.transform&&(e.uniforms.u_EmissiveUVTransform=this.emissiveTexture.transform.array)),(null==(i=this.normalTexture)?void 0:i.valid)&&(e.uniforms.u_NormalSampler=this.normalTexture,e.uniforms.u_NormalScale=this.normalTexture.scale||1,e.uniforms.u_NormalUVSet=this.normalTexture.uvSet||0,this.normalTexture.transform&&(e.uniforms.u_NormalUVTransform=this.normalTexture.transform.array)),(null==(s=this.metallicRoughnessTexture)?void 0:s.valid)&&(e.uniforms.u_MetallicRoughnessSampler=this.metallicRoughnessTexture,e.uniforms.u_MetallicRoughnessUVSet=this.metallicRoughnessTexture.uvSet||0,this.metallicRoughnessTexture.transform&&(e.uniforms.u_MetallicRoughnessUVTransform=this.metallicRoughnessTexture.transform.array)),(null==(o=this.occlusionTexture)?void 0:o.valid)&&(e.uniforms.u_OcclusionSampler=this.occlusionTexture,e.uniforms.u_OcclusionStrength=this.occlusionTexture.strength||1,e.uniforms.u_OcclusionUVSet=this.occlusionTexture.uvSet||0,this.occlusionTexture.transform&&(e.uniforms.u_OcclusionUVTransform=this.occlusionTexture.transform.array))}}class pa{constructor(){this._onChanged=()=>{this._center.set((this._min.x+this._max.x)/2,(this._min.y+this._max.y)/2,(this._min.z+this._max.z)/2),this._extents.set(Math.abs(this._max.x-this._center.x),Math.abs(this._max.y-this._center.y),Math.abs(this._max.z-this._center.z)),this._size.set(2*this._extents.x,2*this._extents.y,2*this._extents.z)},this._min=new xo(0,0,0,this._onChanged,this),this._max=new xo(0,0,0,this._onChanged,this),this._center=new xo(0,0,0,(()=>{}),this),this._size=new xo(0,0,0,(()=>{}),this),this._extents=new xo(0,0,0,(()=>{}),this)}get min(){return this._min}set min(t){this._min.copyFrom(t)}get max(){return this._max}set max(t){this._max.copyFrom(t)}get center(){return this._center}get size(){return this._size}get extents(){return this._extents}static from(t){let e=new pa;return e.min.setFrom(t.min),e.max.setFrom(t.max),e}encapsulate(t){this._min.x=Math.min(this._min.x,t.x),this._min.y=Math.min(this._min.y,t.y),this._min.z=Math.min(this._min.z,t.z),this._max.x=Math.max(this._max.x,t.x),this._max.y=Math.max(this._max.y,t.y),this._max.z=Math.max(this._max.z,t.z)}}class ma{static create(t={}){var e,r,n,i;const s=null!=(e=null==t?void 0:t.radius)?e:1,o=Math.max(3,Math.floor(null!=(r=null==t?void 0:t.segments)?r:32)),a=null!=(n=null==t?void 0:t.thetaStart)?n:0,l=null!=(i=null==t?void 0:t.thetaLength)?i:2*Math.PI,h=[],u=[],c=[],d=[],f=uo.create(),p=uo.create();u.push(0,0,0),c.push(0,0,1),d.push(.5,.5);for(let m=0,g=3;m<=o;m+=1,g+=3){const t=a+m/o*l;f[0]=s*Math.cos(t),f[1]=s*Math.sin(t),u.push(f[0],f[1],f[2]),c.push(0,0,1),p[0]=(u[g]/s+1)/2,p[1]=(u[g+1]/s+1)/2,d.push(p[0],p[1])}for(let m=1;m<=o;m+=1)h.push(m,m+1,0);return Object.assign(new Io,{normals:{buffer:new Float32Array(c)},uvs:[{buffer:new Float32Array(d)}],indices:{buffer:new Uint16Array(h)},positions:{buffer:new Float32Array(u)}})}}class ga{static create(t={}){var e,r,n,i,s,o,a,l;const h=null!=(e=null==t?void 0:t.radiusTop)?e:1,u=null!=(r=null==t?void 0:t.radiusBottom)?r:1,c=null!=(n=null==t?void 0:t.height)?n:1,d=Math.floor(null!=(i=null==t?void 0:t.radialSegments)?i:32),f=Math.floor(null!=(s=null==t?void 0:t.heightSegments)?s:1),p=null!=(o=null==t?void 0:t.openEnded)&&o,m=null!=(a=null==t?void 0:t.thetaStart)?a:0,g=null!=(l=null==t?void 0:t.thetaLength)?l:2*Math.PI,_=[],y=[],v=[],x=[];let b=0;const E=[],T=c/2,A=t=>{const e=b,r=!0===t?h:u,n=!0===t?1:-1;for(let s=1;s<=d;s+=1)y.push(0,T*n,0),x.push(0,n,0),v.push(.5,.5),b+=1;const i=b;for(let s=0;s<=d;s+=1){const t=s/d*g+m,e=Math.cos(t),i=Math.sin(t),o=r*i,a=T*n,l=r*e;y.push(o,a,l),x.push(0,n,0);const h=.5*e+.5,u=.5*i*n+.5;v.push(h,u),b+=1}for(let s=0;s<d;s+=1){const r=e+s,n=i+s;!0===t?_.push(n,n+1,r):_.push(n+1,n,r)}};return(()=>{const t=(u-h)/c;for(let e=0;e<=f;e+=1){const r=[],n=e/f,i=n*(u-h)+h;for(let e=0;e<=d;e+=1){const s=e/d,o=s*g+m,a=Math.sin(o),l=Math.cos(o),h=i*a,u=-n*c+T,f=i*l;y.push(h,u,f);const p=a,_=t,E=l,A=uo.normalize(uo.fromValues(p,_,E));x.push(A[0],A[1],A[2]),v.push(s,1-n),r.push(b),b+=1}E.push(r)}for(let e=0;e<d;e+=1)for(let t=0;t<f;t+=1){const r=E[t][e],n=E[t+1][e],i=E[t+1][e+1],s=E[t][e+1];_.push(r,n,s),_.push(n,i,s)}})(),!1===p&&(h>0&&A(!0),u>0&&A(!1)),Object.assign(new Io,{normals:{buffer:new Float32Array(x)},uvs:[{buffer:new Float32Array(v)}],indices:{buffer:new Uint16Array(_)},positions:{buffer:new Float32Array(y)}})}}var _a;(_a||(_a={})).create=function(t={}){const{radius:e=1,segments:r=32,rings:n=16}=t,i=[],s=[],o=[],a=[],l=[];let h=0;for(let u=0;u<=n;u++){const t=[],s=u/n;let c=0;0==u?c=.5/r:u==n&&(c=-.5/r);for(let n=0;n<=r;n++){const i=n/r;let u=-e*Math.cos(i*Math.PI*2)*Math.sin(s*Math.PI),d=e*Math.cos(s*Math.PI),f=e*Math.sin(i*Math.PI*2)*Math.sin(s*Math.PI),p=uo.fromValues(u,d,f);o.push(u,d,f),l.push(...uo.normalize(p)),a.push(i+c,1-s),t.push(h++)}i.push(t)}for(let u=0;u<n;u++)for(let t=0;t<r;t++){const e=i[u][t+1],r=i[u][t],o=i[u+1][t],a=i[u+1][t+1];0!==u&&s.push(e,r,a),u!==n-1&&s.push(r,o,a)}return Object.assign(new Io,{normals:{buffer:new Float32Array(l)},uvs:[{buffer:new Float32Array(a)}],indices:{buffer:new Uint16Array(s)},positions:{buffer:new Float32Array(o)}})};class ya extends Eo{constructor(t,e){if(super(),this.geometry=t,this.material=e,this.pluginName="pipeline",this.enabledRenderPasses={material:{}},this.renderSortOrder=0,this._instances=[],!t)throw new Error("PIXI3D: Geometry is required when creating a mesh.")}get instances(){return this._instances}createInstance(){var t;if(this.material&&!this.material.isInstancingSupported)throw new Error("PIXI3D: Can't create instance of mesh, material does not support instancing.");return this._instances[this._instances.push(new Do(this,null==(t=this.material)?void 0:t.createInstance()))-1]}removeInstance(t){const e=this._instances.indexOf(t);e>=0&&this._instances.splice(e,1)}enableRenderPass(t,e){this.enabledRenderPasses[t]||(this.enabledRenderPasses[t]=e||{})}disableRenderPass(t){this.enabledRenderPasses[t]&&delete this.enabledRenderPasses[t]}isRenderPassEnabled(t){return!!this.enabledRenderPasses[t]}destroy(t){(!0===t||t&&t.geometry)&&this.geometry.destroy(),(!0===t||t&&t.material)&&this.material&&this.material.destroy(),super.destroy(t)}_render(t){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.skin&&this.skin.calculateJointMatrices(),t.plugins[this.pluginName].render(this)}getBoundingBox(){var t,e;if(!(null==(t=this.geometry.positions)?void 0:t.min))return;if(!(null==(e=this.geometry.positions)?void 0:e.max))return;let r=uo.transformMat4(this.geometry.positions.min,this.worldTransform.array),n=uo.transformMat4(this.geometry.positions.max,this.worldTransform.array);for(let i=0;i<3;i++){let t=r[i];r[i]=Math.min(r[i],n[i]),n[i]=Math.max(t,n[i])}return pa.from({min:r,max:n})}static createQuad(t=new fa){return new ya(Oo.create(),t)}static createCube(t=new fa){return new ya(Mo.create(),t)}static createPlane(t=new fa){return new ya(Po.create(),t)}static createSphere(t=new fa,e){return new ya(_a.create(e),t)}static createCircle(t=new fa,e={}){return new ya(ma.create(e),t)}static createCylinder(t=new fa,e={}){return new ya(ga.create(e),t)}}class va extends W{constructor(t){super(),this.name=t,this.speed=1,this.loop=!1}play(t=li.shared){this.position=0,this._ticker||(this._update=()=>{this.update(t.deltaMS/1e3*this.speed)},this._ticker=t.add(this._update))}stop(){this._ticker&&this._update&&(this._ticker.remove(this._update),this._ticker=this._update=void 0)}update(t){this.position+=t,this.position<this.duration||(this.loop?this.position>this.duration&&(this.position=this.position%this.duration):(this.position=this.duration,this.stop()),this.emit("complete"))}}class xa extends va{constructor(t,e){super(e),this._duration=0,this._position=0,this._channels=[];for(let r of t)this._duration=Math.max(this._duration,r.duration);this._channels=t}get duration(){return this._duration}get position(){return this._position}set position(t){this._position=t;for(let e of this._channels)e.position=this._position}}class ba{constructor(t,e,r=0,n,i,s){this.buffer=t,this.componentType=e,this.stride=r,this.componentCount=n,this.min=i,this.max=s}static from(t,e,r,n,i,s,o,a){switch(t){case 5125:return new ba(new Uint32Array(r,n,i),t,s,e,o,a);case 5126:return new ba(new Float32Array(r,n,i),t,s,e,o,a);case 5120:return new ba(new Int8Array(r,n,i),t,s,e,o,a);case 5121:return new ba(new Uint8Array(r,n,i),t,s,e,o,a);case 5122:return new ba(new Int16Array(r,n,i),t,s,e,o,a);case 5123:return new ba(new Uint16Array(r,n,i),t,s,e,o,a);default:throw new Error(`PIXI3D: Unknown component type "${t}".`)}}}class Ea{constructor(t,e){this.parent=t,this.joints=e,this._jointMatrices=[],this._jointNormalMatrices=[],this._transformIds=[],this.jointNormalMatrices=new Float32Array(16*this.joints.length),this.jointMatrices=new Float32Array(16*this.joints.length);for(let r=0;r<e.length;r++)this._transformIds.push(-1),this._jointMatrices.push(new Float32Array(this.jointMatrices.buffer,64*r,16)),this._jointNormalMatrices.push(new Float32Array(this.jointNormalMatrices.buffer,64*r,16))}calculateJointMatrices(){for(let t=0;t<this.joints.length;t++)this.joints[t].transform._worldID!==this._transformIds[t]&&(this._transformIds[t]=this.joints[t].transform._worldID,mo.multiply(this.joints[t].worldTransform.array,this.joints[t].inverseBindMatrix,this._jointMatrices[t]),mo.multiply(this.parent.transform.inverseWorldTransform.array,this._jointMatrices[t],this._jointMatrices[t]),mo.invert(this._jointMatrices[t],this._jointNormalMatrices[t]),mo.transpose(this._jointNormalMatrices[t],this._jointNormalMatrices[t]))}}class Ta extends Eo{constructor(t){super(),this.inverseBindMatrix=t}}class Aa{constructor(t,e){this._output=t,this._stride=e,this._data=new Float32Array(e)}interpolate(t,e){let r=(t+0)*this._stride,n=(t+1)*this._stride;for(let i=0;i<this._stride;i++)this._output.length>n?this._data[i]=(1-e)*this._output[r+i]+e*this._output[n+i]:this._data[i]=this._output[r+i];return this._data}}class wa{constructor(t,e,r){this._input=t,this._output=e,this._stride=r,this._data=new Float32Array(r)}interpolate(t,e){const r=this._input[t+1]-this._input[t],n=(t+0)*this._stride*3,i=(t+1)*this._stride*3;for(let s=0;s<this._stride;s++)this._data[s]=wa.calculate(e,this._output[n+s+1*this._stride],this._output[i+s+1*this._stride],r*this._output[i+s],r*this._output[n+s+2*this._stride]);return this._data}static calculate(t,e,r,n,i){return(2*t**3-3*t**2+1)*e+(t**3-2*t**2+t)*n+(-2*t**3+3*t**2)*r+(t**3-t**2)*i}}class Sa{constructor(t,e){this._output=t,this._stride=e,this._data=new Float32Array(e)}interpolate(t){for(let e=0;e<this._stride;e++)this._data[e]=this._output[t*this._stride+e];return this._data}}class Ca{static create(t,e,r,n){switch(t){case"LINEAR":return new Aa(r,n);case"CUBICSPLINE":return new wa(e,r,n);case"STEP":return new Sa(r,n)}throw new Error(`PIXI3D: Unknown interpolation type "${t}"`)}}class Ra{constructor(t,e){this._position=0,this._frame=0,this._input=t,this._interpolation=e}get position(){return this._position}set position(t){this.setPosition(t)}get duration(){return this._input[this._input.length-1]}get frame(){return this._frame}get length(){return this._input.length}setPosition(t){this._position=t,this._frame=this.calculateFrame(this._position),this.updateTarget(this._interpolation.interpolate(this._frame,this.calculateFramePosition(this._frame,this._position)))}update(t){this.position+=t}calculateFramePosition(t,e){return t===this._input.length-1?1:(e-this._input[t])/(this._input[t+1]-this._input[t])}calculateFrame(t){if(t<this._input[0])return 0;for(let e=0;e<this._input.length-1;e++)if(t>=this._input[e]&&t<this._input[e+1])return e;return this._input.length-1}}class Ia extends Ra{constructor(t,e,r){super(e,r),this._transform=t}updateTarget(t){this._transform.rotationQuaternion.set(t[0],t[1],t[2],t[3])}}class Pa extends Ra{constructor(t,e,r){super(e,r),this._transform=t}updateTarget(t){this._transform.scale.set(t[0],t[1],t[2])}}class Ma{constructor(t){this._output=t,this._data=new Float32Array(4)}interpolate(t,e){let r=4*(t+0),n=4*(t+1),i=co.set(this._output[r],this._output[r+1],this._output[r+2],this._output[r+3],new Float32Array(4));if(this._output.length<=n)return co.normalize(i,this._data);let s=co.set(this._output[n],this._output[n+1],this._output[n+2],this._output[n+3],new Float32Array(4));return co.normalize(co.slerp(i,s,e,this._data),this._data)}}class Oa extends Ra{constructor(t,e,r){super(e,r),this._transform=t}updateTarget(t){this._transform.position.set(t[0],t[1],t[2])}}class Da extends Ra{constructor(t,e,r){super(e,r),this._weights=t}updateTarget(t){for(let e=0;e<t.length;e++)this._weights[e]=t[e]}}class Na{static create(t,e,r,n,i){if("translation"===n)return new Oa(i.transform,t,Ca.create(r,t,e,3));if("scale"===n)return new Pa(i.transform,t,Ca.create(r,t,e,3));if("rotation"===n)return new Ia(i.transform,t,"LINEAR"===r?new Ma(e):Ca.create(r,t,e,4));if("weights"===n){let n=i.children[0].targetWeights;if(!n)return;return new Da(n,t,Ca.create(r,t,e,n.length))}throw new Error(`PIXI3D: Unknown channel path "${n}"`)}}class Fa{constructor(t,e){var r;if(this._asset=t,this._materialFactory=e||new ha,this._descriptor=this._asset.descriptor,0===t.textures.length)for(let n=0;n<(null==(r=this._descriptor.textures)?void 0:r.length);n++)t.textures.push(this.parseTexture(n))}static createModel(t,e){return new Fa(t,e).parseModel()}static createMesh(t,e,r=0){return new Fa(t,e).parseMesh(r)}parseBuffer(t){if(void 0===t)return;"number"==typeof t&&(t=this._asset.descriptor.accessors[t]);let e=this._descriptor.bufferViews[t.bufferView||0],r=t.byteOffset||0;void 0!==e.byteOffset&&(r+=e.byteOffset);let n=t.count*La[t.type];void 0!==e.byteStride&&0!==e.byteStride&&(n=e.byteStride/Ba[t.componentType]*(t.count-1)+La[t.type]);let i=this._asset.buffers[e.buffer];return ba.from(t.componentType,La[t.type],i,r,n,e.byteStride,t.min,t.max)}parseAnimation(t,e){"number"==typeof t&&(t=this._asset.descriptor.animations[t]);let r=[];for(let n of t.channels){let i=t.samplers[n.sampler],s=this.parseBuffer(i.input);if(void 0===s)continue;let o=this.parseBuffer(i.output);if(void 0===o)continue;let a=Na.create(s.buffer,o.buffer,i.interpolation||"LINEAR",n.target.path,e[n.target.node]);a&&r.push(a)}return new xa(r,t.name)}parseMaterial(t){"number"==typeof t&&(t=this._asset.descriptor.materials[t]);let e=new na;if(!t)return this._materialFactory.create(e);void 0!==t.occlusionTexture&&(e.occlusionTexture=this._asset.textures[t.occlusionTexture.index].clone(),e.occlusionTexture.strength=t.occlusionTexture.strength,e.occlusionTexture.texCoord=t.occlusionTexture.texCoord,t.occlusionTexture.extensions&&t.occlusionTexture.extensions.KHR_texture_transform&&(e.occlusionTexture.transform=t.occlusionTexture.extensions.KHR_texture_transform,void 0!==t.occlusionTexture.extensions.KHR_texture_transform.texCoord&&(e.occlusionTexture.texCoord=t.occlusionTexture.extensions.KHR_texture_transform.texCoord))),void 0!==t.normalTexture&&(e.normalTexture=this._asset.textures[t.normalTexture.index].clone(),e.normalTexture.scale=t.normalTexture.scale||1,e.normalTexture.texCoord=t.normalTexture.texCoord,t.normalTexture.extensions&&t.normalTexture.extensions.KHR_texture_transform&&(e.normalTexture.transform=t.normalTexture.extensions.KHR_texture_transform,void 0!==t.normalTexture.extensions.KHR_texture_transform.texCoord&&(e.normalTexture.texCoord=t.normalTexture.extensions.KHR_texture_transform.texCoord))),void 0!==t.emissiveTexture&&(e.emissiveTexture=this._asset.textures[t.emissiveTexture.index].clone(),e.emissiveTexture.texCoord=t.emissiveTexture.texCoord,t.emissiveTexture.extensions&&t.emissiveTexture.extensions.KHR_texture_transform&&(e.emissiveTexture.transform=t.emissiveTexture.extensions.KHR_texture_transform,void 0!==t.emissiveTexture.extensions.KHR_texture_transform.texCoord&&(e.emissiveTexture.texCoord=t.emissiveTexture.extensions.KHR_texture_transform.texCoord))),void 0!==t.doubleSided&&(e.doubleSided=t.doubleSided),t.emissiveFactor&&(e.emissiveFactor=t.emissiveFactor),t.alphaMode&&(e.alphaMode=t.alphaMode),void 0!==t.alphaCutoff&&(e.alphaCutoff=t.alphaCutoff);let r=t.pbrMetallicRoughness;return void 0!==(null==r?void 0:r.metallicRoughnessTexture)&&(e.metallicRoughnessTexture=this._asset.textures[r.metallicRoughnessTexture.index].clone(),e.metallicRoughnessTexture.texCoord=r.metallicRoughnessTexture.texCoord,r.metallicRoughnessTexture.extensions&&r.metallicRoughnessTexture.extensions.KHR_texture_transform&&(e.metallicRoughnessTexture.transform=r.metallicRoughnessTexture.extensions.KHR_texture_transform,void 0!==r.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord&&(e.metallicRoughnessTexture.texCoord=r.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord))),(null==r?void 0:r.baseColorFactor)&&(e.baseColor=r.baseColorFactor),void 0!==(null==r?void 0:r.baseColorTexture)&&(e.baseColorTexture=this._asset.textures[r.baseColorTexture.index].clone(),e.baseColorTexture.texCoord=r.baseColorTexture.texCoord,r.baseColorTexture.extensions&&r.baseColorTexture.extensions.KHR_texture_transform&&(e.baseColorTexture.transform=r.baseColorTexture.extensions.KHR_texture_transform,void 0!==r.baseColorTexture.extensions.KHR_texture_transform.texCoord&&(e.baseColorTexture.texCoord=r.baseColorTexture.extensions.KHR_texture_transform.texCoord))),void 0!==(null==r?void 0:r.metallicFactor)&&(e.metallic=r.metallicFactor),void 0!==(null==r?void 0:r.roughnessFactor)&&(e.roughness=r.roughnessFactor),t.extensions&&(e.unlit=void 0!==t.extensions.KHR_materials_unlit),this._materialFactory.create(e)}parseTexture(t){const e=this._descriptor.textures[t],r=this._asset.images[e.source],n=new Jr(new De(r.baseTexture.resource,{wrapMode:m.REPEAT,alphaMode:_.NO_PREMULTIPLIED_ALPHA}));if(this._descriptor.samplers&&void 0!==e.sampler){switch(this._descriptor.samplers[e.sampler].wrapS){case 10497:n.baseTexture.wrapMode=m.REPEAT;break;case 33648:n.baseTexture.wrapMode=m.MIRRORED_REPEAT;break;case 33071:n.baseTexture.wrapMode=m.CLAMP}}return n}parseMesh(t){"number"==typeof t&&(t=this._asset.descriptor.meshes[t]);let e=t.weights||[];return t.primitives.map((r=>Object.assign(this.parsePrimitive(r),{name:t.name,targetWeights:e})))}parseSkin(t,e,r){return"number"==typeof t&&(t=this._asset.descriptor.skins[t]),new Ea(e,t.joints.map((t=>r[t])))}parsePrimitive(t){let e,{attributes:r,targets:n}=t,i=Object.assign(new Io,{indices:this.parseBuffer(t.indices),positions:this.parseBuffer(r.POSITION),normals:this.parseBuffer(r.NORMAL),tangents:this.parseBuffer(r.TANGENT),joints:this.parseBuffer(r.JOINTS_0),weights:this.parseBuffer(r.WEIGHTS_0),colors:this.parseBuffer(r.COLOR_0)});for(let s=0;;s++){let t=this.parseBuffer(r[`TEXCOORD_${s}`]);if(void 0===t)break;i.uvs=i.uvs||[],i.uvs.push(t)}if(n)for(let s=0;s<n.length;s++)i.targets=i.targets||[],i.targets.push({positions:this.parseBuffer(n[s].POSITION),normals:this.parseBuffer(n[s].NORMAL),tangents:this.parseBuffer(n[s].TANGENT)});return e=void 0!==t.material?this.parseMaterial(this._asset.descriptor.materials[t.material]):this.parseMaterial(),new ya(i,e)}parseNode(t){const e=this._asset.descriptor.nodes[t];let r;for(let i of this._asset.descriptor.skins||[]){const n=i.joints.indexOf(t);if(n>=0){const t=this.parseBuffer(i.inverseBindMatrices),s=null==t?void 0:t.buffer.slice(16*n,16*n+16);r=Object.assign(new Ta(s),{name:e.name})}}let n=r||Object.assign(new Eo,{name:e.name});return e.translation&&n.position.set(e.translation[0],e.translation[1],e.translation[2]),e.rotation&&n.rotationQuaternion.set(e.rotation[0],e.rotation[1],e.rotation[2],e.rotation[3]),e.scale&&n.scale.set(e.scale[0],e.scale[1],e.scale[2]),e.matrix&&n.transform.setFromMatrix(new yo(e.matrix)),n}parseModel(){let t=this._descriptor.nodes.map(((t,e)=>this.parseNode(e))),e=this._descriptor.scenes[this._asset.descriptor.scene||0],r=new Ga,n=(e,i)=>{let s,o=this._asset.descriptor.nodes[i].mesh;if(void 0!==this._asset.descriptor.nodes[i].skin&&(s=this.parseSkin(this._asset.descriptor.nodes[i].skin,t[i],t)),void 0!==o)for(let n of this.parseMesh(o))r.meshes.push(t[i].addChild(n)),r.meshes[r.meshes.length-1].skin=s;if(e.addChild(t[i]),this._asset.descriptor.nodes[i].children)for(let r of this._asset.descriptor.nodes[i].children)n(t[i],r)};for(let i of e.nodes)n(r,i);if(this._asset.descriptor.animations)for(let i of this._asset.descriptor.animations)r.animations.push(this.parseAnimation(i,t));return r}}const La={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ba={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};function ka(t,e,r){for(let n of t.children)if(n instanceof ya){const t=n.createInstance();t.name=n.name,r.push(e.addChild(t))}else if(n instanceof Eo){const i=e.addChild(new Eo);i.name=t.name,i.position=n.position,i.scale=n.scale,i.rotationQuaternion=n.rotationQuaternion,ka(n,i,r)}}class Ua extends Eo{constructor(t){super(),this.meshes=[],ka(t,this,this.meshes)}}class Ga extends Eo{constructor(){super(...arguments),this.animations=[],this.meshes=[]}static from(t,e){return Fa.createModel(t,e)}createInstance(){return new Ua(this)}getBoundingBox(){this.updateTransform();let t=new pa,e=this.meshes[0].getBoundingBox();e&&(t.min=e.min,t.max=e.max);for(let r=1;r<this.meshes.length;r++){let e=this.meshes[r].getBoundingBox();e&&(t.encapsulate(e.min),t.encapsulate(e.max))}return t}}class ja extends Eo{constructor(){super(...arguments),this.type=Fo.point,this.color=new ea(1,1,1),this.range=10,this.intensity=10,this.innerConeAngle=0,this.outerConeAngle=45}}class Va{constructor(t,e){this.renderer=t,this.name=e,this.clearColor=new ea(0,0,0,0)}get renderTexture(){return this._renderTexture}set renderTexture(t){this._renderTexture=t}clear(){if(this._renderTexture&&this.clearColor){const t=this.renderer.renderTexture.current;this.renderer.renderTexture.bind(this._renderTexture),this.renderer.renderTexture.clear(Array.from(this.clearColor.rgba)),this.renderer.renderTexture.bind(t||void 0)}}render(t){const e=this.renderer.renderTexture.current;this._renderTexture&&this.renderer.renderTexture.bind(this._renderTexture);for(let r of t)r.material&&r.material.render(r,this.renderer);this._renderTexture&&this.renderer.renderTexture.bind(e||void 0)}}var Ha="#version VERSION\n\nVERT_IN vec3 a_Position;\nVERT_IN vec2 a_UV1;\n\nVERT_OUT vec2 v_UV1;\n\nvoid main() {\n  v_UV1 = a_UV1;\n  gl_Position = vec4(a_Position, 1.0);\n}",za="#version VERSION\n\n#define FEATURES\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#ifdef WEBGL2\n  out vec4 FRAG_COLOR;\n#endif\n\nFRAG_IN vec2 v_UV1;\n\nuniform vec2 u_BlurScale;\nuniform sampler2D u_FilterSampler;\n\nvoid main() {\n  vec4 color = vec4(0.0);\n\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-3.0) * u_BlurScale.xy)) * (1.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-2.0) * u_BlurScale.xy)) * (6.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-1.0) * u_BlurScale.xy)) * (15.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+0.0) * u_BlurScale.xy)) * (20.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+1.0) * u_BlurScale.xy)) * (15.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+2.0) * u_BlurScale.xy)) * (6.0/64.0);\n  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+3.0) * u_BlurScale.xy)) * (1.0/64.0);\n\n  FRAG_COLOR = color;\n}";class Wa{constructor(t){this.renderer=t,this._mesh=ya.createQuad(),this._gaussianBlurShader=new Xo(Ir.from(Ho.build(Ha,[],t),Ho.build(za,[],t)))}applyGaussianBlur(t){this.applyBlurScale(t.shadowTexture,t.filterTexture,new Float32Array([0,t.softness/t.shadowTexture.height])),this.applyBlurScale(t.filterTexture,t.shadowTexture,new Float32Array([t.softness/t.shadowTexture.width,0]))}applyBlurScale(t,e,r){this.renderer.renderTexture.bind(e),this.renderer.renderTexture.clear(),this._gaussianBlurShader.uniforms.u_FilterSampler=t,this._gaussianBlurShader.uniforms.u_BlurScale=r,this._gaussianBlurShader.render(this._mesh,this.renderer),this.renderer.renderTexture.bind(void 0)}}var Xa,Ya="#version VERSION\n\n#define FEATURES\n\nvec4 _texture(sampler2D sampler, vec2 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return texture2D(sampler, coord);\n#endif\n}\n\nvec4 _texture(samplerCube sampler, vec3 coord)\n{\n#ifdef WEBGL2\n    return texture(sampler, coord);\n#else\n    return textureCube(sampler, coord);\n#endif\n}\n\nVERT_IN vec3 a_Position;\n\n#ifdef USE_SKINNING\n  VERT_IN vec4 a_Joint1;\n  VERT_IN vec4 a_Weight1;\n#endif\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\n\n#ifdef USE_SKINNING\n  #ifdef USE_SKINNING_TEXTURE\n    uniform sampler2D u_jointMatrixSampler;\n  #else\n    uniform mat4 u_jointMatrix[MAX_JOINT_COUNT];\n  #endif\n#endif\n\n#ifdef USE_INSTANCING\n  VERT_IN vec4 a_ModelMatrix0;\n  VERT_IN vec4 a_ModelMatrix1;\n  VERT_IN vec4 a_ModelMatrix2;\n  VERT_IN vec4 a_ModelMatrix3;\n#endif\n\n// these offsets assume the texture is 4 pixels across\n#define ROW0_U ((0.5 + 0.0) / 4.0)\n#define ROW1_U ((0.5 + 1.0) / 4.0)\n#define ROW2_U ((0.5 + 2.0) / 4.0)\n#define ROW3_U ((0.5 + 3.0) / 4.0)\n\n#ifdef USE_SKINNING\nmat4 getJointMatrix(float boneNdx) {\n  #ifdef USE_SKINNING_TEXTURE\n    float v = (boneNdx + 0.5) / float(MAX_JOINT_COUNT);\n    return mat4(\n      _texture(u_jointMatrixSampler, vec2(ROW0_U, v)), \n      _texture(u_jointMatrixSampler, vec2(ROW1_U, v)), \n      _texture(u_jointMatrixSampler, vec2(ROW2_U, v)), \n      _texture(u_jointMatrixSampler, vec2(ROW3_U, v))\n    );\n  #else\n    return u_jointMatrix[int(boneNdx)];\n  #endif\n}\n\nmat4 getSkinningMatrix() {\n  mat4 skin = mat4(0);\n  skin += \n    a_Weight1.x * getJointMatrix(a_Joint1.x) +\n    a_Weight1.y * getJointMatrix(a_Joint1.y) +\n    a_Weight1.z * getJointMatrix(a_Joint1.z) +\n    a_Weight1.w * getJointMatrix(a_Joint1.w);\n  return skin;\n}\n#endif\n\nvoid main() {\n  mat4 modelMatrix = u_ModelMatrix;\n  #ifdef USE_INSTANCING\n    modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);\n  #endif\n  vec4 pos = vec4(a_Position, 1.0);\n  #ifdef USE_SKINNING\n    pos = getSkinningMatrix() * pos;\n  #endif\n  gl_Position = u_ViewProjectionMatrix * modelMatrix * pos;\n}",Ka="#version VERSION\n\n#define FEATURES\n\n#if defined(WEBGL1)\n  #extension GL_OES_standard_derivatives : enable\n#endif\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#ifdef WEBGL2\n  out vec4 FRAG_COLOR;\n#endif\n\nvoid main() {\n  float depth = gl_FragCoord.z;\n  float dx = 0.0;\n  float dy = 0.0;\n\n  #if defined(WEBGL2) || defined(GL_OES_standard_derivatives)\n    dx = dFdx(depth);\n    dy = dFdy(depth);\n  #endif\n\n  float moment2 = depth * depth + 0.25 * (dx * dx + dy * dy);\n  FRAG_COLOR = vec4(1.0 - depth, 1.0 - moment2, 0.0, 0.0);\n}";class $a{constructor(){this._maxInstances=20,this._modelMatrix=[new Le,new Le,new Le,new Le],this.expandBuffers(this._maxInstances)}expandBuffers(t){for(;t>this._maxInstances;)this._maxInstances+=Math.floor(.5*this._maxInstances);for(let e=0;e<4;e++)this._modelMatrix[e].update(new Float32Array(4*this._maxInstances))}updateBuffers(t){t.length>this._maxInstances&&this.expandBuffers(t.length);for(let e=0;e<t.length;e++){const r=t[e].worldTransform.array;for(let t=0;t<4;t++)this._modelMatrix[t].data.set(r.slice(4*t,4*t+4),4*e)}for(let e=0;e<4;e++)this._modelMatrix[e].update()}addGeometryAttributes(t){for(let e=0;e<4;e++)t.addAttribute(`a_ModelMatrix${e}`,this._modelMatrix[e],4,!1,void 0,0,void 0,!0)}}(Xa||(Xa={})).build=function(t,e=[]){return 1===t.context.webGLVersion&&e.push("WEBGL1 1"),2===t.context.webGLVersion&&e.push("WEBGL2 1"),e};class qa extends Xo{constructor(t,e=[]){e=Xa.build(t,e),super(Ir.from(Ho.build(Ya,e,t),Ho.build(Ka,e,t))),this._instancing=new $a}get maxSupportedJoints(){return 0}createShaderGeometry(t,e){let r=new Ve;return t.indices&&(1===t.indices.buffer.BYTES_PER_ELEMENT?r.addIndex(new Le(new Uint16Array(t.indices.buffer))):r.addIndex(new Le(t.indices.buffer))),t.positions&&r.addAttribute("a_Position",new Le(t.positions.buffer),3,!1,t.positions.componentType,t.positions.stride),e&&this._instancing.addGeometryAttributes(r),r}get name(){return"shadow-shader"}render(t,e,r){if(t.instances.length>0){const e=t.instances.filter((t=>t.worldVisible&&t.renderable));if(0===e.length)return;this._instancing.updateBuffers(e)}super.render(t,e,r)}updateUniforms(t,e){this.uniforms.u_ModelMatrix=t.worldTransform.array,this.uniforms.u_ViewProjectionMatrix=e.lightViewProjection}}class Qa extends qa{constructor(t){const e=Qa.getMaxJointCount(t)-1;super(t,["USE_SKINNING 1","MAX_JOINT_COUNT "+e]),this._maxSupportedJoints=e}get maxSupportedJoints(){return this._maxSupportedJoints}static getMaxJointCount(t){let e=No.getMaxVertexUniformVectors(t)-8;return Math.floor(e/4)}createShaderGeometry(t,e){let r=super.createShaderGeometry(t,e);return t.joints&&r.addAttribute("a_Joint1",new Le(t.joints.buffer),4,!1,t.joints.componentType,t.joints.stride),t.weights&&r.addAttribute("a_Weight1",new Le(t.weights.buffer),4,!1,t.weights.componentType,t.weights.stride),r}get name(){return"skinned-shadow-shader"}updateUniforms(t,e){super.updateUniforms(t,e),t.skin&&(this.uniforms.u_jointMatrix=t.skin.jointMatrices)}}class Ja extends qa{constructor(t){super(t,["USE_SKINNING 1","USE_SKINNING_TEXTURE 1","MAX_JOINT_COUNT 256"]),this._jointMatrixTexture=new Uo(256)}static isSupported(t){return Uo.isSupported(t)}get maxSupportedJoints(){return 256}createShaderGeometry(t,e){let r=super.createShaderGeometry(t,e);return t.joints&&r.addAttribute("a_Joint1",new Le(t.joints.buffer),4,!1,t.joints.componentType,t.joints.stride),t.weights&&r.addAttribute("a_Weight1",new Le(t.weights.buffer),4,!1,t.weights.componentType,t.weights.stride),r}get name(){return"skinned-shadow-shader"}updateUniforms(t,e){super.updateUniforms(t,e),t.skin&&(this._jointMatrixTexture.updateBuffer(t.skin.jointMatrices),this.uniforms.u_jointMatrixSampler=this._jointMatrixTexture)}}class Za{constructor(t){this.renderer=t,this._state=Object.assign(new we,{depthTest:!0,clockwiseFrontFace:!1,culling:!0,blendMode:l.NONE}),this._shadowShader=new qa(this.renderer),this._instancedShadowShader=new qa(this.renderer,["USE_INSTANCING 1"])}getSkinningShader(){return this._textureShader||this._skinningShader||(Ja.isSupported(this.renderer)?this._textureShader=new Ja(this.renderer):(Go.warn(zo.meshVertexSkinningFloatingPointTexturesNotSupported),this._skinningShader=new Qa(this.renderer))),this._textureShader||this._skinningShader}render(t,e){let r=t.instances.length>0?this._instancedShadowShader:this._shadowShader;if(t.skin){let e=this.getSkinningShader();e&&t.skin.joints.length>e.maxSupportedJoints?Go.error(zo.meshVertexSkinningNumberOfJointsNotSupported,{joints:t.skin.joints.length,maxJoints:e.maxSupportedJoints}):r=e}r&&(r.updateUniforms(t,e),r.render(t,this.renderer,this._state))}}class tl{constructor(t,e="shadow"){this.renderer=t,this.name=e,this._lights=[],this._filter=new Wa(t),this._shadow=new Za(t)}addShadowCastingLight(t){this._lights.indexOf(t)<0&&this._lights.push(t)}removeShadowCastingLight(t){const e=this._lights.indexOf(t);e>=0&&this._lights.splice(e,1)}clear(){for(let t of this._lights)t.clear()}render(t){if(0===t.length||0===this._lights.length)return;const e=this.renderer.renderTexture.current;for(let r of this._lights){this.renderer.renderTexture.bind(r.shadowTexture),r.updateLightViewProjection();for(let e of t)this._shadow.render(e,r);r.softness>0&&this._filter.applyGaussianBlur(r)}this.renderer.renderTexture.bind(e||void 0)}}class el extends He{constructor(){super(),this.addAttribute("aMatrix0",this._buffer,4,!1,d.FLOAT),this.addAttribute("aMatrix1",this._buffer,4,!1,d.FLOAT),this.addAttribute("aMatrix2",this._buffer,4,!1,d.FLOAT),this.addAttribute("aMatrix3",this._buffer,4,!1,d.FLOAT)}}var rl="precision highp float;\n\nattribute vec2 aVertexPosition;\n\nattribute vec4 aMatrix0;\nattribute vec4 aMatrix1;\nattribute vec4 aMatrix2;\nattribute vec4 aMatrix3;\n\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void) {\n  mat4 modelMatrix = mat4(aMatrix0, aMatrix1, aMatrix2, aMatrix3);\n\n  gl_Position = modelMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);\n\n  vTextureCoord = vec2(aTextureCoord.x, aTextureCoord.y);\n  vTextureId = aTextureId;\n  vColor = aColor * tint;\n}",nl="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = vColor * vec4(color.rgb, color.a);\n}";const il=Ss.get(e,"BatchRenderer")||Ss.get(e,"AbstractBatchRenderer");class sl extends il{constructor(t){super(t),this.shaderGenerator=new Dr(rl,nl),this.geometryClass=el,this.vertexSize=22,Object.assign(this.state,{culling:!1,clockwiseFrontFace:!1,depthTest:!0})}packInterleavedGeometry(t,e,r,n,i){const{uint32View:s,float32View:o}=e,a=n/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?jt(t._tintRGB,d):t._tintRGB+(255*d<<24);for(let p=0;p<u.length;p+=2){o[n++]=u[p],o[n++]=u[p+1],o[n++]=l[p],o[n++]=l[p+1],s[n++]=f,o[n++]=c;let e=t.modelViewProjection.array;for(let t=0;t<16;t++)o[n++]=e[t]}for(let p=0;p<h.length;p++)r[i++]=a+h[p]}}Ms.installRendererPlugin("sprite3d",sl);Ms.installRendererPlugin("pipeline",class extends Fr{constructor(t){super(t),this.renderer=t,this._meshes=[],this._sprites=[],this.materialPass=new Va(this.renderer,"material"),this.shadowPass=new tl(this.renderer,"shadow"),this.renderPasses=[this.shadowPass,this.materialPass],t.on("prerender",(()=>{for(let t of this.renderPasses)t.clear&&t.clear()})),this._spriteRenderer=new sl(t)}render(t){t.isSprite?this._sprites.push(t):this._meshes.push(t)}flush(){this.sort();for(let t of this.renderPasses)t.render(this._meshes.filter((e=>e.isRenderPassEnabled(t.name))));if(this._meshes=[],this._sprites.length>0){this._spriteRenderer.start();for(let t of this._sprites)this._spriteRenderer.render(t);this._spriteRenderer.stop(),this._sprites=[]}}sort(){this._meshes.sort(((t,e)=>t.material&&e.material?t.material.renderSortType!==e.material.renderSortType?t.material.renderSortType===Qo.transparent?1:-1:t.renderSortOrder===e.renderSortOrder?0:t.renderSortOrder<e.renderSortOrder?-1:1:0)),this._sprites.sort(((t,e)=>t.zIndex!==e.zIndex?t.zIndex-e.zIndex:e.distanceFromCamera-t.distanceFromCamera))}enableShadows(t,e){let r=t instanceof Ga?t.meshes:[t];for(let n of r)e&&n.material instanceof fa&&(n.material.shadowCastingLight=e),n.enableRenderPass(this.shadowPass.name);e&&this.shadowPass.addShadowCastingLight(e)}disableShadows(t){let e=t instanceof Ga?t.meshes:[t];for(let r of e)r.material instanceof fa&&(r.material.shadowCastingLight=void 0),r.disableRenderPass(this.shadowPass.name)}});const ol=Ss.get(e,"ArrayResource")||Ss.get(e,"resources").ArrayResource,al=Ss.get(e,"BaseImageResource")||Ss.get(e,"resources").BaseImageResource;class ll extends ol{constructor(t,e){super(t),this.target=e}upload(t,e){t.gl.pixelStorei(t.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===_.UNPACK);for(let r=0;r<this.items.length;r++){const n=this.items[r].resource;n instanceof ko&&t.gl.texImage2D(this.target,r,e.format,n.width,n.height,0,e.format,e.type,n.data),n instanceof al&&t.gl.texImage2D(this.target,r,e.format,e.format,e.type,n.source)}return!0}}const hl=Ss.get(e,"CubeResource")||Ss.get(e,"resources").CubeResource;class ul extends hl{constructor(t,e=1){super(t),this.levels=e}style(t){let e=t.gl;return e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.levels>1?e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR):e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),!0}}class cl extends De{constructor(){super(...arguments),this.cubemapFormat=Wo.ldr}static get faces(){return["posx","negx","posy","negy","posz","negz"]}get levels(){return this.resource.levels}static fromFaces(t){const e=Array.isArray(t)?t:[t],r=cl.faces.map(((t,r)=>new ll(e.map((e=>e[t])),c.TEXTURE_CUBE_MAP_POSITIVE_X+r)));return new cl(new ul(r,e.length))}static fromColors(t,e=t,r=t,n=t,i=t,s=t){const o=[],a=[t,e,r,n,i,s];for(let l=0;l<a.length;l++){let t=new ko(new Uint8Array(a[l].rgba.map((t=>255*t))),{width:1,height:1}),e=new Jr(new De(t,{type:d.UNSIGNED_BYTE,format:u.RGB,alphaMode:_.NO_PREMULTIPLIED_ALPHA}));o.push(new ll([e],c.TEXTURE_CUBE_MAP_POSITIVE_X+l))}return new cl(new ul(o,1))}}class dl{constructor(t){this.json=t}get format(){return Wo.ldr}get mipmaps(){return this.json}}class fl{constructor(t){this.json=t}get format(){return this.json.format}get mipmaps(){return this.json.mipmaps}}var pl;(pl||(pl={})).getFileVersion=function(t){return 2===t.version?new fl(t):new dl(t)};const ml={use:function(t,e){if("cubemap"!==t.extension)return e();const r=this,n=pl.getFileVersion(t.data),i=n.mipmaps.map((e=>cl.faces.map((r=>t.url.substring(0,t.url.lastIndexOf("/")+1)+e.replace("{{face}}",r)))));let s=i.reduce(((t,e)=>t.concat(e)),[]);r.add(s.filter((t=>!r.resources[t])).map((e=>({parentResource:t,url:e}))));let o=0,a=r.onLoad.add(((r,l)=>{if(s.includes(l.url)&&++o===s.length){const r=i.map((t=>({posx:Jr.from(t[0]),negx:Jr.from(t[1]),posy:Jr.from(t[2]),negy:Jr.from(t[3]),posz:Jr.from(t[4]),negz:Jr.from(t[5])})));let s=cl.fromFaces(r);s.cubemapFormat=n.format,t.cubemap=s,a.detach(),e()}}))},add:function(){Ms.setLoaderResourceExtensionType("cubemap",Cs.json)},test(t){return t.includes(".cubemap")},async load(t){if(!Ms.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const e=await S.ADAPTER.fetch(t),r=await e.json(),n=pl.getFileVersion(r),i=n.mipmaps.map((e=>cl.faces.map((r=>t.substring(0,t.lastIndexOf("/")+1)+e.replace("{{face}}",r))))),s=[];for(let a of i){let t={posx:await Ms.assets.load(a[0]),negx:await Ms.assets.load(a[1]),posy:await Ms.assets.load(a[2]),negy:await Ms.assets.load(a[3]),posz:await Ms.assets.load(a[4]),negz:await Ms.assets.load(a[5])};s.push(t)}let o=cl.fromFaces(s);return o.cubemapFormat=n.format,o}};Ms.installLoaderPlugin("cubemap",ml);const gl=["glsl","vert","frag"],_l={use:(t,e)=>{e()},add:function(){for(let t of gl)Ms.setLoaderResourceExtensionType(t,Cs.text)},test(t){return t.includes(".glsl")||t.includes(".vert")||t.includes(".frag")},async load(t){const e=await S.ADAPTER.fetch(t);return await e.text()}};Ms.installLoaderPlugin("shader",_l);var yl,vl="#version 100\n\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelViewProjection;\n\nvoid main() {\n  gl_Position = u_ModelViewProjection * vec4(a_Position, 1.0);\n}",xl="#version 100\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nuniform vec3 u_Id;\n\nvoid main() {\n  gl_FragColor = vec4(u_Id / 255.0, 1.0);\n}";class bl{constructor(t,e){this._renderer=t,this._update=0,this._matrix=new Float32Array(16),this._pixels=new Uint8Array(e*e*4),this._output=Zr.create({width:e,height:e,resolution:1}),this._shader=new Xo(Ir.from(vl,xl)),this._output.framebuffer.addDepthTexture()}destroy(){this._output.destroy(!0),this._shader.destroy()}resizeToAspect(){const t=this._renderer.width/this._renderer.height,e=Math.floor(this._output.height*t);this._output.width!==e&&(this._pixels=new Uint8Array(e*this._output.height*4),this._output.resize(e,this._output.height))}containsId(t,e,r){const{width:n,height:i}=this._renderer.screen;t=Math.floor(t/n*this._output.width),e=Math.floor((i-e)/i*this._output.height);for(let s=0;s<3;s++)if(r[s]!==this._pixels[4*(e*this._output.width+t)+s])return!1;return!0}update(t){if(this._renderer.renderTexture.bind(this._output),this._update++%2==0){this._renderer.renderTexture.clear();for(let e of t)this.renderHitArea(e)}else{const t=this._renderer.gl;t.readPixels(0,0,this._output.width,this._output.height,t.RGBA,t.UNSIGNED_BYTE,this._pixels)}this._renderer.renderTexture.bind(void 0)}renderHitArea(t){const e=this._shader.uniforms,r=t.object instanceof ya?[t.object]:t.object.meshes,n=t.camera||Ro.main;for(let i of r)e.u_Id=t.id,e.u_ModelViewProjection=mo.multiply(n.viewProjection.array,i.transform.worldTransform.array,this._matrix),this._shader.render(i,this._renderer)}}class El{constructor(t){this.renderer=t,this._hitAreas=[],this._map=new bl(this.renderer,128),li.shared.add(this._update,this,si.LOW),El.main||(El.main=this)}_update(){if(!this.renderer.plugins)return;let t=Ms.getInteractionPlugin(this.renderer);t&&t.hitTest(new Ke(0,0)),this._hitAreas.length>0&&(this._map.resizeToAspect(),this._map.update(this._hitAreas),this._hitAreas=[])}destroy(){this===El.main&&(El.main=void 0),li.shared.remove(this._update,this)}containsHitArea(t,e,r){return this._hitAreas.indexOf(r)<0&&this._hitAreas.push(r),this._map.containsId(t,e,r.id)}}Ms.installRendererPlugin("picking",El),(t=>{let e=0;t.next=function(){return e++,new Uint8Array([e>>16&255,e>>8&255,255&e])}})(yl||(yl={}));var Tl,Al,wl=(t=>(t.low="low",t.medium="medium",t.high="high",t))(wl||{});(t=>{function e(t){return No.supportsFloatLinear(t)?p.LINEAR:p.NEAREST}t.create=function(t,r,n){let i=function(t,e){if(e===wl.high){if(No.isFloatFramebufferSupported(t))return d.FLOAT;if(No.isHalfFloatFramebufferSupported(t))return d.HALF_FLOAT}if(e===wl.medium&&No.isHalfFloatFramebufferSupported(t))return d.HALF_FLOAT;return d.UNSIGNED_BYTE}(t,n);return Zr.create({width:r,height:r,type:i,scaleMode:e(t)})}})(Tl||(Tl={})),(t=>{const e=new Float32Array(16),r=new Float32Array(16),n=new Float32Array(4),i=new Float32Array(3),s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3);t.calculateDirectionalLightViewProjection=function(t){if(t.light.type!==Fo.directional)return;let l=t.shadowArea/2,h=2*l/t.shadowArea,u=mo.ortho(-l,l,-l,l,-l,l,e),c=t.light,d=t.camera||Ro.main;d&&t.followCamera?(uo.scale(d.worldTransform.forward.array,l,a),uo.add(d.worldTransform.position.array,a,o),uo.transformQuat(o,co.conjugate(t.light.worldTransform.rotation.array,n),i),i[0]=h*Math.floor(i[0]/h),i[1]=h*Math.floor(i[1]/h),uo.transformQuat(i,c.worldTransform.rotation.array,i),uo.add(i,c.worldTransform.forward.array,s),mo.lookAt(i,s,c.worldTransform.up.array,r),mo.multiply(u,r,t.lightViewProjection)):(uo.add(c.worldTransform.position.array,t.light.worldTransform.forward.array,o),mo.lookAt(c.worldTransform.position.array,o,c.worldTransform.up.array,r),mo.multiply(u,r,t.lightViewProjection))},t.calculateSpotLightViewProjection=function(t){if(t.light.type!==Fo.spot)return;let n=t.light;mo.perspective(n.outerConeAngle*Xe*2,1,2,n.range,e),uo.add(n.worldTransform.position.array,n.worldTransform.forward.array,o),mo.lookAt(n.worldTransform.position.array,o,n.worldTransform.up.array,r),mo.multiply(e,r,t.lightViewProjection)}})(Al||(Al={}));new Float32Array(3);const Sl=new er;_s.prototype._cacheAsBitmap=!1,_s.prototype._cacheData=null,_s.prototype._cacheAsBitmapResolution=null,_s.prototype._cacheAsBitmapMultisample=null;class Cl{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(_s.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Cl),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),_s.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},_s.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;r.pad(t)}r.ceil(S.RESOLUTION);const n=t.renderTexture.current,i=t.renderTexture.sourceFrame.clone(),s=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,a=Zr.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${te()}`;this._cacheData.textureCacheId=l,De.addToCache(a.baseTexture,l),Jr.addToCache(a,l);const h=this.transform.localTransform.copyTo(Sl).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(n,i,s),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new ws(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-r.x/r.width,u.anchor.y=-r.y/r.height,u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},_s.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},_s.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,i=t._projTransform;e.ceil(S.RESOLUTION);const s=Zr.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${te()}`;this._cacheData.textureCacheId=o,De.addToCache(s.baseTexture,o),Jr.addToCache(s,o);const a=Sl;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:s,clear:!0,transform:a,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const l=new ws(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-e.x/e.width,l.anchor.y=-e.y/e.height,l.alpha=r,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},_s.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},_s.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},_s.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,De.removeFromCache(this._cacheData.textureCacheId),Jr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},_s.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},_s.prototype.name=null,Es.prototype.getChildByName=function(t,e){for(let r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(let r=0,n=this.children.length;r<n;r++){const e=this.children[r];if(!e.getChildByName)continue;const n=e.getChildByName(t,!0);if(n)return n}return null},_s.prototype.getGlobalPosition=function(t=new Ke,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const Rl={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Il=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Pl extends Ur{constructor(t,e=8,r=4,n=Ur.defaultResolution,i=5){const s=function(t,e){const r=Math.ceil(t/2);let n,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";n=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let t=n.replace("%index%",o.toString());t=t.replace("%sampleIndex%",o-(r-1)+".0"),s+=t,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i,t),o=function(t){const e=Rl[t],r=e.length;let n,i=Il,s="";for(let o=0;o<t;o++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString());n=o,o>=r&&(n=t-o-1),i=i.replace("%value%",e[n].toString()),s+=i,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i);super(s,o),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{const i=t.getFilterTexture(),s=t.renderer;let o=e,a=i;this.state.blend=!1,t.applyFilter(this,o,a,y.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,y.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,n),t.returnFilterTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class Ml extends Ur{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(fi,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,i]=Dt.shared.setValue(t).toArray(),s=[r,0,0,0,0,0,n,0,0,0,0,0,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),i=1/3,s=(0,Math.sqrt)(i),o=[r+(1-r)*i,i*(1-r)-s*n,i*(1-r)+s*n,0,0,i*(1-r)+s*n,r+i*(1-r),i*(1-r)-s*n,0,0,i*(1-r)-s*n,i*(1-r)+s*n,r+i*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),i=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(i,e)}saturate(t=0,e){const r=2*t/3+1,n=-.5*(r-1),i=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(i,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,n,i){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const s=Dt.shared,[o,a,l]=s.setValue(r).toArray(),[h,u,c]=s.setValue(n).toArray(),d=[.3,.59,.11,0,0,o,a,l,t,0,h,u,c,e,0,o-h,a-u,l-c,0,0];this._loadMatrix(d,i)}night(t,e){const r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Ml.prototype.grayscale=Ml.prototype.greyscale;const Ol={AlphaFilter:class extends Ur{constructor(t=1){super(di,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends Ur{constructor(t=8,e=4,r=Ur.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Pl(!0,t,e,r,n),this.blurYFilter=new Pl(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){const i=t.getFilterTexture();this.blurXFilter.apply(t,e,i,y.CLEAR),this.blurYFilter.apply(t,i,r,n),t.returnFilterTexture(i)}else s?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:Pl,ColorMatrixFilter:Ml,DisplacementFilter:class extends Ur{constructor(t,e){const r=new er;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,null==e&&(e=20),this.scale=new Ke(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),o=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/o,this.uniforms.rotation[3]=i.d/o),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends Ur{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends Ur{constructor(t=.5,e=Math.random()){super(fi,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(Ol).forEach((([t,e])=>{Object.defineProperty(Ol,t,{get(){return Z(0,`filters.${t} has moved to ${t}`),e}})}));const Dl=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){!this.tickerAdded&&this.domElement&&(li.system.add(this.tickerUpdate,this,si.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(li.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class Nl{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Nl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ke,this.page=new Ke,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Fl extends Nl{constructor(){super(...arguments),this.client=new Ke,this.movement=new Ke,this.offset=new Ke,this.global=new Ke,this.screen=new Ke}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,i,s,o,a,l,h,u,c,d,f,p){throw new Error("Method not implemented.")}}class Ll extends Fl{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Bl extends Fl{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Bl.DOM_DELTA_PIXEL=0,Bl.DOM_DELTA_LINE=1,Bl.DOM_DELTA_PAGE=2;const kl=new Ke,Ul=new Ke;class Gl{constructor(t){this.dispatch=new W,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t)}hitTest(t,e){Dl.pauseUpdate=!0;const r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,kl.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,i=r.length-1;n<i;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(0===r.length)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let i=r.length-1;i>=0;i--)n.forEach((e=>{t.currentTarget=r[i],this.notifyTarget(t,e)}))}propagationPath(t){const e=[t];for(let r=0;r<2048&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,i,s=!1){let o=!1;if(this._interactivePrune(t))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(Dl.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let l=a.length-1;l>=0;l--){const h=a[l],u=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,r,n,i,s||i(t,r));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),s||this._hitElements.length>0?null:o?this._hitElements:a&&!i(t,r)&&n(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,n,i){if(this._interactivePrune(t)||i(t,r))return null;if("dynamic"!==t.eventMode&&"dynamic"!==e||(Dl.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],l=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,r,n,i);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const e=t.isInteractive();return(l.length>0||e)&&l.push(t),l}}}const s=this._isInteractive(e),o=t.isInteractive();return s&&n(t,r)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable)||("none"===t.eventMode||("passive"===t.eventMode&&!t.interactiveChildren||!!t.isMask))}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Ul),!t.hitArea.contains(Ul.x,Ul.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){const r=`on${e=e??t.type}`;t.currentTarget[r]?.(t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ll))return;const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Ll))return;this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r="mouse"===e.pointerType||"pen"===e.pointerType,n=this.trackingData(t.pointerId),i=this.findMountedTarget(n.overTargets);if(n.overTargets?.length>0&&i!==e.target){const n="mousemove"===t.type?"mouseout":"pointerout",s=this.createPointerEvent(t,n,i);if(this.dispatchEvent(s,"pointerout"),r&&this.dispatchEvent(s,"mouseout"),!e.composedPath().includes(i)){const n=this.createPointerEvent(t,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&!e.composedPath().includes(n.target);)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;this.freeEvent(n)}this.freeEvent(s)}if(i!==e.target){const n="mousemove"===t.type?"mouseover":"pointerover",s=this.clonePointerEvent(e,n);this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover");let o=i?.parent;for(;o&&o!==this.rootTarget.parent&&o!==e.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==i&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),r&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(s)}const s=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?s.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&s.push("globalpointermove"),"touch"===e.pointerType&&(this.moveOnAll?s.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&s.push("globaltouchmove")),r&&(this.moveOnAll?s.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&s.push("globalmousemove"),this.cursor=e.target?.cursor),s.length>0&&this.all(e,s),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Ll))return;const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);const i=this.clonePointerEvent(r,"pointerenter");for(i.eventPhase=i.AT_TARGET;i.target&&i.target!==this.rootTarget.parent;)i.currentTarget=i.target,this.notifyTarget(i),n&&this.notifyTarget(i,"mouseenter"),i.target=i.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(i)}mapPointerOut(t){if(!(t instanceof Ll))return;const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,n=this.findMountedTarget(e.overTargets),i=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(i),r&&this.dispatchEvent(i,"mouseout");const s=this.createPointerEvent(t,"pointerleave",n);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),r&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(i),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ll))return;const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),i=this.findMountedTarget(n.pressTargetsByButton[t.button]);let s=i;if(i&&!r.composedPath().includes(i)){let e=i;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],s=e}if(s){const i=this.clonePointerEvent(r,"click");i.target=s,i.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:i.target,timeStamp:e});const o=n.clicksByButton[t.button];if(o.target===i.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=i.target,o.timeStamp=e,i.detail=o.clickCount,"mouse"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightclick":"click")}else"touch"===i.pointerType&&this.dispatchEvent(i,"tap");this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Ll))return;const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let i=r;for(;i;)n.currentTarget=i,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType?this.notifyTarget(n,"touchendoutside"):"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.notifyTarget(n,2===n.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof Bl))return;const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Ll);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],"string"==typeof e&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(Bl);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Ll);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ll&&e instanceof Ll&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Fl&&e instanceof Fl&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,i=r.length;n<i&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const jl={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Vl=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Gl(null),Dl.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ll(null),this.rootWheelEvent=new Bl(null),this.cursorStyles={"default":"inherit",pointer:"pointer"},this.features=new Proxy({...Vl.defaultEventFeatures},{set:(t,e,r)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,Vl._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let r=0,n=e.length;r<n;r++){const t=e[r],n=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;Dl.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const t=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let i=0,s=n.length;i<s;i++){const t=this.bootstrapEvent(this.rootPointerEvent,n[i]);t.type+=r,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const t=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Dl.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Dl.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Dl.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){let n;n=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*i,t.y=(r-n.top)*(this.domElement.height/n.height)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const n=t.changedTouches[r];"undefined"==typeof n.button&&(n.button=0),"undefined"==typeof n.buttons&&(n.buttons=1),"undefined"==typeof n.isPrimary&&(n.isPrimary=1===t.touches.length&&"touchstart"===t.type),"undefined"==typeof n.width&&(n.width=n.radiusX||1),"undefined"==typeof n.height&&(n.height=n.radiusY||1),"undefined"==typeof n.tiltX&&(n.tiltX=0),"undefined"==typeof n.tiltY&&(n.tiltY=0),"undefined"==typeof n.pointerType&&(n.pointerType="touch"),"undefined"==typeof n.pointerId&&(n.pointerId=n.identifier||0),"undefined"==typeof n.pressure&&(n.pressure=n.force||.5),"undefined"==typeof n.twist&&(n.twist=0),"undefined"==typeof n.tangentialPressure&&(n.tangentialPressure=0),"undefined"==typeof n.layerX&&(n.layerX=n.offsetX=n.clientX),"undefined"==typeof n.layerY&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const r=t;"undefined"==typeof r.isPrimary&&(r.isPrimary=!0),"undefined"==typeof r.width&&(r.width=1),"undefined"==typeof r.height&&(r.height=1),"undefined"==typeof r.tiltX&&(r.tiltX=0),"undefined"==typeof r.tiltY&&(r.tiltY=0),"undefined"==typeof r.pointerType&&(r.pointerType="mouse"),"undefined"==typeof r.pointerId&&(r.pointerId=1),"undefined"==typeof r.pressure&&(r.pressure=.5),"undefined"==typeof r.twist&&(r.twist=0),"undefined"==typeof r.tangentialPressure&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=jl[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Hl=Vl;function zl(t){return"dynamic"===t||"static"===t}Hl.extension={name:"events",type:[_e.RendererSystem,_e.CanvasRendererSystem]},Hl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},xe.add(Hl);const Wl={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??zl(Hl.defaultEventMode)},set interactive(t){Z(0,"Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Hl.defaultEventMode},set eventMode(t){this._internalInteractive=zl(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const n="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,n)},removeEventListener(t,e,r){const n="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,n)},dispatchEvent(t){if(!(t instanceof Nl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};_s.mixin(Wl);_s.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class Xl{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(z.tablet||z.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(z.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:i}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,l=n/s*a,h=i/o*a;let u=this.div;u.style.left=`${e}px`,u.style.top=`${r}px`,u.style.width=`${s}px`,u.style.height=`${o}px`;for(let c=0;c<this.children.length;c++){const t=this.children[c];if(t.renderId!==this.renderId)t._accessibleActive=!1,Qt(this.children,c,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,c--;else{u=t._accessibleDiv;let e=t.hitArea;const r=t.worldTransform;t.hitArea?(u.style.left=(r.tx+e.x*r.a)*l+"px",u.style.top=(r.ty+e.y*r.d)*h+"px",u.style.width=e.width*r.a*l+"px",u.style.height=e.height*r.d*h+"px"):(e=t.getBounds(),this.capHitArea(e),u.style.left=e.x*l+"px",u.style.top=e.y*h+"px",u.style.width=e.width*l+"px",u.style.height=e.height*h+"px",u.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(u.title=t.accessibleTitle),u.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&u.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===u.title&&t.tabIndex===u.tabIndex||(u.title=t.accessibleTitle,u.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,i=Object.assign(new Nl(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>n.dispatchEvent(i,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Xl.extension={name:"accessibility",type:[_e.RendererPlugin,_e.CanvasRendererPlugin]},xe.add(Xl);const Yl=class{constructor(t){this.stage=new Es,t=Object.assign({forceCanvas:!1},t),this.renderer=ci(t),Yl._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const r=Yl._plugins.slice(0);r.reverse(),r.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Kl=Yl;Kl._plugins=[],xe.handleByList(_e.Application,Kl._plugins);class $l{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;t=r,e=n}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}$l.extension=_e.Application,xe.add($l);var ql=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(ql||{});const Ql={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Jl,Zl;function th(){Zl={s3tc:Jl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Jl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Jl.getExtension("WEBGL_compressed_texture_etc"),etc1:Jl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Jl.getExtension("WEBGL_compressed_texture_pvrtc")||Jl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Jl.getExtension("WEBGL_compressed_texture_atc"),astc:Jl.getExtension("WEBGL_compressed_texture_astc")}}const eh={extension:{type:_e.DetectionParser,priority:2},test:async()=>{const t=S.ADAPTER.createCanvas().getContext("webgl");return!!t&&(Jl=t,!0)},add:async t=>{Zl||th();const e=[];for(const r in Zl){Zl[r]&&e.push(r)}return[...e,...t]},remove:async t=>(Zl||th(),t.filter((t=>!(t in Zl))))};xe.add(eh);class rh extends Pe{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;"string"==typeof t?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new be(n):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new be(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class nh extends rh{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=nh._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||nh._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let i=0,s=this.levels;i<s;i++){const{levelID:t,levelWidth:e,levelHeight:r,levelBuffer:s}=this._levelBuffers[i];n.compressedTexImage2D(n.TEXTURE_2D,t,this.format,e,r,0,s)}return!0}onBlobLoaded(){this._levelBuffers=nh._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,i,s,o){const a=new Array(r);let l=t.byteOffset,h=s,u=o,c=h+n-1&~(n-1),d=u+i-1&~(i-1),f=c*d*Ql[e];for(let p=0;p<r;p++)a[p]={levelID:p,levelWidth:r>1?h:c,levelHeight:r>1?u:d,levelBuffer:new Uint8Array(t.buffer,l,f)},l+=f,h=h>>1||1,u=u>>1||1,c=h+n-1&~(n-1),d=u+i-1&~(i-1),f=c*d*Ql[e];return a}}const ih=124,sh=3,oh=4,ah=7,lh=19,hh=2,uh=0,ch=1,dh=2,fh=3;const ph={827611204:ql.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:ql.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:ql.COMPRESSED_RGBA_S3TC_DXT5_EXT},mh={70:ql.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ql.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ql.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ql.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ql.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ql.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ql.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ql.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ql.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const gh=[171,75,84,88,32,49,49,187,13,10,26,10],_h=12,yh=16,vh=24,xh=28,bh=36,Eh=40,Th=44,Ah=48,wh=52,Sh=56,Ch=60,Rh=64,Ih={[d.UNSIGNED_BYTE]:1,[d.UNSIGNED_SHORT]:2,[d.INT]:4,[d.UNSIGNED_INT]:4,[d.FLOAT]:4,[d.HALF_FLOAT]:8},Ph={[u.RGBA]:4,[u.RGB]:3,[u.RG]:2,[u.RED]:1,[u.LUMINANCE]:1,[u.LUMINANCE_ALPHA]:2,[u.ALPHA]:1},Mh={[d.UNSIGNED_SHORT_4_4_4_4]:2,[d.UNSIGNED_SHORT_5_5_5_1]:2,[d.UNSIGNED_SHORT_5_6_5]:2};function Oh(t,e,r=!1){const n=new DataView(e);if(!function(t,e){for(let r=0;r<gh.length;r++)if(e.getUint8(r)!==gh[r])return!1;return!0}(0,n))return null;const i=67305985===n.getUint32(_h,!0),s=n.getUint32(yh,i),o=n.getUint32(vh,i),a=n.getUint32(xh,i),l=n.getUint32(bh,i),h=n.getUint32(Eh,i)||1,u=n.getUint32(Th,i)||1,c=n.getUint32(Ah,i)||1,f=n.getUint32(wh,i),p=n.getUint32(Sh,i),m=n.getUint32(Ch,i);if(0===h||1!==u)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==c)throw new Error("WebGL does not support array textures");const g=l+3&-4,_=h+3&-4,y=new Array(c);let v,x=l*h;if(0===s&&(x=g*_),v=0!==s?Ih[s]?Ih[s]*Ph[o]:Mh[s]:Ql[a],void 0===v)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=r?function(t,e,r){const n=new Map;let i=0;for(;i<e;){const s=t.getUint32(Rh+i,r),o=Rh+i+4,a=3-(s+3)%4;if(0===s||s>e-i)break;let l=0;for(;l<s&&0!==t.getUint8(o+l);l++);if(-1===l)break;const h=(new TextDecoder).decode(new Uint8Array(t.buffer,o,l)),u=new DataView(t.buffer,o+l+1,s-l-1);n.set(h,u),i+=4+s+a}return n}(n,m,i):null;let E=x*v,T=l,A=h,w=g,S=_,C=Rh+m;for(let d=0;d<p;d++){const t=n.getUint32(C,i);let r=C+4;for(let n=0;n<c;n++){let t=y[n];t||(t=y[n]=new Array(p)),t[d]={levelID:d,levelWidth:p>1||0!==s?T:w,levelHeight:p>1||0!==s?A:S,levelBuffer:new Uint8Array(e,r,E)},r+=E}C+=t+4,C=C%4!=0?C+4-C%4:C,T=T>>1||1,A=A>>1||1,w=T+4-1&-4,S=A+4-1&-4,E=w*S*v}return 0!==s?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,r=!1;return s===d.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===d.UNSIGNED_INT?(r=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===d.INT&&(r=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new Pe(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:r?Dh(o):o}})),kvData:b}:{compressed:y.map((t=>new nh(null,{format:a,width:l,height:h,levels:p,levelBuffers:t}))),kvData:b}}function Dh(t){switch(t){case u.RGBA:return u.RGBA_INTEGER;case u.RGB:return u.RGB_INTEGER;case u.RG:return u.RG_INTEGER;case u.RED:return u.RED_INTEGER;default:return t}}const Nh={extension:{type:_e.LoadParser,priority:Ui.High},name:"loadDDS",test(t){return Ni(t,".dds")},async load(t,e,r){const n=await S.ADAPTER.fetch(t),i=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,ih/Uint32Array.BYTES_PER_ELEMENT),n=r[sh],i=r[oh],s=r[ah],o=new Uint32Array(t,lh*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const r=o[hh];if(808540228!==r){const e=ph[r],o=new Uint8Array(t,128);return[new nh(o,{format:e,width:i,height:n,levels:s})]}const a=128,l=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),h=l[uh],u=l[ch],c=l[dh],d=l[fh],f=mh[h];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(4===c)throw new Error("DDSParser does not support cubemap textures");if(6===u)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=Ql[f];let r=0,o=i,a=n;for(let t=0;t<s;t++)r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let l=m;for(let n=0;n<d;n++)p.push(new Uint8Array(t,l,r)),l+=r}return p.map((t=>new nh(t,{format:f,width:i,height:n,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await n.arrayBuffer()),s=i.map((n=>ts(new De(n,{mipmap:g.OFF,alphaMode:_.NO_PREMULTIPLIED_ALPHA,resolution:ge(t),...e.data}),r,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};xe.add(Nh);const Fh={extension:{type:_e.LoadParser,priority:Ui.High},name:"loadKTX",test(t){return Ni(t,".ktx")},async load(t,e,r){const n=await S.ADAPTER.fetch(t),i=await n.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=Oh(0,i),l=s??o,h={mipmap:g.OFF,alphaMode:_.NO_PREMULTIPLIED_ALPHA,resolution:ge(t),...e.data},u=l.map((e=>{l===o&&Object.assign(h,{type:e.type,format:e.format});const n=new De(e,h);return n.ktxKeyValueData=a,ts(n,r,t)}));return 1===u.length?u[0]:u},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};xe.add(Fh);const Lh={extension:_e.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(S.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(S.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};xe.add(Lh);const Bh=new qe,kh=class{constructor(t){this.renderer=t}async image(t,e,r){const n=new Image;return n.src=await this.base64(t,e,r),n}async base64(t,e,r){const n=this.canvas(t);if(void 0!==n.toBlob)return new Promise(((t,i)=>{n.toBlob((e=>{if(!e)return void i(new Error("ICanvas.toBlob failed!"));const r=new FileReader;r.onload=()=>t(r.result),r.onerror=i,r.readAsDataURL(e)}),e,r)}));if(void 0!==n.toDataURL)return n.toDataURL(e,r);if(void 0!==n.convertToBlob){const t=await n.convertToBlob({type:e,quality:r});return new Promise(((e,r)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:n,height:i,flipY:s}=this._rawPixels(t,e);s&&kh._flipY(r,n,i),kh._unpremultiplyAlpha(r);const o=new le(n,i,1),a=new ImageData(new Uint8ClampedArray(r.buffer),n,i);return o.context.putImageData(a,0,0),o.canvas}pixels(t,e){const{pixels:r,width:n,height:i,flipY:s}=this._rawPixels(t,e);return s&&kh._flipY(r,n,i),kh._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,i,s=!1,o=!1;if(t&&(t instanceof Zr?i=t:(i=r.generateTexture(t,{resolution:r.resolution,multisample:r.multisample}),o=!0)),i){if(n=i.baseTexture.resolution,e=e??i.frame,s=!1,!o){r.renderTexture.bind(i);const t=i.framebuffer.glFramebuffers[r.CONTEXT_UID];t.blitFramebuffer&&r.framebuffer.bind(t.blitFramebuffer)}}else n=r.resolution,e||((e=Bh).width=r.width/n,e.height=r.height/n),s=!0,r.renderTexture.bind();const a=Math.round(e.width*n),l=Math.round(e.height*n),h=new Uint8Array(4*a*l),u=r.gl;return u.readPixels(Math.round(e.x*n),Math.round(e.y*n),a,l,u.RGBA,u.UNSIGNED_BYTE,h),o&&i?.destroy(!0),{pixels:h,width:a,height:l,flipY:s}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,i=r>>1,s=new Uint8Array(n);for(let o=0;o<i;o++){const e=o*n,i=(r-o-1)*n;s.set(t.subarray(e,e+n)),t.copyWithin(e,i,i+n),t.set(s,i)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const e=t[r+3];if(0!==e){const n=255.001/e;t[r]=t[r]*n+.5,t[r+1]=t[r+1]*n+.5,t[r+2]=t[r+2]*n+.5}}}};let Uh=kh;Uh.extension={name:"extract",type:_e.RendererSystem},xe.add(Uh);const Gh={build(t){const e=t.points;let r,n,i,s,o,a;if(t.type===Ye.CIRC){const e=t.shape;r=e.x,n=e.y,o=a=e.radius,i=s=0}else if(t.type===Ye.ELIP){const e=t.shape;r=e.x,n=e.y,o=e.width,a=e.height,i=s=0}else{const e=t.shape,l=e.width/2,h=e.height/2;r=e.x+l,n=e.y+h,o=a=Math.max(0,Math.min(e.radius,Math.min(l,h))),i=l-o,s=h-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(e.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(i?4:0)+(s?4:0);if(e.length=h,0===h)return;if(0===l)return e.length=8,e[0]=e[6]=r+i,e[1]=e[3]=n+s,e[2]=e[4]=r-i,void(e[5]=e[7]=n-s);let u=0,c=4*l+(i?2:0)+2,d=c,f=h;{const t=i+o,a=s,l=r+t,h=r-t,p=n+a;if(e[u++]=l,e[u++]=p,e[--c]=p,e[--c]=h,s){const t=n-a;e[d++]=h,e[d++]=t,e[--f]=t,e[--f]=l}}for(let p=1;p<l;p++){const t=Math.PI/2*(p/l),h=i+Math.cos(t)*o,m=s+Math.sin(t)*a,g=r+h,_=r-h,y=n+m,v=n-m;e[u++]=g,e[u++]=y,e[--c]=y,e[--c]=_,e[d++]=_,e[d++]=v,e[--f]=v,e[--f]=g}{const t=s+a,o=r+i,l=r-i,h=n+t,c=n-t;e[u++]=o,e[u++]=h,e[--f]=c,e[--f]=o,i&&(e[u++]=l,e[u++]=h,e[--f]=c,e[--f]=l)}},triangulate(t,e){const r=t.points,n=e.points,i=e.indices;if(0===r.length)return;let s=n.length/2;const o=s;let a,l;if(t.type!==Ye.RREC){const e=t.shape;a=e.x,l=e.y}else{const e=t.shape;a=e.x+e.width/2,l=e.y+e.height/2}const h=t.matrix;n.push(t.matrix?h.a*a+h.c*l+h.tx:a,t.matrix?h.b*a+h.d*l+h.ty:l),s++,n.push(r[0],r[1]);for(let u=2;u<r.length;u+=2)n.push(r[u],r[u+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function jh(t,e=!1){const r=t.length;if(r<6)return;let n=0;for(let i=0,s=t[r-2],o=t[r-1];i<r;i+=2){const e=t[i],r=t[i+1];n+=(e-s)*(r+o),s=e,o=r}if(!e&&n>0||e&&n<=0){const e=r/2;for(let n=e+e%2;n<r;n+=2){const e=r-n-2,i=r-n-1,s=n,o=n+1;[t[e],t[s]]=[t[s],t[e]],[t[i],t[o]]=[t[o],t[i]]}}}const Vh={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let r=t.points;const n=t.holes,i=e.points,s=e.indices;if(r.length>=6){jh(r,!1);const t=[];for(let i=0;i<n.length;i++){const e=n[i];jh(e.points,!0),t.push(r.length/2),r=r.concat(e.points)}const e=X(r,t,2);if(!e)return;const o=i.length/2;for(let r=0;r<e.length;r+=3)s.push(e[r]+o),s.push(e[r+1]+o),s.push(e[r+2]+o);for(let n=0;n<r.length;n++)i.push(r[n])}}},Hh={build(t){const e=t.shape,r=e.x,n=e.y,i=e.width,s=e.height,o=t.points;o.length=0,i>=0&&s>=0&&o.push(r,n,r+i,n,r+i,n+s,r,n+s)},triangulate(t,e){const r=t.points,n=e.points;if(0===r.length)return;const i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},zh={build(t){Gh.build(t)},triangulate(t,e){Gh.triangulate(t,e)}};var Wh=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Wh||{}),Xh=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Xh||{});const Yh={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class Kh{static curveTo(t,e,r,n,i,s){const o=s[s.length-2],a=s[s.length-1]-e,l=o-t,h=n-e,u=r-t,c=Math.abs(a*u-l*h);if(c<1e-8||0===i)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;const d=a*a+l*l,f=h*h+u*u,p=a*h+l*u,m=i*Math.sqrt(d)/c,g=i*Math.sqrt(f)/c,_=m*p/d,y=g*p/f,v=m*u+g*l,x=m*h+g*a,b=l*(g+_),E=a*(g+_),T=u*(m+y),A=h*(m+y);return{cx:v+t,cy:x+e,radius:i,startAngle:Math.atan2(E-x,b-v),endAngle:Math.atan2(A-x,T-v),anticlockwise:l*h>u*a}}static arc(t,e,r,n,i,s,o,a,l){const h=o-s,u=Yh._segmentsCount(Math.abs(h)*i,40*Math.ceil(Math.abs(h)/ze)),c=h/(2*u),d=2*c,f=Math.cos(c),p=Math.sin(c),m=u-1,g=m%1/m;for(let _=0;_<=m;++_){const t=c+s+d*(_+g*_),e=Math.cos(t),o=-Math.sin(t);l.push((f*e+p*o)*i+r,(f*-o+p*e)*i+n)}}}class $h{static curveLength(t,e,r,n,i,s,o,a){let l=0,h=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,_=0,y=0,v=t,x=e;for(let b=1;b<=10;++b)h=b/10,u=h*h,c=u*h,d=1-h,f=d*d,p=f*d,m=p*t+3*f*h*r+3*d*u*i+c*o,g=p*e+3*f*h*n+3*d*u*s+c*a,_=v-m,y=x-g,v=m,x=g,l+=Math.sqrt(_*_+y*y);return l}static curveTo(t,e,r,n,i,s,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const h=Yh._segmentsCount($h.curveLength(a,l,t,e,r,n,i,s));let u=0,c=0,d=0,f=0,p=0;o.push(a,l);for(let m=1,g=0;m<=h;++m)g=m/h,u=1-g,c=u*u,d=c*u,f=g*g,p=f*g,o.push(d*a+3*c*g*t+3*u*f*r+p*i,d*l+3*c*g*e+3*u*f*n+p*s)}}function qh(t,e,r,n,i,s,o,a){let l,h;o?(l=n,h=-r):(l=-n,h=r);const u=t-r*i+l,c=e-n*i+h,d=t+r*s+l,f=e+n*s+h;return a.push(u,c,d,f),2}function Qh(t,e,r,n,i,s,o,a){const l=r-t,h=n-e;let u=Math.atan2(l,h),c=Math.atan2(i-t,s-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(l*l+h*h),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),_=f/g;if(d+=_,a){o.push(t,e,r,n);for(let r=1,n=d;r<g;r++,n+=_)o.push(t,e,t+Math.sin(n)*m,e+Math.cos(n)*m);o.push(t,e,i,s)}else{o.push(r,n,t,e);for(let r=1,n=d;r<g;r++,n+=_)o.push(t+Math.sin(n)*m,e+Math.cos(n)*m,t,e);o.push(i,s,t,e)}return 2*g}function Jh(t,e){t.lineStyle.native?function(t,e){let r=0;const n=t.shape,i=t.points||n.points,s=n.type!==Ye.POLY||n.closeStroke;if(0===i.length)return;const o=e.points,a=e.indices,l=i.length/2,h=o.length/2;let u=h;for(o.push(i[0],i[1]),r=1;r<l;r++)o.push(i[2*r],i[2*r+1]),a.push(u,u+1),u++;s&&a.push(u,h)}(t,e):function(t,e){const r=t.shape;let n=t.points||r.points.slice();const i=e.closePointEps;if(0===n.length)return;const s=t.lineStyle,o=new Ke(n[0],n[1]),a=new Ke(n[n.length-2],n[n.length-1]),l=r.type!==Ye.POLY||r.closeStroke,h=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(l){n=n.slice(),h&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);n.unshift(t,e),n.push(t,e)}const u=e.points,c=n.length/2;let d=n.length;const f=u.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let _=n[0],y=n[1],v=n[2],x=n[3],b=0,E=0,T=-(y-x),A=_-v,w=0,S=0,C=Math.sqrt(T*T+A*A);T/=C,A/=C,T*=p,A*=p;const R=s.alignment,I=2*(1-R),P=2*R;l||(s.cap===Xh.ROUND?d+=Qh(_-T*(I-P)*.5,y-A*(I-P)*.5,_-T*I,y-A*I,_+T*P,y+A*P,u,!0)+2:s.cap===Xh.SQUARE&&(d+=qh(_,y,T,A,I,P,!0,u))),u.push(_-T*I,y-A*I,_+T*P,y+A*P);for(let D=1;D<c-1;++D){_=n[2*(D-1)],y=n[2*(D-1)+1],v=n[2*D],x=n[2*D+1],b=n[2*(D+1)],E=n[2*(D+1)+1],T=-(y-x),A=_-v,C=Math.sqrt(T*T+A*A),T/=C,A/=C,T*=p,A*=p,w=-(x-E),S=v-b,C=Math.sqrt(w*w+S*S),w/=C,S/=C,w*=p,S*=p;const t=v-_,e=y-x,r=v-b,i=E-x,o=t*r+e*i,a=e*r-i*t,l=a<0;if(Math.abs(a)<.001*Math.abs(o)){u.push(v-T*I,x-A*I,v+T*P,x+A*P),o>=0&&(s.join===Wh.ROUND?d+=Qh(v,x,v-T*I,x-A*I,v-w*I,x-S*I,u,!1)+4:d+=2,u.push(v-w*P,x-S*P,v+w*I,x+S*I));continue}const h=(-T+_)*(-A+x)-(-T+v)*(-A+y),c=(-w+b)*(-S+x)-(-w+v)*(-S+E),f=(t*c-r*h)/a,R=(i*h-e*c)/a,M=(f-v)*(f-v)+(R-x)*(R-x),O=v+(f-v)*I,N=x+(R-x)*I,F=v-(f-v)*P,L=x-(R-x)*P,B=l?I:P,k=M<=Math.min(t*t+e*e,r*r+i*i)+B*B*m;let U=s.join;if(U===Wh.MITER&&M/m>g&&(U=Wh.BEVEL),k)switch(U){case Wh.MITER:u.push(O,N,F,L);break;case Wh.BEVEL:l?u.push(O,N,v+T*P,x+A*P,O,N,v+w*P,x+S*P):u.push(v-T*I,x-A*I,F,L,v-w*I,x-S*I,F,L),d+=2;break;case Wh.ROUND:l?(u.push(O,N,v+T*P,x+A*P),d+=Qh(v,x,v+T*P,x+A*P,v+w*P,x+S*P,u,!0)+4,u.push(O,N,v+w*P,x+S*P)):(u.push(v-T*I,x-A*I,F,L),d+=Qh(v,x,v-T*I,x-A*I,v-w*I,x-S*I,u,!1)+4,u.push(v-w*I,x-S*I,F,L))}else{switch(u.push(v-T*I,x-A*I,v+T*P,x+A*P),U){case Wh.MITER:l?u.push(F,L,F,L):u.push(O,N,O,N),d+=2;break;case Wh.ROUND:d+=l?Qh(v,x,v+T*P,x+A*P,v+w*P,x+S*P,u,!0)+2:Qh(v,x,v-T*I,x-A*I,v-w*I,x-S*I,u,!1)+2}u.push(v-w*I,x-S*I,v+w*P,x+S*P),d+=2}}_=n[2*(c-2)],y=n[2*(c-2)+1],v=n[2*(c-1)],x=n[2*(c-1)+1],T=-(y-x),A=_-v,C=Math.sqrt(T*T+A*A),T/=C,A/=C,T*=p,A*=p,u.push(v-T*I,x-A*I,v+T*P,x+A*P),l||(s.cap===Xh.ROUND?d+=Qh(v-T*(I-P)*.5,x-A*(I-P)*.5,v-T*I,x-A*I,v+T*P,x+A*P,u,!1)+2:s.cap===Xh.SQUARE&&(d+=qh(v,x,T,A,I,P,!1,u)));const M=e.indices,O=Yh.epsilon*Yh.epsilon;for(let D=f;D<d+f-2;++D)_=u[2*D],y=u[2*D+1],v=u[2*(D+1)],x=u[2*(D+1)+1],b=u[2*(D+2)],E=u[2*(D+2)+1],Math.abs(_*(x-E)+v*(E-y)+b*(y-x))<O||M.push(D,D+1,D+2)}(t,e)}class Zh{static curveLength(t,e,r,n,i,s){const o=t-2*r+i,a=e-2*n+s,l=2*r-2*t,h=2*n-2*e,u=4*(o*o+a*a),c=4*(o*l+a*h),d=l*l+h*h,f=2*Math.sqrt(u+c+d),p=Math.sqrt(u),m=2*u*p,g=2*Math.sqrt(d),_=c/p;return(m*f+p*c*(f-g)+(4*d*u-c*c)*Math.log((2*p+_+f)/(_+g)))/(4*m)}static curveTo(t,e,r,n,i){const s=i[i.length-2],o=i[i.length-1],a=Yh._segmentsCount(Zh.curveLength(s,o,t,e,r,n));let l=0,h=0;for(let u=1;u<=a;++u){const c=u/a;l=s+(t-s)*c,h=o+(e-o)*c,i.push(l+(t+(r-t)*c-l)*c,h+(e+(n-e)*c-h)*c)}}}const tu={[Ye.POLY]:Vh,[Ye.CIRC]:Gh,[Ye.ELIP]:Gh,[Ye.RECT]:Hh,[Ye.RREC]:zh},eu=[],ru=[];class nu{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new nu(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class iu{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const su=new Ke,ou=class extends He{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new gs,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),ru.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),eu.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const i=new nu(t,e,r,n);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new nu(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&(n.shape&&(n.matrix?n.matrix.applyInverse(t,su):su.copyFrom(t),n.shape.contains(su.x,su.y)))){let t=!1;if(n.holes)for(let e=0;e<n.holes.length;e++){if(n.holes[e].shape.contains(su.x,su.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;const i=e[a],s=i.fillStyle,o=i.lineStyle;tu[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix),(s.visible||o.visible)&&this.processHoles(i.holes);for(let e=0;e<2;e++){const a=0===e?s:o;if(!a.visible)continue;const l=a.texture.baseTexture,h=this.indices.length,u=this.points.length/2;l.wrapMode=m.REPEAT,0===e?this.processFill(i):this.processLine(i);const c=this.points.length/2-u;0!==c&&(r&&!this._compareStyles(n,a)&&(r.end(h,u),r=null),r||(r=eu.pop()||new iu,r.begin(a,h,u),this.batches.push(r),n=a),this.addUvs(this.points,t,a.texture,u,c,a.matrix))}}const i=this.indices.length,s=this.points.length/2;if(r&&r.end(i,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const r=t[e];for(let t=0;t<r.size;t++){const e=r.start+t;this.indicesUint16[e]=this.indicesUint16[e]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*ou.BATCHABLE_SIZE}buildDrawCalls(){let t=++De._globalBatch;for(let h=0;h<this.drawCalls.length;h++)this.drawCalls[h].texArray.clear(),ru.push(this.drawCalls[h]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=ru.pop();n||(n=new Ne,n.texArray=new Nr),n.texArray.count=0,n.start=0,n.size=0,n.type=h.TRIANGLES;let i=0,s=null,o=0,a=!1,l=h.TRIANGLES,u=0;this.drawCalls.push(n);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,g=p.texture.baseTexture;a!==!!p.native&&(a=!!p.native,l=a?h.LINES:h.TRIANGLES,s=null,i=f,t++),s!==g&&(s=g,g._batchEnabled!==t&&(i===f&&(t++,i=0,n.size>0&&(n=ru.pop(),n||(n=new Ne,n.texArray=new Nr),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=l),g.touched=1,g._batchEnabled=t,g._batchLocation=i,g.wrapMode=m.REPEAT,n.texArray.elements[n.texArray.count++]=g,i++)),n.size+=d.size,u+=d.size,o=g._batchLocation,this.addColors(e,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(r,o,d.attribSize,d.attribStart)}De._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let l=0;l<t.length/2;l++)s[a++]=t[2*l],s[a++]=t[2*l+1],s[a++]=e[2*l],s[a++]=e[2*l+1],o[a++]=r[l],s[a++]=n[l];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)Vh.triangulate(t,this);else{tu[t.type].triangulate(t,this)}}processLine(t){Jh(t,this);for(let e=0;e<t.holes.length;e++)Jh(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];tu[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[2*r],i=t[2*r+1];t[2*r]=e.a*n+e.c*i+e.tx,t[2*r+1]=e.b*n+e.d*i+e.ty}}addColors(t,e,r,n,i=0){const s=Dt.shared.setValue(e).toLittleEndianNumber(),o=Dt.shared.setValue(s).toPremultiplied(r);t.length=Math.max(t.length,i+n);for(let a=0;a<n;a++)t[i+a]=o}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let i=0;i<r;i++)t[n+i]=e}addUvs(t,e,r,n,i,s=null){let o=0;const a=e.length,l=r.frame;for(;o<i;){let r=t[2*(n+o)],i=t[2*(n+o)+1];if(s){const t=s.a*r+s.c*i+s.tx;i=s.b*r+s.d*i+s.ty,r=t}o++,e.push(r/l.width,i/l.height)}const h=r.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(e,r,a,i)}adjustUvs(t,e,r,n){const i=e.baseTexture,s=1e-6,o=r+2*n,a=e.frame,l=a.width/i.width,h=a.height/i.height;let u=a.x/a.width,c=a.y/a.height,d=Math.floor(t[r]+s),f=Math.floor(t[r+1]+s);for(let p=r+2;p<o;p+=2)d=Math.min(d,Math.floor(t[p]+s)),f=Math.min(f,Math.floor(t[p+1]+s));u-=d,c-=f;for(let p=r;p<o;p+=2)t[p]=(t[p]+u)*l,t[p+1]=(t[p+1]+c)*h}};let au=ou;au.BATCHABLE_SIZE=100;class lu{constructor(){this.color=16777215,this.alpha=1,this.texture=Jr.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new lu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Jr.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class hu extends lu{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Xh.BUTT,this.join=Wh.MITER,this.miterLimit=10}clone(){const t=new hu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const uu={},cu=class extends Es{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new lu,this._lineStyle=new hu,this._matrix=null,this._holeMode=!1,this.state=we.for2d(),this._geometry=t||new au,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Dt(16777215),this.blendMode=l.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new cu(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:n,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Jr.WHITE,color:t?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Xh.BUTT,join:Wh.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Ze,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Ze,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return n===t&&i===e||r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Zh.curveTo(t,e,r,n,i),this}bezierCurveTo(t,e,r,n,i,s){return this._initCurve(),$h.curveTo(t,e,r,n,i,s,this.currentPath.points),this}arcTo(t,e,r,n,i){this._initCurve(t,e);const s=this.currentPath.points,o=Kh.curveTo(t,e,r,n,i,s);if(o){const{cx:t,cy:e,radius:r,startAngle:n,endAngle:i,anticlockwise:s}=o;this.arc(t,e,r,n,i,s)}return this}arc(t,e,r,n,i,s=!1){if(n===i)return this;!s&&i<=n?i+=ze:s&&n<=i&&(n+=ze);if(0===i-n)return this;const o=t+Math.cos(n)*r,a=e+Math.sin(n)*r,l=this._geometry.closePointEps;let h=this.currentPath?this.currentPath.points:null;if(h){const t=Math.abs(h[h.length-2]-o),e=Math.abs(h[h.length-1]-a);t<l&&e<l||h.push(o,a)}else this.moveTo(o,a),h=this.currentPath.points;return Kh.arc(o,a,t,e,r,n,i,s,h),this}beginFill(t=0,e){return this.beginTextureFill({texture:Jr.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Dt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Jr.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new qe(t,e,r,n))}drawRoundedRect(t,e,r,n,i){return this.drawShape(new tr(t,e,r,n,i))}drawCircle(t,e,r){return this.drawShape(new Qe(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new Je(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):e=Array.isArray(t[0])?t[0]:t;const i=new Ze(e);return i.closeStroke=r,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==Ye.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const r=t.batches[n],i=r.style.color,s=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:Dt.shared.setValue(i).toRgbArray(),_tintRGB:i,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[n]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,i=e.uniforms,s=r.drawCalls;i.translationMatrix=this.transform.worldTransform,Dt.shared.setValue(this._tintColor).premultiply(n).toArray(i.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let o=0,a=s.length;o<a;o++)this._renderDrawCallDirect(t,r.drawCalls[o])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:i,start:s}=e,o=r.count;for(let a=0;a<o;a++)t.texture.bind(r.elements[a],a);t.geometry.draw(n,i,s)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!uu[r]){const{maxTextures:e}=t.plugins[r],n=new Int32Array(e);for(let t=0;t<e;t++)n[t]=t;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new er,"default":Mr.from({uSamplers:n},!0)},s=t.plugins[r]._shader.program;uu[r]=new Or(s,i)}e=uu[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,i)}containsPoint(t){return this.worldTransform.applyInverse(t,cu._TEMP_POINT),this._geometry.containsPoint(cu._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Dt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData;let u=0;for(let c=0;c<l.length;c+=2){const t=l[c],e=l[c+1];h[u++]=r*t+i*e+o,h[u++]=s*e+n*t+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let du=cu;du.curves=Yh,du._TEMP_POINT=new Ke;class fu{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const pu=new Ke,mu=new Ze,gu=class extends Es{constructor(t,e,r,n=h.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||we.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=S.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===h.TRIANGLES&&e.length<2*gu.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,i=n.a,s=n.b,o=n.c,a=n.d,l=n.tx,h=n.ty,u=this.vertexData;for(let c=0;c<u.length/2;c++){const t=e[2*c],r=e[2*c+1];u[2*c]=i*t+o*r+l,u[2*c+1]=s*t+a*r+h}if(this._roundPixels){const t=S.RESOLUTION;for(let e=0;e<u.length;++e)u[e]=Math.round(u[e]*t)/t}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new fu(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,pu);const e=this.geometry.getBuffer("aVertexPosition").data,r=mu.points,n=this.geometry.getIndex().data,i=n.length,s=4===this.drawMode?3:1;for(let o=0;o+2<i;o+=s){const t=2*n[o],i=2*n[o+1],s=2*n[o+2];if(r[0]=e[t],r[1]=e[t+1],r[2]=e[i],r[3]=e[i+1],r[4]=e[s],r[5]=e[s+1],mu.contains(pu.x,pu.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let _u=gu;_u.BATCHABLE_SIZE=100;class yu extends Ve{constructor(t,e,r){super();const n=new Le(t),i=new Le(e,!0),s=new Le(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,d.FLOAT).addAttribute("aTextureCoord",i,2,!1,d.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class vu extends Or{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:er.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(r,e.uniforms),super(e.program||Ir.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r),this._colorDirty=!1,this.uvMatrix=new pn(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Dt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Dt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class xu{constructor(t,e,r){this.geometry=new Ve,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let r=t[n];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||d.FLOAT,offset:r.offset},e[n]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Le(zt(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let s=0;s<this.dynamicProperties.length;++s){const t=this.dynamicProperties[s];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Le(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let s=0;s<this.staticProperties.length;++s){const t=this.staticProperties[s];t.offset=n,n+=t.size,this.staticStride+=t.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new Le(this.staticData,!0,!1);for(let s=0;s<this.dynamicProperties.length;++s){const e=this.dynamicProperties[s];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===d.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let s=0;s<this.staticProperties.length;++s){const e=this.staticProperties[s];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===d.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const i=this.dynamicProperties[n];i.uploadFunction(t,e,r,i.type===d.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const i=this.staticProperties[n];i.uploadFunction(t,e,r,i.type===d.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class bu extends Fr{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new er,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:d.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Or.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=we.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,i=this.renderer;let s=e.length;if(0===s)return;s>r&&!t.autoResize&&(s=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,l=a.alphaMode>0;this.state.blendMode=Ut(t.blendMode,l),i.state.set(this.state);const h=i.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Dt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let d=0,f=0;d<s;d+=n,f+=1){let r=s-d;r>n&&(r=n),f>=o.length&&o.push(this._generateOneMoreBuffer(t));const a=o[f];a.uploadDynamic(e,d,r);const l=t._bufferUpdateIDs[f]||0;c=c||a._updateID<l,c&&(a._updateID=t._updateID,a.uploadStatic(e,d,r)),i.geometry.bind(a.geometry),h.drawElements(h.TRIANGLES,6*r,h.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,i=t._properties;for(let s=0;s<r;s+=n)e.push(new xu(this.properties,i,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new xu(this.properties,r,e)}uploadVertices(t,e,r,n,i,s){let o=0,a=0,l=0,h=0;for(let u=0;u<r;++u){const r=t[e+u],c=r._texture,d=r.scale.x,f=r.scale.y,p=c.trim,m=c.orig;p?(a=p.x-r.anchor.x*m.width,o=a+p.width,h=p.y-r.anchor.y*m.height,l=h+p.height):(o=m.width*(1-r.anchor.x),a=m.width*-r.anchor.x,l=m.height*(1-r.anchor.y),h=m.height*-r.anchor.y),n[s]=a*d,n[s+1]=h*f,n[s+i]=o*d,n[s+i+1]=h*f,n[s+2*i]=o*d,n[s+2*i+1]=l*f,n[s+3*i]=a*d,n[s+3*i+1]=l*f,s+=4*i}}uploadPosition(t,e,r,n,i,s){for(let o=0;o<r;o++){const r=t[e+o].position;n[s]=r.x,n[s+1]=r.y,n[s+i]=r.x,n[s+i+1]=r.y,n[s+2*i]=r.x,n[s+2*i+1]=r.y,n[s+3*i]=r.x,n[s+3*i+1]=r.y,s+=4*i}}uploadRotation(t,e,r,n,i,s){for(let o=0;o<r;o++){const r=t[e+o].rotation;n[s]=r,n[s+i]=r,n[s+2*i]=r,n[s+3*i]=r,s+=4*i}}uploadUvs(t,e,r,n,i,s){for(let o=0;o<r;++o){const r=t[e+o]._texture._uvs;r?(n[s]=r.x0,n[s+1]=r.y0,n[s+i]=r.x1,n[s+i+1]=r.y1,n[s+2*i]=r.x2,n[s+2*i+1]=r.y2,n[s+3*i]=r.x3,n[s+3*i+1]=r.y3,s+=4*i):(n[s]=0,n[s+1]=0,n[s+i]=0,n[s+i+1]=0,n[s+2*i]=0,n[s+2*i+1]=0,n[s+3*i]=0,n[s+3*i+1]=0,s+=4*i)}}uploadTint(t,e,r,n,i,s){for(let o=0;o<r;++o){const r=t[e+o],a=Dt.shared.setValue(r._tintRGB).toPremultiplied(r.alpha,r.texture.baseTexture.alphaMode>0);n[s]=a,n[s+i]=a,n[s+2*i]=a,n[s+3*i]=a,s+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}bu.extension={name:"particle",type:_e.RendererPlugin},xe.add(bu);var Eu=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(Eu||{});const Tu={willReadFrequently:!0},Au=class{static get experimentalLetterSpacingSupported(){let t=Au._experimentalLetterSpacingSupported;if(void 0!==t){const e=S.ADAPTER.getCanvasRenderingContext2D().prototype;t=Au._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,i,s,o,a,l){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,r,n=Au._canvas){r=null==r?e.wordWrap:r;const i=e.toFontString(),s=Au.measureFont(i);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=n.getContext("2d",Tu);o.font=i;const a=(r?Au.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(a.length);let h=0;for(let f=0;f<a.length;f++){const t=Au._measureText(a[f],e.letterSpacing,o);l[f]=t,h=Math.max(h,t)}let u=h+e.strokeThickness;e.dropShadow&&(u+=e.dropShadowDistance);const c=e.lineHeight||s.fontSize+e.strokeThickness;let d=Math.max(c,s.fontSize+2*e.strokeThickness)+(a.length-1)*(c+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new Au(t,e,u,d,a,l,c+e.leading,h,s)}static _measureText(t,e,r){let n=!1;Au.experimentalLetterSpacingSupported&&(Au.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let i=r.measureText(t).width;return i>0&&(n?i-=e:i+=(Au.graphemeSegmenter(t).length-1)*e),i}static wordWrap(t,e,r=Au._canvas){const n=r.getContext("2d",Tu);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:h}=e,u=Au.collapseSpaces(h),c=Au.collapseNewlines(h);let d=!u;const f=e.wordWrapWidth+l,p=Au.tokenize(t);for(let m=0;m<p.length;m++){let t=p[m];if(Au.isNewline(t)){if(!c){o+=Au.addLine(s),d=!u,s="",i=0;continue}t=" "}if(u){const e=Au.isBreakingSpace(t),r=Au.isBreakingSpace(s[s.length-1]);if(e&&r)continue}const r=Au.getFromCache(t,l,a,n);if(r>f)if(""!==s&&(o+=Au.addLine(s),s="",i=0),Au.canBreakWords(t,e.breakWords)){const r=Au.wordWrapSplit(t);for(let h=0;h<r.length;h++){let u=r[h],c=u,p=1;for(;r[h+p];){const n=r[h+p];if(Au.canBreakChars(c,n,t,h,e.breakWords))break;u+=n,c=n,p++}h+=p-1;const m=Au.getFromCache(u,l,a,n);m+i>f&&(o+=Au.addLine(s),d=!1,s="",i=0),s+=u,i+=m}}else{s.length>0&&(o+=Au.addLine(s),s="",i=0);const e=m===p.length-1;o+=Au.addLine(t,!e),d=!1,s="",i=0}else r+i>f&&(d=!1,o+=Au.addLine(s),s="",i=0),(s.length>0||!Au.isBreakingSpace(t)||d)&&(s+=t,i+=r)}return o+=Au.addLine(s,!1),o}static addLine(t,e=!0){return t=Au.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,r,n){let i=r[t];return"number"!=typeof i&&(i=Au._measureText(t,e,n)+e,r[t]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!Au.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&Au._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&Au._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if("string"!=typeof t)return e;for(let n=0;n<t.length;n++){const i=t[n],s=t[n+1];Au.isBreakingSpace(i,s)||Au.isNewline(i)?(""!==r&&(e.push(r),r=""),e.push(i)):r+=i}return""!==r&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,i){return!0}static wordWrapSplit(t){return Au.graphemeSegmenter(t)}static measureFont(t){if(Au._fonts[t])return Au._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=Au._canvas,n=Au._context;n.font=t;const i=Au.METRICS_STRING+Au.BASELINE_SYMBOL,s=Math.ceil(n.measureText(i).width);let o=Math.ceil(n.measureText(Au.BASELINE_SYMBOL).width);const a=Math.ceil(Au.HEIGHT_MULTIPLIER*o);if(o=o*Au.BASELINE_MULTIPLIER|0,0===s||0===a)return Au._fonts[t]=e,e;r.width=s,r.height=a,n.fillStyle="#f00",n.fillRect(0,0,s,a),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,o);const l=n.getImageData(0,0,s,a).data,h=l.length,u=4*s;let c=0,d=0,f=!1;for(c=0;c<o;++c){for(let t=0;t<u;t+=4)if(255!==l[d+t]){f=!0;break}if(f)break;d+=u}for(e.ascent=o-c,d=h-u,f=!1,c=a;c>o;--c){for(let t=0;t<u;t+=4)if(255!==l[d+t]){f=!0;break}if(f)break;d-=u}return e.descent=c-o,e.fontSize=e.ascent+e.descent,Au._fonts[t]=e,e}static clearMetrics(t=""){t?delete Au._fonts[t]:Au._fonts={}}static get _canvas(){if(!Au.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",Tu);if(r?.measureText)return Au.__canvas=t,t;e=S.ADAPTER.createCanvas()}catch(t){e=S.ADAPTER.createCanvas()}e.width=e.height=10,Au.__canvas=e}return Au.__canvas}static get _context(){return Au.__context||(Au.__context=Au._canvas.getContext("2d",Tu)),Au.__context}};let wu=Au;wu.METRICS_STRING="|q",wu.BASELINE_SYMBOL="M",wu.BASELINE_MULTIPLIER=1.4,wu.HEIGHT_MULTIPLIER=2,wu.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),wu.experimentalLetterSpacing=!1,wu._fonts={},wu._newlines=[10,13],wu._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Su=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Cu=class{constructor(t){this.styleID=0,this.reset(),Pu(this,t,t)}clone(){const t={};return Pu(t,this,Cu.defaultStyle),new Cu(t)}reset(){Pu(this,Cu.defaultStyle,Cu.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Iu(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Iu(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Iu(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let t=e[r].trim();/([\"\'])[^\'\"]+\1/.test(t)||Su.includes(t)||(t=`"${t}"`),e[r]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let Ru=Cu;function Iu(t){const e=Dt.shared;return Array.isArray(t)?t.map((t=>e.setValue(t).toHex())):e.setValue(t).toHex()}function Pu(t,e,r){for(const n in r)Array.isArray(e[n])?t[n]=e[n].slice():t[n]=e[n]}Ru.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Eu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const Mu={texture:!0,children:!1,baseTexture:!0},Ou=class extends ws{constructor(t,e,r){let n=!1;r||(r=S.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const i=Jr.from(r);i.orig=new qe,i.trim=new qe,super(i),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Ou.defaultResolution??S.RESOLUTION,this._autoResolution=Ou.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return wu.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Z(0,"Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),wu.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=wu.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=n.width,s=n.height,o=n.lines,a=n.lineHeight,l=n.lineWidths,h=n.maxLineWidth,u=n.fontProperties;let c,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const t=e.dropShadow&&0===p,i=t?Math.ceil(Math.max(1,s)+2*e.padding):0,f=i*this._resolution;if(t){r.fillStyle="black",r.strokeStyle="black";const t=e.dropShadowColor,n=e.dropShadowBlur*this._resolution,i=e.dropShadowDistance*this._resolution;r.shadowColor=Dt.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=n,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*i,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*i+f}else r.fillStyle=this._generateFillStyle(e,o,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let m=(a-u.fontSize)/2;a-u.fontSize<0&&(m=0);for(let r=0;r<o.length;r++)c=e.strokeThickness/2,d=e.strokeThickness/2+r*a+u.ascent+m,"right"===e.align?c+=h-l[r]:"center"===e.align&&(c+=(h-l[r])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[r],c+e.padding,d+e.padding-i,!0),e.fill&&this.drawLetterSpacing(o[r],c+e.padding,d+e.padding-i)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const i=this._style.letterSpacing;let s=!1;if(wu.experimentalLetterSpacingSupported&&(wu.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||s)return void(n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r));let o=e;const a=wu.graphemeSegmenter(t);let l=this.context.measureText(t).width,h=0;for(let u=0;u<a.length;++u){const t=a[u];n?this.context.strokeText(t,o,r):this.context.fillText(t,o,r);let e="";for(let r=u+1;r<a.length;++r)e+=a[r];h=this.context.measureText(e).width,o+=l-h+i,l=h}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=de(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-2*n,e.orig.height=e._frame.height-2*n,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(!Array.isArray(n))return n;if(1===n.length)return n[0];let i;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,l=this.canvas.height/this._resolution-s-2*o,h=n.slice(),u=t.fillGradientStops.slice();if(!u.length){const t=h.length+1;for(let e=1;e<t;++e)u.push(e/t)}if(h.unshift(n[0]),u.unshift(0),h.push(n[n.length-1]),u.push(1),t.fillGradientType===Eu.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,l+o);const n=r.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=r.lineHeight*(t-1)+n,o=r.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const c=o+n,d=r.lineHeight*(t+1);let f=c;t+1<e.length&&d<c&&(f=(c+d)/2);const p=(f-a)/l;for(let t=0;t<h.length;t++){let e=0;e="number"==typeof u[t]?u[t]:t/h.length;let r=Math.min(1,Math.max(0,a/l+e*p));r=Number(r.toFixed(5)),i.addColorStop(r,h[t])}}}else{i=this.context.createLinearGradient(o,l/2,a+o,l/2);const t=h.length+1;let e=1;for(let r=0;r<h.length;r++){let n;n="number"==typeof u[r]?u[r]:e/t,i.addColorStop(n,h[r]),e++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},Mu,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Jt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Jt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Ru?t:new Ru(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let Du=Ou;Du.defaultAutoResolution=!0;class Nu{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Fu(t,e){let r=!1;if(t?._textures?.length)for(let n=0;n<t._textures.length;n++)if(t._textures[n]instanceof Jr){const i=t._textures[n].baseTexture;e.includes(i)||(e.push(i),r=!0)}return r}function Lu(t,e){if(t.baseTexture instanceof De){const r=t.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function Bu(t,e){if(t._texture&&t._texture instanceof Jr){const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function ku(t,e){return e instanceof Du&&(e.updateText(!0),!0)}function Uu(t,e){if(e instanceof Ru){const t=e.toFontString();return wu.measureFont(t),!0}return!1}function Gu(t,e){if(t instanceof Du){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function ju(t,e){return t instanceof Ru&&(e.includes(t)||e.push(t),!0)}const Vu=class{constructor(t){this.limiter=new Nu(Vu.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Gu),this.registerFindHook(ju),this.registerFindHook(Fu),this.registerFindHook(Lu),this.registerFindHook(Bu),this.registerUploadHook(ku),this.registerUploadHook(Uu)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,li.system.addOnce(this.tick,this,si.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)li.system.addOnce(this.tick,this,si.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Es)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&li.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Hu=Vu;function zu(t,e){return e instanceof De&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Wu(t,e){if(!(e instanceof du))return!1;const{geometry:r}=e;e.finishPoly(),r.updateBatches();const{batches:n}=r;for(let i=0;i<n.length;i++){const{texture:e}=n[i].style;e&&zu(t,e.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function Xu(t,e){return t instanceof du&&(e.push(t),!0)}Hu.uploadsPerFrame=4,Object.defineProperties(S,{UPLOADS_PER_FRAME:{get(){return Hu.uploadsPerFrame},set(t){Z(0,"settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Hu.uploadsPerFrame=t}}});class Yu extends Hu{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Xu),this.registerUploadHook(zu),this.registerUploadHook(Wu)}}Yu.extension={name:"prepare",type:_e.RendererSystem},xe.add(Yu);new Ke;var Ku="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const $u=new er;class qu extends Fr{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new rn,this.state=we.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Or.from(Ku,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Or.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Or.from(Ku,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const i=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-i,n[1]=n[3]=-s,n[2]=n[4]=1-i,n[5]=n[7]=1-s,r.invalidate();const o=t._texture,a=o.baseTexture,l=a.alphaMode>0,h=t.tileTransform.localTransform,u=t.uvMatrix;let c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==m.CLAMP:a.wrapMode===m.CLAMP&&(a.wrapMode=m.REPEAT));const d=c?this.simpleShader:this.shader,f=o.width,p=o.height,g=t._width,_=t._height;$u.set(h.a*f/g,h.b*f/_,h.c*p/g,h.d*p/_,h.tx/g,h.ty/_),$u.invert(),c?$u.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=$u.toArray(!0),d.uniforms.uColor=Dt.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(r),this.state.blendMode=Ut(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}qu.extension={name:"tilingSprite",type:_e.RendererPlugin},xe.add(qu);const Qu=class{constructor(t,e,r=null){this.linkedSheets=[],this._texture=t instanceof Jr?t:null,this.baseTexture=t instanceof De?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=ge(t,null);return null===r&&(r=parseFloat(e??"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Qu.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const r=Qu.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const t=this._frameKeys[e],r=this._frames[t],n=r.frame;if(n){let e=null,i=null;const s=!1!==r.trimmed&&r.sourceSize?r.sourceSize:r.frame,o=new qe(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);e=r.rotated?new qe(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):new qe(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),!1!==r.trimmed&&r.spriteSourceSize&&(i=new qe(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[t]=new Jr(this.baseTexture,e,o,i,r.rotated?2:0,r.anchor,r.borders),Jr.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Qu.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*Qu.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Ju=Qu;Ju.BATCH_SIZE=1e3;const Zu=["jpg","png","jpeg","avif","webp"];function tc(t,e,r){const n={};if(t.forEach((t=>{n[t]=e})),Object.keys(e.textures).forEach((t=>{n[t]=e.textures[t]})),!r){const r=Q.dirname(t[0]);e.linkedSheets.forEach(((t,i)=>{const s=tc([`${r}/${e.data.meta.related_multi_packs[i]}`],t,!0);Object.assign(n,s)}))}return n}const ec={extension:_e.Asset,cache:{test:t=>t instanceof Ju,getCacheableAssets:(t,e)=>tc(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),n=e.pop();return"json"===r&&Zu.includes(n)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(S.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:_e.LoadParser,priority:Ui.Normal},async testParse(t,e){return".json"===Q.extname(e.src).toLowerCase()&&!!t.frames},async parse(t,e,r){let n=Q.dirname(e.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");let i=n+t.meta.image;i=ms(i,e.src);const s=(await r.load([i]))[i],o=new Ju(s.baseTexture,t,e.src);await o.parse();const a=t?.meta?.related_multi_packs;if(Array.isArray(a)){const t=[];for(const s of a){if("string"!=typeof s)continue;let i=n+s;e.data?.ignoreMultiPack||(i=ms(i,e.src),t.push(r.load({src:i,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(t);o.linkedSheets=i,i.forEach((t=>{t.linkedSheets=[o].concat(o.linkedSheets.filter((e=>e!==t)))}))}return o},unload(t){t.destroy(!0)}}};xe.add(ec);class rc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class nc{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const i in e){const t=e[i].match(/^[a-z]+/gm)[0],n=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const e in n){const t=n[e].split("="),r=t[0],i=t[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;s[r]=a}r[t].push(s)}const n=new rc;return r.info.forEach((t=>n.info.push({face:t.face,size:parseInt(t.size,10)}))),r.common.forEach((t=>n.common.push({lineHeight:parseInt(t.lineHeight,10)}))),r.page.forEach((t=>n.page.push({id:parseInt(t.id,10),file:t.file}))),r.char.forEach((t=>n.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),r.kerning.forEach((t=>n.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),r.distanceField.forEach((t=>n.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),n}}class ic{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new rc,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(let l=0;l<i.length;l++)e.page.push({id:parseInt(i[l].getAttribute("id"),10)||0,file:i[l].getAttribute("file")});for(let l=0;l<s.length;l++){const t=s[l];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let l=0;l<o.length;l++)e.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(let l=0;l<a.length;l++)e.distanceField.push({fieldType:a[l].getAttribute("fieldType"),distanceRange:parseInt(a[l].getAttribute("distanceRange"),10)});return e}}class sc{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&ic.test(S.ADAPTER.parseXML(t))}static parse(t){return ic.parse(S.ADAPTER.parseXML(t))}}const oc=[nc,ic,sc];function ac(t,e,r,n,i,s,o){const a=r.text,l=r.fontProperties;e.translate(n,i),e.scale(s,s);const h=o.strokeThickness/2,u=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,r,n,i,s){const o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=r.dropShadow?r.dropShadowDistance:0,h=r.padding||0,u=t.width/n-l-2*h,c=t.height/n-l-2*h,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===Eu.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,h,u/2,c+h);let t=0;const n=(s.fontProperties.fontSize+r.strokeThickness)/c;for(let e=0;e<i.length;e++){const r=s.lineHeight*e;for(let e=0;e<d.length;e++){let i=0;i="number"==typeof f[e]?f[e]:e/d.length;const s=r/c+i*n;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(h,c/2,u+h,c/2);const t=d.length+1;let r=1;for(let e=0;e<d.length;e++){let n;n="number"==typeof f[e]?f[e]:r/t,a.addColorStop(n,d[e]),r++}}return a}(t,e,o,s,[a],r),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,r=o.dropShadowBlur*s,n=o.dropShadowDistance*s;e.shadowColor=Dt.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*n,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*n}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,h,u+r.lineHeight-l.descent),o.fill&&e.fillText(a,h,u+r.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function lc(t){return Array.from?Array.from(t):t.split("")}function hc(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const uc=class{constructor(t,e,r){const[n]=t.info,[i]=t.common,[s]=t.page,[o]=t.distanceField,a=ge(s.file),l={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=i.lineHeight/a,this.chars={},this.pageTextures=l;for(let h=0;h<t.page.length;h++){const{id:r,file:n}=t.page[h];l[r]=e instanceof Array?e[h]:e[n],o?.fieldType&&"none"!==o.fieldType&&(l[r].baseTexture.alphaMode=_.NO_PREMULTIPLIED_ALPHA,l[r].baseTexture.mipmap=g.OFF)}for(let h=0;h<t.char.length;h++){const{id:e,page:r}=t.char[h];let{x:n,y:i,width:s,height:o,xoffset:u,yoffset:c,xadvance:d}=t.char[h];n/=a,i/=a,s/=a,o/=a,u/=a,c/=a,d/=a;const f=new qe(n+l[r].frame.x/a,i+l[r].frame.y/a,s,o);this.chars[e]={xOffset:u,yOffset:c,xAdvance:d,kerning:{},texture:new Jr(l[r].baseTexture,f),page:r}}for(let h=0;h<t.kerning.length;h++){let{first:e,second:r,amount:n}=t.kerning[h];e/=a,r/=a,n/=a,this.chars[r]&&(this.chars[r].kerning[e]=n)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let n;if(t instanceof rc)n=t;else{const e=function(t){for(let e=0;e<oc.length;e++)if(oc[e].test(t))return oc[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");n=e.parse(t)}e instanceof Jr&&(e=[e]);const i=new uc(n,e,r);return uc.available[i.font]=i,i}static uninstall(t){const e=uc.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete uc.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:i,resolution:s,textureWidth:o,textureHeight:a,...l}=Object.assign({},uc.defaultOptions,r),h=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let r=0,n=t.length;r<n;r++){const n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const t=n[0].charCodeAt(0),r=n[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let n=t,i=r;n<=i;n++)e.push(String.fromCharCode(n))}else e.push(...lc(n))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(n),u=e instanceof Ru?e:new Ru(e),c=o,d=new rc;d.info[0]={face:u.fontFamily,size:u.fontSize},d.common[0]={lineHeight:u.fontSize};let f,p,m,g=0,_=0,y=0;const v=[],x=[];for(let E=0;E<h.length;E++){f||(f=S.ADAPTER.createCanvas(),f.width=o,f.height=a,p=f.getContext("2d"),m=new De(f,{resolution:s,...l}),v.push(m),x.push(new Jr(m)),d.page.push({id:x.length-1,file:""}));const t=h[E],e=wu.measureText(t,u,!1,f),r=e.width,n=Math.ceil(e.height),b=Math.ceil(("italic"===u.fontStyle?2:1)*r);if(_>=a-n*s){if(0===_)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--E,f=null,p=null,m=null,_=0,g=0,y=0;continue}if(y=Math.max(n+e.fontProperties.descent,y),b*s+g>=c){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${t}')`);--E,_+=y*s,_=Math.ceil(_),g=0,y=0;continue}ac(f,p,e,g,_,s,u);const T=hc(e.text);d.char.push({id:T,page:x.length-1,x:g/s,y:_/s,width:b,height:n,xoffset:0,yoffset:0,xadvance:r-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),g+=(b+2*i)*s,g=Math.ceil(g)}for(let E=0,T=h.length;E<T;E++){const t=h[E];for(let e=0;e<T;e++){const r=h[e],n=p.measureText(t).width,i=p.measureText(r).width,s=p.measureText(t+r).width-(n+i);s&&d.kerning.push({first:hc(t),second:hc(r),amount:s})}}const b=new uc(d,x,!0);return void 0!==uc.available[t]&&uc.uninstall(t),uc.available[t]=b,b}};let cc=uc;cc.ALPHA=[["a","z"],["A","Z"]," "],cc.NUMERIC=[["0","9"]],cc.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],cc.ASCII=[[" ","~"]],cc.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:uc.ALPHANUMERIC},cc.available={};const dc=[],fc=[],pc=[],mc=class extends Es{constructor(t,e={}){super();const{align:r,tint:n,maxWidth:i,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},mc.styleDefaults,e);if(!cc.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new Dt(n),this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new ur((()=>{this.dirty=!0}),this,0,0),this._roundPixels=S.ROUND_PIXELS,this.dirty=!0,this._resolution=S.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=cc.available[this._fontName],e=this.fontSize,r=e/t.size,n=new Ke,i=[],s=[],o=[],a=lc(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*t.size/e,u="none"===t.distanceFieldType?dc:fc;let c=null,d=0,f=0,p=0,m=-1,g=0,_=0,y=0,v=0;for(let l=0;l<a.length;l++){const e=a[l],r=hc(e);if(/(?:\s)/.test(e)&&(m=l,g=d,v++),"\r"===e||"\n"===e){s.push(d),o.push(-1),f=Math.max(f,d),++p,++_,n.x=0,n.y+=t.lineHeight,c=null,v=0;continue}const u=t.chars[r];if(!u)continue;c&&u.kerning[c]&&(n.x+=u.kerning[c]);const x=pc.pop()||{texture:Jr.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ke};x.texture=u.texture,x.line=p,x.charCode=r,x.position.x=Math.round(n.x+u.xOffset+this._letterSpacing/2),x.position.y=Math.round(n.y+u.yOffset),x.prevSpaces=v,i.push(x),d=x.position.x+Math.max(u.xAdvance-u.xOffset,u.texture.orig.width),n.x+=u.xAdvance+this._letterSpacing,y=Math.max(y,u.yOffset+u.texture.height),c=r,-1!==m&&h>0&&n.x>h&&(++_,Qt(i,1+m-_,1+l-m),l=m,m=-1,s.push(g),o.push(i.length>0?i[i.length-1].prevSpaces:0),f=Math.max(f,g),p++,n.x=0,n.y+=t.lineHeight,c=null,v=0)}const x=a[a.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=g),s.push(d),f=Math.max(f,d),o.push(-1));const b=[];for(let l=0;l<=p;l++){let t=0;"right"===this._align?t=f-s[l]:"center"===this._align?t=(f-s[l])/2:"justify"===this._align&&(t=o[l]<0?0:(f-s[l])/o[l]),b.push(t)}const E=i.length,T={},A=[],w=this._activePagesMeshData;u.push(...w);for(let S=0;S<E;S++){const e=i[S].texture,r=e.baseTexture.uid;if(!T[r]){let n=u.pop();if(!n){const e=new yu;let r,i;"none"===t.distanceFieldType?(r=new vu(Jr.EMPTY),i=l.NORMAL):(r=new vu(Jr.EMPTY,{program:Ir.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),i=l.NORMAL_NPM);const s=new _u(e,r);s.blendMode=i,n={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}n.index=0,n.indexCount=0,n.vertexCount=0,n.uvsCount=0,n.total=0;const{_textureCache:i}=this;i[r]=i[r]||new Jr(e.baseTexture),n.mesh.texture=i[r],n.mesh.tint=this._tintColor.value,A.push(n),T[r]=n}T[r].total++}for(let l=0;l<w.length;l++)A.includes(w[l])||this.removeChild(w[l].mesh);for(let l=0;l<A.length;l++)A[l].mesh.parent!==this&&this.addChild(A[l].mesh);this._activePagesMeshData=A;for(const l in T){const t=T[l],e=t.total;if(!(t.indices?.length>6*e)||t.vertices.length<2*_u.BATCHABLE_SIZE)t.vertices=new Float32Array(8*e),t.uvs=new Float32Array(8*e),t.indices=new Uint16Array(6*e);else{const e=t.total,r=t.vertices;for(let t=4*e*2;t<r.length;t++)r[t]=0}t.mesh.size=6*e}for(let l=0;l<E;l++){const t=i[l];let e=t.position.x+b[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const n=e*r,s=t.position.y*r,o=t.texture,a=T[o.baseTexture.uid],h=o.frame,u=o._uvs,c=a.index++;a.indices[6*c+0]=0+4*c,a.indices[6*c+1]=1+4*c,a.indices[6*c+2]=2+4*c,a.indices[6*c+3]=0+4*c,a.indices[6*c+4]=2+4*c,a.indices[6*c+5]=3+4*c,a.vertices[8*c+0]=n,a.vertices[8*c+1]=s,a.vertices[8*c+2]=n+h.width*r,a.vertices[8*c+3]=s,a.vertices[8*c+4]=n+h.width*r,a.vertices[8*c+5]=s+h.height*r,a.vertices[8*c+6]=n,a.vertices[8*c+7]=s+h.height*r,a.uvs[8*c+0]=u.x0,a.uvs[8*c+1]=u.y0,a.uvs[8*c+2]=u.x1,a.uvs[8*c+3]=u.y1,a.uvs[8*c+4]=u.x2,a.uvs[8*c+5]=u.y2,a.uvs[8*c+6]=u.x3,a.uvs[8*c+7]=u.y3}this._textWidth=f*r,this._textHeight=(n.y+t.lineHeight)*r;for(const l in T){const t=T[l];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const r=this._textWidth*this.anchor.x,n=this._textHeight*this.anchor.y;for(let i=0;i<t.total;i++)t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n}this._maxLineHeight=y*r;const e=t.mesh.geometry.getBuffer("aVertexPosition"),n=t.mesh.geometry.getBuffer("aTextureCoord"),i=t.mesh.geometry.getIndex();e.data=t.vertices,n.data=t.uvs,i.data=t.indices,e.update(),n.update(),i.update()}for(let l=0;l<i.length;l++)pc.push(i[l]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=cc.available[this._fontName];if("none"!==r){const{a:r,b:i,c:s,d:o}=this.worldTransform,a=Math.sqrt(r*r+i*i),l=Math.sqrt(s*s+o*o),h=(Math.abs(a)+Math.abs(l))/2,u=this.fontSize/n,c=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=h*e*u*c}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=cc.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!cc.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??cc.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===cc.available[this._fontName].distanceFieldType?dc:fc;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Jr.EMPTY}));for(const n in e){e[n].destroy(),delete e[n]}this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};mc.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const gc=[".xml",".fnt"],_c={extension:{type:_e.LoadParser,priority:Ui.Normal},name:"loadBitmapFont",test(t){return gc.includes(Q.extname(t).toLowerCase())},async testParse(t){return nc.test(t)||sc.test(t)},async parse(t,e,r){const n=nc.test(t)?nc.parse(t):sc.parse(t),{src:i}=e,{page:s}=n,o=[];for(let h=0;h<s.length;++h){const t=s[h].file;let e=Q.join(Q.dirname(i),t);e=ms(e,i),o.push(e)}const a=await r.load(o),l=o.map((t=>a[t]));return cc.install(n,l,!0)},async load(t,e){return(await S.ADAPTER.fetch(t)).text()},unload(t){t.destroy()}};xe.add(_c);const yc=class extends Ru{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new yc(Object.keys(yc.defaultOptions).reduce(((e,r)=>({...e,[r]:t[r]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts["delete"](t.fontFace),delete yc.availableFonts[t.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=yc;if(r[t]){const e=r[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return S.ADAPTER.fetch(t).then((t=>t.blob())).then((async t=>new Promise(((e,r)=>{const n=URL.createObjectURL(t),i=new FileReader;i.onload=()=>e([n,i.result]),i.onerror=r,i.readAsDataURL(t)})))).then((async([n,i])=>{const s=Object.assign({family:Q.basename(t,Q.extname(t)),weight:"normal",style:"normal",src:n,dataSrc:i,refs:1,originalUrl:t,fontFace:null},e);r[t]=s,this._fonts.push(s),this.styleID++;const o=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style}; \n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Bt(t)),"number"==typeof t?Ft(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const i=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${i} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${i} ${t}`}reset(){Object.assign(this,yc.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=S.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){}get fillGradientType(){return super.fillGradientType}set miterLimit(t){}get miterLimit(){return super.miterLimit}set trim(t){}get trim(){return super.trim}set textBaseline(t){}get textBaseline(){return super.textBaseline}set leading(t){}get leading(){return super.leading}set lineJoin(t){}get lineJoin(){return super.lineJoin}};let vc=yc;vc.availableFonts={},vc.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const xc=class extends ws{constructor(t="",e={}){super(Jr.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const r=new Image,n=Jr.from(r,{scaleMode:S.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new qe,n.trim=new qe,this.texture=n;const i="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg"),a=document.createElementNS(i,"foreignObject"),l=document.createElementNS(s,"div"),h=document.createElementNS(s,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",o.appendChild(a),this.maxWidth=xc.defaultMaxWidth,this.maxHeight=xc.defaultMaxHeight,this._domElement=l,this._styleElement=h,this._svgRoot=o,this._foreignObject=a,this._foreignObject.appendChild(h),this._foreignObject.appendChild(l),this._image=r,this._loadImage=new Image,this._autoResolution=xc.defaultAutoResolution,this._resolution=xc.defaultResolution??S.RESOLUTION,this.text=t,this.style=e}measureText(t){const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const i=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(i.width)),o=Math.min(this.maxHeight,Math.ceil(i.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",o.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(n)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:s+2*r.padding,height:o+2*r.padding}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:i,height:s}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,i)),r.height=n.height=Math.ceil(Math.max(1,s)),this._loading||(this._loading=!0,await new Promise((t=>{n.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,r.src=n.src,n.onload=null,n.src="",this.updateTexture(),t()};const i=(new XMLSerializer).serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(i)}`})))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:i}=t,{baseTexture:s}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},xc.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=e,this._svgRoot?.remove(),this._svgRoot=e,this._domElement?.remove(),this._domElement=e,this._foreignObject?.remove(),this._foreignObject=e,this._styleElement?.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Jt(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Jt(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof vc?(this.ownsStyle=!1,this._style=t):t instanceof Ru?(this.ownsStyle=!0,this._style=vc.from(t)):(this.ownsStyle=!0,this._style=new vc(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let bc=xc;bc.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},bc.defaultMaxWidth=2024,bc.defaultMaxHeight=2024,bc.defaultAutoResolution=!0;var Ec=Object.defineProperty,Tc=(t,e,r)=>(((t,e,r)=>{e in t?Ec(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);class Ac extends Ve{constructor(t=!1){super(),Tc(this,"_buffer"),Tc(this,"_indexBuffer"),this._buffer=new Le(null,t,!1),this._indexBuffer=new Le(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,d.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,d.FLOAT).addAttribute("aColor",this._buffer,4,!0,d.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,d.FLOAT).addAttribute("aFWidth",this._buffer,1,!0,d.FLOAT).addIndex(this._indexBuffer)}}var wc,Sc,Cc,Rc=Object.defineProperty;class Ic extends Br{constructor(t){super(t),this.shaderGenerator=new Dr("precision highp float;\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aColor;\r\nattribute float aTextureId;\r\nattribute float aFWidth;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform vec4 tint;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\nvarying float vTextureId;\r\nvarying float vFWidth;\r\n\r\nvoid main(void) {\r\n  gl_Position = vec4(\r\n      (projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy,\r\n      0.0, 1.0);\r\n\r\n  vTextureCoord = aTextureCoord;\r\n  vTextureId = aTextureId;\r\n  vFWidth = aFWidth;\r\n  vColor = aColor * tint;\r\n}","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nvarying float vTextureId;\r\nuniform sampler2D uSamplers[%count%];\r\n\r\n// Tint\r\nvarying vec4 vColor;\r\n\r\n// fwidth equivalent smoothing factor (in our case, spread * scale)\r\nvarying float vFWidth;\r\n\r\nvoid main(void) {\r\n  vec4 color;\r\n\r\n  %forloop%\r\n\r\n  float smoothing = vFWidth;\r\n\r\n  // un-pre multiplying alpha\r\n  // This _could_ be dangerous if alpha is 0 but we have a min ahead in the code\r\n  // so if alpha is 0 we will take that 0 and be happy.\r\n  color.rgb /= color.a;\r\n\r\n  // MSDF\r\n  float median = color.r + color.g + color.b -\r\n                 min(color.r, min(color.g, color.b)) -\r\n                 max(color.r, max(color.g, color.b));\r\n  // SDF\r\n  median = min(median, color.a);\r\n\r\n  float screenPxDistance = vFWidth*(median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n\r\n  gl_FragColor = vec4(vColor * alpha);\r\n}"),this.geometryClass=Ac,this.vertexSize=7}packInterleavedGeometry(t,e,r,n,i){const{uint32View:s,float32View:o}=e,a=n/this.vertexSize,l=t.uvs,h=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?jt(t._tintRGB,d):t._tintRGB+(255*d<<24),{a:p,b:m,c:g,d:_}=t.worldTransform,y=Math.sqrt(p*p+m*m),v=Math.sqrt(g*g+_*_),x=(Math.abs(y)+Math.abs(v))/2*t.range*this.renderer.resolution;for(let b=0;b<u.length;b+=2)o[n++]=u[b],o[n++]=u[b+1],o[n++]=l[b],o[n++]=l[b+1],s[n++]=f,o[n++]=c,o[n++]=x;for(let b=0;b<h.length;b++)r[i++]=a+h[b]}}let Pc;function Mc(){return Pc}wc=Ic,Sc="extension",Cc={name:"mtsdf",type:_e.RendererPlugin},((t,e,r)=>{e in t?Rc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(wc,"symbol"!=typeof Sc?Sc+"":Sc,Cc);let Oc=0;const Dc=class extends W{constructor(t){super(),this.id=Oc++,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"paused":this.paused=e;break;case"loop":this.loop=e;break;case"muted":this.muted=e}return this}get progress(){const{currentTime:t}=this._source;return t/this._duration}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}_onPlay(){this._playing=!0}_onPause(){this._playing=!1}init(t){this._playing=!1,this._duration=t.source.duration;const e=this._source=t.source.cloneNode(!1);e.src=t.parent.url,e.onplay=this._onPlay.bind(this),e.onpause=this._onPause.bind(this),t.context.on("refresh",this.refresh,this),t.context.on("refreshPaused",this.refreshPaused,this),this._media=t}_internalStop(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())}stop(){this._internalStop(),this._source&&this.emit("stop")}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get filters(){return null}set filters(t){}refresh(){const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const r=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*r*n,this._source.playbackRate=this._speed*t.speed*e.speed}refreshPaused(){const t=this._media.context,e=this._media.parent,r=this._paused||e.paused||t.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",r))}play(t){const{start:e,end:r,speed:n,loop:i,volume:s,muted:o}=t;this._speed=n,this._volume=s,this._loop=!!i,this._muted=o,this.refresh(),this.loop&&null!==r&&(this.loop=!1),this._start=e,this._end=r||this._duration,this._start=Math.max(0,this._start-Dc.PADDING),this._end=Math.min(this._end+Dc.PADDING,this._duration),this._source.onloadedmetadata=()=>{this._source&&(this._source.currentTime=e,this._source.onloadedmetadata=null,this.emit("progress",e,this._duration),li.shared.add(this._onUpdate,this))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")}_onUpdate(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()}_onComplete(){li.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)}destroy(){li.shared.remove(this._onUpdate,this),this.removeAllListeners();const t=this._source;t&&(t.onended=null,t.onplay=null,t.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)}toString(){return`[HTMLAudioInstance id=${this.id}]`}};let Nc=Dc;Nc.PADDING=.1;class Fc extends W{init(t){this.parent=t,this._source=t.options.source||new Audio,t.url&&(this._source.src=t.url)}create(){return new Nc(this)}get isPlayable(){return!!this._source&&4===this._source.readyState}get duration(){return this._source.duration}get context(){return this.parent.context}get filters(){return null}set filters(t){}destroy(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)}get source(){return this._source}load(t){const e=this._source,r=this.parent;if(4===e.readyState){r.isLoaded=!0;const e=r.autoPlayStart();return void(t&&setTimeout((()=>{t(null,r,e)}),0))}if(!r.url)return void t(new Error("sound.url or sound.source must be set"));e.src=r.url;const n=()=>{o(),r.isLoaded=!0;const e=r.autoPlayStart();t&&t(null,r,e)},i=()=>{o(),t&&t(new Error("Sound loading has been aborted"))},s=()=>{o();const r=`Failed to load audio element (code: ${e.error.code})`;t&&t(new Error(r))},o=()=>{e.removeEventListener("canplaythrough",n),e.removeEventListener("load",n),e.removeEventListener("abort",i),e.removeEventListener("error",s)};e.addEventListener("canplaythrough",n,!1),e.addEventListener("load",n,!1),e.addEventListener("abort",i,!1),e.addEventListener("error",s,!1),e.load()}}class Lc{constructor(t,e){this.parent=t,Object.assign(this,e),this.duration=this.end-this.start}play(t){return this.parent.play({complete:t,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})}destroy(){this.parent=null}}const Bc=["ogg","oga","opus","m4a","mp3","mpeg","wav","aiff","wma","mid","caf"],kc={};!function(t){const e={m4a:"audio/mp4",oga:"audio/ogg",opus:'audio/ogg; codecs="opus"',caf:'audio/x-caf; codecs="opus"',...t||{}},r=document.createElement("audio"),n={},i=/^no$/;Bc.forEach((t=>{const s=r.canPlayType(`audio/${t}`).replace(i,""),o=e[t]?r.canPlayType(e[t]).replace(i,""):"";n[t]=!!s||!!o})),Object.assign(kc,n)}();class Uc{static setParamValue(t,e){if(t.setValueAtTime){const r=Mc().context;t.setValueAtTime(e,r.audioContext.currentTime)}else t.value=e;return e}}let Gc=0;class jc extends W{constructor(t){super(),this.id=Gc++,this._media=null,this._paused=!1,this._muted=!1,this._elapsed=0,this.init(t)}set(t,e){if(void 0===this[t])throw new Error(`Property with name ${t} does not exist.`);switch(t){case"speed":this.speed=e;break;case"volume":this.volume=e;break;case"muted":this.muted=e;break;case"loop":this.loop=e;break;case"paused":this.paused=e}return this}stop(){this._source&&(this._internalStop(),this.emit("stop"))}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh(),this._update(!0)}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}get filters(){return this._filters}set filters(t){this._filters&&(this._filters?.filter((t=>t)).forEach((t=>t.disconnect())),this._filters=null,this._source.connect(this._gain)),this._filters=t?.length?t.slice(0):null,this.refresh()}refresh(){if(!this._source)return;const t=this._media.context,e=this._media.parent;this._source.loop=this._loop||e.loop;const r=t.volume*(t.muted?0:1),n=e.volume*(e.muted?0:1),i=this._volume*(this._muted?0:1);Uc.setParamValue(this._gain.gain,i*n*r),Uc.setParamValue(this._source.playbackRate,this._speed*e.speed*t.speed),this.applyFilters()}applyFilters(){if(this._filters?.length){this._source.disconnect();let t=this._source;this._filters.forEach((e=>{t.connect(e.destination),t=e})),t.connect(this._gain)}}refreshPaused(){const t=this._media.context,e=this._media.parent,r=this._paused||e.paused||t.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",r))}play(t){const{start:e,end:r,speed:n,loop:i,volume:s,muted:o,filters:a}=t;this._paused=!1;const{source:l,gain:h}=this._media.nodes.cloneBufferSource();this._source=l,this._gain=h,this._speed=n,this._volume=s,this._loop=!!i,this._muted=o,this._filters=a,this.refresh();const u=this._source.buffer.duration;this._duration=u,this._end=r,this._lastUpdate=this._now(),this._elapsed=e,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=r,this._source.loopStart=e,this._source.start(0,e)):r?this._source.start(0,e,r-e):this._source.start(0,e),this.emit("start"),this._update(!0),this.enableTicker(!0)}enableTicker(t){li.shared.remove(this._updateListener,this),t&&li.shared.add(this._updateListener,this)}get progress(){return this._progress}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}destroy(){this.removeAllListeners(),this._internalStop(),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._filters?.forEach((t=>t.disconnect())),this._filters=null,this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1}toString(){return`[WebAudioInstance id=${this.id}]`}_now(){return this._media.context.audioContext.currentTime}_updateListener(){this._update()}_update(t=!1){if(this._source){const e=this._now(),r=e-this._lastUpdate;if(r>0||t){const t=this._source.playbackRate.value;this._elapsed+=r*t,this._lastUpdate=e;const n=this._duration;let i;if(this._source.loopStart){const t=this._source.loopEnd-this._source.loopStart;i=(this._source.loopStart+this._elapsed%t)/n}else i=this._elapsed%n/n;this._progress=i,this.emit("progress",this._progress,n)}}}init(t){this._media=t,t.context.events.on("refresh",this.refresh,this),t.context.events.on("refreshPaused",this.refreshPaused,this)}_internalStop(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.stop(0),this._source.disconnect();try{this._source.buffer=null}catch(t){}this._source=null}}_onComplete(){if(this._source){this.enableTicker(!1),this._source.onended=null,this._source.disconnect();try{this._source.buffer=null}catch(t){}}this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)}}class Vc{constructor(t,e){this._output=e,this._input=t}get destination(){return this._input}get filters(){return this._filters}set filters(t){if(this._filters&&(this._filters.forEach((t=>{t&&t.disconnect()})),this._filters=null,this._input.connect(this._output)),t&&t.length){this._filters=t.slice(0),this._input.disconnect();let e=null;t.forEach((t=>{null===e?this._input.connect(t.destination):e.connect(t.destination),e=t})),e.connect(this._output)}}destroy(){this.filters=null,this._input=null,this._output=null}}const Hc=class extends Vc{constructor(t){const e=t.audioContext,r=e.createBufferSource(),n=e.createGain(),i=e.createAnalyser();r.connect(i),i.connect(n),n.connect(t.destination),super(i,n),this.context=t,this.bufferSource=r,this.gain=n,this.analyser=i}get script(){return this._script||(this._script=this.context.audioContext.createScriptProcessor(Hc.BUFFER_SIZE),this._script.connect(this.context.destination)),this._script}destroy(){super.destroy(),this.bufferSource.disconnect(),this._script&&this._script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this._script=null,this.gain=null,this.analyser=null,this.context=null}cloneBufferSource(){const t=this.bufferSource,e=this.context.audioContext.createBufferSource();e.buffer=t.buffer,Uc.setParamValue(e.playbackRate,t.playbackRate.value),e.loop=t.loop;const r=this.context.audioContext.createGain();return e.connect(r),r.connect(this.destination),{source:e,gain:r}}get bufferSize(){return this.script.bufferSize}};let zc=Hc;zc.BUFFER_SIZE=0;class Wc{init(t){this.parent=t,this._nodes=new zc(this.context),this._source=this._nodes.bufferSource,this.source=t.options.source}destroy(){this.parent=null,this._nodes.destroy(),this._nodes=null;try{this._source.buffer=null}catch(t){}this._source=null,this.source=null}create(){return new jc(this)}get context(){return this.parent.context}get isPlayable(){return!!this._source&&!!this._source.buffer}get filters(){return this._nodes.filters}set filters(t){this._nodes.filters=t}get duration(){return this._source.buffer.duration}get buffer(){return this._source.buffer}set buffer(t){this._source.buffer=t}get nodes(){return this._nodes}load(t){this.source?this._decode(this.source,t):this.parent.url?this._loadUrl(t):t&&t(new Error("sound.url or sound.source must be set"))}async _loadUrl(t){const e=this.parent.url,r=await S.ADAPTER.fetch(e);this._decode(await r.arrayBuffer(),t)}_decode(t,e){const r=(t,r)=>{if(t)e&&e(t);else{this.parent.isLoaded=!0,this.buffer=r;const t=this.parent.autoPlayStart();e&&e(null,this.parent,t)}};if(t instanceof AudioBuffer)r(null,t);else{this.parent.context.decode(t,r)}}}const Xc=class{static from(t){let e={};"string"==typeof t?e.url=t:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?e.source=t:Array.isArray(t)?e.url=t:e=t,e={autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1,...e},Object.freeze(e);const r=Mc().useLegacy?new Fc:new Wc;return new Xc(r,e)}constructor(t,e){this.media=t,this.options=e,this._instances=[],this._sprites={},this.media.init(this);const r=e.complete;this._autoPlayOptions=r?{complete:r}:null,this.isLoaded=!1,this._preloadQueue=null,this.isPlaying=!1,this.autoPlay=e.autoPlay,this.singleInstance=e.singleInstance,this.preload=e.preload||this.autoPlay,this.url=Array.isArray(e.url)?this.preferUrl(e.url):e.url,this.speed=e.speed,this.volume=e.volume,this.loop=e.loop,e.sprites&&this.addSprites(e.sprites),this.preload&&this._preload(e.loaded)}preferUrl(t){const[{url:e}]=t.map((t=>({url:t,ext:Q.extname(t).slice(1)}))).sort(((t,e)=>Bc.indexOf(t.ext)-Bc.indexOf(e.ext)));return e}get context(){return Mc().context}pause(){return this.isPlaying=!1,this.paused=!0,this}resume(){return this.isPlaying=this._instances.length>0,this.paused=!1,this}get paused(){return this._paused}set paused(t){this._paused=t,this.refreshPaused()}get speed(){return this._speed}set speed(t){this._speed=t,this.refresh()}get filters(){return this.media.filters}set filters(t){this.media.filters=t}addSprites(t,e){if("object"==typeof t){const e={};for(const r in t)e[r]=this.addSprites(r,t[r]);return e}const r=new Lc(this,e);return this._sprites[t]=r,r}destroy(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null}removeSprites(t){if(t){const e=this._sprites[t];void 0!==e&&(e.destroy(),delete this._sprites[t])}else for(const e in this._sprites)this.removeSprites(e);return this}get isPlayable(){return this.isLoaded&&this.media&&this.media.isPlayable}stop(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(let t=this._instances.length-1;t>=0;t--)this._instances[t].stop();return this}play(t,e){let r;if("string"==typeof t){r={sprite:t,loop:this.loop,complete:e}}else"function"==typeof t?(r={},r.complete=t):r=t;if(r={complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1,...r||{}},r.sprite){const t=r.sprite,e=this._sprites[t];r.start=e.start+(r.start||0),r.end=e.end,r.speed=e.speed||1,r.loop=e.loop||r.loop,delete r.sprite}if(r.offset&&(r.start=r.offset),!this.isLoaded)return this._preloadQueue?new Promise((t=>{this._preloadQueue.push((()=>{t(this.play(r))}))})):(this._preloadQueue=[],this.autoPlay=!0,this._autoPlayOptions=r,new Promise(((t,e)=>{this._preload(((n,i,s)=>{this._preloadQueue.forEach((t=>t())),this._preloadQueue=null,n?e(n):(r.loaded&&r.loaded(n,i,s),t(s))}))})));(this.singleInstance||r.singleInstance)&&this._removeInstances();const n=this._createInstance();return this._instances.push(n),this.isPlaying=!0,n.once("end",(()=>{r.complete&&r.complete(this),this._onComplete(n)})),n.once("stop",(()=>{this._onComplete(n)})),n.play(r),n}refresh(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refresh()}refreshPaused(){const t=this._instances.length;for(let e=0;e<t;e++)this._instances[e].refreshPaused()}get volume(){return this._volume}set volume(t){this._volume=t,this.refresh()}get muted(){return this._muted}set muted(t){this._muted=t,this.refresh()}get loop(){return this._loop}set loop(t){this._loop=t,this.refresh()}_preload(t){this.media.load(t)}get instances(){return this._instances}get sprites(){return this._sprites}get duration(){return this.media.duration}autoPlayStart(){let t;return this.autoPlay&&(t=this.play(this._autoPlayOptions)),t}_removeInstances(){for(let t=this._instances.length-1;t>=0;t--)this._poolInstance(this._instances[t]);this._instances.length=0}_onComplete(t){if(this._instances){const e=this._instances.indexOf(t);e>-1&&this._instances.splice(e,1),this.isPlaying=this._instances.length>0}this._poolInstance(t)}_createInstance(){if(Xc._pool.length>0){const t=Xc._pool.pop();return t.init(this.media),t}return this.media.create()}_poolInstance(t){t.destroy(),Xc._pool.indexOf(t)<0&&Xc._pool.push(t)}};let Yc=Xc;Yc._pool=[];class Kc extends W{constructor(){super(...arguments),this.speed=1,this.muted=!1,this.volume=1,this.paused=!1}refresh(){this.emit("refresh")}refreshPaused(){this.emit("refreshPaused")}get filters(){return null}set filters(t){}get audioContext(){return null}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this.paused}destroy(){this.removeAllListeners()}}class $c extends Vc{constructor(){const t=window,e=new $c.AudioContext,r=e.createDynamicsCompressor(),n=e.createAnalyser();n.connect(r),r.connect(e.destination),super(n,r),this._ctx=e,this._offlineCtx=new $c.OfflineAudioContext(1,2,t.OfflineAudioContext?Math.max(8e3,Math.min(96e3,e.sampleRate)):44100),this.compressor=r,this.analyser=n,this.events=new W,this.volume=1,this.speed=1,this.muted=!1,this.paused=!1,this._locked="suspended"===e.state&&("ontouchstart"in globalThis||"onclick"in globalThis),this._locked&&(this._unlock(),this._unlock=this._unlock.bind(this),document.addEventListener("mousedown",this._unlock,!0),document.addEventListener("touchstart",this._unlock,!0),document.addEventListener("touchend",this._unlock,!0)),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),globalThis.addEventListener("focus",this.onFocus),globalThis.addEventListener("blur",this.onBlur)}onFocus(){const t=this._ctx.state;"suspended"!==t&&"interrupted"!==t&&this._locked||this._ctx.resume()}onBlur(){this._locked||this._ctx.suspend()}_unlock(){this._locked&&(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._locked=!1))}playEmptySound(){const t=this._ctx.createBufferSource();t.buffer=this._ctx.createBuffer(1,1,22050),t.connect(this._ctx.destination),t.start(0,0,0),"suspended"===t.context.state&&t.context.resume()}static get AudioContext(){const t=window;return t.AudioContext||t.webkitAudioContext||null}static get OfflineAudioContext(){const t=window;return t.OfflineAudioContext||t.webkitOfflineAudioContext||null}destroy(){super.destroy();const t=this._ctx;"undefined"!=typeof t.close&&t.close(),globalThis.removeEventListener("focus",this.onFocus),globalThis.removeEventListener("blur",this.onBlur),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null}get audioContext(){return this._ctx}get offlineContext(){return this._offlineCtx}set paused(t){t&&"running"===this._ctx.state?this._ctx.suspend():t||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=t}get paused(){return this._paused}refresh(){this.events.emit("refresh")}refreshPaused(){this.events.emit("refreshPaused")}toggleMute(){return this.muted=!this.muted,this.refresh(),this.muted}togglePause(){return this.paused=!this.paused,this.refreshPaused(),this._paused}decode(t,e){const r=t=>{e(new Error(t?.message||"Unable to decode file"))},n=this._offlineCtx.decodeAudioData(t,(t=>{e(null,t)}),r);n&&n["catch"](r)}}class qc{constructor(t,e){this.init(t,e)}init(t,e){this.destination=t,this.source=e||t}connect(t){this.source.connect(t)}disconnect(){this.source.disconnect()}destroy(){this.disconnect(),this.destination=null,this.source=null}}const Qc=class extends qc{constructor(t=0,e=0,r=0,n=0,i=0,s=0,o=0,a=0,l=0,h=0){var u=(...t)=>{super(...t)};if(Mc().useLegacy)return void u(null);const c=[{f:Qc.F32,type:"lowshelf",gain:t},{f:Qc.F64,type:"peaking",gain:e},{f:Qc.F125,type:"peaking",gain:r},{f:Qc.F250,type:"peaking",gain:n},{f:Qc.F500,type:"peaking",gain:i},{f:Qc.F1K,type:"peaking",gain:s},{f:Qc.F2K,type:"peaking",gain:o},{f:Qc.F4K,type:"peaking",gain:a},{f:Qc.F8K,type:"peaking",gain:l},{f:Qc.F16K,type:"highshelf",gain:h}].map((t=>{const e=Mc().context.audioContext.createBiquadFilter();return e.type=t.type,Uc.setParamValue(e.Q,1),e.frequency.value=t.f,Uc.setParamValue(e.gain,t.gain),e}));u(c[0],c[c.length-1]),this.bands=c,this.bandsMap={};for(let d=0;d<this.bands.length;d++){const t=this.bands[d];d>0&&this.bands[d-1].connect(t),this.bandsMap[t.frequency.value]=t}}setGain(t,e=0){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);Uc.setParamValue(this.bandsMap[t].gain,e)}getGain(t){if(!this.bandsMap[t])throw new Error(`No band found for frequency ${t}`);return this.bandsMap[t].gain.value}set f32(t){this.setGain(Qc.F32,t)}get f32(){return this.getGain(Qc.F32)}set f64(t){this.setGain(Qc.F64,t)}get f64(){return this.getGain(Qc.F64)}set f125(t){this.setGain(Qc.F125,t)}get f125(){return this.getGain(Qc.F125)}set f250(t){this.setGain(Qc.F250,t)}get f250(){return this.getGain(Qc.F250)}set f500(t){this.setGain(Qc.F500,t)}get f500(){return this.getGain(Qc.F500)}set f1k(t){this.setGain(Qc.F1K,t)}get f1k(){return this.getGain(Qc.F1K)}set f2k(t){this.setGain(Qc.F2K,t)}get f2k(){return this.getGain(Qc.F2K)}set f4k(t){this.setGain(Qc.F4K,t)}get f4k(){return this.getGain(Qc.F4K)}set f8k(t){this.setGain(Qc.F8K,t)}get f8k(){return this.getGain(Qc.F8K)}set f16k(t){this.setGain(Qc.F16K,t)}get f16k(){return this.getGain(Qc.F16K)}reset(){this.bands.forEach((t=>{Uc.setParamValue(t.gain,0)}))}destroy(){this.bands.forEach((t=>{t.disconnect()})),this.bands=null,this.bandsMap=null}};let Jc=Qc;Jc.F32=32,Jc.F64=64,Jc.F125=125,Jc.F250=250,Jc.F500=500,Jc.F1K=1e3,Jc.F2K=2e3,Jc.F4K=4e3,Jc.F8K=8e3,Jc.F16K=16e3;const Zc=t=>{const e=t.src;return t?.alias?.[0]??Q.basename(e,Q.extname(e))},td={extension:_e.Asset,detection:{test:async()=>!0,add:async t=>[...t,...Bc.filter((t=>kc[t]))],remove:async t=>t.filter((e=>t.includes(e)))},loader:{extension:{type:[_e.LoadParser],priority:Ui.High},test(t){const e=Q.extname(t).slice(1);return!!kc[e]},async load(t,e){const r=await new Promise(((r,n)=>Yc.from({...e.data,url:t,preload:!0,loaded(t,i){t?n(t):r(i),e.data?.loaded?.(t,i)}})));return Mc().add(Zc(e),r),r},async unload(t,e){Mc().remove(Zc(e))}}};xe.add(td);const ed=function(t){return Pc=t,t}(new class{constructor(){this.init()}init(){return this.supported&&(this._webAudioContext=new $c),this._htmlAudioContext=new Kc,this._sounds={},this.useLegacy=!this.supported,this}get context(){return this._context}get filtersAll(){return this.useLegacy?[]:this._context.filters}set filtersAll(t){this.useLegacy||(this._context.filters=t)}get supported(){return null!==$c.AudioContext}add(t,e){if("object"==typeof t){const r={};for(const n in t){const i=this._getOptions(t[n],e);r[n]=this.add(n,i)}return r}if(e instanceof Yc)return this._sounds[t]=e,e;const r=this._getOptions(e),n=Yc.from(r);return this._sounds[t]=n,n}_getOptions(t,e){let r;return r="string"==typeof t||Array.isArray(t)?{url:t}:t instanceof ArrayBuffer||t instanceof AudioBuffer||t instanceof HTMLAudioElement?{source:t}:t,r={...r,...e||{}},r}get useLegacy(){return this._useLegacy}set useLegacy(t){this._useLegacy=t,this._context=!t&&this.supported?this._webAudioContext:this._htmlAudioContext}remove(t){return this.exists(t,!0),this._sounds[t].destroy(),delete this._sounds[t],this}get volumeAll(){return this._context.volume}set volumeAll(t){this._context.volume=t,this._context.refresh()}get speedAll(){return this._context.speed}set speedAll(t){this._context.speed=t,this._context.refresh()}togglePauseAll(){return this._context.togglePause()}pauseAll(){return this._context.paused=!0,this._context.refreshPaused(),this}resumeAll(){return this._context.paused=!1,this._context.refreshPaused(),this}toggleMuteAll(){return this._context.toggleMute()}muteAll(){return this._context.muted=!0,this._context.refresh(),this}unmuteAll(){return this._context.muted=!1,this._context.refresh(),this}removeAll(){for(const t in this._sounds)this._sounds[t].destroy(),delete this._sounds[t];return this}stopAll(){for(const t in this._sounds)this._sounds[t].stop();return this}exists(t,e=!1){return!!this._sounds[t]}isPlaying(){for(const t in this._sounds)if(this._sounds[t].isPlaying)return!0;return!1}find(t){return this.exists(t,!0),this._sounds[t]}play(t,e){return this.find(t).play(e)}stop(t){return this.find(t).stop()}pause(t){return this.find(t).pause()}resume(t){return this.find(t).resume()}volume(t,e){const r=this.find(t);return void 0!==e&&(r.volume=e),r.volume}speed(t,e){const r=this.find(t);return void 0!==e&&(r.speed=e),r.speed}duration(t){return this.find(t).duration}close(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this}});const rd=["msdf","mtsdf","sdf"],nd={extension:_e.Asset,loader:{extension:{type:_e.LoadParser,priority:Ui.Normal},testParse(t,e){return Promise.resolve(e.src.includes(".json")&&id.test(t))},parse(t,e,r){return n=this,i=null,s=function*(){const n=e.src.replace(/^.*[\\\/]/,"").replace(/\.[^/.]+$/,""),i=id.parse(t,n),{src:s}=e,{page:o}=i,a=[];for(let t=0;t<o.length;++t){const e=o[t].file,r=Q.join(Q.dirname(s),e);a.push(r)}const l=yield r.load(a),h=a.map((t=>l[t]));return cc.install(i,h,!0)},new Promise(((t,e)=>{var r=t=>{try{a(s.next(t))}catch(at){e(at)}},o=t=>{try{a(s["throw"](t))}catch(at){e(at)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);a((s=s.apply(n,i)).next())}));var n,i,s},unload(t){t.destroy()}}};var id,sd;function od(t){return od="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},od(t)}function ad(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ld(t){var e=function(t,e){if("object"!==od(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(r!==undefined){var n=r.call(t,e||"default");if("object"!==od(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===od(e)?e:String(e)}function hd(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ld(n.key),n)}}function ud(t,e,r){return e&&hd(t.prototype,e),r&&hd(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function cd(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dd(t,e){return dd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dd(t,e)}function fd(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dd(t,e)}function pd(t,e){if(e&&("object"===od(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return cd(t)}function md(t){return md=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},md(t)}function gd(t,e,r){return(e=ld(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yd(t){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_d(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function xd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?vd(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}xe.add(nd),(sd=id||(id={})).test=function(t){var e;for(let r=0;r<rd.length;r++)if((null==(e=null==t?void 0:t.atlas)?void 0:e.type)===rd[r])return!0;return!1},sd.parse=function(t,e){var r,n;const i=new rc;i.info=[{face:t.name,size:t.atlas.size}],i.common=[{lineHeight:t.metrics.lineHeight*t.atlas.size}],i.page=[{file:`${e}.png`,id:0}];for(let s=0;s<t.glyphs.length;s++){const e=t.glyphs[s],o=null!=(r=e.atlasBounds)?r:{bottom:0,left:0,right:0,top:0},a=null!=(n=e.planeBounds)?n:{bottom:0,left:0,right:0,top:0},l=Math.abs(o.top-o.bottom);let h=o.top,u=(1+a.top)*t.atlas.size;"bottom"===t.atlas.yOrigin&&(h=t.atlas.height-h,u=(1-a.top)*t.atlas.size),i.char.push({id:e.unicode,page:0,height:l,width:Math.abs(o.left-o.right),x:o.left,y:h,xadvance:e.advance*t.atlas.size,xoffset:a.left*t.atlas.size,yoffset:u})}for(let s=0;s<t.kerning.length;s++){const e=t.kerning[s];i.kerning.push({amount:e.advance*t.atlas.size,first:e.unicode1,second:e.unicode2})}return i.distanceField=[{distanceRange:t.atlas.distanceRange,fieldType:t.atlas.type}],i};var bd={type:"logger",log:function(t){this.output("log",t)},warn:function(t){this.output("warn",t)},error:function(t){this.output("error",t)},output:function(t,e){console&&console[t]}},Ed=new(function(){function t(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};ad(this,t),this.init(e,r)}return ud(t,[{key:"init",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.prefix=e.prefix||"i18next:",this.logger=t||bd,this.options=e,this.debug=e.debug}},{key:"setDebug",value:function(t){this.debug=t}},{key:"log",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.forward(e,"log","",!0)}},{key:"warn",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.forward(e,"warn","",!0)}},{key:"error",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.forward(e,"error","")}},{key:"deprecate",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(t,e,r,n){return n&&!this.debug?null:("string"==typeof t[0]&&(t[0]="".concat(r).concat(this.prefix," ").concat(t[0])),this.logger[e](t))}},{key:"create",value:function(e){return new t(this.logger,xd(xd({},{prefix:"".concat(this.prefix,":").concat(e,":")}),this.options))}},{key:"clone",value:function(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new t(this.logger,e)}}]),t}()),Td=function(){function t(){ad(this,t),this.observers={}}return ud(t,[{key:"on",value:function(t,e){var r=this;return t.split(" ").forEach((function(t){r.observers[t]=r.observers[t]||[],r.observers[t].push(e)})),this}},{key:"off",value:function(t,e){this.observers[t]&&(e?this.observers[t]=this.observers[t].filter((function(t){return t!==e})):delete this.observers[t])}},{key:"emit",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this.observers[t]&&[].concat(this.observers[t]).forEach((function(t){t.apply(void 0,r)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(e){e.apply(e,[t].concat(r))}))}}]),t}();function Ad(){var t,e,r=new Promise((function(r,n){t=r,e=n}));return r.resolve=t,r.reject=e,r}function wd(t){return null==t?"":""+t}function Sd(t,e,r){function n(t){return t&&t.indexOf("###")>-1?t.replace(/###/g,"."):t}function i(){return!t||"string"==typeof t}for(var s="string"!=typeof e?[].concat(e):e.split(".");s.length>1;){if(i())return{};var o=n(s.shift());!t[o]&&r&&(t[o]=new r),t=Object.prototype.hasOwnProperty.call(t,o)?t[o]:{}}return i()?{}:{obj:t,k:n(s.shift())}}function Cd(t,e,r){var n=Sd(t,e,Object);n.obj[n.k]=r}function Rd(t,e){var r=Sd(t,e),n=r.obj,i=r.k;return n?n[i]:undefined}function Id(t,e,r){for(var n in e)"__proto__"!==n&&"constructor"!==n&&(n in t?"string"==typeof t[n]||t[n]instanceof String||"string"==typeof e[n]||e[n]instanceof String?r&&(t[n]=e[n]):Id(t[n],e[n],r):t[n]=e[n]);return t}function Pd(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Md={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Od(t){return"string"==typeof t?t.replace(/[&<>"'\/]/g,(function(t){return Md[t]})):t}var Dd="undefined"!=typeof window&&window.navigator&&"undefined"==typeof window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,Nd=[" ",",","?","!",";"];function Fd(t,e){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:".";if(!t)return undefined;if(t[e])return t[e];for(var n=e.split(r),i=t,s=0;s<n.length;++s){if(!i)return undefined;if("string"==typeof i[n[s]]&&s+1<n.length)return undefined;if(i[n[s]]===undefined){for(var o=2,a=n.slice(s,s+o).join(r),l=i[a];l===undefined&&n.length>s+o;)o++,l=i[a=n.slice(s,s+o).join(r)];if(l===undefined)return undefined;if(null===l)return null;if(e.endsWith(a)){if("string"==typeof l)return l;if(a&&"string"==typeof l[a])return l[a]}var h=n.slice(s+o).join(r);return h?Fd(l,h,r):undefined}i=i[n[s]]}return i}function Ld(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Bd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ld(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ld(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function kd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(at){return!1}}();return function(){var r,n=md(t);if(e){var i=md(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pd(this,r)}}var Ud=function(t){fd(r,t);var e=kd(r);function r(t){var n,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{ns:["translation"],defaultNS:"translation"};return ad(this,r),n=e.call(this),Dd&&Td.call(cd(n)),n.data=t||{},n.options=i,n.options.keySeparator===undefined&&(n.options.keySeparator="."),n.options.ignoreJSONStructure===undefined&&(n.options.ignoreJSONStructure=!0),n}return ud(r,[{key:"addNamespaces",value:function(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}},{key:"removeNamespaces",value:function(t){var e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}},{key:"getResource",value:function(t,e,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},i=n.keySeparator!==undefined?n.keySeparator:this.options.keySeparator,s=n.ignoreJSONStructure!==undefined?n.ignoreJSONStructure:this.options.ignoreJSONStructure,o=[t,e];r&&"string"!=typeof r&&(o=o.concat(r)),r&&"string"==typeof r&&(o=o.concat(i?r.split(i):r)),t.indexOf(".")>-1&&(o=t.split("."));var a=Rd(this.data,o);return a||!s||"string"!=typeof r?a:Fd(this.data&&this.data[t]&&this.data[t][e],r,i)}},{key:"addResource",value:function(t,e,r,n){var i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{silent:!1},s=this.options.keySeparator;s===undefined&&(s=".");var o=[t,e];r&&(o=o.concat(s?r.split(s):r)),t.indexOf(".")>-1&&(n=e,e=(o=t.split("."))[1]),this.addNamespaces(e),Cd(this.data,o,n),i.silent||this.emit("added",t,e,r,n)}},{key:"addResources",value:function(t,e,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{silent:!1};for(var i in r)"string"!=typeof r[i]&&"[object Array]"!==Object.prototype.toString.apply(r[i])||this.addResource(t,e,i,r[i],{silent:!0});n.silent||this.emit("added",t,e,r)}},{key:"addResourceBundle",value:function(t,e,r,n,i){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{silent:!1},o=[t,e];t.indexOf(".")>-1&&(n=r,r=e,e=(o=t.split("."))[1]),this.addNamespaces(e);var a=Rd(this.data,o)||{};n?Id(a,r,i):a=Bd(Bd({},a),r),Cd(this.data,o,a),s.silent||this.emit("added",t,e,r)}},{key:"removeResourceBundle",value:function(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}},{key:"hasResourceBundle",value:function(t,e){return this.getResource(t,e)!==undefined}},{key:"getResourceBundle",value:function(t,e){return e||(e=this.options.defaultNS),"v1"===this.options.compatibilityAPI?Bd(Bd({},{}),this.getResource(t,e)):this.getResource(t,e)}},{key:"getDataByLanguage",value:function(t){return this.data[t]}},{key:"hasLanguageSomeTranslations",value:function(t){var e=this.getDataByLanguage(t);return!!(e&&Object.keys(e)||[]).find((function(t){return e[t]&&Object.keys(e[t]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),r}(Td),Gd={processors:{},addPostProcessor:function(t){this.processors[t.name]=t},handle:function(t,e,r,n,i){var s=this;return t.forEach((function(t){s.processors[t]&&(e=s.processors[t].process(e,r,n,i))})),e}};function jd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vd(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?jd(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Hd(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(at){return!1}}();return function(){var r,n=md(t);if(e){var i=md(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pd(this,r)}}var zd={},Wd=function(t){fd(r,t);var e=Hd(r);function r(t){var n,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return ad(this,r),n=e.call(this),Dd&&Td.call(cd(n)),function(t,e,r){t.forEach((function(t){e[t]&&(r[t]=e[t])}))}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,cd(n)),n.options=i,n.options.keySeparator===undefined&&(n.options.keySeparator="."),n.logger=Ed.create("translator"),n}return ud(r,[{key:"changeLanguage",value:function(t){t&&(this.language=t)}},{key:"exists",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{interpolation:{}};if(t===undefined||null===t)return!1;var r=this.resolve(t,e);return r&&r.res!==undefined}},{key:"extractFromKey",value:function(t,e){var r=e.nsSeparator!==undefined?e.nsSeparator:this.options.nsSeparator;r===undefined&&(r=":");var n=e.keySeparator!==undefined?e.keySeparator:this.options.keySeparator,i=e.ns||this.options.defaultNS||[],s=r&&t.indexOf(r)>-1,o=!(this.options.userDefinedKeySeparator||e.keySeparator||this.options.userDefinedNsSeparator||e.nsSeparator||function(t,e,r){e=e||"",r=r||"";var n=Nd.filter((function(t){return e.indexOf(t)<0&&r.indexOf(t)<0}));if(0===n.length)return!0;var i=new RegExp("(".concat(n.map((function(t){return"?"===t?"\\?":t})).join("|"),")")),s=!i.test(t);if(!s){var o=t.indexOf(r);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s}(t,r,n));if(s&&!o){var a=t.match(this.interpolator.nestingRegexp);if(a&&a.length>0)return{key:t,namespaces:i};var l=t.split(r);(r!==n||r===n&&this.options.ns.indexOf(l[0])>-1)&&(i=l.shift()),t=l.join(n)}return"string"==typeof i&&(i=[i]),{key:t,namespaces:i}}},{key:"translate",value:function(t,e,n){var i=this;if("object"!==od(e)&&this.options.overloadTranslationOptionHandler&&(e=this.options.overloadTranslationOptionHandler(arguments)),e||(e={}),t===undefined||null===t)return"";Array.isArray(t)||(t=[String(t)]);var s=e.returnDetails!==undefined?e.returnDetails:this.options.returnDetails,o=e.keySeparator!==undefined?e.keySeparator:this.options.keySeparator,a=this.extractFromKey(t[t.length-1],e),l=a.key,h=a.namespaces,u=h[h.length-1],c=e.lng||this.language,d=e.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(d){var f=e.nsSeparator||this.options.nsSeparator;return s?{res:"".concat(u).concat(f).concat(l),usedKey:l,exactUsedKey:l,usedLng:c,usedNS:u}:"".concat(u).concat(f).concat(l)}return s?{res:l,usedKey:l,exactUsedKey:l,usedLng:c,usedNS:u}:l}var p=this.resolve(t,e),m=p&&p.res,g=p&&p.usedKey||l,_=p&&p.exactUsedKey||l,y=Object.prototype.toString.apply(m),v=e.joinArrays!==undefined?e.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject;if(x&&m&&("string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(y)<0&&("string"!=typeof v||"[object Array]"!==y)){if(!e.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var b=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,m,Vd(Vd({},e),{},{ns:h})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return s?(p.res=b,p):b}if(o){var E="[object Array]"===y,T=E?[]:{},A=E?_:g;for(var w in m)if(Object.prototype.hasOwnProperty.call(m,w)){var S="".concat(A).concat(o).concat(w);T[w]=this.translate(S,Vd(Vd({},e),{joinArrays:!1,ns:h})),T[w]===S&&(T[w]=m[w])}m=T}}else if(x&&"string"==typeof v&&"[object Array]"===y)(m=m.join(v))&&(m=this.extendTranslation(m,t,e,n));else{var C=!1,R=!1,I=e.count!==undefined&&"string"!=typeof e.count,P=r.hasDefaultValue(e),M=I?this.pluralResolver.getSuffix(c,e.count,e):"",O=e["defaultValue".concat(M)]||e.defaultValue;!this.isValidLookup(m)&&P&&(C=!0,m=O),this.isValidLookup(m)||(R=!0,m=l);var D=(e.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&R?undefined:m,N=P&&O!==m&&this.options.updateMissing;if(R||C||N){if(this.logger.log(N?"updateKey":"missingKey",c,u,l,N?O:m),o){var F=this.resolve(l,Vd(Vd({},e),{},{keySeparator:!1}));F&&F.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var L=[],B=this.languageUtils.getFallbackCodes(this.options.fallbackLng,e.lng||this.language);if("fallback"===this.options.saveMissingTo&&B&&B[0])for(var k=0;k<B.length;k++)L.push(B[k]);else"all"===this.options.saveMissingTo?L=this.languageUtils.toResolveHierarchy(e.lng||this.language):L.push(e.lng||this.language);var U=function(t,r,n){var s=P&&n!==m?n:D;i.options.missingKeyHandler?i.options.missingKeyHandler(t,u,r,s,N,e):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(t,u,r,s,N,e),i.emit("missingKey",t,u,r,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&I?L.forEach((function(t){i.pluralResolver.getSuffixes(t,e).forEach((function(r){U([t],l+r,e["defaultValue".concat(r)]||O)}))})):U(L,l,O))}m=this.extendTranslation(m,t,e,p,n),R&&m===l&&this.options.appendNamespaceToMissingKey&&(m="".concat(u,":").concat(l)),(R||C)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(l):l,C?m:undefined):this.options.parseMissingKeyHandler(m))}return s?(p.res=m,p):m}},{key:"extendTranslation",value:function(t,e,r,n,i){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)t=this.i18nFormat.parse(t,Vd(Vd({},this.options.interpolation.defaultVariables),r),n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init(Vd(Vd({},r),{interpolation:Vd(Vd({},this.options.interpolation),r.interpolation)}));var o,a="string"==typeof t&&(r&&r.interpolation&&r.interpolation.skipOnVariables!==undefined?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){var l=t.match(this.interpolator.nestingRegexp);o=l&&l.length}var h=r.replace&&"string"!=typeof r.replace?r.replace:r;if(this.options.interpolation.defaultVariables&&(h=Vd(Vd({},this.options.interpolation.defaultVariables),h)),t=this.interpolator.interpolate(t,h,r.lng||this.language,r),a){var u=t.match(this.interpolator.nestingRegexp);o<(u&&u.length)&&(r.nest=!1)}!r.lng&&"v1"!==this.options.compatibilityAPI&&n&&n.res&&(r.lng=n.usedLng),!1!==r.nest&&(t=this.interpolator.nest(t,(function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return i&&i[0]===n[0]&&!r.context?(s.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(e[0])),null):s.translate.apply(s,n.concat([e]))}),r)),r.interpolation&&this.interpolator.reset()}var c=r.postProcess||this.options.postProcess,d="string"==typeof c?[c]:c;return t!==undefined&&null!==t&&d&&d.length&&!1!==r.applyPostProcessor&&(t=Gd.handle(d,t,e,this.options&&this.options.postProcessPassResolved?Vd({i18nResolved:n},r):r,this)),t}},{key:"resolve",value:function(t){var e,r,n,i,s,o=this,a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return"string"==typeof t&&(t=[t]),t.forEach((function(t){if(!o.isValidLookup(e)){var l=o.extractFromKey(t,a),h=l.key;r=h;var u=l.namespaces;o.options.fallbackNS&&(u=u.concat(o.options.fallbackNS));var c=a.count!==undefined&&"string"!=typeof a.count,d=c&&!a.ordinal&&0===a.count&&o.pluralResolver.shouldUseIntlApi(),f=a.context!==undefined&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,p=a.lngs?a.lngs:o.languageUtils.toResolveHierarchy(a.lng||o.language,a.fallbackLng);u.forEach((function(t){o.isValidLookup(e)||(s=t,!zd["".concat(p[0],"-").concat(t)]&&o.utils&&o.utils.hasLoadedNamespace&&!o.utils.hasLoadedNamespace(s)&&(zd["".concat(p[0],"-").concat(t)]=!0,o.logger.warn('key "'.concat(r,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(r){if(!o.isValidLookup(e)){i=r;var s,l=[h];if(o.i18nFormat&&o.i18nFormat.addLookupKeys)o.i18nFormat.addLookupKeys(l,h,r,t,a);else{var u;c&&(u=o.pluralResolver.getSuffix(r,a.count,a));var p="".concat(o.options.pluralSeparator,"zero");if(c&&(l.push(h+u),d&&l.push(h+p)),f){var m="".concat(h).concat(o.options.contextSeparator).concat(a.context);l.push(m),c&&(l.push(m+u),d&&l.push(m+p))}}for(;s=l.pop();)o.isValidLookup(e)||(n=s,e=o.getResource(r,t,s,a))}})))}))}})),{res:e,usedKey:r,exactUsedKey:n,usedLng:i,usedNS:s}}},{key:"isValidLookup",value:function(t){return!(t===undefined||!this.options.returnNull&&null===t||!this.options.returnEmptyString&&""===t)}},{key:"getResource",value:function(t,e,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(t,e,r,n):this.resourceStore.getResource(t,e,r,n)}}],[{key:"hasDefaultValue",value:function(t){var e="defaultValue";for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e===r.substring(0,12)&&undefined!==t[r])return!0;return!1}}]),r}(Td);function Xd(t){return t.charAt(0).toUpperCase()+t.slice(1)}var Yd=function(){function t(e){ad(this,t),this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ed.create("languageUtils")}return ud(t,[{key:"getScriptPartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return null;var e=t.split("-");return 2===e.length?null:(e.pop(),"x"===e[e.length-1].toLowerCase()?null:this.formatLanguageCode(e.join("-")))}},{key:"getLanguagePartFromCode",value:function(t){if(!t||t.indexOf("-")<0)return t;var e=t.split("-");return this.formatLanguageCode(e[0])}},{key:"formatLanguageCode",value:function(t){if("string"==typeof t&&t.indexOf("-")>-1){var e=["hans","hant","latn","cyrl","cans","mong","arab"],r=t.split("-");return this.options.lowerCaseLng?r=r.map((function(t){return t.toLowerCase()})):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),e.indexOf(r[1].toLowerCase())>-1&&(r[1]=Xd(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),e.indexOf(r[1].toLowerCase())>-1&&(r[1]=Xd(r[1].toLowerCase())),e.indexOf(r[2].toLowerCase())>-1&&(r[2]=Xd(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}},{key:"isSupportedCode",value:function(t){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}},{key:"getBestMatchFromCodes",value:function(t){var e,r=this;return t?(t.forEach((function(t){if(!e){var n=r.formatLanguageCode(t);r.options.supportedLngs&&!r.isSupportedCode(n)||(e=n)}})),!e&&this.options.supportedLngs&&t.forEach((function(t){if(!e){var n=r.getLanguagePartFromCode(t);if(r.isSupportedCode(n))return e=n;e=r.options.supportedLngs.find((function(t){return t===n?t:t.indexOf("-")<0&&n.indexOf("-")<0?void 0:0===t.indexOf(n)?t:void 0}))}})),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e):null}},{key:"getFallbackCodes",value:function(t,e){if(!t)return[];if("function"==typeof t&&(t=t(e)),"string"==typeof t&&(t=[t]),"[object Array]"===Object.prototype.toString.apply(t))return t;if(!e)return t["default"]||[];var r=t[e];return r||(r=t[this.getScriptPartFromCode(e)]),r||(r=t[this.formatLanguageCode(e)]),r||(r=t[this.getLanguagePartFromCode(e)]),r||(r=t["default"]),r||[]}},{key:"toResolveHierarchy",value:function(t,e){var r=this,n=this.getFallbackCodes(e||this.options.fallbackLng||[],t),i=[],s=function(t){t&&(r.isSupportedCode(t)?i.push(t):r.logger.warn("rejecting language code not found in supportedLngs: ".concat(t)))};return"string"==typeof t&&t.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(t)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(t)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(t))):"string"==typeof t&&s(this.formatLanguageCode(t)),n.forEach((function(t){i.indexOf(t)<0&&s(r.formatLanguageCode(t))})),i}}]),t}(),Kd=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],$d={1:function(t){return Number(t>1)},2:function(t){return Number(1!=t)},3:function(t){return 0},4:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},5:function(t){return Number(0==t?0:1==t?1:2==t?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5)},6:function(t){return Number(1==t?0:t>=2&&t<=4?1:2)},7:function(t){return Number(1==t?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2)},8:function(t){return Number(1==t?0:2==t?1:8!=t&&11!=t?2:3)},9:function(t){return Number(t>=2)},10:function(t){return Number(1==t?0:2==t?1:t<7?2:t<11?3:4)},11:function(t){return Number(1==t||11==t?0:2==t||12==t?1:t>2&&t<20?2:3)},12:function(t){return Number(t%10!=1||t%100==11)},13:function(t){return Number(0!==t)},14:function(t){return Number(1==t?0:2==t?1:3==t?2:3)},15:function(t){return Number(t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2)},16:function(t){return Number(t%10==1&&t%100!=11?0:0!==t?1:2)},17:function(t){return Number(1==t||t%10==1&&t%100!=11?0:1)},18:function(t){return Number(0==t?0:1==t?1:2)},19:function(t){return Number(1==t?0:0==t||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3)},20:function(t){return Number(1==t?0:0==t||t%100>0&&t%100<20?1:2)},21:function(t){return Number(t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0)},22:function(t){return Number(1==t?0:2==t?1:(t<0||t>10)&&t%10==0?2:3)}},qd=["v1","v2","v3"],Qd={zero:0,one:1,two:2,few:3,many:4,other:5};var Jd=function(){function t(e){var r,n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};ad(this,t),this.languageUtils=e,this.options=n,this.logger=Ed.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(r={},Kd.forEach((function(t){t.lngs.forEach((function(e){r[e]={numbers:t.nr,plurals:$d[t.fc]}}))})),r)}return ud(t,[{key:"addRule",value:function(t,e){this.rules[t]=e}},{key:"getRule",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(t,{type:e.ordinal?"ordinal":"cardinal"})}catch(r){return}return this.rules[t]||this.rules[this.languageUtils.getLanguagePartFromCode(t)]}},{key:"needsPlural",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},r=this.getRule(t,e);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(t,e){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.getSuffixes(t,r).map((function(t){return"".concat(e).concat(t)}))}},{key:"getSuffixes",value:function(t){var e=this,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},n=this.getRule(t,r);return n?this.shouldUseIntlApi()?n.resolvedOptions().pluralCategories.sort((function(t,e){return Qd[t]-Qd[e]})).map((function(t){return"".concat(e.options.prepend).concat(t)})):n.numbers.map((function(n){return e.getSuffix(t,n,r)})):[]}},{key:"getSuffix",value:function(t,e){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},n=this.getRule(t,r);return n?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(n.select(e)):this.getSuffixRetroCompatible(n,e):(this.logger.warn("no plural rule found for: ".concat(t)),"")}},{key:"getSuffixRetroCompatible",value:function(t,e){var r=this,n=t.noAbs?t.plurals(e):t.plurals(Math.abs(e)),i=t.numbers[n];this.options.simplifyPluralSuffix&&2===t.numbers.length&&1===t.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var s=function(){return r.options.prepend&&i.toString()?r.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_".concat(i.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===t.numbers.length&&1===t.numbers[0]?s():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}},{key:"shouldUseIntlApi",value:function(){return!qd.includes(this.options.compatibilityJSON)}}]),t}();function Zd(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Zd(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zd(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ef(t,e,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:".",i=!(arguments.length>4&&arguments[4]!==undefined)||arguments[4],s=function(t,e,r){var n=Rd(t,r);return n!==undefined?n:Rd(e,r)}(t,e,r);return!s&&i&&"string"==typeof r&&(s=Fd(t,r,n))===undefined&&(s=Fd(e,r,n)),s}var rf=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ad(this,t),this.logger=Ed.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(t){return t},this.init(e)}return ud(t,[{key:"init",value:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};t.interpolation||(t.interpolation={escapeValue:!0});var e=t.interpolation;this.escape=e.escape!==undefined?e.escape:Od,this.escapeValue=e.escapeValue===undefined||e.escapeValue,this.useRawValueToEscape=e.useRawValueToEscape!==undefined&&e.useRawValueToEscape,this.prefix=e.prefix?Pd(e.prefix):e.prefixEscaped||"{{",this.suffix=e.suffix?Pd(e.suffix):e.suffixEscaped||"}}",this.formatSeparator=e.formatSeparator?e.formatSeparator:e.formatSeparator||",",this.unescapePrefix=e.unescapeSuffix?"":e.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":e.unescapeSuffix||"",this.nestingPrefix=e.nestingPrefix?Pd(e.nestingPrefix):e.nestingPrefixEscaped||Pd("$t("),this.nestingSuffix=e.nestingSuffix?Pd(e.nestingSuffix):e.nestingSuffixEscaped||Pd(")"),this.nestingOptionsSeparator=e.nestingOptionsSeparator?e.nestingOptionsSeparator:e.nestingOptionsSeparator||",",this.maxReplaces=e.maxReplaces?e.maxReplaces:1e3,this.alwaysFormat=e.alwaysFormat!==undefined&&e.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var t="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(t,"g");var e="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(e,"g");var r="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(r,"g")}},{key:"interpolate",value:function(t,e,r,n){var i,s,o,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function h(t){return t.replace(/\$/g,"$$$$")}var u=function(t){if(t.indexOf(a.formatSeparator)<0){var i=ef(e,l,t,a.options.keySeparator,a.options.ignoreJSONStructure);return a.alwaysFormat?a.format(i,undefined,r,tf(tf(tf({},n),e),{},{interpolationkey:t})):i}var s=t.split(a.formatSeparator),o=s.shift().trim(),h=s.join(a.formatSeparator).trim();return a.format(ef(e,l,o,a.options.keySeparator,a.options.ignoreJSONStructure),h,r,tf(tf(tf({},n),e),{},{interpolationkey:o}))};this.resetRegExp();var c=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,d=n&&n.interpolation&&n.interpolation.skipOnVariables!==undefined?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(t){return h(t)}},{regex:this.regexp,safeValue:function(t){return a.escapeValue?h(a.escape(t)):h(t)}}].forEach((function(e){for(o=0;i=e.regex.exec(t);){var r=i[1].trim();if((s=u(r))===undefined)if("function"==typeof c){var l=c(t,i,n);s="string"==typeof l?l:""}else if(n&&Object.prototype.hasOwnProperty.call(n,r))s="";else{if(d){s=i[0];continue}a.logger.warn("missed to pass in variable ".concat(r," for interpolating ").concat(t)),s=""}else"string"==typeof s||a.useRawValueToEscape||(s=wd(s));var h=e.safeValue(s);if(t=t.replace(i[0],h),d?(e.regex.lastIndex+=s.length,e.regex.lastIndex-=i[0].length):e.regex.lastIndex=0,++o>=a.maxReplaces)break}})),t}},{key:"nest",value:function(t,e){var r,n,i,s=this,o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};function a(t,e){var r=this.nestingOptionsSeparator;if(t.indexOf(r)<0)return t;var n=t.split(new RegExp("".concat(r,"[ ]*{"))),s="{".concat(n[1]);t=n[0];var o=(s=this.interpolate(s,i)).match(/'/g),a=s.match(/"/g);(o&&o.length%2==0&&!a||a.length%2!=0)&&(s=s.replace(/'/g,'"'));try{i=JSON.parse(s),e&&(i=tf(tf({},e),i))}catch(at){return this.logger.warn("failed parsing options string in nesting for key ".concat(t),at),"".concat(t).concat(r).concat(s)}return delete i.defaultValue,t}for(;r=this.nestingRegexp.exec(t);){var l=[];(i=(i=tf({},o)).replace&&"string"!=typeof i.replace?i.replace:i).applyPostProcessor=!1,delete i.defaultValue;var h=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){var u=r[1].split(this.formatSeparator).map((function(t){return t.trim()}));r[1]=u.shift(),l=u,h=!0}if((n=e(a.call(this,r[1].trim(),i),i))&&r[0]===t&&"string"!=typeof n)return n;"string"!=typeof n&&(n=wd(n)),n||(this.logger.warn("missed to resolve ".concat(r[1]," for nesting ").concat(t)),n=""),h&&(n=l.reduce((function(t,e){return s.format(t,e,o.lng,tf(tf({},o),{},{interpolationkey:r[1].trim()}))}),n.trim())),t=t.replace(r[0],n),this.regexp.lastIndex=0}return t}}]),t}();function nf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function sf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nf(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function of(t){var e={};return function(r,n,i){var s=n+JSON.stringify(i),o=e[s];return o||(o=t(n,i),e[s]=o),o(r)}}var af=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};ad(this,t),this.logger=Ed.create("formatter"),this.options=e,this.formats={number:of((function(t,e){var r=new Intl.NumberFormat(t,sf({},e));return function(t){return r.format(t)}})),currency:of((function(t,e){var r=new Intl.NumberFormat(t,sf(sf({},e),{},{style:"currency"}));return function(t){return r.format(t)}})),datetime:of((function(t,e){var r=new Intl.DateTimeFormat(t,sf({},e));return function(t){return r.format(t)}})),relativetime:of((function(t,e){var r=new Intl.RelativeTimeFormat(t,sf({},e));return function(t){return r.format(t,e.range||"day")}})),list:of((function(t,e){var r=new Intl.ListFormat(t,sf({},e));return function(t){return r.format(t)}}))},this.init(e)}return ud(t,[{key:"init",value:function(t){var e=(arguments.length>1&&arguments[1]!==undefined?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=e.formatSeparator?e.formatSeparator:e.formatSeparator||","}},{key:"add",value:function(t,e){this.formats[t.toLowerCase().trim()]=e}},{key:"addCached",value:function(t,e){this.formats[t.toLowerCase().trim()]=of(e)}},{key:"format",value:function(t,e,r){var n=this,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},s=e.split(this.formatSeparator).reduce((function(t,e){var s=function(t){var e=t.toLowerCase().trim(),r={};if(t.indexOf("(")>-1){var n=t.split("(");e=n[0].toLowerCase().trim();var i=n[1].substring(0,n[1].length-1);"currency"===e&&i.indexOf(":")<0?r.currency||(r.currency=i.trim()):"relativetime"===e&&i.indexOf(":")<0?r.range||(r.range=i.trim()):i.split(";").forEach((function(t){if(t){var e=yd(t.split(":")),n=e[0],i=e.slice(1).join(":").trim().replace(/^'+|'+$/g,"");r[n.trim()]||(r[n.trim()]=i),"false"===i&&(r[n.trim()]=!1),"true"===i&&(r[n.trim()]=!0),isNaN(i)||(r[n.trim()]=parseInt(i,10))}}))}return{formatName:e,formatOptions:r}}(e),o=s.formatName,a=s.formatOptions;if(n.formats[o]){var l=t;try{var h=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},u=h.locale||h.lng||i.locale||i.lng||r;l=n.formats[o](t,u,sf(sf(sf({},a),i),h))}catch(c){n.logger.warn(c)}return l}return n.logger.warn("there was no format function for ".concat(o)),t}),t);return s}}]),t}();function lf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function hf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?lf(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):lf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function uf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(at){return!1}}();return function(){var r,n=md(t);if(e){var i=md(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pd(this,r)}}var cf=function(t){fd(r,t);var e=uf(r);function r(t,n,i){var s,o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return ad(this,r),s=e.call(this),Dd&&Td.call(cd(s)),s.backend=t,s.store=n,s.services=i,s.languageUtils=i.languageUtils,s.options=o,s.logger=Ed.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=o.maxParallelReads||10,s.readingCalls=0,s.maxRetries=o.maxRetries>=0?o.maxRetries:5,s.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(i,o.backend,o),s}return ud(r,[{key:"queueLoad",value:function(t,e,r,n){var i=this,s={},o={},a={},l={};return t.forEach((function(t){var n=!0;e.forEach((function(e){var a="".concat(t,"|").concat(e);!r.reload&&i.store.hasResourceBundle(t,e)?i.state[a]=2:i.state[a]<0||(1===i.state[a]?o[a]===undefined&&(o[a]=!0):(i.state[a]=1,n=!1,o[a]===undefined&&(o[a]=!0),s[a]===undefined&&(s[a]=!0),l[e]===undefined&&(l[e]=!0)))})),n||(a[t]=!0)})),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(t,e,r){var n=t.split("|"),i=n[0],s=n[1];e&&this.emit("failedLoading",i,s,e),r&&this.store.addResourceBundle(i,s,r),this.state[t]=e?-1:2;var o={};this.queue.forEach((function(r){!function(t,e,r,n){var i=Sd(t,e,Object),s=i.obj,o=i.k;s[o]=s[o]||[],n&&(s[o]=s[o].concat(r)),n||s[o].push(r)}(r.loaded,[i],s),function(t,e){t.pending[e]!==undefined&&(delete t.pending[e],t.pendingCount--)}(r,t),e&&r.errors.push(e),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach((function(t){o[t]||(o[t]={});var e=r.loaded[t];e.length&&e.forEach((function(e){o[t][e]===undefined&&(o[t][e]=!0)}))})),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())})),this.emit("loaded",o),this.queue=this.queue.filter((function(t){return!t.done}))}},{key:"read",value:function(t,e,r){var n=this,i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0,s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:undefined;if(!t.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:t,ns:e,fcName:r,tried:i,wait:s,callback:o});else{this.readingCalls++;var a=function(a,l){if(n.readingCalls--,n.waitingReads.length>0){var h=n.waitingReads.shift();n.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}a&&l&&i<n.maxRetries?setTimeout((function(){n.read.call(n,t,e,r,i+1,2*s,o)}),s):o(a,l)},l=this.backend[r].bind(this.backend);if(2!==l.length)return l(t,e,a);try{var h=l(t,e);h&&"function"==typeof h.then?h.then((function(t){return a(null,t)}))["catch"](a):a(null,h)}catch(u){a(u)}}}},{key:"prepareLoading",value:function(t,e){var r=this,n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},i=arguments.length>3?arguments[3]:undefined;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof t&&(t=this.languageUtils.toResolveHierarchy(t)),"string"==typeof e&&(e=[e]);var s=this.queueLoad(t,e,n,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach((function(t){r.loadOne(t)}))}},{key:"load",value:function(t,e,r){this.prepareLoading(t,e,{},r)}},{key:"reload",value:function(t,e,r){this.prepareLoading(t,e,{reload:!0},r)}},{key:"loadOne",value:function(t){var e=this,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"",n=t.split("|"),i=n[0],s=n[1];this.read(i,s,"read",undefined,undefined,(function(n,o){n&&e.logger.warn("".concat(r,"loading namespace ").concat(s," for language ").concat(i," failed"),n),!n&&o&&e.logger.log("".concat(r,"loaded namespace ").concat(s," for language ").concat(i),o),e.loaded(t,n,o)}))}},{key:"saveMissing",value:function(t,e,r,n,i){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{},o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(e))this.logger.warn('did not save key "'.concat(r,'" as the namespace "').concat(e,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(r!==undefined&&null!==r&&""!==r){if(this.backend&&this.backend.create){var a=hf(hf({},s),{},{isUpdate:i}),l=this.backend.create.bind(this.backend);if(l.length<6)try{var h;(h=5===l.length?l(t,e,r,n,a):l(t,e,r,n))&&"function"==typeof h.then?h.then((function(t){return o(null,t)}))["catch"](o):o(null,h)}catch(u){o(u)}else l(t,e,r,n,o,a)}t&&t[0]&&this.store.addResource(t[0],e,r,n)}}}]),r}(Td);function df(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(t){var e={};if("object"===od(t[1])&&(e=t[1]),"string"==typeof t[1]&&(e.defaultValue=t[1]),"string"==typeof t[2]&&(e.tDescription=t[2]),"object"===od(t[2])||"object"===od(t[3])){var r=t[3]||t[2];Object.keys(r).forEach((function(t){e[t]=r[t]}))}return e},interpolation:{escapeValue:!0,format:function(t,e,r,n){return t},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function ff(t){return"string"==typeof t.ns&&(t.ns=[t.ns]),"string"==typeof t.fallbackLng&&(t.fallbackLng=[t.fallbackLng]),"string"==typeof t.fallbackNS&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t}function pf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function mf(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pf(Object(r),!0).forEach((function(e){gd(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pf(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(at){return!1}}();return function(){var r,n=md(t);if(e){var i=md(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pd(this,r)}}function _f(){}var yf=function(t){fd(r,t);var e=gf(r);function r(){var t,n,i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},s=arguments.length>1?arguments[1]:undefined;if(ad(this,r),t=e.call(this),Dd&&Td.call(cd(t)),t.options=ff(i),t.services={},t.logger=Ed,t.modules={external:[]},n=cd(t),Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach((function(t){"function"==typeof n[t]&&(n[t]=n[t].bind(n))})),s&&!t.isInitialized&&!i.isClone){if(!t.options.initImmediate)return t.init(i,s),pd(t,cd(t));setTimeout((function(){t.init(i,s)}),0)}return t}return ud(r,[{key:"init",value:function(){var t=this,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},r=arguments.length>1?arguments[1]:undefined;"function"==typeof e&&(r=e,e={}),!e.defaultNS&&!1!==e.defaultNS&&e.ns&&("string"==typeof e.ns?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));var n=df();function i(t){return t?"function"==typeof t?new t:t:null}if(this.options=mf(mf(mf({},n),this.options),ff(e)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=mf(mf({},n.interpolation),this.options.interpolation)),e.keySeparator!==undefined&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==undefined&&(this.options.userDefinedNsSeparator=e.nsSeparator),!this.options.isClone){var s;this.modules.logger?Ed.init(i(this.modules.logger),this.options):Ed.init(null,this.options),this.modules.formatter?s=this.modules.formatter:"undefined"!=typeof Intl&&(s=af);var o=new Yd(this.options);this.store=new Ud(this.options.resources,this.options);var a=this.services;a.logger=Ed,a.resourceStore=this.store,a.languageUtils=o,a.pluralResolver=new Jd(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!s||this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format||(a.formatter=i(s),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new rf(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new cf(i(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.emit.apply(t,[e].concat(n))})),this.modules.languageDetector&&(a.languageDetector=i(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=i(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new Wd(this.services,this.options),this.translator.on("*",(function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.emit.apply(t,[e].concat(n))})),this.modules.external.forEach((function(e){e.init&&e.init(t)}))}if(this.format=this.options.interpolation.format,r||(r=_f),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(e){t[e]=function(){var r;return(r=t.store)[e].apply(r,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(e){t[e]=function(){var r;return(r=t.store)[e].apply(r,arguments),t}}));var h=Ad(),u=function(){var e=function(e,n){t.isInitialized&&!t.initializedStoreOnce&&t.logger.warn("init: i18next is already initialized. You should call init just once!"),t.isInitialized=!0,t.options.isClone||t.logger.log("initialized",t.options),t.emit("initialized",t.options),h.resolve(n),r(e,n)};if(t.languages&&"v1"!==t.options.compatibilityAPI&&!t.isInitialized)return e(null,t.t.bind(t));t.changeLanguage(t.options.lng,e)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),h}},{key:"loadResources",value:function(t){var e=this,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_f,n="string"==typeof t?t:this.language;if("function"==typeof t&&(r=t),!this.options.resources||this.options.partialBundledLanguages){if(n&&"cimode"===n.toLowerCase())return r();var i=[],s=function(t){t&&e.services.languageUtils.toResolveHierarchy(t).forEach((function(t){i.indexOf(t)<0&&i.push(t)}))};if(n)s(n);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(t){return s(t)}));this.options.preload&&this.options.preload.forEach((function(t){return s(t)})),this.services.backendConnector.load(i,this.options.ns,(function(t){t||e.resolvedLanguage||!e.language||e.setResolvedLanguage(e.language),r(t)}))}else r(null)}},{key:"reloadResources",value:function(t,e,r){var n=Ad();return t||(t=this.languages),e||(e=this.options.ns),r||(r=_f),this.services.backendConnector.reload(t,e,(function(t){n.resolve(),r(t)})),n}},{key:"use",value:function(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===t.type&&(this.modules.backend=t),("logger"===t.type||t.log&&t.warn&&t.error)&&(this.modules.logger=t),"languageDetector"===t.type&&(this.modules.languageDetector=t),"i18nFormat"===t.type&&(this.modules.i18nFormat=t),"postProcessor"===t.type&&Gd.addPostProcessor(t),"formatter"===t.type&&(this.modules.formatter=t),"3rdParty"===t.type&&this.modules.external.push(t),this}},{key:"setResolvedLanguage",value:function(t){if(t&&this.languages&&!(["cimode","dev"].indexOf(t)>-1))for(var e=0;e<this.languages.length;e++){var r=this.languages[e];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}},{key:"changeLanguage",value:function(t,e){var r=this;this.isLanguageChangingTo=t;var n=Ad();this.emit("languageChanging",t);var i=function(t){r.language=t,r.languages=r.services.languageUtils.toResolveHierarchy(t),r.resolvedLanguage=undefined,r.setResolvedLanguage(t)},s=function(s){t||s||!r.services.languageDetector||(s=[]);var o="string"==typeof s?s:r.services.languageUtils.getBestMatchFromCodes(s);o&&(r.language||i(o),r.translator.language||r.translator.changeLanguage(o),r.services.languageDetector&&r.services.languageDetector.cacheUserLanguage&&r.services.languageDetector.cacheUserLanguage(o)),r.loadResources(o,(function(t){!function(t,s){s?(i(s),r.translator.changeLanguage(s),r.isLanguageChangingTo=undefined,r.emit("languageChanged",s),r.logger.log("languageChanged",s)):r.isLanguageChangingTo=undefined,n.resolve((function(){return r.t.apply(r,arguments)})),e&&e(t,(function(){return r.t.apply(r,arguments)}))}(t,o)}))};return t||!this.services.languageDetector||this.services.languageDetector.async?!t&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(t):s(this.services.languageDetector.detect()),n}},{key:"getFixedT",value:function(t,e,r){var n=this,i=function s(t,e){var i;if("object"!==od(e)){for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];i=n.options.overloadTranslationOptionHandler([t,e].concat(a))}else i=mf({},e);i.lng=i.lng||s.lng,i.lngs=i.lngs||s.lngs,i.ns=i.ns||s.ns,i.keyPrefix=i.keyPrefix||r||s.keyPrefix;var h,u=n.options.keySeparator||".";return h=i.keyPrefix&&Array.isArray(t)?t.map((function(t){return"".concat(i.keyPrefix).concat(u).concat(t)})):i.keyPrefix?"".concat(i.keyPrefix).concat(u).concat(t):t,n.t(h,i)};return"string"==typeof t?i.lng=t:i.lngs=t,i.ns=e,i.keyPrefix=r,i}},{key:"t",value:function(){var t;return this.translator&&(t=this.translator).translate.apply(t,arguments)}},{key:"exists",value:function(){var t;return this.translator&&(t=this.translator).exists.apply(t,arguments)}},{key:"setDefaultNamespace",value:function(t){this.options.defaultNS=t}},{key:"hasLoadedNamespace",value:function(t){var e=this,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var n=this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;var o=function(t,r){var n=e.services.backendConnector.state["".concat(t,"|").concat(r)];return-1===n||2===n};if(r.precheck){var a=r.precheck(this,o);if(a!==undefined)return a}return!!this.hasResourceBundle(n,t)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!o(n,t)||i&&!o(s,t)))}},{key:"loadNamespaces",value:function(t,e){var r=this,n=Ad();return this.options.ns?("string"==typeof t&&(t=[t]),t.forEach((function(t){r.options.ns.indexOf(t)<0&&r.options.ns.push(t)})),this.loadResources((function(t){n.resolve(),e&&e(t)})),n):(e&&e(),Promise.resolve())}},{key:"loadLanguages",value:function(t,e){var r=Ad();"string"==typeof t&&(t=[t]);var n=this.options.preload||[],i=t.filter((function(t){return n.indexOf(t)<0}));return i.length?(this.options.preload=n.concat(i),this.loadResources((function(t){r.resolve(),e&&e(t)})),r):(e&&e(),Promise.resolve())}},{key:"dir",value:function(t){if(t||(t=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!t)return"rtl";var e=this.services&&this.services.languageUtils||new Yd(df());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(e.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var t=this,e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_f,i=mf(mf(mf({},this.options),e),{isClone:!0}),s=new r(i);e.debug===undefined&&e.prefix===undefined||(s.logger=s.logger.clone(e));return["store","services","language"].forEach((function(e){s[e]=t[e]})),s.services=mf({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new Wd(s.services,s.options),s.translator.on("*",(function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];s.emit.apply(s,[t].concat(r))})),s.init(i,n),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),r}(Td);gd(yf,"createInstance",(function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},e=arguments.length>1?arguments[1]:undefined;return new yf(t,e)}));var vf=yf.createInstance();vf.createInstance=yf.createInstance;vf.createInstance,vf.dir,vf.init,vf.loadResources,vf.reloadResources,vf.use,vf.changeLanguage,vf.getFixedT,vf.t,vf.exists,vf.setDefaultNamespace,vf.hasLoadedNamespace,vf.loadNamespaces,vf.loadLanguages;const xf=JSON.parse('{"u2":"3DGame","i8":"0.0.1"}'),bf=1692460643450,Ef=!1,Tf=Ef,Af=!1,wf=xf.i8,Sf="1.0.0",Cf=xf.u2,Rf=!1,If=(window.location.search.match(/[?&]lang=([a-z]{2}([-_][a-z]{2})?)/)||[])[1]||document.documentElement.lang||navigator.language,Pf={extension:_e.Asset,resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),n=e.pop();return"json"===r&&"i18"===n},parse:t=>{var e,r;const n=t.split("?")[0].split("/").pop().split(".").reverse();return{data:{lng:null!=(e=n[2])?e:"en",ns:null!=(r=n[3])?r:"translation"},src:t}}},loader:{extension:{type:_e.LoadParser,priority:Ui.Normal},testParse(t,e){return Promise.resolve(e.src.includes("i18.json")&&e.data.lng&&e.data.ns)},parse(t,e,r){return vf.addResourceBundle(e.data.lng,e.data.ns,t,!0,!1),Promise.resolve(t)}}};let Mf;vf.init({debug:Ef,resources:{},lng:If,fallbackLng:Ef?"cimode":{"default":["en"]}}),xe.add(Pf),xe.add(Ic),Mf="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&self.performance!==undefined&&self.performance.now!==undefined?self.performance.now.bind(self.performance):Date.now!==undefined?Date.now:function(){return(new Date).getTime()};class Of{constructor(){Of.prototype.__init.call(this),Of.prototype.__init2.call(this),Of.prototype.__init3.call(this),Of.prototype.__init4.call(this)}__init(){this._tweens={}}static get shared(){return Of._shared||(Of._shared=new Of),Of._shared}__init2(){this._paused=!1}isPaused(){return this._paused}pause(){this._paused=!0}resume(){this._paused=!1}__init3(){this._lastUpdateTime=undefined}__init4(){this.now=Mf}getAll(){return Object.keys(this._tweens).map((t=>this._tweens[t]))}removeAll(){this._tweens={}}add(t){this._tweens[t.getId()]=t}remove(t){delete this._tweens[t.getId()]}update(t,e=!1){if(t==undefined&&(this._lastUpdateTime==undefined?(this._lastUpdateTime=this.now(),t=0):t=this.now()-this._lastUpdateTime),this._lastUpdateTime=this.now(),this._paused)return!1;const r=Object.keys(this._tweens);if(0==r.length)return!1;for(let n=0;n<r.length;n++){const i=this._tweens[r[n]];i&&0==i.update(t,!0)&&!e&&delete this._tweens[r[n]]}return!0}}const Df={Step:{None(t){return t<.5?0:1}},Linear:{None(t){return t}},Quadratic:{In(t){return t*t},Out(t){return t*(2-t)},InOut(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In(t){return t*t*t},Out(t){return--t*t*t+1},InOut(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In(t){return t*t*t*t},Out(t){return 1- --t*t*t*t},InOut(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In(t){return t*t*t*t*t},Out(t){return--t*t*t*t*t+1},InOut(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In(t){return 1-Math.cos(t*Math.PI/2)},Out(t){return Math.sin(t*Math.PI/2)},InOut(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In(t){return 0==t?0:Math.pow(1024,t-1)},Out(t){return 1==t?1:1-Math.pow(2,-10*t)},InOut(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In(t){return 1-Math.sqrt(1-t*t)},Out(t){return Math.sqrt(1- --t*t)},InOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In(t){return 0==t?0:1==t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out(t){return 0==t?0:1==t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut(t){return 0==t?0:1==t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In(t){return 1-Df.Bounce.Out(1-t)},Out(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut(t){return t<.5?.5*Df.Bounce.In(2*t):.5*Df.Bounce.Out(2*t-1)+.5}}},Nf={Geom:{Linear(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.Linear;return e<0?s(t[0],t[1],n):e>1?s(t[r],t[r-1],r-n):s(t[i],t[i+1>r?r:i+1],n-i)},Bezier(t,e){let r=0;const n=t.length-1,i=Math.pow,s=Nf.Utils.Bernstein;for(let o=0;o<=n;o++)r+=s(n,o)*i(1-e,n-o)*i(e,o)*t[o];return r},QuadraticBezier(t,e){let r=0;const n=t.length-1;if(1==e)return t[n];const i=Math.pow,s=Nf.Utils.Bernstein,o=n*e,a=Math.floor(o),l=.5*(o-a)+a%2*.5,h=a-a%2,u=h+1,c=h+2;return r+=s(2,0)*i(1-l,2)*i(l,0)*t[h],r+=s(2,1)*i(1-l,1)*i(l,1)*t[u],r+=s(2,2)*i(1-l,0)*i(l,2)*t[c],r},CubicBezier(t,e){let r=0;const n=t.length-1;if(1==e)return t[n];const i=Math.pow,s=Nf.Utils.Bernstein,o=n*e,a=Math.floor(o),l=1/3*(o-a)+1/3*(a%3),h=a-a%3,u=h+1,c=h+2,d=h+3;return r+=s(3,0)*i(1-l,3)*i(l,0)*t[h],r+=s(3,1)*i(1-l,2)*i(l,1)*t[u],r+=s(3,2)*i(1-l,1)*i(l,2)*t[c],r+=s(3,3)*i(1-l,0)*i(l,3)*t[d],r},CatmullRom(t,e){const r=t.length-1;let n=r*e,i=Math.floor(n);const s=Nf.Utils.CatmullRom;return t[0]==t[r]?(e<0&&(i=Math.floor(n=r*(1+e))),s(t[(i-1+r)%r],t[i],t[(i+1)%r],t[(i+2)%r],n-i)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[r]-(s(t[r],t[r],t[r-1],t[r-1],n-r)-t[r]):s(t[i?i-1:0],t[i],t[r<i+1?r:i+1],t[r<i+2?r:i+2],n-i)}},Angle:{Radians(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.WrapLinear;return e<0?s(t[0],t[1],n,2*Math.PI):e>1?s(t[r],t[r-1],r-n,2*Math.PI):s(t[i],t[i+1>r?r:i+1],n-i,2*Math.PI)},Degrees(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.WrapLinear;return e<0?s(t[0],t[1],n,360):e>1?s(t[r],t[r-1],r-n,360):s(t[i],t[i+1>r?r:i+1],n-i,360)}},Color:{RGB(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.RGBLinear;return e<0?s(t[0],t[1],n):e>1?s(t[r],t[r-1],r-n):s(t[i],t[i+1>r?r:i+1],n-i)},HSV(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.HSVLinear;return e<0?s(t[0],t[1],n):e>1?s(t[r],t[r-1],r-n):s(t[i],t[i+1>r?r:i+1],n-i)},HCL(t,e){const r=t.length-1,n=r*e,i=Math.floor(n),s=Nf.Utils.HCLLinear;return e<0?s(t[0],t[1],n):e>1?s(t[r],t[r-1],r-n):s(t[i],t[i+1>r?r:i+1],n-i)}},Utils:{RGBsplit(t){return{a:t>>24&255,r:t>>16&255,g:t>>8&255,b:255&t}},HSVsplit(t){const e=Nf.Utils.RGBsplit(t);e.r/=255,e.g/=255,e.b/=255;const r=Math.max(e.r,e.g,e.b),n=Math.min(e.r,e.g,e.b);let i;const s=r,o=r-n,a=0==r?0:o/r;if(r==n)i=0;else{switch(r){case e.r:i=(e.g-e.b)/o+(e.g<e.b?6:0);break;case e.g:i=(e.b-e.r)/o+2;break;case e.b:i=(e.r-e.g)/o+4}i/=6}return{a:e.a,h:i,s:a,v:s}},HSVJoin(t){let e,r,n;const i=Math.floor(6*t.h),s=6*t.h-i,o=t.v*(1-t.s),a=t.v*(1-s*t.s),l=t.v*(1-(1-s)*t.s);switch(i%6){case 0:e=t.v,r=l,n=o;break;case 1:e=a,r=t.v,n=o;break;case 2:e=o,r=t.v,n=l;break;case 3:e=o,r=a,n=t.v;break;case 4:e=l,r=o,n=t.v;break;case 5:e=t.v,r=o,n=a}return t.a<<24|e<<16|r<<8|n},HCLSplit(t){const e=Nf.Utils.RGBsplit(t),r={a:e.a,h:0,c:0,l:0};let n=0;const i=Math.min(e.r,Math.min(e.g,e.b)),s=Math.max(e.r,Math.max(e.g,e.b));let o=.03;return r.c=s-i,0!=r.c&&(n=Math.atan2(e.g-e.b,e.r-e.g)/Math.PI,o*=i/s),o=Math.exp(o),r.h=(n/2-Math.min(n%1,-n%1)/6)%1,r.c*=o,r.l=Nf.Utils.Linear(-i,s,o)/1.060909067907034,r},HCLJoin(t){const e={a:t.a,r:0,g:0,b:0};if(0!=t.l){let r=t.h;const n=t.c,i=.530454533953517*t.l,s=Math.exp(.03*(1-n/(2*i))),o=(2*i-n)/(2*s-1),a=n/s,l=(r+Math.min(2*r%1/4,-2*r%1/8))*Math.PI*2;let h;r*=6,r<=.999?(h=Math.tan(l),e.r=1,e.g=h/(1+h)):r<=1.001?(e.r=1,e.g=1):r<=2?(h=Math.tan(l),e.r=(1+h)/h,e.g=1):r<=3?(h=Math.tan(l),e.g=1,e.b=1+h):r<=3.999?(h=Math.tan(l),e.g=1/(1+h),e.b=1):r<=4.001?(e.g=0,e.b=1):r<=5?(h=Math.tan(l),e.r=-1/h,e.b=1):(h=Math.tan(l),e.r=1,e.b=-h),e.r=e.r*a+o,e.g=e.g*a+o,e.b=e.b*a+o}return e.a<<24|e.r<<16|e.g<<8|e.b},WrapLinear(t,e,r,n){let i;return t=(t+n*Math.trunc(Math.abs(t/n)))%n,e=(e+n*Math.trunc(Math.abs(e/n)))%n,Math.abs(t-e)<=.5*n?i=Nf.Utils.Linear(t,e,r):(i=t<e?Nf.Utils.Linear(t+n,e,r):Nf.Utils.Linear(t,e+n,r),i%=n),i},RGBLinear(t,e,r){const n=Nf.Utils.RGBsplit(t),i=Nf.Utils.RGBsplit(e);return Nf.Utils.Linear(n.a,i.a,r)<<24|Nf.Utils.Linear(n.r,i.r,r)<<16|Nf.Utils.Linear(n.g,i.g,r)<<8|Nf.Utils.Linear(n.b,i.b,r)},HSVLinear(t,e,r){const n=Nf.Utils.HSVsplit(t),i=Nf.Utils.HSVsplit(e);let s;Math.abs(n.h-i.h)<=.5?s=Nf.Utils.Linear(n.h,i.h,r):(s=n.h<i.h?Nf.Utils.Linear(n.h+1,i.h,r):Nf.Utils.Linear(n.h,i.h+1,r),s%=1);const o=Nf.Utils.Linear(n.s,i.s,r),a=Nf.Utils.Linear(n.v,i.v,r),l=Nf.Utils.Linear(n.a,i.a,r);return Nf.Utils.HSVJoin({a:l,h:s,s:o,v:a})},HCLLinear(t,e,r){const n=Nf.Utils.HCLSplit(t),i=Nf.Utils.HCLSplit(e);let s;Math.abs(n.h-i.h)<=.5?s=Nf.Utils.Linear(n.h,i.h,r):(s=n.h<i.h?Nf.Utils.Linear(n.h+1,i.h,r):Nf.Utils.Linear(n.h,i.h+1,r),s%=1);const o=Nf.Utils.Linear(n.c,i.c,r),a=Nf.Utils.Linear(n.l,i.l,r),l=Nf.Utils.Linear(n.a,i.a,r);return Nf.Utils.HSVJoin({a:l,h:s,s:o,v:a})},Linear(t,e,r){return(e-t)*r+t},Bernstein(t,e){const r=Nf.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:function(){const t=[1];return function(e){let r=1;if(t[e])return t[e];for(let t=e;t>1;t--)r*=t;return t[e]=r,r}}(),CatmullRom(t,e,r,n,i){const s=.5*(r-t),o=.5*(n-e),a=i*i;return(2*e-2*r+s+o)*(i*a)+(-3*e+3*r-2*s-o)*a+s*i+e}}};class Ff{static __initStatic(){this._nextId=0}static nextId(){return Ff._nextId++}}Ff.__initStatic();const Lf={safetyCheckFunction:t=>!0,easingFunction:Df.Linear.None,yoyoEasingFunction:undefined,interpolationFunction:Nf.Geom.Linear};class Bf{__init(){this._isPaused=!1}__init2(){this._valuesStart={}}__init3(){this._valuesEnd={}}__init4(){this._valuesStartRepeat={}}__init5(){this._duration=0}__init6(){this._repeatCount=0}__init7(){this._repeat=0}__init8(){this._yoyo=!1}__init9(){this._isPlaying=!1}get _reversed(){return this.yoyo&&this._repeatCount%2!=0}__init10(){this._delayTime=0}__init11(){this._startTime=0}__init12(){this._elapsedTime=0}__init13(){this._timescale=1}__init14(){this._safetyCheckFunction=Lf.safetyCheckFunction}__init15(){this._easingFunction=Lf.easingFunction}__init16(){this._yoyoEasingFunction=Lf.yoyoEasingFunction}__init17(){this._interpolationFunction=Lf.interpolationFunction}__init18(){this._chainedTweens=[]}__init19(){this._onStartCallbackFired=!1}__init20(){this._onAfterDelayCallbackFired=!1}__init21(){this._id=Ff.nextId()}__init22(){this._isChainStopped=!1}get _group(){return this._groupRef?this._groupRef:Of.shared}set _group(t){this._groupRef=t}constructor(t,e){Bf.prototype.__init.call(this),Bf.prototype.__init2.call(this),Bf.prototype.__init3.call(this),Bf.prototype.__init4.call(this),Bf.prototype.__init5.call(this),Bf.prototype.__init6.call(this),Bf.prototype.__init7.call(this),Bf.prototype.__init8.call(this),Bf.prototype.__init9.call(this),Bf.prototype.__init10.call(this),Bf.prototype.__init11.call(this),Bf.prototype.__init12.call(this),Bf.prototype.__init13.call(this),Bf.prototype.__init14.call(this),Bf.prototype.__init15.call(this),Bf.prototype.__init16.call(this),Bf.prototype.__init17.call(this),Bf.prototype.__init18.call(this),Bf.prototype.__init19.call(this),Bf.prototype.__init20.call(this),Bf.prototype.__init21.call(this),Bf.prototype.__init22.call(this),this._object=t,this._group=e}getId(){return this._id}getGroup(){return this._group}getTimescale(){return this._timescale}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}from(t){try{JSON.stringify(t)}catch(at){throw new Error("The object you provided to the from() method has a circular reference!")}return this._setupProperties(t,this._valuesStart,t,this._valuesStartRepeat,!0),this}to(t,e){try{this._valuesEnd=JSON.parse(JSON.stringify(t))}catch(at){return this.dynamicTo(t,e)}return e!==undefined&&(this._duration=e),this}dynamicTo(t,e){return this._valuesEnd=t,e!==undefined&&(this._duration=e),this}duration(t){return this._duration=t,this}start(t){return this._isPlaying||(t!=undefined&&(this._delayTime=t),this._group.add(this),this._reversed&&(this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat))),this._repeatCount=0,this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onAfterDelayCallbackFired=!1,this._isChainStopped=!1,this._startTime=-this._delayTime,this._elapsedTime=0,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,!1)),this}restart(t){return this.reset(),this.start(t)}reset(){return this._isPlaying&&this.stop(),this._valuesStart={},this._valuesStartRepeat={},this}rewind(){this._isPlaying&&this.stop(),this._reversed&&this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd);const t=this._easingFunction(0);return this._updateProperties(this._object,this._valuesStart,this._valuesEnd,t),this}_setupProperties(t,e,r,n,i){for(const s in r){const o=t[s],a=Array.isArray(o),l=!Number.isNaN(Number(o)),h=a?"array":typeof o,u="object"==h,c="object"==typeof r[s],d=!a&&Array.isArray(r[s]);"undefined"!=h&&"function"!=h&&r[s]!=undefined&&(a||l||u)&&((u||a||c)&&o&&!d?("undefined"==typeof e[s]&&(e[s]=a?[]:{}),"undefined"==typeof n[s]&&(n[s]=a?[]:{}),this._setupProperties(o,e[s],r[s],n[s],i)):(("undefined"==typeof e[s]||i)&&(e[s]=o),("undefined"==typeof n[s]||i)&&(n[s]=d?r[s].slice().reverse()[0]:e[s]||0)))}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object,this),this):this}end(t=!1){let e=[];if(t||(e=this._chainedTweens,this._chainedTweens=[]),this.resume(),this.update(Infinity),!t){this._chainedTweens=e;for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start()}return this}skip(t,e=!1){return this.resume(),this.update(t*this._duration-(e?this._elapsedTime:0)),this}pause(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this}resume(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}startChainedTweens(t=!1){t&&this.stop();for(let e=0,r=this._chainedTweens.length;e<r;e++)this._chainedTweens[e].start();return this}group(t){return this._group=t,this}delay(t){return this._delayTime=t,this}timescale(t){return this._timescale=t,this}repeat(t=Infinity){return this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!0){return this._yoyo=t,this}easing(t){return this._easingFunction=t,this}safetyCheck(t){return this._safetyCheckFunction=t,this}yoyoEasing(t){return this._yoyoEasingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onAfterDelay(t){return this._onAfterDelayCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t,e=!1){const r=this._internalUpdate(t);return r||e||this._group.remove(this),r}_internalUpdate(t){if(!this._safetyCheckFunction(this._object))return!1;if(this._isPaused)return!1;let e;t*=this._timescale,this._elapsedTime+=t;const r=this._duration,n=this._startTime+this._elapsedTime;if(n>r&&!this._isPlaying)return!1;this.isPlaying||this.start(),0==this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object,this),this._onStartCallbackFired=!0),0==this._onAfterDelayCallbackFired&&n>=0&&(this._onAfterDelayCallback&&this._onAfterDelayCallback(this._object,this),this._onAfterDelayCallbackFired=!0),e=n/this._duration,0==this._duration&&(e=n>=0?1:0),e=Math.min(1,e),e=Math.max(0,e);let i=Number.isFinite(n)?n%this._duration:n;Number.isNaN(i)&&(i=0);const s=Math.floor(n/this._duration);let o;if(o=this._reversed&&this._yoyoEasingFunction?this._yoyoEasingFunction(e):this._easingFunction(e),this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&(1!=e||this._repeat-this._repeatCount<=0)&&this._onUpdateCallback(this._object,e,this),1==e){if(this._repeat-this._repeatCount>0){const t=this._repeatCount;if(this._repeatCount=Math.min(this._repeat+1,this._repeatCount+s),this._onUpdateCallback&&(this._repeat-this._repeatCount<0||i<=0)&&this._onUpdateCallback(this._object,e,this),this._yoyo?this._swapEndStartRepeatValues(this._valuesStartRepeat,this._valuesEnd):this._moveForwardStartRepeatValues(this._valuesStartRepeat,this._valuesEnd),this._valuesStart=JSON.parse(JSON.stringify(this._valuesStartRepeat)),this._repeatDelayTime!==undefined?this._startTime=-this._repeatDelayTime:this._startTime=0,this._onRepeatCallback){let e=1;Number.isFinite(s)?e=this._repeatCount-t:Number.isFinite(this._repeat)&&(e=this._repeat-t);for(let r=0;r<e;r++)this._onRepeatCallback(this._object,t+1+r,this)}if(this._elapsedTime=0,this._repeat-this._repeatCount>=0)return i>0&&Number.isFinite(this._repeat)&&this._internalUpdate(i),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object,this);for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start(),i>0&&this._chainedTweens[t].update(i);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,r,n){for(const i in r){if(e[i]==undefined)continue;const s=e[i];let o=r[i];const a=Array.isArray(t[i]),l=Array.isArray(o);!a&&l?this._reversed?t[i]=this._interpolationFunction(o.concat([s]),n):t[i]=this._interpolationFunction([s].concat(o),n):"object"==typeof o&&o?this._updateProperties(t[i],s,o,n):(o=this._handleRelativeValue(s,o),"number"!=typeof o||"number"!=typeof s&&"string"!=typeof s||(t[i]=Number(s)+(o-Number(s))*n,"string"==typeof s&&(t[i]=String(t[i]))))}}_handleRelativeValue(t,e){return"string"!=typeof e?e:"+"==e.charAt(0)||"-"==e.charAt(0)?t+Number(e):Number(e)}_swapEndStartRepeatValues(t,e){for(const r in t){const n=!Array.isArray(t[r])&&Array.isArray(e[r]);if("object"==typeof t[r])this._swapEndStartRepeatValues(t[r],e[r]);else{const i=t[r];if("string"==typeof e[r])t[r]=Number(t[r])+Number(e[r]),e[r]=i;else if(n){const n=e[r].slice().reverse();t[r]=n[0],e[r]=n}else t[r]=e[r],e[r]=i}}}_moveForwardStartRepeatValues(t,e){for(const r in t)"object"==typeof e[r]?this._moveForwardStartRepeatValues(t[r],e[r]):"string"==typeof e[r]&&(t[r]=Number(t[r])+Number(e[r]))}}var kf=Object.defineProperty,Uf=(t,e,r)=>(((t,e,r)=>{e in t?kf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);class Gf extends Es{constructor(){super(),Uf(this,"pauseUpdateOnFocusLost",!0),Uf(this,"pauseTweenOnFocusLost"),Uf(this,"tweens"),Uf(this,"events"),Uf(this,"index"),Uf(this,"stages"),Uf(this,"closeHandler"),this.stages=[this],this.tweens=new Of,this.events=new W,this.name=this.constructor.name}requestClose(){return t=this,e=null,r=function*(){return this.closeHandler(),yield Promise.resolve(),!0},new Promise(((n,i)=>{var s=t=>{try{a(r.next(t))}catch(at){i(at)}},o=t=>{try{a(r["throw"](t))}catch(at){i(at)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,o);a((r=r.apply(t,e)).next())}));var t,e,r}onPopupOpen(t,e){}onPopupClose(t,e){}onSceneOpen(t,e){}onSceneClose(t,e){}onStart(){}onShow(){}onDestroy(t){}onFocus(){}onFocusLost(){}onResize(t,e){}onPause(){}onResume(){}update(t){}onMessage(t){}destroy(){if(this.stages)for(const t of this.stages)t&&t!=this&&t.destroy({children:!0});this.tweens.removeAll(),this.events.removeAllListeners(),super.destroy({children:!0})}}class jf extends Gf{constructor(){super()}startCovering(){return Promise.resolve()}startResolving(){return Promise.resolve(void 0)}startUncovering(){return Promise.resolve()}onDownloadProgress(t,e){}}var Vf=(t=>(t.BACKSPACE="Backspace",t.TAB="Tab",t.ENTER="Enter",t.SHIFT="ShiftLeft",t.CTRL="ControlLeft",t.ALT="AltLeft",t.PAUSE="Pause",t.CAPS_LOCK="CapsLock",t.ESCAPE="Escape",t.SPACE="Space",t.PAGE_UP="PageUp",t.PAGE_DOWN="PageDown",t.END="End",t.HOME="Home",t.LEFT_ARROW="ArrowLeft",t.UP_ARROW="ArrowUp",t.RIGHT_ARROW="ArrowRight",t.DOWN_ARROW="ArrowDown",t.INSERT="Insert",t.DELETE="Delete",t.KEY_0="Digit0",t.KEY_1="Digit1",t.KEY_2="Digit2",t.KEY_3="Digit3",t.KEY_4="Digit4",t.KEY_5="Digit5",t.KEY_6="Digit6",t.KEY_7="Digit7",t.KEY_8="Digit8",t.KEY_9="Digit9",t.KEY_A="KeyA",t.KEY_B="KeyB",t.KEY_C="KeyC",t.KEY_D="KeyD",t.KEY_E="KeyE",t.KEY_F="KeyF",t.KEY_G="KeyG",t.KEY_H="KeyH",t.KEY_I="KeyI",t.KEY_J="KeyJ",t.KEY_K="KeyK",t.KEY_L="KeyL",t.KEY_M="KeyM",t.KEY_N="KeyN",t.KEY_O="KeyO",t.KEY_P="KeyP",t.KEY_Q="KeyQ",t.KEY_R="KeyR",t.KEY_S="KeyS",t.KEY_T="KeyT",t.KEY_U="KeyU",t.KEY_V="KeyV",t.KEY_W="KeyW",t.KEY_X="KeyX",t.KEY_Y="KeyY",t.KEY_Z="KeyZ",t.LEFT_META="MetaLeft",t.RIGHT_META="MetaRight",t.SELECT="Select",t.NUMPAD_0="Numpad0",t.NUMPAD_1="Numpad1",t.NUMPAD_2="Numpad2",t.NUMPAD_3="Numpad3",t.NUMPAD_4="Numpad4",t.NUMPAD_5="Numpad5",t.NUMPAD_6="Numpad6",t.NUMPAD_7="Numpad7",t.NUMPAD_8="Numpad8",t.NUMPAD_9="Numpad9",t.MULTIPLY="NumpadMultiply",t.ADD="NumpadAdd",t.SUBTRACT="NumpadSubtract",t.DECIMAL="NumpadDecimal",t.DIVIDE="NumpadDivide",t.NUMPAD_ENTER="NumpadEnter",t.F1="F1",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.F10="F10",t.F11="F11",t.F12="F12",t.NUM_LOCK="NumLock",t.SCROLL_LOCK="ScrollLock",t.SEMICOLON="Semicolon",t.EQUALS="Equal",t.COMMA="Comma",t.DASH="Minus",t.PERIOD="Period",t.FORWARD_SLASH="Slash",t.GRAVE_ACCENT="Backquote",t.OPEN_BRACKET="BracketLeft",t.BACK_SLASH="Backslash",t.CLOSE_BRACKET="BracketRight",t.SINGLE_QUOTE="Quote",t.ANY="AnyKey",t))(Vf||{});const Hf={8:"Backspace",9:"Tab",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",65:"KeyA",66:"KeyB",67:"KeyC",68:"KeyD",69:"KeyE",70:"KeyF",71:"KeyG",72:"KeyH",73:"KeyI",74:"KeyJ",75:"KeyK",76:"KeyL",77:"KeyM",78:"KeyN",79:"KeyO",80:"KeyP",81:"KeyQ",82:"KeyR",83:"KeyS",84:"KeyT",85:"KeyU",86:"KeyV",87:"KeyW",88:"KeyX",89:"KeyY",90:"KeyZ",91:"MetaLeft",92:"MetaRight",93:"Select",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Semicolon",187:"Equal",188:"Comma",189:"Minus",190:"Period",191:"Slash",192:"Backquote",219:"BracketLeft",220:"Backslash",221:"BracketRight",222:"Quote"};var zf=Object.defineProperty,Wf=(t,e,r)=>(((t,e,r)=>{e in t?zf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);const Xf=class{constructor(){Wf(this,"isDownMap",new Map),Wf(this,"previousFrame",new Map),Wf(this,"justPressedMap",new Map),Wf(this,"justReleasedMap",new Map),Wf(this,"pressed",new W),Wf(this,"released",new W),Wf(this,"stopRaf",!1),Wf(this,"keydown"),Wf(this,"keyUp"),Wf(this,"_enabled",!0),this.keydown=t=>{if(this.enabled){let e=t.code;e||(e=Hf[t.keyCode]),e&&(this.isDownMap.set(e,!0),this.pressed.emit(e,t)),this.pressed.emit(Vf.ANY,t)}},window.addEventListener("keydown",this.keydown),this.keyUp=t=>{if(this.enabled){let e=t.code;e||(e=Hf[t.keyCode]),e&&(this.isDownMap.set(e,!1),this.released.emit(e,t)),this.released.emit(Vf.ANY,t)}},window.addEventListener("keyup",this.keyUp),this.update()}get enabled(){return this._enabled}set enabled(t){!t&&this._enabled&&this.clearState(),this._enabled=t}update(){this.enabled&&(this.isDownMap.forEach(((t,e)=>{t&&!this.previousFrame.get(e)?this.justPressedMap.set(e,!0):this.justPressedMap.set(e,!1),!t&&this.previousFrame.get(e)?this.justReleasedMap.set(e,!0):this.justReleasedMap.set(e,!1)})),this.isDownMap.forEach(((t,e)=>{this.previousFrame.set(e,t)}))),this.stopRaf||requestAnimationFrame(this.update.bind(this))}isDown(t){if(t==Vf.ANY){let t=!1;return this.isDownMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.isDownMap.get(t))}justPressed(t){if(t==Vf.ANY){let t=!1;return this.justPressedMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.justPressedMap.get(t))}justReleased(t){if(t==Vf.ANY){let t=!1;return this.justReleasedMap.forEach((e=>e?t=!0:void 0)),t}return Boolean(this.justReleasedMap.get(t))}removeAllListeners(){this.pressed.removeAllListeners(),this.released.removeAllListeners()}clearState(){this.isDownMap.clear(),this.previousFrame.clear(),this.justPressedMap.clear(),this.justReleasedMap.clear()}destroy(){this.removeAllListeners(),this.clearState(),this!=Xf.shared&&(this.stopRaf=!0,window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyUp))}};let Yf=Xf;function Kf(t,e){return t.map(((t,e)=>({item:t,index:e}))).sort(((t,r)=>e(t.item,r.item)||t.index-r.index)).map((({item:t})=>t))}Wf(Yf,"shared",new Xf);var $f,qf,Qf=i(466),Jf=i.n(Qf);(qf=$f||($f={})).NEW=Symbol("scene_created"),qf.DESTROY=Symbol("scene_destroyed"),qf.START=Symbol("scene_started"),qf.SHOW=Symbol("scene_shown");var Zf=Object.defineProperty,tp=(t,e,r)=>(((t,e,r)=>{e in t?Zf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r),ep=(t,e,r)=>new Promise(((n,i)=>{var s=t=>{try{a(r.next(t))}catch(at){i(at)}},o=t=>{try{a(r["throw"](t))}catch(at){i(at)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,o);a((r=r.apply(t,e)).next())}));var rp=Object.defineProperty,np=(t,e,r)=>(((t,e,r)=>{e in t?rp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);const ip=class{constructor(){}static initialize(t,e="1",r=(t=>({}))){ip.instance=t,ip.savedataVersion=e,ip.savedataConflictSolver=r}static save(t){return ip.instance?ip.instance.save(null!=t?t:ip.DEFAULT_SAVESLOT):Promise.reject("You didn't call Initialize!")}static load(t){return e=this,r=null,n=function*(){if(!ip.instance)return Promise.reject("You didn't call Initialize!");yield ip.instance.load(null!=t?t:ip.DEFAULT_SAVESLOT);const e=yield ip.instance.getSavedataVersion(null!=t?t:ip.DEFAULT_SAVESLOT);e!=ip.savedataVersion&&(ip.instance.internalMap=this.savedataConflictSolver(ip.instance.internalMap,e),yield ip.instance.setSavedataVersion(ip.savedataVersion,null!=t?t:ip.DEFAULT_SAVESLOT),yield ip.save(null!=t?t:ip.DEFAULT_SAVESLOT))},new Promise(((t,i)=>{var s=t=>{try{a(n.next(t))}catch(at){i(at)}},o=t=>{try{a(n["throw"](t))}catch(at){i(at)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,r)).next())}));var e,r,n}static"delete"(t){return ip.instance?ip.instance["delete"](null!=t?t:ip.DEFAULT_SAVESLOT):Promise.reject("You didn't call Initialize!")}static getValue(t){return ip.instance?ip.instance.getValue(t):null}static setValue(t,e){return ip.instance?ip.instance.setValue(t,e):null}};let sp=ip;np(sp,"instance"),np(sp,"savedataVersion"),np(sp,"savedataConflictSolver"),np(sp,"DEFAULT_SAVESLOT",`SAVEDATA_${Cf}`);var op=Object.defineProperty,ap=(t,e,r)=>(((t,e,r)=>{e in t?op(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);const lp=class{constructor(){}static idealScale(t=1,e,r,n=lp.IDEAL_WIDTH,i=lp.IDEAL_HEIGHT,s=lp.DEFAULT_TIEBREAKER){return s(e/n,r/i)*t}static setScaleRelativeToScreen(t,e,r,n,i,s=lp.DEFAULT_TIEBREAKER){const o=t.getLocalBounds();return t.scale.set(s(e*n/o.width,r*i/o.height)),t.scale.x}static screenScale(t,e,r,n,i,s,o=lp.DEFAULT_TIEBREAKER){return o(r*(null!=i?i:1)/t,n*(null!=s?s:1)/e)}static screenScale1D(t,e,r){return e*(null!=r?r:1)/t}static setScaleRelativeToIdeal(t,e,r,n=lp.IDEAL_WIDTH,i=lp.IDEAL_HEIGHT,s=lp.DEFAULT_TIEBREAKER){return t.scale.set(s(e/n,r/i)),t.scale.x}static forceWidth(t,e){return t}static forceHeight(t,e){return e}};let hp=lp;ap(hp,"IDEAL_WIDTH",1920),ap(hp,"IDEAL_HEIGHT",1080),ap(hp,"DEFAULT_TIEBREAKER",Math.min),ap(hp,"FILL",Math.max),ap(hp,"FIT",Math.min);var up=i(483),cp=i.n(up),dp=Object.defineProperty,fp=(t,e,r)=>(((t,e,r)=>{e in t?dp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r),pp=(t,e,r)=>new Promise(((n,i)=>{var s=t=>{try{a(r.next(t))}catch(at){i(at)}},o=t=>{try{a(r["throw"](t))}catch(at){i(at)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,o);a((r=r.apply(t,e)).next())}));var mp=Object.defineProperty,gp=(t,e,r)=>(((t,e,r)=>{e in t?mp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);var _p=Object.defineProperty,yp=(t,e,r)=>(((t,e,r)=>{e in t?_p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);var vp=Object.defineProperty,xp=(t,e,r)=>(((t,e,r)=>{e in t?vp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);const bp=class extends W{static initialize(){return t=this,e=null,r=function*(){return new Promise(((t,e)=>{(async(...t)=>{const e=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),r=await(e?Promise.all([i.e(466),i.e(921)]).then(i.bind(i,666)):Promise.all([i.e(337),i.e(289)]).then(i.bind(i,337))),{"default":n}=r;return await n(...t)})().then((e=>{bp.box2D=e,t()}))["catch"]((t=>{e(t)}))}))},new Promise(((n,i)=>{var s=t=>{try{a(r.next(t))}catch(at){i(at)}},o=t=>{try{a(r["throw"](t))}catch(at){i(at)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,o);a((r=r.apply(t,e)).next())}));var t,e,r}static getVec2(t,e){return"number"==typeof t?new bp.box2D.b2Vec2(t,e):new bp.box2D.b2Vec2(t.x,t.y)}static createb2World(t){var e,r;bp.world,bp.world=new bp.box2D.b2World(new bp.box2D.b2Vec2(null!=(e=null==t?void 0:t.x)?e:0,null!=(r=null==t?void 0:t.y)?r:0));const n=new bp.box2D.JSContactListener;n.BeginContact=bp.onBeginContact.bind(bp),n.EndContact=bp.onEndContact.bind(bp),n.PreSolve=bp.onPreSolve.bind(bp),n.PostSolve=bp.onPostSolve.bind(bp),bp.world.SetContactListener(n)}static createBoxBody(t){const e=new bp.box2D.b2PolygonShape;return e.SetAsBox(t.size.width/2,t.size.height/2),bp.createBody(t,e)}static createCircleBody(t){const e=new bp.box2D.b2CircleShape;return e.set_m_radius(t.radius),bp.createBody(t,e)}static createPolygonBody(t){const e=bp.createPolygonShape(t.vertices.map((t=>new bp.box2D.b2Vec2(t.x,t.y))));return bp.createBody(t,e)}static getBody(t){return bp.bodies.getByValue(t)}static getDisplayObject(t){return bp.bodies.get(t)}static update(t){var e;null==(e=bp.world)||e.Step(t/1e3,8,3);const r=new Array;bp.bodies.forEach(((t,e)=>{if(e.toDestroy||t.destroyed)r.push(e);else{const r=e.GetPosition();t.position.set(r.get_x(),r.get_y()),t.rotation=e.GetAngle()}}));for(const n of r)bp.bodies["delete"](n),bp.world.DestroyBody(n)}static quitAndDestroyBody(t){const e=bp.bodies.getByValue(t);this.destroyBody(e)}static destroyBody(t){t.SetEnabled(!1),t.toDestroy=!0}static changeCategoryBits(t,e){(t instanceof _s?bp.bodies.getByValue(t):t).GetFixtureList().GetFilterData().set_categoryBits(e)}static changeMaskBits(t,e){(t instanceof _s?bp.bodies.getByValue(t):t).GetFixtureList().GetFilterData().set_maskBits(e)}static clearWorld(){bp.bodies.clear(),bp.onBeginContacts.clear(),bp.onEndContacts.clear(),bp.onPreSolveContacts.clear(),bp.onPostSolveContacts.clear(),bp.world.__destroy__(),bp.world=null}static updatePositionFromDisplayObject(t){if(t instanceof _s){const e=t;bp.bodies.getByValue(e).SetTransform(new bp.box2D.b2Vec2(e.x,e.y),e.rotation)}else{const e=t,r=bp.bodies.get(e);e.SetTransform(new bp.box2D.b2Vec2(r.x,r.y),r.rotation)}}static createBody(t,e){var r,n,i,s;const o=new bp.box2D.b2BodyDef;o.set_type(t.type),null!=t.initialPosition&&(o.set_position(new bp.box2D.b2Vec2(t.initialPosition.x,t.initialPosition.y)),t.displayObject.position.set(t.initialPosition.x,t.initialPosition.y)),null!=t.initialAngle&&(o.set_angle(t.initialAngle),t.displayObject.rotation=t.initialAngle);const a=bp.world.CreateBody(o),l=a.CreateFixture(e,null!=(r=t.mass)?r:0);l.SetFriction(null!=(n=t.friction)?n:0),l.SetRestitution(null!=(i=t.restitution)?i:0),l.SetSensor(t.isSensor);const h=l.GetFilterData();return null!=t.categoryBits&&h.set_categoryBits(t.categoryBits),null!=t.maskBits&&h.set_maskBits(t.maskBits),bp.bodies.set(a,t.displayObject),a.SetEnabled(null==(s=t.enabled)||s),null!=t.onBeginContact&&bp.onBeginContacts.set(a,t.onBeginContact),null!=t.onEndContact&&bp.onEndContacts.set(a,t.onEndContact),null!=t.onPreSolve&&bp.onPreSolveContacts.set(a,t.onPreSolve),null!=t.onPostSolve&&bp.onPostSolveContacts.set(a,t.onPostSolve),a}static onBeginContact(t){var e,r;const n=bp.box2D.wrapPointer(t,bp.box2D.b2Contact),i=n.GetFixtureA().GetBody(),s=n.GetFixtureB().GetBody(),o=bp.bodies.get(i),a=bp.bodies.get(s);null==(e=bp.onBeginContacts.get(i))||e({contact:n,body:i,anotherBody:s,displayObject:o,anotherDisplayObject:a}),null==(r=bp.onBeginContacts.get(s))||r({contact:n,body:s,anotherBody:i,displayObject:a,anotherDisplayObject:o})}static onEndContact(t){var e,r;const n=bp.box2D.wrapPointer(t,bp.box2D.b2Contact),i=n.GetFixtureA().GetBody(),s=n.GetFixtureB().GetBody(),o=bp.bodies.get(i),a=bp.bodies.get(s);null==(e=bp.onEndContacts.get(i))||e({contact:n,body:i,anotherBody:s,displayObject:o,anotherDisplayObject:a}),null==(r=bp.onEndContacts.get(s))||r({contact:n,body:s,anotherBody:i,displayObject:a,anotherDisplayObject:o})}static onPreSolve(t,e){var r,n;const i=bp.box2D.wrapPointer(t,bp.box2D.b2Contact),s=bp.box2D.wrapPointer(e,bp.box2D.b2Manifold),o=i.GetFixtureA().GetBody(),a=i.GetFixtureB().GetBody(),l=bp.bodies.get(o),h=bp.bodies.get(a);null==(r=bp.onPreSolveContacts.get(o))||r({contact:i,body:o,anotherBody:a,displayObject:l,anotherDisplayObject:h,oldManifold:s}),null==(n=bp.onPreSolveContacts.get(a))||n({contact:i,body:a,anotherBody:o,displayObject:h,anotherDisplayObject:l,oldManifold:s})}static onPostSolve(t,e){var r,n;const i=bp.box2D.wrapPointer(t,bp.box2D.b2Contact),s=bp.box2D.wrapPointer(e,bp.box2D.b2ContactImpulse),o=i.GetFixtureA().GetBody(),a=i.GetFixtureB().GetBody(),l=bp.bodies.get(o),h=bp.bodies.get(a);null==(r=bp.onPostSolveContacts.get(o))||r({contact:i,body:o,anotherBody:a,displayObject:l,anotherDisplayObject:h,impulse:s}),null==(n=bp.onPostSolveContacts.get(a))||n({contact:i,body:a,anotherBody:o,displayObject:h,anotherDisplayObject:l,impulse:s})}static createPolygonShape(t){const{_malloc:e,b2Vec2:r,b2PolygonShape:n,HEAPF32:i,wrapPointer:s}=bp.box2D,o=new n,a=e(8*t.length);let l=0;for(let u=0;u<t.length;u++)i[a+l>>2]=t[u].get_x(),i[a+(l+4)>>2]=t[u].get_y(),l+=8;const h=s(a,r);return o.Set(h,t.length),o}};let Ep=bp;xp(Ep,"box2D"),xp(Ep,"world"),xp(Ep,"bodies",new class{constructor(){yp(this,"keyValueMap"),yp(this,"valueKeyMap"),this.keyValueMap=new Map,this.valueKeyMap=new Map}set(t,e){this.keyValueMap.set(t,e),this.valueKeyMap.set(e,t)}get(t){return this.keyValueMap.get(t)}getByValue(t){return this.valueKeyMap.get(t)}"delete"(t){const e=this.keyValueMap.get(t);this.keyValueMap["delete"](t),this.valueKeyMap["delete"](e)}clear(){this.keyValueMap.clear(),this.valueKeyMap.clear()}forEach(t,e){this.keyValueMap.forEach(t,e)}}),xp(Ep,"onBeginContacts",new Map),xp(Ep,"onEndContacts",new Map),xp(Ep,"onPreSolveContacts",new Map),xp(Ep,"onPostSolveContacts",new Map);var Tp=Object.defineProperty,Ap=(t,e,r)=>(((t,e,r)=>{e in t?Tp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);const wp=class extends Gf{constructor(){super(),Ap(this,"impala"),Ap(this,"road"),Ap(this,"hauntedhouse"),Ap(this,"firstperson"),Ap(this,"dragon"),Ap(this,"cameraControl"),Ap(this,"idle",!0),Ap(this,"zoomCameraControl"),this.impala=Ga.from(ls.get("impala")),this.road=Ga.from(ls.get("road")),this.hauntedhouse=Ga.from(ls.get("hauntedhouse")),this.firstperson=Ga.from(ls.get("firstperson")),this.dragon=Ga.from(ls.get("dragon")),this.firstperson.scale.set(.03,.03,.03),this.firstperson.y=50,this.impala.x=20,this.impala.y=1,this.impala.scale.set(30,30,30),this.hauntedhouse.x=50,this.addChild(this.impala,this.road,this.hauntedhouse,this.firstperson,this.dragon);const t=new ja;t.type=Fo.directional,t.intensity=5,t.color=new ea(1,1,1),t.rotationQuaternion.setEulerAngles(45,-75,0),Zo.main.lights.push(t);const e=new ja;e.type=Fo.directional,e.intensity=5,e.color=new ea(1,1,1),e.rotationQuaternion.setEulerAngles(45,75,0),Zo.main.lights.push(e);const r=new ja;r.type=Fo.directional,r.intensity=5,r.color=new ea(1,1,1),r.rotationQuaternion.setEulerAngles(-80,0,-45),Zo.main.lights.push(r),this.cameraControl=Hp,this.cameraControl.distance=0,this.cameraControl.target.x=0,this.cameraControl.target.y=2,this.cameraControl.target.z=50,this.zoomCameraControl=Hp,this.zoomCameraControl.distance=0,this.zoomCameraControl.target.x=0,this.cameraControl.target.y=2,this.cameraControl.target.z=50,this.hauntedhouse.animations[0].loop=!0,this.hauntedhouse.animations[0].play(),this.hauntedhouse.scale.set(3),this.hauntedhouse.meshes.forEach((t=>{const e=t.material;e.exposure=1.1,e.roughness=.6,e.metallic=0})),this.dragon.z=-500,this.dragon.animations[0].loop=!0,this.dragon.animations[0].play(),this.dragon.scale.set(15),this.dragon.meshes.forEach((t=>{const e=t.material;e.exposure=1.1,e.roughness=.6,e.metallic=0}))}update(t){if(super.update(t),this.firstperson.position.set(this.cameraControl.target.x,this.cameraControl.target.y,this.cameraControl.target.z),this.firstperson.rotationQuaternion.setEulerAngles(this.cameraControl.angles.x,this.cameraControl.angles.y,0),this.firstperson.position.y=this.cameraControl.target.y+Math.cos(performance.now()*wp.handMovementFrequency)*wp.handMovementAmplitude,this.dragon.z+=3*wp.vehiculeSpeed,Yf.shared.isDown("KeyW")||Yf.shared.isDown("KeyS")||Yf.shared.isDown("KeyA")||Yf.shared.isDown("KeyD")){const t=Hp.angles.y*(Math.PI/180),e=Hp.angles.x*(Math.PI/180),r=wp.cameraMoveSpeed*Math.cos(t),n=wp.cameraMoveSpeed*Math.sin(t),i=wp.cameraMoveSpeed*Math.sin(e);Yf.shared.isDown("KeyW")&&(Hp.target.z+=r,Hp.target.x+=n,Hp.target.y-=i),Yf.shared.isDown("KeyS")&&(Hp.target.z-=r,Hp.target.x-=n,Hp.target.y+=i),Yf.shared.isDown("KeyA")&&(Hp.target.z-=n,Hp.target.x+=r),Yf.shared.isDown("KeyD")&&(Hp.target.z+=n,Hp.target.x-=r)}if(Yf.shared.isDown("Space")&&(Hp.target.y+=wp.cameraMoveSpeed),Yf.shared.isDown("Enter")&&(this.idle?this.idle=!1:this.idle=!0),Yf.shared.isDown("ArrowUp")&&(Hp.angles.x-=2),Yf.shared.isDown("ArrowLeft")&&(Hp.angles.y+=2),Yf.shared.isDown("ArrowRight")&&(Hp.angles.y-=2),Yf.shared.isDown("ArrowDown")&&(Hp.angles.x+=2),Yf.shared.isDown("KeyR")&&(this.impala.z+=wp.vehiculeSpeed),Yf.shared.isDown("KeyF")&&(this.impala.z-=wp.vehiculeSpeed),Yf.shared.isDown("KeyE")&&(this.impala.position.set(this.cameraControl.target.x+1,this.cameraControl.target.y-2.7,this.cameraControl.target.z),this.impala.rotationQuaternion.setEulerAngles(this.cameraControl.angles.x,this.cameraControl.angles.y,0),this.impala.z+=wp.vehiculeSpeed),Yf.shared.justPressed("NumpadSubtract")&&new Bf(this.cameraControl).to({distance:5},500).start(),Yf.shared.justPressed("NumpadAdd")&&new Bf(this.cameraControl).to({distance:0},500).start(),Yf.shared.isDown("KeyV")){const t=.5;this.zoomCameraControl.distance-=t,this.zoomCameraControl.distance<0&&(this.zoomCameraControl.distance=0),this.firstperson.position.set(this.zoomCameraControl.target.x,this.zoomCameraControl.target.y,this.zoomCameraControl.target.z),this.firstperson.rotationQuaternion.setEulerAngles(this.zoomCameraControl.angles.x,this.zoomCameraControl.angles.y,0)}}};let Sp=wp;var Cp;function Rp(t,e,r){return Math.min(Math.max(t,e),r)}function Ip(t,e,r){return t*(1-r)+e*r}Ap(Sp,"BUNDLES",["3d"]),Ap(Sp,"handMovementAmplitude",.05),Ap(Sp,"handMovementFrequency",.005),Ap(Sp,"cameraMoveSpeed",.2),Ap(Sp,"vehiculeSpeed",.4),Ap(Sp,"cameraRotationSpeed",.01),Ap(Sp,"GRAVITY",200),(Cp||(Cp={})).promisify=function(t){const e=t._onCompleteCallback;return new Promise((r=>{t.onComplete(((t,n)=>{e&&e(t,n),r({object:t,tween:n})}))}))};Math.pow(2,-16);var Pp=Object.defineProperty,Mp=(t,e,r)=>(((t,e,r)=>{e in t?Pp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r);class Op extends Es{constructor(t){var e,r,n,i,s,o,a,l;super(),Mp(this,"uniforms"),Mp(this,"_min"),Mp(this,"_max"),Mp(this,"_value"),Mp(this,"_ratio"),Mp(this,"_anchor"),Mp(this,"_animatedRatio"),Mp(this,"barContainer"),Mp(this,"quad"),Mp(this,"background"),Mp(this,"startCap"),Mp(this,"endCap"),Mp(this,"content"),Mp(this,"reverse"),Mp(this,"tween"),Mp(this,"capRadius"),this._anchor=new ur(this.updateAnchor,this,t.anchorX,t.anchorY);const{outerRadius:h,innerRadius:u}=t;let c;if(c="number"==typeof t.colors?[{color:t.colors,stop:1}]:Array.from(t.colors),c.length>9)for(;c.length>9;)c.pop();const d=(new Ve).addAttribute("aVertexPosition",[-h,-h,h,-h,h,h,-h,h],2).addAttribute("aUvs",[0,0,1,0,1,1,0,1],2).addIndex([0,1,2,0,2,3]);this.uniforms={progress:0|t.initialValue,thicknessInPixels:h-u,radiusInPixels:h,smoothingInPixels:null!=(e=t.overrideSmoothingSize)?e:1,colors:c.reduce(((t,e)=>{var r;return t.concat(this.hexToShader(e.color),[null!=(r=e.alpha)?r:1])}),[]),colorStops:c.map((t=>t.stop)),colorCount:c.length,fixedPattern:Boolean(t.fixed),uWorldAlpha:this.worldAlpha,reverse:Boolean(t.reverse)};const f=Or.from("attribute vec2 aVertexPosition;\r\nattribute vec2 aUvs;\r\n\r\nuniform mat3 translationMatrix;\r\nuniform mat3 projectionMatrix;\r\n\r\nvarying vec2 vUvs;\r\n\r\nvoid main() {\r\n\r\n  vUvs = aUvs;\r\n  gl_Position = vec4(\r\n      (projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy,\r\n      0.0, 1.0);\r\n}","\r\n#define PI 3.1415926538\r\n\r\nvarying vec2 vUvs;\r\n\r\nuniform float progress;\r\nuniform float thicknessInPixels;\r\nuniform float radiusInPixels;\r\nuniform float smoothingInPixels;\r\n\r\nuniform vec4 colors[9];\r\nuniform float colorStops[9];\r\nuniform float colorCount;\r\n\r\nuniform float fixedPattern;\r\nuniform float reverse;\r\n\r\nuniform float uWorldAlpha;\r\n\r\nfloat radToAlpha(float rad) {\r\n  float normalizedThickness = (thicknessInPixels / radiusInPixels) * 0.5;\r\n  float normalizedInnerRadius = 0.5 - normalizedThickness;\r\n  float normalizedFade = smoothingInPixels / radiusInPixels;\r\n\r\n  float innerCutout = step(normalizedInnerRadius + normalizedFade, rad);\r\n  float outerCutout = step(rad, 0.5 - normalizedFade);\r\n\r\n  float innerFade = smoothstep(normalizedInnerRadius,\r\n                               normalizedInnerRadius + normalizedFade, rad);\r\n  float outerFade = smoothstep(0.5 - normalizedFade, 0.5, rad);\r\n  // float alpha2 = smoothstep(0.5, rad, 0.5);\r\n\r\n  return innerFade - outerFade;\r\n}\r\n\r\nfloat arcToAlpha(float arc, float t) {\r\n  float regular = step(PI * -1.0, arc) * step(arc, mix(PI * -1.0, PI, t));\r\n  float reversed = step(mix(PI * -1.0, PI, t), arc) * step(arc, PI);\r\n\r\n  return mix(regular, reversed, reverse);\r\n}\r\n\r\nvec4 arcToColor(float arc, float t) {\r\n\r\n  float progressToUse = mix(t, 1.0, fixedPattern); // fixedPattern ? 1 : t\r\n\r\n  float progressInArcRegular = mix(0.01, PI * 2.0, progressToUse);\r\n  float arcProgressRegular = (arc + PI) / progressInArcRegular;\r\n\r\n  float progressInArcReversed = mix(-PI * 2.0, 0.01, progressToUse);\r\n  float arcProgressReversed = (arc - PI) / progressInArcReversed;\r\n\r\n  // Reverse?\r\n  float arcProgress = mix(arcProgressRegular, arcProgressReversed, reverse);\r\n\r\n  if (arcProgress < colorStops[0] || colorCount <= 1.0) {\r\n    // special case for the first one\r\n    return colors[0];\r\n  } else if (arcProgress < colorStops[1] || colorCount <= 2.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[0], colorStops[1], arcProgress);\r\n    return mix(colors[0], colors[1], correctedProgress);\r\n  } else if (arcProgress < colorStops[2] || colorCount <= 3.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[1], colorStops[2], arcProgress);\r\n    return mix(colors[1], colors[2], correctedProgress);\r\n  } else if (arcProgress < colorStops[3] || colorCount <= 4.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[2], colorStops[3], arcProgress);\r\n    return mix(colors[2], colors[3], correctedProgress);\r\n  } else if (arcProgress < colorStops[4] || colorCount <= 5.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[3], colorStops[4], arcProgress);\r\n    return mix(colors[3], colors[4], correctedProgress);\r\n  } else if (arcProgress < colorStops[5] || colorCount <= 6.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[4], colorStops[5], arcProgress);\r\n    return mix(colors[4], colors[5], correctedProgress);\r\n  } else if (arcProgress < colorStops[6] || colorCount <= 7.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[5], colorStops[6], arcProgress);\r\n    return mix(colors[5], colors[6], correctedProgress);\r\n  } else if (arcProgress < colorStops[7] || colorCount <= 8.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[6], colorStops[7], arcProgress);\r\n    return mix(colors[6], colors[7], correctedProgress);\r\n  } else if (arcProgress < colorStops[8] || colorCount <= 9.0) {\r\n    float correctedProgress =\r\n        smoothstep(colorStops[7], colorStops[8], arcProgress);\r\n    return mix(colors[7], colors[8], correctedProgress);\r\n  } else {\r\n    // special case for the last one\r\n    return colors[7];\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  // invert progress if needed.\r\n  float t = mix(progress, 1.0 - progress, reverse);\r\n\r\n  float dX = 0.5 - vUvs.x;\r\n  float dY = 0.5 - vUvs.y;\r\n  float rad = sqrt(dX * dX + dY * dY);\r\n  float arc = atan(dX, -dY);\r\n\r\n  vec4 finalColor = arcToColor(arc, t);\r\n\r\n  finalColor.a *= radToAlpha(rad) * arcToAlpha(arc, t) * uWorldAlpha;\r\n  finalColor.rgb *= finalColor.a;\r\n\r\n  gl_FragColor = finalColor;\r\n}",this.uniforms);this.quad=new _u(d,f),this.background=t.background?ws.from(t.background):ws.from(Jr.EMPTY),this.background.anchor.set(.5);const p=h-u-2*(null!=(r=t.overrideSmoothingSize)?r:1);this.capRadius=null!=(n=t.capRadius)?n:(u+h)/2,this.startCap=new du,this.startCap.beginFill(c[0].color,null!=(i=c[0].alpha)?i:1),this.startCap.drawCircle(0,0,p/2),this.startCap.endFill(),this.startCap.visible=t.startCap,this.endCap=new du,this.endCap.beginFill(c[c.length-1].color,null!=(s=c[c.length-1].alpha)?s:1),this.endCap.drawCircle(0,0,p/2),this.endCap.endFill(),this.endCap.visible=t.endCap,this.reverse=Boolean(t.reverse),this.barContainer=new Es,this.barContainer.addChild(this.quad),this.barContainer.addChild(this.startCap),this.barContainer.addChild(this.endCap),this.content=new Es,this.content.addChild(this.background),this.content.addChild(this.barContainer),this.addChild(this.content),this._min=null!=(o=t.minValue)?o:0,this._max=null!=(a=t.maxValue)?a:1,this.value=null!=(l=t.initialValue)?l:0}get min(){return this._min}set min(t){this._min=t,this.updateValue()}get max(){return this._max}set max(t){this._max=t,this.updateValue()}get value(){return this._value}set value(t){this._value=t,this.updateValue()}get ratio(){return this._ratio}set ratio(t){this._value=t*(this._max-this._min)+this._min,this.updateValue()}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get animatedRatio(){return this._animatedRatio}get animatedValue(){return this.animatedRatio*(this.max-this.min)+this.min}updateValue(t,e){var r;null!=t&&(this._value=t),null==(r=this.tween)||r.stop(),this._ratio=Rp((this._value-this._min)/(this._max-this._min),0,1),e?(this.tween=new Bf({t:this._animatedRatio}),this.tween.to({t:this._ratio},e),this.tween.easing(Df.Quadratic.Out).onUpdate((t=>this.updateShader(t.t))).start()):this.updateShader(this._ratio)}destroy(t){var e;null==(e=this.tween)||e.stop(),super.destroy(t)}updateShader(t){this._animatedRatio=t;const e=-.5*Math.PI,r=1.5*Math.PI;let n;n=this.reverse?Ip(r,e,t):Ip(e,r,t),this.uniforms.progress=t,this.fixCap(n)}fixCap(t){this.startCap.position.x=0,this.startCap.position.y=-this.capRadius,this.endCap.x=Math.cos(t)*this.capRadius,this.endCap.y=Math.sin(t)*this.capRadius}updateAnchor(){this.content.x=this.content.x*(.5-this.anchor.x),this.content.y=this.content.y*(.5-this.anchor.y)}hexToShader(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}render(t){this.uniforms.uWorldAlpha=this.worldAlpha,super.render(t)}}var Dp=Object.defineProperty,Np=Object.getOwnPropertySymbols,Fp=Object.prototype.hasOwnProperty,Lp=Object.prototype.propertyIsEnumerable,Bp=(t,e,r)=>e in t?Dp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,kp=(t,e)=>{for(var r in e||(e={}))Fp.call(e,r)&&Bp(t,r,e[r]);if(Np)for(var r of Np(e))Lp.call(e,r)&&Bp(t,r,e[r]);return t},Up=(t,e,r)=>(Bp(t,"symbol"!=typeof e?e+"":e,r),r);class Gp extends jf{constructor(){super(),Up(this,"color"),Up(this,"fadeInTime"),Up(this,"fadeOutTime"),Up(this,"fade"),Up(this,"overallProgress"),Up(this,"progressSettingsBase"),Up(this,"bundleProgressBars",{}),this.fade=new du,this.fade.interactive=!0,this.fade.alpha=0,this.progressSettingsBase={colors:16777215,innerRadius:300,outerRadius:400,anchorX:.5,anchorY:.5,endCap:!1,startCap:!1,initialValue:0},this.overallProgress=new Op(this.progressSettingsBase),this.overallProgress.alpha=0,this.addChild(this.fade),this.addChild(this.overallProgress)}startCovering(){const t=new Bf(this.fade,this.tweens).to({alpha:1},this.fadeInTime).easing(Df.Linear.None).start();return new Bf(this.overallProgress,this.tweens).to({alpha:1},this.fadeInTime).delay(100).easing(Df.Linear.None).start(),Cp.promisify(t).then()}startResolving(){return Promise.resolve(void 0)}startUncovering(){this.tweens.removeAll(),new Bf(this.overallProgress,this.tweens).to({alpha:0},this.fadeOutTime).easing(Df.Linear.None).start();const t=new Bf(this.fade,this.tweens).to({alpha:0},this.fadeOutTime).easing(Df.Linear.None).start();return Cp.promisify(t).then()}onDownloadProgress(t,e){this.overallProgress.updateValue(t,300);const r=Object.keys(e).sort();if(1!=r.length)for(let n=0;n<r.length;n++){if(void 0===this.bundleProgressBars[r[n]]){const t=kp({},this.progressSettingsBase);t.outerRadius=290-30*n,t.innerRadius=t.outerRadius-20;const e=new Op(t);this.overallProgress.addChild(e),this.bundleProgressBars[r[n]]=e}this.bundleProgressBars[r[n]].updateValue(e[r[n]],300)}}onResize(t,e){this.fade.clear(),this.fade.beginFill(this.color,1),this.fade.drawRect(0,0,t,e),this.fade.endFill(),hp.setScaleRelativeToScreen(this.overallProgress,t,e,.5,.25),this.overallProgress.x=t/2,this.overallProgress.y=e/2}}S.RENDER_OPTIONS.hello=!1,Lf.safetyCheckFunction=t=>!(null==t?void 0:t.destroyed);const jp={backgroundColor:0,width:hp.IDEAL_WIDTH,resolution:window.devicePixelRatio||1,autoDensity:!0,height:hp.IDEAL_HEIGHT,autoStart:!1,view:document.getElementById("pixi-canvas"),interactionTestsAllScenes:!0};document.getElementById("pixi-content").style.background="#000000",document.getElementById("pixi-content").appendChild(jp.view),window.addEventListener("touchmove",(function(t){t.preventDefault()}),{capture:!1,passive:!1}),function(t=[Vf.UP_ARROW,Vf.DOWN_ARROW,Vf.RIGHT_ARROW,Vf.LEFT_ARROW,Vf.ENTER,Vf.SPACE]){document.addEventListener("keydown",(e=>{(t.includes(e.code)||t.includes(Hf[e.keyCode]))&&e.preventDefault()}))}(),document.addEventListener("click",(()=>window.focus())),document.addEventListener("mouseup",(()=>window.focus())),document.addEventListener("pointerup",(()=>window.focus())),document.addEventListener("touchend",(()=>window.focus())),document.addEventListener("touchstart",(()=>window.focus())),document.addEventListener("pointerup",(()=>window.focus())),document.addEventListener("mouseup",(()=>window.focus())),document.addEventListener("pointerdown",(()=>window.focus())),document.addEventListener("mousedown",(()=>window.focus()));const Vp=new class{constructor(t,e=new li){tp(this,"pauseGlobalTweenOnFocusLost",!0),tp(this,"pauseSoundOnFocusLost",!0),tp(this,"destroyGlobalTweensOnSceneChange",!0),tp(this,"removeKeyboardEventsOnSceneChange",!0),tp(this,"closeAllScenesOnSceneChange",!1),tp(this,"defaultTransition",jf),tp(this,"defaultTransitionParams",[]),tp(this,"sceneRenderer"),tp(this,"popupQueue",[]),tp(this,"popupQueueParams",[]),tp(this,"mainScene"),tp(this,"currentScenes"),tp(this,"currentPopups"),tp(this,"currentTransition",null),tp(this,"lockScene"),tp(this,"preferredOrientation","portrait"),tp(this,"currentOrientation","portrait"),tp(this,"ticker"),tp(this,"hasFocus",!0),tp(this,"stats"),tp(this,"updateTimeStats"),tp(this,"_isChangingScene",!1),tp(this,"initializedAssets"),this.initializedAssets=this.initAssets(),this.sceneRenderer=t,this.ticker=e,this.currentPopups=[],this.currentScenes=[],window.addEventListener("pointerdown",(()=>{this.hasFocus||this.focus()})),window.addEventListener("focus",this.focus.bind(this)),window.addEventListener("blur",this.focusLost.bind(this)),window.addEventListener("message",this.postMessage.bind(this)),this.ticker.add(this.update,this),this.ticker.start(),Af&&(this.stats=new(Jf()),this.updateTimeStats=this.stats.addPanel(new(Jf().Panel)("UPD %","#ff8","#221")),this.stats.showPanel(0),document.body.appendChild(this.stats.dom))}get width(){return this.sceneRenderer.width}get height(){return this.sceneRenderer.height}get devicePixelRatio(){return this.sceneRenderer.devicePixelRatio}get minAllowedFPS(){return this.ticker.minFPS}set minAllowedFPS(t){this.ticker.minFPS=t}get globalDtScale(){return this.ticker.speed}set globalDtScale(t){this.ticker.speed=t}get dt(){return this.ticker.deltaMS}get numPopupsOpen(){return this.currentPopups.length}get numScenesOpen(){return this.currentScenes.length}get isChangingScene(){return this._isChangingScene}changeScene(t,e){return ep(this,null,(function*(){var r;const{transitionClass:n,transitionParams:i}=e||{};let{sceneParams:s}=e||{};this._isChangingScene=!0,this.currentTransition&&this.destroyScene(this.currentTransition);let o=this.defaultTransition,a=this.defaultTransitionParams;n&&(a=i,n instanceof Promise?(o=yield this.extractSceneFromPromise(n),this.currentTransition=i?new o(...i):new o):o=n),yield this.loadAssetBundles(o,void 0,!0),this.currentTransition=a?new o(...a):new o,this.currentTransition.onResize(this.width,this.height),this.currentTransition.events.emit($f.START),this.currentTransition.onStart(),this.currentTransition.events.emit($f.SHOW),this.currentTransition.onShow(),yield this.currentTransition.startCovering(),this.destroyGlobalTweensOnSceneChange&&Of.shared.removeAll(),this.removeKeyboardEventsOnSceneChange&&Yf.shared.removeAllListeners(),this.closeAllScenesOnSceneChange?this.closeAllScenes():this.mainScene&&this.mainScene.closeHandler();const{overrideScene:l,overrideSceneParams:h}=null!=(r=yield this.currentTransition.startResolving())?r:{};return null!=l&&(t=l),null!=h&&(s=h),this.mainScene=yield this.openScene(t,{sceneParams:s,skipShowCall:!0,onBundleDownloadProgress:this.currentTransition.onDownloadProgress.bind(this.currentTransition)}),this.currentTransition.startUncovering().then((()=>{var t,e;this._isChangingScene=!1,null==(t=this.mainScene)||t.events.emit($f.SHOW),null==(e=this.mainScene)||e.onShow(),this.destroyScene(this.currentTransition),this.currentTransition=null})),this.mainScene}))}setRotateScene(t,e,r){this.preferredOrientation=t,this.lockScene&&(this.lockScene.events.emit($f.DESTROY),this.lockScene.onDestroy(null),this.destroyScene(this.lockScene)),this.lockScene=new e(...r),this.lockScene.onResize(this.width,this.height),this.lockScene.events.emit($f.START),this.lockScene.onStart()}isOrientationCorect(){return!this.lockScene||(this.currentOrientation=this.width>this.height?"landscape":"portrait",this.currentOrientation==this.preferredOrientation)}queuePopup(t,e){this.currentPopups.length>0?(this.popupQueue.push(t),this.popupQueueParams.push(null!=e?e:[])):this.openPopup(t,e)}openPopup(t,e,r=!0){return ep(this,null,(function*(){var n,i;if(!1===r&&this.currentPopups.length>0)return null;let s;s=t instanceof Promise?yield this.extractSceneFromPromise(t):t,yield this.loadAssetBundles(s);const o=null!=e&&null!=e?new s(...e):new s;o.events.emit($f.NEW);for(const t of this.currentScenes)t.onPopupOpen(o,e);null==(n=this.currentTransition)||n.onPopupOpen(o,e),null==(i=this.lockScene)||i.onPopupOpen(o,e);for(const t of this.currentPopups)t.onPopupOpen(o,e);return o.closeHandler=this.closePopup.bind(this,o,s),this.currentPopups.push(o),o.onResize(this.width,this.height),o.events.emit($f.START),o.onStart(),o.events.emit($f.SHOW),o.onShow(),o}))}closePopup(t,e,r){var n,i;if(this.currentPopups.includes(t)){e||(e=t.constructor),t.events.emit($f.DESTROY),t.onDestroy(null),this.currentPopups.includes(t)&&this.currentPopups.splice(this.currentPopups.indexOf(t),1),this.destroyScene(t);for(const t of this.currentScenes)t.onPopupClose(e,r);null==(n=this.currentTransition)||n.onPopupClose(e,r),null==(i=this.lockScene)||i.onPopupClose(e,r);for(const t of this.currentPopups)t.onPopupClose(e,r)}}requestClosePopup(t,e){return ep(this,null,(function*(){const{timeout:r,force:n}=null!=e?e:{};let i;if(r){const e=Promise.race([t.requestClose(),new Promise((t=>setTimeout((()=>t("timeout")),r)))]);i=yield e.then((e=>"string"==typeof e?(this.closePopup(t),!0):e))}else i=yield t.requestClose();return!i&&n?(this.closePopup(t),!0):i}))}requestCloseAllPopups(t){return Promise.all(this.currentPopups.map((e=>this.requestClosePopup(e,t))))}closeAllPopups(){let t=this.currentPopups.length;for(;t-- >0;)this.closePopup(this.currentPopups[t])}openScene(t,e){return ep(this,null,(function*(){var r,n;const{sceneParams:i,skipShowCall:s,onBundleDownloadProgress:o}=e||{};let a;a=t instanceof Promise?yield this.extractSceneFromPromise(t):t,yield this.loadAssetBundles(a,o);const l=null!=i&&null!=i?new a(...i):new a;l.events.emit($f.NEW);for(const t of this.currentScenes)t.onSceneOpen(l,i);null==(r=this.currentTransition)||r.onSceneOpen(l,i),null==(n=this.lockScene)||n.onSceneOpen(l,i);for(const t of this.currentPopups)t.onSceneOpen(l,i);return l.closeHandler=this.closeScene.bind(this,l,a),this.currentScenes.push(l),l.onResize(this.width,this.height),l.events.emit($f.START),l.onStart(),s||(l.events.emit($f.SHOW),l.onShow()),l}))}closeScene(t,e,r){var n,i;if(this.currentScenes.includes(t)){null!=e&&null!=e||(e=t.constructor),t.events.emit($f.DESTROY),t.onDestroy(null),this.currentScenes.includes(t)&&this.currentScenes.splice(this.currentScenes.indexOf(t),1),this.destroyScene(t);for(const t of this.currentScenes)t.onSceneClose(e,r);null==(n=this.currentTransition)||n.onSceneClose(e,r),null==(i=this.lockScene)||i.onSceneClose(e,r);for(const t of this.currentPopups)t.onSceneClose(e,r)}}requestCloseScene(t,e){return ep(this,null,(function*(){const{timeout:r,force:n}=null!=e?e:{};let i;if(r){const e=Promise.race([t.requestClose(),new Promise((t=>setTimeout((()=>t("timeout")),r)))]);i=yield e.then((e=>"string"==typeof e?(this.closeScene(t),!0):e))}else i=yield t.requestClose();return!i&&n?(this.closeScene(t),!0):i}))}requestCloseAllscenes(t){return Promise.all(this.currentScenes.map((e=>this.requestCloseScene(e,t))))}closeAllScenes(){let t=this.currentScenes.length;for(;t-- >0;)this.closeScene(this.currentScenes[t])}resize(t,e,r){var n,i;this.sceneRenderer.resize(t,e,r);for(const s of this.currentScenes)s.onResize(t,e);null==(n=this.currentTransition)||n.onResize(t,e),null==(i=this.lockScene)||i.onResize(t,e);for(const s of this.currentPopups)s.onResize(t,e)}update(){var t,e,r,n,i,s,o,a,l,h,u,c;let d=0,f=0;Af&&(null==(t=this.stats)||t.begin(),d=(performance||Date).now());const p=this.ticker.deltaMS;this.pauseGlobalTweenOnFocusLost&&!this.hasFocus||Of.shared.update(p);for(const m of this.currentScenes)m.pauseUpdateOnFocusLost&&!this.hasFocus||m.update(p),m.pauseTweenOnFocusLost&&!this.hasFocus||m.tweens.update(p);(null==(e=this.currentTransition)?void 0:e.pauseUpdateOnFocusLost)&&!this.hasFocus||null==(r=this.currentTransition)||r.update(p),(null==(n=this.currentTransition)?void 0:n.pauseTweenOnFocusLost)&&!this.hasFocus||null==(s=null==(i=this.currentTransition)?void 0:i.tweens)||s.update(p),(null==(o=this.lockScene)?void 0:o.pauseUpdateOnFocusLost)&&!this.hasFocus||null==(a=this.lockScene)||a.update(p),(null==(l=this.lockScene)?void 0:l.pauseTweenOnFocusLost)&&!this.hasFocus||null==(u=null==(h=this.lockScene)?void 0:h.tweens)||u.update(p);for(const m of this.currentPopups)m.pauseUpdateOnFocusLost&&!this.hasFocus||m.update(p),m.pauseTweenOnFocusLost&&!this.hasFocus||m.tweens.update(p);if(Af&&(f=(performance||Date).now()),this.render(),Af){null==(c=this.stats)||c.end();const t=(performance||Date).now(),e=t-d,r=(e-(t-f))/e;this.updateTimeStats.update(Math.round(100*r),100)}}render(){this.sceneRenderer.preRender&&this.sceneRenderer.preRender(),this.currentScenes=Kf(this.currentScenes,((t,e)=>{var r,n;return(null!=(r=t.index)?r:0)-(null!=(n=e.index)?n:0)})),this.currentScenes.forEach(this.sceneRenderer.renderScene.bind(this.sceneRenderer)),this.currentTransition&&this.sceneRenderer.renderScene(this.currentTransition),this.currentPopups=Kf(this.currentPopups,((t,e)=>{var r,n;return(null!=(r=t.index)?r:0)-(null!=(n=e.index)?n:0)})),this.currentPopups.forEach(this.sceneRenderer.renderScene.bind(this.sceneRenderer)),this.isOrientationCorect()||this.sceneRenderer.renderScene(this.lockScene),this.sceneRenderer.postRender&&this.sceneRenderer.postRender()}focus(){var t,e;this.hasFocus=!0,this.pauseSoundOnFocusLost&&ed._context.muted&&ed.unmuteAll();for(const r of this.currentScenes)r.onFocus();null==(t=this.currentTransition)||t.onFocus(),null==(e=this.lockScene)||e.onFocus();for(const r of this.currentPopups)r.onFocus()}focusLost(){var t,e;this.hasFocus=!1,this.pauseSoundOnFocusLost&&(ed._context.muted||ed.muteAll());for(const r of this.currentScenes)r.onFocusLost();null==(t=this.currentTransition)||t.onFocusLost(),null==(e=this.lockScene)||e.onFocusLost();for(const r of this.currentPopups)r.onFocusLost()}postMessage(t){var e,r;for(const n of this.currentScenes)n.onMessage(t);null==(e=this.currentTransition)||e.onMessage(t),null==(r=this.lockScene)||r.onMessage(t);for(const n of this.currentPopups)n.onMessage(t)}externalPause(){var t,e;ed._context.paused||ed.pauseAll(),this.sceneRenderer.externalPause&&this.sceneRenderer.externalPause();for(const r of this.currentScenes)r.onPause();null==(t=this.currentTransition)||t.onPause(),null==(e=this.lockScene)||e.onPause();for(const r of this.currentPopups)r.onPause()}externalResume(){var t,e;this.sceneRenderer.externalResume&&this.sceneRenderer.externalResume(),ed._context.paused&&ed.resumeAll();for(const r of this.currentScenes)r.onResume();null==(t=this.currentTransition)||t.onResume(),null==(e=this.lockScene)||e.onResume();for(const r of this.currentPopups)r.onResume()}destroyScene(t){t.closeHandler=()=>{},t.destroy()}setDefaultTransition(t,e){this.defaultTransition=t,this.defaultTransitionParams=null!=e?e:[]}extractSceneFromPromise(t){return ep(this,null,(function*(){const e=yield t;for(const t in e)if(t.toLowerCase().includes("scene"))return e[t];throw new Error("Could not find a scene in the package")}))}loadAssetBundles(t,e,r){return ep(this,null,(function*(){if(yield this.initializedAssets,t.BUNDLES){let r=0,n=t.BUNDLES;n.includes("*")&&(n=Object.keys(ls.resolver._bundles));const i={};n.forEach((t=>i[t]=0));const s=[];for(const t of n)s.push(ls.loadBundle(t,(s=>{e&&(r+=s,i[t]=s,e(r/n.length,i))})));yield Promise.all(s)}}))}initAssets(){return ep(this,null,(function*(){ls.init({defaultSearchParams:{v:bf}});const[t,e]=yield Promise.all([ls.load("./assets.json"),ls.load("./atlas/autoPackedAtlas.json")]);for(const r of e){const e=`ATLAS:${r.name}`,n=t.bundles.find((t=>t.name==r.name));n?Array.isArray(n.assets)?n.assets.push({name:e,srcs:r.url}):n.assets[e]=r.url:t.bundles.push({name:r.name,assets:{[e]:r.url}})}ls.reset(),yield ls.init({manifest:t,defaultSearchParams:{v:bf}}),yield ls.loadBundle("initialLoad")}))}}(new class{constructor(t,e){var r;gp(this,"width"),gp(this,"height"),gp(this,"devicePixelRatio"),gp(this,"letterboxScale"),gp(this,"pixiRenderer"),gp(this,"inputCatcher"),Ir.defaultFragmentPrecision=x.HIGH,this.devicePixelRatio=null!=(r=t.resolution)?r:devicePixelRatio||1,this.width=t.width,this.height=t.height;const n=Object.assign({clearBeforeRender:!1},t);this.pixiRenderer=ci(n),this.letterboxScale=Boolean(e),this.inputCatcher=new Es,t.interactionTestsAllScenes&&Object.defineProperty(this.pixiRenderer,"lastObjectRendered",{get:()=>this.inputCatcher}),Ef&&(globalThis.__PIXI_RENDERER__=this.pixiRenderer)}get canvas(){return this.pixiRenderer.view}get backgroundColor(){var t;const e=null!=(t=this.pixiRenderer.background.colorRgba)?t:[0,0,0,0];return{r:e[0],g:e[1],b:e[2],a:e[3]}}set backgroundColor(t){this.pixiRenderer.background.color=t.r<<16|t.g<<8|t.b,this.pixiRenderer.background.alpha=t.a}preRender(){"clear"in this.pixiRenderer&&this.pixiRenderer.clear(),this.inputCatcher.removeChildren()}postRender(){}renderScene(t){let e=!1;if(t.stages)for(const r of t.stages)r&&r instanceof Es&&(this.pixiRenderer.render(r),e=!0,r.interactiveChildren&&this.inputCatcher.addChild(r))}resize(t,e,r){if(document.getElementById("viewport").setAttribute("content","width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover"),this.devicePixelRatio=r||1,this.width=t,this.height=e,this.letterboxScale){this.width=hp.IDEAL_WIDTH,this.height=hp.IDEAL_HEIGHT;const r=this.pixiRenderer.view,n=Math.min(t/hp.IDEAL_WIDTH,e/hp.IDEAL_HEIGHT);r.style.width=`${Math.floor(n*hp.IDEAL_WIDTH)}px`,r.style.height=`${Math.floor(n*hp.IDEAL_HEIGHT)}px`,r.style.marginLeft=r.style.marginRight=(t-Math.floor(n*hp.IDEAL_WIDTH))/2+"px",r.style.marginTop=r.style.marginBottom=(e-Math.floor(n*hp.IDEAL_HEIGHT))/2+"px"}else this.devicePixelRatio=r||1,this.width=t,this.height=e,this.pixiRenderer.resolution=this.devicePixelRatio,this.pixiRenderer.resize(t,e)}externalPause(){this.pixiRenderer.plugins.interaction.useSystemTicker=!1}externalResume(){this.pixiRenderer.plugins.interaction.useSystemTicker=!0}getDetails(){return`Pixi Renderer - PixiJS v${Mi}`}}(jp)),Hp=new class{constructor(t,e=Ro.main){this._autoUpdate=!0,this._allowControl=!0,this._camera=Ro.main,this._target={x:0,y:0,z:0},this._angles=new ur((()=>{this._angles.x=Math.min(Math.max(-85,this._angles.x),85)}),void 0,0,180),this._distance=5,this._enableDamping=!1,this._dampingFactor=.1,this._grabbed=!1,this._previousPinchDistance=0,this._previousClientX=0,this._previousClientY=0,this._dampingAngles={x:0,y:180},this._dampingDistance=5,this.onPointerDown=(t,e)=>{this._grabbed=!0,this._previousClientX=t,this._previousClientY=e},this.onPointerUp=()=>{this._grabbed=!1},this.onPointerMove=(t,e)=>{if(this._grabbed){const r=t-this._previousClientX,n=e-this._previousClientY;this.angles.x+=.5*n,this.angles.y-=.5*r,this.updateCamera(),this._previousClientX=t,this._previousClientY=e}},this.onPreRender=()=>{this.autoUpdate&&this.updateCamera()},this.onMouseDownInteraction=t=>{var e,r,n;if(this.allowControl&&!t.stopped){this._grabbed=!0;const i=t.data.originalEvent,s=i,o=null==(e=null==i?void 0:i.targetTouches)?void 0:e[0],a=null!=(r=null==o?void 0:o.clientX)?r:null==s?void 0:s.clientX,l=null!=(n=null==o?void 0:o.clientY)?n:null==s?void 0:s.clientY;this.onPointerDown(a,l)}},this.onMouseDown=t=>{this.allowControl&&this.onPointerDown(t.clientX,t.clientY)},this.onMouseMove=t=>{this.allowControl&&1===t.buttons&&this.onPointerMove(t.clientX,t.clientY)},this.onMouseUp=t=>{this.allowControl&&this.onPointerUp()},this.onWheel=t=>{this.allowControl&&(this.distance+=.01*t.deltaY,t.preventDefault(),this.updateCamera())},this.onTouchStart=t=>{var e;if(this.allowControl){const r=null==(e=null==t?void 0:t.targetTouches)?void 0:e[0];if(r){const t=r.clientX,e=r.clientY;this.onPointerDown(t,e)}2===t.touches.length&&(t.preventDefault(),this._previousPinchDistance=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY))}},this.onPinch=t=>{if(this.allowControl){t.preventDefault();const e=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY),r=e-this._previousPinchDistance;this.distance-=.1*r,this.updateCamera(),this._previousPinchDistance=e}},this.onTouchMove=t=>{var e;if(this.allowControl){const r=null==(e=null==t?void 0:t.targetTouches)?void 0:e[0];if(1===t.touches.length&&r){const t=r.clientX,e=r.clientY;this.onPointerMove(t,e)}2===t.touches.length&&this.onPinch(t)}},this.onTouchEnd=t=>{this.allowControl&&0===t.touches.length&&this.onPointerUp()},this._element=t,this._camera=e,this.bind()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){this._autoUpdate=t}get allowControl(){return this._allowControl}set allowControl(t){this._allowControl=t}get camera(){return this._camera}set camera(t){this._camera=t}get target(){return this._target}set target(t){this._target=t}get angles(){return this._angles}get distance(){return this._distance}set distance(t){this._distance=Math.min(Math.max(t,.01),Number.MAX_SAFE_INTEGER)}get enableDamping(){return this._enableDamping}set enableDamping(t){this._enableDamping=t}get dampingFactor(){return this._dampingFactor}set dampingFactor(t){this._dampingFactor=t}destroy(){this.unbind()}bind(){this.camera.renderer.on("prerender",this.onPreRender);let t=Ms.getInteractionPlugin(this.camera.renderer);t&&t.on("mousedown",this.onMouseDownInteraction),this._element.addEventListener("mousedown",this.onMouseDown),this._element.addEventListener("touchstart",this.onTouchStart),this._element.addEventListener("wheel",this.onWheel),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd)}unbind(){this._element.removeEventListener("mousedown",this.onMouseDown),this._element.removeEventListener("touchstart",this.onTouchStart),this._element.removeEventListener("wheel",this.onWheel),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}updateCamera(){this.enableDamping&&(this._dampingAngles.x+=(this.angles.x-this._dampingAngles.x)*this.dampingFactor,this._dampingAngles.y+=(this.angles.y-this._dampingAngles.y)*this.dampingFactor,this._dampingDistance+=(this.distance-this._dampingDistance)*this.dampingFactor);const t=this.enableDamping?this._dampingAngles:this.angles,e=this.enableDamping?this._dampingDistance:this.distance,r=co.fromEuler(t.x,t.y,0,new Float32Array(4)),n=uo.transformQuat(uo.set(0,0,1,new Float32Array(3)),r,new Float32Array(3)),i=uo.subtract(uo.set(this.target.x,this.target.y,this.target.z,new Float32Array(3)),uo.scale(n,e,new Float32Array(3)),new Float32Array(3));this.camera.position.set(i[0],i[1],i[2]),this.camera.rotationQuaternion.set(r[0],r[1],r[2],r[3])}}(jp.view);if(sp.initialize(new class{constructor(t){fp(this,"cryptoKey"),fp(this,"internalMap",{}),this.cryptoKey=t}xorCrypt(t){if(!this.cryptoKey)return t;let e="";for(let r=0;r<t.length;++r)e+=String.fromCharCode(t.charCodeAt(r)^this.cryptoKey.charCodeAt(r%this.cryptoKey.length));return e}save(t){return pp(this,null,(function*(){yield cp().setItem(t,this.xorCrypt(JSON.stringify(this.internalMap)))}))}load(t){return pp(this,null,(function*(){try{this.internalMap=JSON.parse(this.xorCrypt(yield cp().getItem(t))),this.internalMap||(this.internalMap={})}catch(e){this["delete"](t)}}))}setSavedataVersion(t,e){return pp(this,null,(function*(){yield cp().setItem(`${e}_VERSION`,t)}))}getSavedataVersion(t){return pp(this,null,(function*(){return yield cp().getItem(`${t}_VERSION`)}))}"delete"(t){return pp(this,null,(function*(){this.internalMap={},yield this.save(t)}))}getValue(t){return this.internalMap[t]}setValue(t,e){return this.internalMap[t]=e,e}},Sf),sp.load(),Ef)for(const i in r);window.addEventListener("resize",(()=>{const t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight,window.innerHeight||0);Vp.resize(t,e,window.devicePixelRatio||1)})),window.dispatchEvent(new Event("resize"));const zp=function(){Vp.changeScene(Sp,{transitionClass:Gp})};Rf?Ep.initialize().then((()=>zp())):zp()})()})();